[
   {
      "disabled" : false,
      "type" : "tab",
      "info" : "",
      "label" : "Home Automation",
      "id" : "8bb76918.ef6b48"
   },
   {
      "info" : "",
      "label" : "Location Tracking",
      "id" : "46ed0d55.4c98b4",
      "type" : "tab",
      "disabled" : false
   },
   {
      "disabled" : false,
      "type" : "tab",
      "info" : "",
      "label" : "Security",
      "id" : "af1cc9bd.91cc08"
   },
   {
      "disabled" : false,
      "type" : "tab",
      "info" : "",
      "id" : "20661f8a.532c4",
      "label" : "Utilities"
   },
   {
      "type" : "tab",
      "id" : "7d04740a.ad6adc",
      "info" : "",
      "label" : "Dashboard",
      "disabled" : false
   },
   {
      "disabled" : false,
      "id" : "e0703c90.1a341",
      "info" : "",
      "label" : "Dev",
      "type" : "tab"
   },
   {
      "type" : "subflow",
      "name" : "Family home or guest mode on?",
      "info" : "",
      "id" : "c663f7df.ca58b8",
      "in" : [
         {
            "wires" : [
               {
                  "id" : "d2c9201e.f640e"
               }
            ],
            "y" : 560,
            "x" : 40
         }
      ],
      "out" : [
         {
            "wires" : [
               {
                  "port" : 1,
                  "id" : "caba1d6f.2e38"
               }
            ],
            "y" : 560,
            "x" : 1060
         }
      ]
   },
   {
      "outputLabels" : [
         "Left Zone",
         "Entered new zone apart from spouse"
      ],
      "id" : "7ae32389.5d604c",
      "inputLabels" : [
         "Device tracker event"
      ],
      "name" : "Format payload and geozone logic",
      "type" : "subflow",
      "info" : "",
      "in" : [
         {
            "x" : 40,
            "wires" : [
               {
                  "id" : "bdfc4800.593338"
               }
            ],
            "y" : 40
         }
      ],
      "out" : [
         {
            "x" : 820,
            "wires" : [
               {
                  "id" : "516c338e.65601c",
                  "port" : 0
               }
            ],
            "y" : 120
         },
         {
            "wires" : [
               {
                  "port" : 0,
                  "id" : "4fbed005.8d064"
               }
            ],
            "y" : 40,
            "x" : 1240
         }
      ]
   },
   {
      "out" : [
         {
            "x" : 1315.49995040894,
            "y" : 438.714291572571,
            "wires" : [
               {
                  "port" : 0,
                  "id" : "418d9d7f.f1b724"
               }
            ]
         },
         {
            "y" : 260,
            "wires" : [
               {
                  "id" : "53da29f5.9c6808",
                  "port" : 1
               }
            ],
            "x" : 360
         }
      ],
      "in" : [
         {
            "wires" : [
               {
                  "id" : "53da29f5.9c6808"
               }
            ],
            "y" : 151.071425437927,
            "x" : 34.9999961853027
         }
      ],
      "outputLabels" : [
         "Speak, no guests, normal output",
         "No speaks, guest mode on, continue flow"
      ],
      "info" : "",
      "id" : "837bbace.420028",
      "type" : "subflow",
      "name" : "Voice Alerts"
   },
   {
      "name" : "Play theme song",
      "type" : "subflow",
      "info" : "",
      "id" : "63316ec5.c01aa",
      "in" : [
         {
            "x" : 40,
            "wires" : [
               {
                  "id" : "fdcc21e8.0b72"
               }
            ],
            "y" : 60
         }
      ],
      "out" : [
         {
            "y" : 320,
            "wires" : [
               {
                  "port" : 0,
                  "id" : "96f71b34.5ea358"
               }
            ],
            "x" : 1560
         }
      ]
   },
   {
      "id" : "3844d016.18a29",
      "info" : "",
      "name" : "Guest mode on?",
      "type" : "subflow",
      "out" : [
         {
            "wires" : [
               {
                  "port" : 1,
                  "id" : "c61527c3.d75f98"
               }
            ],
            "y" : 200,
            "x" : 1080
         }
      ],
      "in" : [
         {
            "x" : 240,
            "wires" : [],
            "y" : 200
         }
      ]
   },
   {
      "in" : [
         {
            "wires" : [
               {
                  "id" : "5904fbc7.300974"
               }
            ],
            "y" : 300,
            "x" : 80
         }
      ],
      "out" : [
         {
            "y" : 300,
            "wires" : [
               {
                  "port" : 1,
                  "id" : "2c2c6211.b4bd2e"
               }
            ],
            "x" : 980
         }
      ],
      "type" : "subflow",
      "name" : "Family away?",
      "info" : "",
      "id" : "2283eff7.ee9ab"
   },
   {
      "type" : "subflow",
      "name" : "Device offline for four hours",
      "id" : "10fa16ea.e265b9",
      "info" : "",
      "in" : [
         {
            "y" : 720,
            "wires" : [
               {
                  "id" : "211c28b0.54bb88"
               }
            ],
            "x" : 200
         }
      ],
      "out" : []
   },
   {
      "in" : [
         {
            "x" : 120,
            "y" : 720,
            "wires" : [
               {
                  "id" : "e1f63ff3.8f1c2"
               }
            ]
         }
      ],
      "out" : [
         {
            "y" : 740,
            "wires" : [
               {
                  "id" : "59f4f478.f3441c",
                  "port" : 0
               }
            ],
            "x" : 1040
         }
      ],
      "name" : "ZWave Stats",
      "type" : "subflow",
      "id" : "e7369e7e.c4997",
      "info" : ""
   },
   {
      "pass" : "your-api-password",
      "url" : "https://your-hostname.duckdns.org:8123",
      "z" : "",
      "id" : "e2a02faf.48099",
      "type" : "server",
      "name" : "Home Assistant"
   },
   {
      "id" : "4238db6e.227ed4",
      "keepalive" : "60",
      "birthPayload" : "",
      "broker" : "localhost",
      "cleansession" : true,
      "compatmode" : false,
      "willPayload" : "",
      "type" : "mqtt-broker",
      "willTopic" : "",
      "port" : "1883",
      "willQos" : "0",
      "birthQos" : "0",
      "birthTopic" : "",
      "z" : "",
      "clientid" : "node-red",
      "usetls" : false
   },
   {
      "caname" : "",
      "id" : "849977e5.257f68",
      "cert" : "",
      "key" : "",
      "type" : "tls-config",
      "keyname" : "",
      "name" : "HASS-TLS",
      "certname" : "",
      "ca" : "",
      "z" : "",
      "verifyservercert" : false
   },
   {
      "z" : "",
      "order" : 2,
      "icon" : "dashboard",
      "id" : "ac8be8.7ad34418",
      "type" : "ui_tab",
      "name" : "Home"
   },
   {
      "id" : "ea10f06.a52e21",
      "collapse" : false,
      "type" : "ui_group",
      "tab" : "ac8be8.7ad34418",
      "name" : "Environmental",
      "width" : "6",
      "order" : 1,
      "disp" : true,
      "z" : ""
   },
   {
      "type" : "ui_base",
      "id" : "baaae33d.2423a",
      "site" : {
         "dateFormat" : "DD/MM/YYYY",
         "hideToolbar" : "true",
         "allowSwipe" : "false",
         "sizes" : {
            "cx" : 6,
            "py" : 0,
            "gy" : 6,
            "sy" : 96,
            "gx" : 6,
            "cy" : 6,
            "px" : 0,
            "sx" : 96
         },
         "name" : "Home Assistant Graphs"
      },
      "theme" : {
         "customTheme" : {
            "baseColor" : "#4B7930",
            "baseFont" : "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
            "name" : "Untitled Theme 1",
            "default" : "#4B7930"
         },
         "darkTheme" : {
            "default" : "#097479",
            "reset" : false,
            "baseFont" : "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
            "baseColor" : "#097479",
            "edited" : true
         },
         "themeState" : {
            "widget-textColor" : {
               "edited" : false,
               "value" : "#eeeeee"
            },
            "group-textColor" : {
               "edited" : false,
               "value" : "#0eb8c0"
            },
            "widget-backgroundColor" : {
               "value" : "#097479",
               "edited" : false
            },
            "base-color" : {
               "default" : "#097479",
               "edited" : false,
               "value" : "#097479"
            },
            "base-font" : {
               "value" : "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "page-titlebar-backgroundColor" : {
               "value" : "#097479",
               "edited" : false
            },
            "group-borderColor" : {
               "value" : "#555555",
               "edited" : false
            },
            "widget-borderColor" : {
               "edited" : false,
               "value" : "#333333"
            },
            "page-backgroundColor" : {
               "edited" : false,
               "value" : "#111111"
            },
            "group-backgroundColor" : {
               "value" : "#333333",
               "edited" : false
            },
            "page-sidebar-backgroundColor" : {
               "edited" : false,
               "value" : "#000000"
            }
         },
         "lightTheme" : {
            "default" : "#0094CE",
            "reset" : false,
            "baseFont" : "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
            "baseColor" : "#0094CE",
            "edited" : true
         },
         "name" : "theme-dark"
      }
   },
   {
      "disp" : true,
      "order" : 2,
      "z" : "",
      "type" : "ui_group",
      "tab" : "ac8be8.7ad34418",
      "name" : "Batteries",
      "width" : "6",
      "collapse" : false,
      "id" : "2a707ff1.43daa"
   },
   {
      "id" : "ba683c3d.a294c",
      "collapse" : false,
      "width" : "6",
      "type" : "ui_group",
      "tab" : "ac8be8.7ad34418",
      "name" : "Z-Wave",
      "z" : "",
      "disp" : true,
      "order" : 3
   },
   {
      "haltifstate" : "",
      "x" : 130,
      "type" : "server-state-changed",
      "name" : "Garage Entry Door South",
      "entityidfiltertype" : "exact",
      "entityidfilter" : "sensor.garage_entry_door_south_access_control",
      "wires" : [
         [
            "3a8d7ef3.299a02"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "1a0e0be.bd5b6f4",
      "server" : "e2a02faf.48099",
      "y" : 280
   },
   {
      "outputLabels" : [
         "Open",
         "Closed"
      ],
      "property" : "payload",
      "id" : "3a8d7ef3.299a02",
      "y" : 320,
      "rules" : [
         {
            "v" : "22",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "v" : "23",
            "vt" : "str"
         }
      ],
      "name" : "Door Open",
      "type" : "switch",
      "x" : 350,
      "propertyType" : "msg",
      "z" : "8bb76918.ef6b48",
      "checkall" : "true",
      "outputs" : 2,
      "wires" : [
         [
            "bbd5969b.0b3d18",
            "39ebd578.aa60fa",
            "59d7405f.fa55b",
            "987a7121.805bf"
         ],
         []
      ]
   },
   {
      "y" : 280,
      "id" : "39ebd578.aa60fa",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "dca506ce.6a1fc8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "name" : "If Garage Stair Lights Off",
      "type" : "api-current-state",
      "entity_id" : "light.stairs",
      "x" : 630,
      "halt_if" : "on"
   },
   {
      "type" : "api-call-service",
      "name" : "Main Level Lights on",
      "x" : 980,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "service_domain" : "scene",
      "id" : "b621c0a7.2c659",
      "server" : "e2a02faf.48099",
      "y" : 440,
      "data" : "{ \"entity_id\": \"scene.main_level_lights\" }"
   },
   {
      "service_domain" : "climate",
      "id" : "bbe74c77.d0d3a",
      "server" : "e2a02faf.48099",
      "y" : 320,
      "data" : "{ \"entity_id\": \"climate.hallway_nest\", \"temperature\": 72 }",
      "type" : "api-call-service",
      "name" : "Turn on heat",
      "x" : 950,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "set_temperature"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "3a8d7ef3.299a02"
         ]
      ],
      "entityidfilter" : "sensor.garage_entry_door_north_access_control",
      "haltifstate" : "",
      "x" : 130,
      "entityidfiltertype" : "exact",
      "name" : "Garage Entry Door North",
      "type" : "server-state-changed",
      "y" : 340,
      "server" : "e2a02faf.48099",
      "id" : "f3d3eb4e.a4db78"
   },
   {
      "wires" : [
         [
            "7d00680.09c4698"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "haltifstate" : "",
      "x" : 110,
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "name" : "Garage Door South",
      "entityidfilter" : "sensor.garage_door_south_tilt_alarm_level",
      "y" : 440,
      "id" : "9d716b1f.76be58",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 500,
      "server" : "e2a02faf.48099",
      "id" : "e4398abd.6c2ec8",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "7d00680.09c4698"
         ]
      ],
      "entityidfilter" : "sensor.garage_door_north_tilt_alarm_level",
      "haltifstate" : "",
      "x" : 110,
      "name" : "Garage Door North",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact"
   },
   {
      "y" : 520,
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "property" : "payload",
      "id" : "7d00680.09c4698",
      "z" : "8bb76918.ef6b48",
      "checkall" : "true",
      "outputs" : 2,
      "wires" : [
         [
            "8740e0c5.05e3f",
            "4aeea995.5b1608"
         ],
         [
            "4aeea995.5b1608"
         ]
      ],
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "255"
         },
         {
            "t" : "eq",
            "v" : "0",
            "vt" : "str"
         }
      ],
      "name" : "Motion or Open ",
      "type" : "switch",
      "x" : 340,
      "propertyType" : "msg"
   },
   {
      "entityidfilter" : "sensor.garage_motion_sensor_alarm_level",
      "type" : "server-state-changed",
      "name" : "Garage Motion ",
      "entityidfiltertype" : "exact",
      "haltifstate" : "",
      "x" : 100,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "7d00680.09c4698"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "7530c76d.e29608",
      "y" : 560
   },
   {
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 980,
      "type" : "api-call-service",
      "name" : "Turn on garage lights",
      "data" : "{ \"entity_id\":\"light.garage\"}",
      "y" : 640,
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "8740e0c5.05e3f"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "bbd5969b.0b3d18",
      "y" : 460,
      "halt_if" : "0",
      "x" : 500,
      "name" : "If Garage Stairs Motion Detected",
      "entity_id" : "sensor.garage_stairs_motion_sensor_alarm_level",
      "type" : "api-current-state",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "8740e0c5.05e3f",
            "4aeea995.5b1608",
            "1eee1d2b.7e8613"
         ]
      ]
   },
   {
      "y" : 580,
      "payloadval" : "0",
      "id" : "4aeea995.5b1608",
      "wires" : [
         [
            "ffbd0a93.915c18"
         ],
         []
      ],
      "z" : "8bb76918.ef6b48",
      "type" : "stoptimer",
      "payloadtype" : "num",
      "name" : "10min",
      "x" : 750,
      "duration" : "10",
      "units" : "Minute"
   },
   {
      "data" : "{ \"entity_id\":\"light.garage\"}",
      "y" : 680,
      "server" : "e2a02faf.48099",
      "id" : "ffbd0a93.915c18",
      "service_domain" : "light",
      "service" : "turn_off",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 980,
      "name" : "Turn off garage lights",
      "type" : "api-call-service"
   },
   {
      "y" : 1100,
      "crontab" : "15 07 * * 1,2,3,4,5",
      "id" : "146bfc92.3b9763",
      "once" : false,
      "repeat" : "",
      "wires" : [
         [
            "91165e1b.35eaa",
            "b01b30c3.7ec77",
            "664d125b.7ce1fc"
         ]
      ],
      "payload" : "7:15 on weekdays",
      "z" : "8bb76918.ef6b48",
      "payloadType" : "str",
      "type" : "inject",
      "name" : "",
      "x" : 130,
      "topic" : ""
   },
   {
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 760,
      "type" : "api-call-service",
      "name" : "Turn on Coffee Grinder",
      "data" : "{ \"entity_id\":\"switch.coffee_grinder_switch\" }",
      "y" : 1100,
      "server" : "e2a02faf.48099",
      "id" : "bead0d7e.cf404",
      "service_domain" : "switch"
   },
   {
      "wires" : [
         [
            "124b1ca6.1bbc33",
            "ec29f7b8.4f4088"
         ],
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 550,
      "payloadtype" : "num",
      "type" : "stoptimer",
      "name" : "65 seconds",
      "duration" : "65",
      "units" : "Second",
      "y" : 1140,
      "id" : "a71ae479.af01e8",
      "payloadval" : "0"
   },
   {
      "id" : "124b1ca6.1bbc33",
      "service_domain" : "switch",
      "server" : "e2a02faf.48099",
      "y" : 1140,
      "data" : "{ \"entity_id\":\"switch.coffee_grinder_switch\" }",
      "name" : "Turn off Coffee Grinder",
      "type" : "api-call-service",
      "x" : 760,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_off"
   },
   {
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "name" : "Main Level Lights on",
      "type" : "api-call-service",
      "x" : 1400,
      "mergecontext" : "",
      "y" : 1100,
      "data" : "{ \"entity_id\": \"scene.main_level_lights\" }",
      "service_domain" : "scene",
      "id" : "ce8445.e7feabb8",
      "server" : "e2a02faf.48099"
   },
   {
      "halt_if" : "on",
      "type" : "api-current-state",
      "name" : "If Guest Mode Off",
      "entity_id" : "input_boolean.guest_mode",
      "x" : 470,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "bead0d7e.cf404",
            "f0c63942.6650c8"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "664d125b.7ce1fc",
      "y" : 1100
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "91165e1b.35eaa"
         ]
      ],
      "entityidfilter" : "switch.coffee_grinder_switch",
      "x" : 110,
      "haltifstate" : "off",
      "type" : "server-state-changed",
      "name" : "Coffee Grinder on",
      "entityidfiltertype" : "exact",
      "y" : 1180,
      "server" : "e2a02faf.48099",
      "id" : "40ea396b.d3d228"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "db8011c6.b04b2",
      "y" : 780,
      "entityidfilter" : "sensor.garage_stairs_motion_sensor_alarm_level",
      "x" : 120,
      "haltifstate" : "",
      "entityidfiltertype" : "exact",
      "name" : "Garage Stairs Motion ",
      "type" : "server-state-changed",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "b30b715.575c99"
         ]
      ]
   },
   {
      "property" : "payload",
      "id" : "b30b715.575c99",
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "y" : 780,
      "type" : "switch",
      "name" : "Motion",
      "propertyType" : "msg",
      "x" : 340,
      "rules" : [
         {
            "v" : "255",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "v" : "0",
            "vt" : "str"
         }
      ],
      "wires" : [
         [
            "b1f458eb.3dd1c8",
            "1d3c0969.8169d7",
            "fc145f82.b9154"
         ],
         [
            "b1f458eb.3dd1c8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "outputs" : 2,
      "checkall" : "true"
   },
   {
      "duration" : "10",
      "units" : "Minute",
      "x" : 590,
      "payloadtype" : "num",
      "type" : "stoptimer",
      "name" : "10min",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "8c861ef0.5083c",
            "5e29a7d9.981a38"
         ],
         []
      ],
      "id" : "b1f458eb.3dd1c8",
      "payloadval" : "0",
      "y" : 860
   },
   {
      "y" : 820,
      "data" : "{ \"entity_id\":\"light.stairs\"}",
      "service_domain" : "light",
      "id" : "1d3c0969.8169d7",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "name" : "Turn on stairs lights",
      "type" : "api-call-service",
      "x" : 970,
      "mergecontext" : ""
   },
   {
      "service" : "turn_off",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 970,
      "name" : "Turn off stairs lights",
      "type" : "api-call-service",
      "data" : "{ \"entity_id\":\"light.stairs\"}",
      "y" : 860,
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "5e29a7d9.981a38"
   },
   {
      "id" : "76acb4c6.9160dc",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "y" : 780,
      "data" : "{ \"entity_id\":\"light.basement\"}",
      "type" : "api-call-service",
      "name" : "Turn on basement lights",
      "x" : 990,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on"
   },
   {
      "type" : "api-call-service",
      "name" : "Turn off basement lights",
      "x" : 990,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_off",
      "id" : "1bb8b0a0.e9c35f",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "y" : 900,
      "data" : "{ \"entity_id\":\"light.basement\"}"
   },
   {
      "name" : "Turn on basement lights",
      "type" : "api-call-service",
      "x" : 990,
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "id" : "7efe7fd2.e123f",
      "service_domain" : "light",
      "y" : 520,
      "data" : "{ \"entity_id\":\"light.basement\"}"
   },
   {
      "y" : 340,
      "server" : "e2a02faf.48099",
      "id" : "dca506ce.6a1fc8",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "b621c0a7.2c659",
            "7efe7fd2.e123f",
            "99edfdc7.a8032"
         ]
      ],
      "halt_if" : "on",
      "entity_id" : "input_boolean.guest_mode",
      "name" : "If Guest Mode Off",
      "type" : "api-current-state",
      "x" : 710
   },
   {
      "halt_if" : "on",
      "type" : "api-current-state",
      "name" : "If Guest Mode Off",
      "entity_id" : "input_boolean.guest_mode",
      "x" : 750,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "1bb8b0a0.e9c35f"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "8c861ef0.5083c",
      "y" : 900
   },
   {
      "wires" : [
         [
            "79aef37.ba4700c"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "entity_id" : "binary_sensor.wan",
      "name" : "Internet Connection Off",
      "type" : "api-current-state",
      "x" : 130,
      "halt_if" : "on",
      "y" : 1600,
      "id" : "cf5d9bba.b5f088",
      "server" : "e2a02faf.48099"
   },
   {
      "x" : 860,
      "type" : "api-call-service",
      "name" : "Turn off network gear",
      "service" : "turn_off",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "id" : "c1d6a8c7.4cab18",
      "service_domain" : "switch",
      "data" : "{ \"entity_id\":\"switch.network_gear_switch\" }",
      "y" : 1600
   },
   {
      "y" : 1680,
      "data" : "{ \"entity_id\":\"switch.network_gear_switch\" }",
      "service_domain" : "switch",
      "id" : "25068d9f.cc5212",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "type" : "api-call-service",
      "name" : "Turn on network gear",
      "x" : 1040
   },
   {
      "payloadval" : "0",
      "id" : "f22628cc.ac40d8",
      "y" : 1600,
      "name" : "5 minutes",
      "type" : "stoptimer",
      "payloadtype" : "num",
      "x" : 620,
      "duration" : "5",
      "units" : "Minute",
      "wires" : [
         [
            "c1d6a8c7.4cab18",
            "682c9d9d.1eb284",
            "10fc5f28.e36c81"
         ],
         []
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "id" : "9853f453.50be08",
      "server" : "e2a02faf.48099",
      "y" : 1640,
      "name" : "Internet Connection On",
      "type" : "api-current-state",
      "entity_id" : "binary_sensor.wan",
      "x" : 130,
      "halt_if" : "off",
      "wires" : [
         [
            "b718ffe5.e62ed"
         ]
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "reg" : false,
      "action" : "",
      "y" : 1640,
      "id" : "b718ffe5.e62ed",
      "property" : "",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "f22628cc.ac40d8"
         ]
      ],
      "to" : "",
      "rules" : [
         {
            "tot" : "str",
            "pt" : "msg",
            "to" : "STOP",
            "p" : "payload",
            "t" : "set"
         }
      ],
      "x" : 450,
      "name" : "Stop timer",
      "type" : "change",
      "from" : ""
   },
   {
      "op1type" : "str",
      "op1" : "1",
      "id" : "682c9d9d.1eb284",
      "op2type" : "str",
      "op2" : "0",
      "y" : 1680,
      "duration" : "1",
      "units" : "min",
      "reset" : "",
      "x" : 840,
      "name" : "Wait one minute",
      "type" : "trigger",
      "extend" : false,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "25068d9f.cc5212"
         ]
      ]
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "3941333.1bea2cc",
      "y" : 100,
      "entityidfilter" : "group.family",
      "haltifstate" : "",
      "x" : 90,
      "name" : "Family Home",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "225ea6ad.d070aa"
         ]
      ]
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "switch",
      "id" : "13058d3c.4a1843",
      "y" : 240,
      "data" : "{ \"entity_id\":\"group.humidifiers\"}",
      "name" : "Turn on humidifiers",
      "type" : "api-call-service",
      "x" : 970,
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "wires" : [
         []
      ]
   },
   {
      "y" : 1560,
      "id" : "fe6e17d.7399ee8",
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "x" : 200,
      "info" : "",
      "name" : "Reboot network gear if the internet goes down",
      "type" : "comment"
   },
   {
      "id" : "26bb4b56.bc97c4",
      "y" : 960,
      "name" : "Turn on the main level lights and grind coffee on work days",
      "type" : "comment",
      "x" : 230,
      "info" : "",
      "z" : "8bb76918.ef6b48",
      "wires" : []
   },
   {
      "id" : "45612f2e.90bd4",
      "y" : 40,
      "name" : "Setup the house when we come through the garage or get marked as home",
      "type" : "comment",
      "x" : 290,
      "info" : "",
      "wires" : [],
      "z" : "8bb76918.ef6b48"
   },
   {
      "y" : 740,
      "id" : "96646703.d7b4e8",
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "info" : "",
      "x" : 260,
      "name" : "Turn on garage stair lights and basement when motion is detected",
      "type" : "comment"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "76acb4c6.9160dc"
         ]
      ],
      "halt_if" : "on",
      "name" : "If Guest Mode Off",
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state",
      "x" : 750,
      "y" : 780,
      "server" : "e2a02faf.48099",
      "id" : "fc145f82.b9154"
   },
   {
      "wires" : [
         [
            "f4fbb4a2.6646c8",
            "788e2d3e.b185a4"
         ]
      ],
      "z" : "46ed0d55.4c98b4",
      "x" : 130,
      "haltifstate" : "",
      "type" : "server-state-changed",
      "name" : "Wifes Location Changed",
      "entityidfiltertype" : "exact",
      "entityidfilter" : "device_tracker.dawns_iphone",
      "y" : 80,
      "id" : "6334923.fe4cb6c",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "3a53eed2.e0e1f2",
      "y" : 220,
      "data" : "{ \"message\":\"msg\"}",
      "name" : "Notify Walt",
      "type" : "api-call-service",
      "x" : 1510,
      "z" : "46ed0d55.4c98b4",
      "service" : "ios_walts_iphone",
      "wires" : [
         []
      ]
   },
   {
      "x" : 200,
      "info" : "",
      "name" : "Turn down heat and lights off when we are away",
      "type" : "comment",
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "id" : "c2c0219.fb1f7e",
      "y" : 1760
   },
   {
      "wires" : [
         [
            "3dccda89.1d8a16"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "name" : "Family Status",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "haltifstate" : "",
      "x" : 90,
      "entityidfilter" : "group.family",
      "y" : 1800,
      "id" : "60513f16.1f5fa",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 1840,
      "data" : "{ \"message\": \"Nobody home, turning down heat and lights off\" }",
      "id" : "675ad3ec.c9f2ac",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "ios_walts_iphone",
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "x" : 1210
   },
   {
      "wires" : [
         []
      ],
      "service" : "set_temperature",
      "z" : "8bb76918.ef6b48",
      "x" : 1220,
      "type" : "api-call-service",
      "name" : "Turn down heat",
      "data" : "{ \"entity_id\": \"climate.hallway_nest\", \"temperature\": 67 }",
      "y" : 1880,
      "service_domain" : "climate",
      "id" : "e5bfca9b.0f87d8",
      "server" : "e2a02faf.48099"
   },
   {
      "service_domain" : "light",
      "id" : "66765f49.da2d4",
      "server" : "e2a02faf.48099",
      "y" : 1920,
      "data" : "{ \"entity_id\":\"group.all_lights\"}",
      "name" : "Turn off all lights",
      "type" : "api-call-service",
      "x" : 1220,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_off"
   },
   {
      "y" : 1960,
      "data" : "{ \"entity_id\":\"group.humidifiers\"}",
      "server" : "e2a02faf.48099",
      "service_domain" : "switch",
      "id" : "9c7dd40f.bd1fe8",
      "z" : "8bb76918.ef6b48",
      "service" : "turn_off",
      "wires" : [
         []
      ],
      "name" : "Turn off humidifiers",
      "type" : "api-call-service",
      "x" : 1230
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "150c6f5d.e6ca51",
      "y" : 160,
      "entityidfilter" : "device_tracker.walts_iphone",
      "name" : "Walts Location Changed",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "haltifstate" : "",
      "x" : 130,
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "91468204.28d44",
            "788e2d3e.b185a4"
         ]
      ]
   },
   {
      "wires" : [
         [
            "c131478b.afbc58"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "name" : "Garage Stairs Door",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "haltifstate" : "",
      "x" : 110,
      "entityidfilter" : "sensor.stairs_door_access_control",
      "y" : 820,
      "id" : "39ba4084.595b4",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 840,
      "outputLabels" : [
         "Open",
         "Closed"
      ],
      "property" : "payload",
      "id" : "c131478b.afbc58",
      "z" : "8bb76918.ef6b48",
      "outputs" : 2,
      "checkall" : "true",
      "wires" : [
         [
            "1d3c0969.8169d7",
            "fc145f82.b9154",
            "b1f458eb.3dd1c8"
         ],
         [
            "b1f458eb.3dd1c8"
         ]
      ],
      "rules" : [
         {
            "v" : "22",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "v" : "23",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "name" : "Door Open Or Closed",
      "type" : "switch",
      "x" : 340,
      "propertyType" : "msg"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "info" : "",
      "x" : 150,
      "type" : "comment",
      "name" : "Fade on the lights on work days",
      "y" : 1240,
      "id" : "c8335c96.7174b"
   },
   {
      "repeat" : "",
      "once" : false,
      "id" : "6c027bc7.81fd34",
      "crontab" : "50 06 * * 1,2,3,4,5",
      "y" : 1280,
      "topic" : "",
      "x" : 130,
      "type" : "inject",
      "name" : "",
      "payloadType" : "str",
      "z" : "8bb76918.ef6b48",
      "payload" : "6:50 on weekdays",
      "wires" : [
         [
            "a774d768.84e818"
         ]
      ]
   },
   {
      "id" : "a774d768.84e818",
      "server" : "e2a02faf.48099",
      "y" : 1280,
      "type" : "api-current-state",
      "name" : "If Guest Mode Off",
      "entity_id" : "input_boolean.guest_mode",
      "x" : 350,
      "halt_if" : "on",
      "wires" : [
         [
            "b966d79e.a1f698"
         ]
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "wires" : [
         [
            "b2e1971a.100438"
         ]
      ],
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "x" : 1280,
      "type" : "api-call-service",
      "name" : "Turn on Son1s lamp at 1%",
      "mergecontext" : "",
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"brightness\":\"1\", \"color_temp\":\"236\"}",
      "y" : 1320,
      "id" : "4321f595.99043c",
      "service_domain" : "light",
      "server" : "e2a02faf.48099"
   },
   {
      "op2" : "0",
      "y" : 1360,
      "op1type" : "str",
      "z" : "8bb76918.ef6b48",
      "duration" : "30",
      "reset" : "",
      "x" : 1250,
      "op2type" : "str",
      "op1" : "1",
      "id" : "ce971dc7.47848",
      "bytopic" : "all",
      "extend" : false,
      "wires" : [
         [
            "1607ea57.3a5706"
         ]
      ],
      "units" : "s",
      "name" : "Wait thirty seconds",
      "type" : "trigger"
   },
   {
      "y" : 1360,
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"transition\":\"600\",\"brightness\":\"255\", \"color_temp\":\"236\"}",
      "server" : "e2a02faf.48099",
      "id" : "1607ea57.3a5706",
      "service_domain" : "light",
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "type" : "api-call-service",
      "name" : "Start 10 minute fade in for Son1's lamp",
      "x" : 1540
   },
   {
      "pauseType" : "rate",
      "id" : "91165e1b.35eaa",
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "a71ae479.af01e8"
         ]
      ],
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "30",
      "rate" : "1",
      "drop" : true,
      "y" : 1140,
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "x" : 380,
      "timeout" : "5",
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1"
   },
   {
      "x" : 380,
      "type" : "api-call-service",
      "name" : "Update Walts location",
      "service" : "ios_walts_iphone",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "id" : "f4fbb4a2.6646c8",
      "service_domain" : "notify",
      "data" : "{ \"message\":\"request_location_update\"}",
      "y" : 80
   },
   {
      "service" : "ios_dawns_iphone",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         []
      ],
      "x" : 410,
      "type" : "api-call-service",
      "name" : "Update Wifes location",
      "data" : "{ \"message\":\"request_location_update\"}",
      "y" : 160,
      "server" : "e2a02faf.48099",
      "id" : "91468204.28d44",
      "service_domain" : "notify"
   },
   {
      "x" : 970,
      "name" : "Turn on stairs lights",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "service_domain" : "light",
      "id" : "59d7405f.fa55b",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"light.stairs\"}",
      "y" : 560
   },
   {
      "name" : "Location tracking",
      "type" : "comment",
      "info" : "",
      "x" : 100,
      "wires" : [],
      "z" : "46ed0d55.4c98b4",
      "id" : "d76067c.1179398",
      "y" : 40
   },
   {
      "wires" : [
         [
            "c283c7e3.723f48"
         ]
      ],
      "z" : "20661f8a.532c4",
      "haltifstate" : "not_home",
      "x" : 130,
      "type" : "server-state-changed",
      "name" : "Guests on WiFi Network",
      "entityidfilter" : "group.guests",
      "y" : 80,
      "id" : "ad07ccbe.d3089",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [
         []
      ],
      "service" : "turn_on",
      "z" : "20661f8a.532c4",
      "x" : 980,
      "type" : "api-call-service",
      "name" : "Turn on guest mode",
      "data" : "{ \"entity_id\": \"input_boolean.guest_mode\"}",
      "y" : 80,
      "service_domain" : "input_boolean",
      "id" : "757b73dc.a14b5c",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "e53093b7.f93ed",
      "y" : 120,
      "data" : "{ \"message\": \"Guest Home while family is away\" }",
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "x" : 950,
      "z" : "20661f8a.532c4",
      "service" : "ios_walts_iphone",
      "wires" : [
         []
      ]
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "f59cfbf.f051108"
         ]
      ],
      "payload" : "10:00PM",
      "topic" : "",
      "payloadType" : "str",
      "type" : "inject",
      "name" : "",
      "x" : 110,
      "crontab" : "00 22 * * *",
      "y" : 160,
      "once" : false,
      "repeat" : "",
      "id" : "54c0e6b3.abfcd8"
   },
   {
      "halt_if" : "off",
      "name" : "If Guest Mode On",
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state",
      "x" : 350,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "79371887.3b47a8"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "f59cfbf.f051108",
      "y" : 160
   },
   {
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "service" : "ios_walts_iphone",
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "x" : 950,
      "y" : 160,
      "data" : "{ \"message\": \"Guest mode will remain enabled until manually turned off\" }",
      "service_domain" : "notify",
      "id" : "79371887.3b47a8",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 40,
      "id" : "963d39c2.10c038",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 130,
      "info" : "",
      "type" : "comment",
      "name" : "Guest mode management"
   },
   {
      "y" : 120,
      "id" : "f2aab9d0.42f8a8",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "e53093b7.f93ed"
         ]
      ],
      "z" : "20661f8a.532c4",
      "name" : "If Family Not Home",
      "entity_id" : "group.family",
      "type" : "api-current-state",
      "x" : 730,
      "halt_if" : "home"
   },
   {
      "y" : 220,
      "id" : "90f77d40.3903b",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "info" : "",
      "x" : 130,
      "name" : "Battery checks for sensors",
      "type" : "comment"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "fee1fc92.269e3",
      "y" : 260,
      "entityidfilter" : "sensor.battery_status",
      "haltifstate" : "",
      "x" : 140,
      "name" : "Battery Status of all sensors",
      "type" : "server-state-changed",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "5cce42bc.9494dc"
         ]
      ]
   },
   {
      "x" : 950,
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "service" : "ios_walts_iphone",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "id" : "3fc03062.fc3f1",
      "service_domain" : "notify",
      "data" : "{ \"message\": \"Guest Home while family is away\" }",
      "y" : 260
   },
   {
      "x" : 610,
      "type" : "function",
      "name" : "Format battery message",
      "wires" : [
         [
            "3fc03062.fc3f1"
         ]
      ],
      "outputs" : 1,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "id" : "5cce42bc.9494dc",
      "func" : "msg.payload = { data: {'message': 'Check battery ' + msg.payload } };\nreturn msg;",
      "y" : 260
   },
   {
      "crontab" : "0 0-23 * * *",
      "y" : 360,
      "repeat" : "",
      "once" : false,
      "id" : "e23ad481.fbf788",
      "z" : "20661f8a.532c4",
      "payload" : "",
      "wires" : [
         [
            "2b751637.8120da"
         ]
      ],
      "topic" : "",
      "x" : 110,
      "type" : "inject",
      "name" : "On the hour",
      "payloadType" : "date"
   },
   {
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "service" : "query_cableone_data_usage",
      "type" : "api-call-service",
      "name" : "Query CableONE data usage",
      "x" : 1000,
      "mergecontext" : "",
      "y" : 360,
      "data" : "{ }",
      "id" : "2b751637.8120da",
      "service_domain" : "shell_command",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [],
      "z" : "20661f8a.532c4",
      "name" : "Query CableONE Data Cap Usage",
      "type" : "comment",
      "x" : 160,
      "info" : "",
      "y" : 320,
      "id" : "389de39c.59885c"
   },
   {
      "z" : "20661f8a.532c4",
      "qos" : "1",
      "wires" : [
         [
            "7e030515.6e8c9c"
         ]
      ],
      "topic" : "#",
      "name" : "All MQTT Messages",
      "type" : "mqtt in",
      "x" : 110,
      "y" : 580,
      "broker" : "4238db6e.227ed4",
      "id" : "6b60a3bf.63e32c"
   },
   {
      "y" : 580,
      "func" : "tele_check = /^tele/;\npower_check = /POWER/g;\n\nif (tele_check.test(msg.topic) && power_check.test(msg.payload)) {\n    new_payload     = msg.payload.replace(/.*POWER..\\\"([A-Z]+)\\\".*/, '$1');\n    msg.payload     = new_payload;\n\n    new_topic       = msg.topic.replace(/(\\w+).(\\w+).(\\w+)/, 'stat/$2/POWER');\n    msg.topic       = new_topic;\n    \n    msg.altered     = 1;\n}\n\nreturn msg;",
      "id" : "7e030515.6e8c9c",
      "wires" : [
         [
            "cdbb849e.19b978"
         ]
      ],
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "outputs" : 1,
      "type" : "function",
      "name" : "Reformat telemetry to state",
      "x" : 400
   },
   {
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "outputs" : 1,
      "checkall" : "true",
      "z" : "20661f8a.532c4",
      "x" : 690,
      "propertyType" : "msg",
      "name" : "If message reformatted",
      "type" : "switch",
      "rules" : [
         {
            "t" : "eq",
            "v" : "1",
            "vt" : "num"
         }
      ],
      "y" : 580,
      "id" : "cdbb849e.19b978",
      "property" : "altered"
   },
   {
      "entityidfilter" : "sensor.front_door_access_control",
      "type" : "server-state-changed",
      "name" : "Front Door",
      "haltifstate" : "",
      "x" : 80,
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "7048c9bb.ae4a88",
      "y" : 200
   },
   {
      "y" : 260,
      "server" : "e2a02faf.48099",
      "id" : "fbdea74.98dba58",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "entityidfilter" : "sensor.basement_back_door_access_control",
      "entityidfiltertype" : "substring",
      "type" : "server-state-changed",
      "name" : "Basement Back Door",
      "haltifstate" : "",
      "x" : 120
   },
   {
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "entityidfilter" : "sensor.screened_porch_door_access_control",
      "x" : 120,
      "haltifstate" : "",
      "type" : "server-state-changed",
      "name" : "Screened Porch Door",
      "y" : 320,
      "server" : "e2a02faf.48099",
      "id" : "2b44a923.01bb36"
   },
   {
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 130,
      "haltifstate" : "",
      "type" : "server-state-changed",
      "name" : "Garage Entry Door South",
      "entityidfilter" : "sensor.garage_entry_door_south_access_control",
      "y" : 380,
      "id" : "485b946f.1e2f3c",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 440,
      "server" : "e2a02faf.48099",
      "id" : "4f2dcef4.36e7",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "entityidfilter" : "sensor.garage_entry_door_north_access_control",
      "type" : "server-state-changed",
      "name" : "Garage Entry Door North",
      "x" : 130,
      "haltifstate" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "d55c9490.ae4028",
      "y" : 500,
      "entityidfilter" : "sensor.stairs_door_access_control",
      "type" : "server-state-changed",
      "name" : "Garage Stairs Door",
      "haltifstate" : "",
      "x" : 110,
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ]
   },
   {
      "wires" : [
         [
            "62c7725c.883fcc"
         ],
         [
            "62c7725c.883fcc"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "checkall" : "true",
      "outputs" : 2,
      "name" : "Doors Open or Closed",
      "type" : "switch",
      "x" : 480,
      "propertyType" : "msg",
      "rules" : [
         {
            "vt" : "str",
            "v" : "22",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "v" : "23",
            "vt" : "str"
         }
      ],
      "y" : 280,
      "property" : "payload",
      "id" : "ed027925.58a1f8",
      "outputLabels" : [
         "Open",
         "Closed"
      ]
   },
   {
      "id" : "1537323c.cb698e",
      "server" : "e2a02faf.48099",
      "y" : 140,
      "haltifstate" : "",
      "x" : 100,
      "entityidfiltertype" : "substring",
      "name" : "Garage Motion ",
      "type" : "server-state-changed",
      "entityidfilter" : "sensor.garage_motion_sensor_alarm_level",
      "wires" : [
         [
            "806fa6b.8209558"
         ]
      ],
      "z" : "af1cc9bd.91cc08"
   },
   {
      "y" : 80,
      "server" : "e2a02faf.48099",
      "id" : "b6f8910d.0609f",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "aae0381e.3331d8"
         ]
      ],
      "entityidfilter" : "sensor.garage_stairs_motion_sensor_alarm_level",
      "type" : "server-state-changed",
      "name" : "Garage Stairs Motion ",
      "entityidfiltertype" : "substring",
      "x" : 120,
      "haltifstate" : ""
   },
   {
      "y" : 80,
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "property" : "payload",
      "id" : "aae0381e.3331d8",
      "z" : "af1cc9bd.91cc08",
      "outputs" : 2,
      "checkall" : "true",
      "wires" : [
         [
            "62c7725c.883fcc"
         ],
         []
      ],
      "rules" : [
         {
            "vt" : "str",
            "v" : "255",
            "t" : "eq"
         },
         {
            "v" : "0",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "type" : "switch",
      "name" : "Motion",
      "x" : 480,
      "propertyType" : "msg"
   },
   {
      "y" : 40,
      "id" : "9f775522.889818",
      "z" : "af1cc9bd.91cc08",
      "wires" : [],
      "name" : "Alerts if motion or doors move when we are not home",
      "type" : "comment",
      "x" : 220,
      "info" : ""
   },
   {
      "id" : "80e2c411.0090f8",
      "y" : 560,
      "info" : "",
      "x" : 150,
      "name" : "Alert if doors are open too long",
      "type" : "comment",
      "wires" : [],
      "z" : "af1cc9bd.91cc08"
   },
   {
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "d2624da.51817b"
         ],
         []
      ],
      "units" : "Minute",
      "duration" : "15",
      "x" : 1030,
      "name" : "15 minutes",
      "type" : "stoptimer",
      "payloadtype" : "num",
      "y" : 680,
      "id" : "5e54acc4.be8764",
      "payloadval" : "0"
   },
   {
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "to" : "STOP",
            "tot" : "str",
            "pt" : "msg"
         }
      ],
      "x" : 690,
      "name" : "Stop timer",
      "from" : "",
      "type" : "change",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "5e54acc4.be8764"
         ]
      ],
      "to" : "",
      "id" : "5d71175.ba67de8",
      "property" : "",
      "reg" : false,
      "y" : 800,
      "action" : ""
   },
   {
      "z" : "af1cc9bd.91cc08",
      "service" : "family_iphones",
      "wires" : [
         []
      ],
      "type" : "api-call-service",
      "name" : "Notify Family",
      "x" : 1030,
      "y" : 760,
      "data" : "{ \"message\": \"msg\" }",
      "server" : "e2a02faf.48099",
      "id" : "848e6e46.320ba",
      "service_domain" : "notify"
   },
   {
      "x" : 80,
      "haltifstate" : "",
      "type" : "server-state-changed",
      "name" : "Front Door",
      "entityidfilter" : "sensor.front_door_access_control",
      "wires" : [
         [
            "1523c8b7.aeee17"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "id" : "498e7861.71c078",
      "server" : "e2a02faf.48099",
      "y" : 600
   },
   {
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "1523c8b7.aeee17"
         ]
      ],
      "entityidfilter" : "sensor.basement_back_door_access_control",
      "type" : "server-state-changed",
      "name" : "Basement Back Door",
      "x" : 120,
      "haltifstate" : "",
      "y" : 660,
      "server" : "e2a02faf.48099",
      "id" : "d41be6a.29d7018"
   },
   {
      "y" : 720,
      "server" : "e2a02faf.48099",
      "id" : "84b50263.7170f",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "1523c8b7.aeee17"
         ]
      ],
      "entityidfilter" : "sensor.screened_porch_door_access_control",
      "haltifstate" : "",
      "x" : 120,
      "name" : "Screened Porch Door",
      "type" : "server-state-changed"
   },
   {
      "y" : 640,
      "property" : "payload",
      "id" : "1523c8b7.aeee17",
      "outputLabels" : [
         "Open",
         "Closed"
      ],
      "wires" : [
         [
            "5571cb3c.251cd4",
            "d5b38e8a.ee827"
         ],
         [
            "5d71175.ba67de8"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "checkall" : "true",
      "outputs" : 2,
      "type" : "switch",
      "name" : "Door Open Or Closed",
      "propertyType" : "msg",
      "x" : 380,
      "rules" : [
         {
            "t" : "eq",
            "v" : "22",
            "vt" : "str"
         },
         {
            "t" : "eq",
            "v" : "23",
            "vt" : "str"
         }
      ]
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "3bca974f.3b27c8",
      "y" : 780,
      "entityidfilter" : "sensor.garage_door_south_tilt_alarm_level",
      "name" : "Garage Door South",
      "entityidfiltertype" : "substring",
      "type" : "server-state-changed",
      "haltifstate" : "",
      "x" : 110,
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "e65236da.3530a8"
         ]
      ]
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "793a4734.9d54b8",
      "y" : 840,
      "entityidfilter" : "sensor.garage_door_north_tilt_alarm_level",
      "x" : 110,
      "haltifstate" : "",
      "name" : "Garage Door North",
      "type" : "server-state-changed",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "e65236da.3530a8"
         ]
      ]
   },
   {
      "y" : 800,
      "property" : "payload",
      "id" : "e65236da.3530a8",
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "wires" : [
         [
            "5571cb3c.251cd4"
         ],
         [
            "5d71175.ba67de8"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "outputs" : 2,
      "checkall" : "true",
      "name" : "Garage Door Open Or Closed",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 410,
      "rules" : [
         {
            "vt" : "str",
            "v" : "255",
            "t" : "eq"
         },
         {
            "vt" : "str",
            "v" : "0",
            "t" : "eq"
         }
      ]
   },
   {
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "30",
      "rate" : "1",
      "drop" : true,
      "y" : 620,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "5",
      "x" : 1010,
      "z" : "af1cc9bd.91cc08",
      "randomFirst" : "1",
      "pauseType" : "rate",
      "id" : "82b2cd34.5bb27",
      "type" : "delay",
      "name" : "Only let one message through",
      "wires" : [
         [
            "5e54acc4.be8764"
         ]
      ]
   },
   {
      "x" : 1050,
      "name" : "Format message",
      "type" : "function",
      "wires" : [
         [
            "848e6e46.320ba",
            "e91e1174.d8ddc"
         ]
      ],
      "outputs" : 1,
      "noerr" : 0,
      "z" : "af1cc9bd.91cc08",
      "id" : "d2624da.51817b",
      "y" : 720,
      "func" : "door        = msg.topic.replace(/^.*\\.(.*)_(access|alarm).*/, '$1');\ndoor        = door.replace(/_/g, ' ');\nmsg.payload = { data: {'message': door + ' has been open over 15 minutes' } };\n\nreturn msg;"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "987a7121.805bf",
      "y" : 100,
      "halt_if" : "0",
      "entity_id" : "sensor.garage_motion_sensor_alarm_level",
      "name" : "If Garage Motion Detected",
      "type" : "api-current-state",
      "x" : 640,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "56e5a29c.1d958c"
         ]
      ]
   },
   {
      "halt_if" : "home",
      "x" : 610,
      "type" : "api-current-state",
      "name" : "If Family Not Home",
      "entity_id" : "group.family",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "bbaa55e4.8d5ba8"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "56e5a29c.1d958c",
      "y" : 140
   },
   {
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "name" : "Turn on master bedroom",
      "type" : "api-call-service",
      "x" : 990,
      "y" : 120,
      "data" : "{ \"entity_id\":\"light.master_bedroom\"}",
      "server" : "e2a02faf.48099",
      "id" : "6dbf538f.d536cc",
      "service_domain" : "light"
   },
   {
      "id" : "e295d74a.c6f488",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"light.sengled_e11g13_030b05a4_1\"}",
      "y" : 80,
      "x" : 990,
      "type" : "api-call-service",
      "name" : "Turn on upstairs landing",
      "wires" : [
         []
      ],
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "2b9c3b21.c9bee4"
         ]
      ],
      "halt_if" : "on",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "name" : "If Guest Mode Off",
      "x" : 610,
      "y" : 180,
      "server" : "e2a02faf.48099",
      "id" : "bbaa55e4.8d5ba8"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "3d015f18.990dd",
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\"}",
      "y" : 160,
      "x" : 990,
      "name" : "Turn on Son1's Lamp",
      "type" : "api-call-service",
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ]
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "62f28eac.1bcf4",
      "data" : "{ \"entity_id\":\"light.colins_lamp\"}",
      "y" : 200,
      "x" : 980,
      "name" : "Turn on Son2's Lamp",
      "type" : "api-call-service",
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ]
   },
   {
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "x" : 600,
      "timeout" : "5",
      "timeoutUnits" : "seconds",
      "rateUnits" : "minute",
      "drop" : true,
      "y" : 220,
      "rate" : "1",
      "nbRateUnits" : "30",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "wires" : [
         [
            "8e9cdb7d.9f1268"
         ]
      ],
      "type" : "delay",
      "name" : "",
      "id" : "2b9c3b21.c9bee4",
      "pauseType" : "rate"
   },
   {
      "id" : "6fec6164.86ae9",
      "y" : 40,
      "info" : "",
      "x" : 940,
      "type" : "comment",
      "name" : "Upstairs",
      "z" : "8bb76918.ef6b48",
      "wires" : []
   },
   {
      "id" : "a673cf79.c8467",
      "y" : 360,
      "type" : "comment",
      "name" : "Main Level",
      "x" : 940,
      "info" : "",
      "wires" : [],
      "z" : "8bb76918.ef6b48"
   },
   {
      "id" : "7aa9e081.06fd1",
      "y" : 480,
      "x" : 980,
      "info" : "",
      "type" : "comment",
      "name" : "Basement and garage",
      "z" : "8bb76918.ef6b48",
      "wires" : []
   },
   {
      "data" : "{ \"message\":\"request_location_update\"}",
      "y" : 80,
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "b58f2da5.6fc3e",
      "service" : "ios_walts_iphone",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         []
      ],
      "x" : 1260,
      "name" : "Update Walts location",
      "type" : "api-call-service"
   },
   {
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "service" : "ios_dawns_iphone",
      "type" : "api-call-service",
      "name" : "Update Wifes location",
      "x" : 1270,
      "y" : 120,
      "data" : "{ \"message\":\"request_location_update\"}",
      "id" : "555e84d9.56d97c",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099"
   },
   {
      "drop" : false,
      "y" : 140,
      "rate" : "1",
      "nbRateUnits" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "randomFirst" : "1",
      "z" : "af1cc9bd.91cc08",
      "timeout" : "3",
      "x" : 800,
      "rateUnits" : "second",
      "timeoutUnits" : "minutes",
      "id" : "c2286c26.27939",
      "pauseType" : "delay",
      "wires" : [
         [
            "b3cae960.eb0e38"
         ]
      ],
      "name" : "3 minute delay for location update",
      "type" : "delay"
   },
   {
      "id" : "ee75ae12.67511",
      "y" : 280,
      "func" : "door        = msg.topic.replace(/^.*\\.(.*)_(access|alarm).*/, '$1');\ndoor        = door.replace(/_/g, ' ');\nmsg.payload = { data: {'message': door + ' opened three minutes ago while family was out' } };\n\nreturn msg;",
      "name" : "Format message",
      "type" : "function",
      "x" : 990,
      "z" : "af1cc9bd.91cc08",
      "noerr" : 0,
      "outputs" : 1,
      "wires" : [
         [
            "43df1ee7.8196"
         ]
      ]
   },
   {
      "port" : "993",
      "id" : "a13e1986.19edf8",
      "useSSL" : true,
      "repeat" : "300",
      "server" : "imap.gmail.com",
      "disposition" : "None",
      "y" : 680,
      "x" : 70,
      "box" : "OptionC",
      "type" : "e-mail in",
      "name" : "",
      "protocol" : "IMAP",
      "wires" : [
         [
            "df1ac37.1976c4"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "name" : "From Mary Immaculate",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 260,
      "rules" : [
         {
            "t" : "cont",
            "v" : "optioncalerts.com",
            "vt" : "str"
         }
      ],
      "wires" : [
         [
            "532a6fa1.bf616"
         ]
      ],
      "z" : "20661f8a.532c4",
      "checkall" : "true",
      "outputs" : 1,
      "property" : "from",
      "id" : "df1ac37.1976c4",
      "y" : 680
   },
   {
      "y" : 680,
      "property" : "payload",
      "id" : "532a6fa1.bf616",
      "z" : "20661f8a.532c4",
      "checkall" : "true",
      "outputs" : 1,
      "wires" : [
         [
            "55b89320.b29b5c",
            "b3b40a7a.3d42d8",
            "c4d808d1.9fbf48"
         ]
      ],
      "rules" : [
         {
            "v" : "no school",
            "vt" : "str",
            "t" : "cont"
         }
      ],
      "name" : "No school?",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 480
   },
   {
      "service_domain" : "input_boolean",
      "id" : "55b89320.b29b5c",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"no_school_mode\"} ",
      "y" : 680,
      "x" : 920,
      "name" : "Turn on \"no school mode\"",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "service" : "turn_on",
      "z" : "20661f8a.532c4"
   },
   {
      "x" : 870,
      "type" : "api-call-service",
      "name" : "Notify Family",
      "wires" : [
         []
      ],
      "service" : "family_iphones",
      "z" : "20661f8a.532c4",
      "service_domain" : "notify",
      "id" : "b3b40a7a.3d42d8",
      "server" : "e2a02faf.48099",
      "data" : "{ \"message\": \"No School tomorrow\" }",
      "y" : 720
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "3c5a303e.c31d8",
      "y" : 820,
      "halt_if" : "off",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.no_school_mode",
      "name" : "If No School Mode On",
      "x" : 270,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "2d27c7ec.756e78",
            "b83f778e.8a82a8"
         ]
      ]
   },
   {
      "once" : false,
      "repeat" : "",
      "id" : "94fd5cd4.065a1",
      "crontab" : "00 09 * * *",
      "y" : 820,
      "topic" : "",
      "x" : 90,
      "type" : "inject",
      "payloadType" : "str",
      "name" : "",
      "z" : "20661f8a.532c4",
      "payload" : "9:00am",
      "wires" : [
         [
            "3c5a303e.c31d8"
         ]
      ]
   },
   {
      "y" : 820,
      "data" : "{ \"entity_id\":\"no_school_mode\"} ",
      "id" : "2d27c7ec.756e78",
      "service_domain" : "input_boolean",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "service" : "turn_on",
      "name" : "Turn on \"no school mode\"",
      "type" : "api-call-service",
      "x" : 710
   },
   {
      "data" : "{ \"message\": \"Turning off no school mode - Alarm clocks will go off normally tomorrow morning\" }",
      "y" : 860,
      "service_domain" : "notify",
      "id" : "b83f778e.8a82a8",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "service" : "family_iphones",
      "z" : "20661f8a.532c4",
      "x" : 660,
      "name" : "Notify Family",
      "type" : "api-call-service"
   },
   {
      "y" : 640,
      "id" : "c2c4376f.76f138",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "info" : "",
      "x" : 130,
      "name" : "Monitor for no school days",
      "type" : "comment"
   },
   {
      "y" : 780,
      "id" : "640c31ce.7db44",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "name" : "Turn off no school mode",
      "type" : "comment",
      "x" : 130,
      "info" : ""
   },
   {
      "id" : "b966d79e.a1f698",
      "server" : "e2a02faf.48099",
      "y" : 1280,
      "entity_id" : "input_boolean.no_school_mode",
      "name" : "If No School mode",
      "type" : "api-current-state",
      "x" : 570,
      "halt_if" : "on",
      "wires" : [
         [
            "9ff97d14.a2d8e",
            "60801386.316afc"
         ]
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "entityidfilter" : "calendar.family_sleepin",
      "name" : "Family Calendar - No school event",
      "type" : "server-state-changed",
      "x" : 420,
      "haltifstate" : "off",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "55b89320.b29b5c",
            "b3b40a7a.3d42d8",
            "c4d808d1.9fbf48"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "630ca5d3.5e759c",
      "y" : 720
   },
   {
      "wires" : [
         [
            "3028dd0a.dc3952",
            "717049d9.26fc08"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "pauseType" : "delay",
      "id" : "691ff7e.4b75e08",
      "z" : "46ed0d55.4c98b4",
      "randomFirst" : "1",
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "30",
      "x" : 620,
      "rate" : "1",
      "y" : 180,
      "drop" : false,
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1"
   },
   {
      "z" : "46ed0d55.4c98b4",
      "noerr" : 0,
      "outputs" : "2",
      "wires" : [
         [
            "c21dbb32.350808",
            "99c0bcdb.ffe2",
            "11cac704.acdbc9"
         ],
         []
      ],
      "type" : "function",
      "name" : "Still in triggered zone or just passing through?",
      "x" : 1040,
      "y" : 180,
      "func" : "walt_updated_loc = global.get('walt_location')||null;\ndawn_updated_loc = global.get('dawn_location')||null;\n\nmsg.dawn_updated_loc = dawn_updated_loc;\nmsg.walt_updated_loc = walt_updated_loc;\n\nif (msg.person == 'walt' && (walt_updated_loc == msg.loc)) {\n    node.status({fill:\"green\",shape:\"dot\",text:\"Still in triggered geozone, sending message\"});\n    msg.passing_through = 0;\n    return[ msg,null ];\n} else if (msg.person == 'dawn' && (dawn_updated_loc == msg.loc)) {\n    node.status({fill:\"green\",shape:\"dot\",text:\"Still in triggered geozone, sending message\"});\n    msg.passing_through = 0;\n    return[ msg,null ];\n} else {\n    node.status({fill:\"red\",shape:\"ring\",text:\"Just passing through geozone, stopping flow\"});\n    msg.passing_through = 1;\n    return [ null,msg ];\n}",
      "outputLabels" : [
         "Still in triggered zone",
         "Passing through"
      ],
      "id" : "9845c56b.21d638"
   },
   {
      "nbRateUnits" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "drop" : false,
      "y" : 180,
      "rate" : "1",
      "x" : 780,
      "timeout" : "10",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "randomFirst" : "1",
      "z" : "46ed0d55.4c98b4",
      "id" : "3028dd0a.dc3952",
      "pauseType" : "delay",
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "9845c56b.21d638"
         ]
      ]
   },
   {
      "z" : "7ae32389.5d604c",
      "outputs" : 3,
      "checkall" : "true",
      "wires" : [
         [
            "bad86bdd.a7a558"
         ],
         [
            "286ded0b.61d8a2",
            "ecbc45f0.2c3ce8"
         ],
         [
            "39dc733b.2aec8c"
         ]
      ],
      "rules" : [
         {
            "t" : "eq",
            "v" : "left",
            "vt" : "str"
         },
         {
            "t" : "eq",
            "v" : "is at",
            "vt" : "str"
         },
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "unknown"
         }
      ],
      "name" : "Leaving or entering a zone?",
      "type" : "switch",
      "x" : 540,
      "propertyType" : "msg",
      "y" : 40,
      "property" : "verb",
      "id" : "516c338e.65601c"
   },
   {
      "func" : "// Clear our msg object as the service call to\n// update our location doesn't seem to like it\nnewmsg = {};\nnewmsg.payload = \"Update\";\n\nif(msg.person == \"walt\") {\n    return[ newmsg, null ];\n} else if(msg.person == \"dawn\") {\n    return[ null, newmsg ];\n}",
      "y" : 200,
      "id" : "717049d9.26fc08",
      "outputLabels" : [
         "walt",
         "dawn"
      ],
      "wires" : [
         [
            "f4fbb4a2.6646c8"
         ],
         [
            "91468204.28d44"
         ]
      ],
      "outputs" : "2",
      "z" : "46ed0d55.4c98b4",
      "noerr" : 0,
      "x" : 160,
      "name" : "Clear msg and switch",
      "type" : "function"
   },
   {
      "lat" : "",
      "wires" : [
         [
            "82b2cd34.5bb27"
         ],
         []
      ],
      "startOffset" : 0,
      "z" : "af1cc9bd.91cc08",
      "x" : 630,
      "name" : "Night",
      "type" : "time-range-switch",
      "lon" : "",
      "y" : 600,
      "id" : "5571cb3c.251cd4",
      "startTime" : "sunsetStart",
      "endTime" : "dawn",
      "endOffset" : 0
   },
   {
      "wires" : [],
      "z" : "46ed0d55.4c98b4",
      "active" : true,
      "name" : "FinalNotify",
      "type" : "debug",
      "x" : 1350,
      "complete" : "true",
      "console" : "false",
      "y" : 100,
      "id" : "c21dbb32.350808"
   },
   {
      "wires" : [
         [
            "9652ab51.5bae68"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 490,
      "type" : "api-current-state",
      "name" : "Family Mode",
      "entity_id" : "group.family",
      "halt_if" : "",
      "y" : 980,
      "id" : "1debd879.7d8d08",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [
         [
            "dfab892.528a878"
         ]
      ],
      "z" : "20661f8a.532c4",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "name" : "Guest mode",
      "x" : 490,
      "halt_if" : "",
      "y" : 940,
      "id" : "fc9e2d66.62f4e",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "3b870494.1a05ac",
      "once" : false,
      "repeat" : "10",
      "y" : 940,
      "crontab" : "",
      "name" : "",
      "type" : "inject",
      "payloadType" : "date",
      "x" : 150,
      "topic" : "Every 10sec",
      "wires" : [
         [
            "fc9e2d66.62f4e",
            "1debd879.7d8d08",
            "7d5c167d.428f28",
            "4d20e83c.3733d8"
         ]
      ],
      "payload" : "",
      "z" : "20661f8a.532c4"
   },
   {
      "wires" : [],
      "z" : "20661f8a.532c4",
      "type" : "comment",
      "name" : "Turn our input booleans to global variables",
      "info" : "",
      "x" : 180,
      "y" : 900,
      "id" : "d827ee6e.e7ed7"
   },
   {
      "y" : 940,
      "func" : "global.set('guest_mode',msg.payload);\nreturn msg;",
      "id" : "dfab892.528a878",
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "outputs" : 1,
      "type" : "function",
      "name" : "Set global variables",
      "x" : 670
   },
   {
      "wires" : [
         []
      ],
      "outputs" : 1,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "x" : 670,
      "type" : "function",
      "name" : "Set global variables",
      "y" : 980,
      "func" : "global.set('family_mode',msg.payload);\nreturn msg;",
      "id" : "9652ab51.5bae68"
   },
   {
      "x" : 520,
      "type" : "function",
      "name" : "Is family home or guest mode on?",
      "wires" : [
         [],
         []
      ],
      "outputs" : 2,
      "z" : "c663f7df.ca58b8",
      "noerr" : 0,
      "id" : "caba1d6f.2e38",
      "outputLabels" : [
         "abort",
         "continue"
      ],
      "func" : "family_mode         = global.get('family_mode')||null;\nguest_mode          = global.get('guest_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.family_mode     = family_mode;\nmsg.guest_mode      = guest_mode;\n\nif( family_mode == 'home' || guest_mode == 'on' || ha_uptime_sec < 600) {\n    msg.abort_alert = 1;\n    return [ msg, null ];\n} else {\n     msg.abort_alert = 0;\n    return [ null, msg ];   \n}",
      "y" : 560
   },
   {
      "z" : "af1cc9bd.91cc08",
      "y" : 660,
      "wires" : [
         [
            "82b2cd34.5bb27"
         ]
      ],
      "type" : "subflow:c663f7df.ca58b8",
      "name" : "",
      "id" : "d5b38e8a.ee827",
      "x" : 710
   },
   {
      "y" : 440,
      "id" : "2ce419c7.fb69b6",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "9fff04c1.ef0688"
         ]
      ],
      "z" : "c663f7df.ca58b8",
      "name" : "Family Mode",
      "type" : "api-current-state",
      "entity_id" : "group.family",
      "x" : 470,
      "halt_if" : ""
   },
   {
      "y" : 400,
      "server" : "e2a02faf.48099",
      "id" : "9a1ed94a.6731a8",
      "z" : "c663f7df.ca58b8",
      "wires" : [
         [
            "d85f38d8.e12fb8"
         ]
      ],
      "halt_if" : "",
      "x" : 470,
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state",
      "name" : "Guest mode"
   },
   {
      "wires" : [
         []
      ],
      "z" : "c663f7df.ca58b8",
      "noerr" : 0,
      "outputs" : 1,
      "type" : "function",
      "name" : "Set global variables",
      "x" : 670,
      "y" : 400,
      "func" : "global.set('guest_mode',msg.payload);\nreturn msg;",
      "id" : "d85f38d8.e12fb8"
   },
   {
      "id" : "9fff04c1.ef0688",
      "func" : "global.set('family_mode',msg.payload);\nreturn msg;",
      "y" : 440,
      "x" : 670,
      "name" : "Set global variables",
      "type" : "function",
      "outputs" : 1,
      "z" : "c663f7df.ca58b8",
      "noerr" : 0,
      "wires" : [
         []
      ]
   },
   {
      "wires" : [
         [
            "caba1d6f.2e38"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "id" : "9239610f.2b97b",
      "pauseType" : "delay",
      "randomFirst" : "1",
      "z" : "c663f7df.ca58b8",
      "x" : 280,
      "timeout" : "1",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "y" : 560,
      "drop" : false,
      "rate" : "1",
      "nbRateUnits" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds"
   },
   {
      "x" : 750,
      "id" : "62c7725c.883fcc",
      "type" : "subflow:c663f7df.ca58b8",
      "name" : "",
      "z" : "af1cc9bd.91cc08",
      "y" : 60,
      "wires" : [
         [
            "b58f2da5.6fc3e",
            "555e84d9.56d97c",
            "c2286c26.27939"
         ]
      ]
   },
   {
      "x" : 760,
      "id" : "b3cae960.eb0e38",
      "name" : "Family still not home",
      "type" : "subflow:c663f7df.ca58b8",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ee75ae12.67511"
         ]
      ],
      "y" : 220
   },
   {
      "endOffset" : 0,
      "endTime" : "21:00",
      "startTime" : "07:30",
      "id" : "aebd9c21.e33fc",
      "y" : 1800,
      "lon" : "-92.58257",
      "name" : "",
      "type" : "time-range-switch",
      "x" : 930,
      "z" : "8bb76918.ef6b48",
      "startOffset" : 0,
      "lat" : "40.18944",
      "wires" : [
         [
            "675ad3ec.c9f2ac",
            "e5bfca9b.0f87d8",
            "66765f49.da2d4",
            "9c7dd40f.bd1fe8",
            "6c92f048.18abb"
         ],
         [
            "3841f6fb.417bea"
         ]
      ]
   },
   {
      "y" : 220,
      "id" : "8e9cdb7d.9f1268",
      "endOffset" : 0,
      "endTime" : "21:00",
      "startTime" : "07:00",
      "lat" : "",
      "wires" : [
         [
            "e295d74a.c6f488",
            "6dbf538f.d536cc",
            "3d015f18.990dd",
            "62f28eac.1bcf4",
            "13058d3c.4a1843",
            "82f399bc.7354c8",
            "bbe74c77.d0d3a"
         ],
         []
      ],
      "z" : "8bb76918.ef6b48",
      "startOffset" : 0,
      "type" : "time-range-switch",
      "name" : "7AM to 9PM",
      "x" : 770,
      "lon" : ""
   },
   {
      "drop" : false,
      "y" : 80,
      "rate" : "1",
      "nbRateUnits" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "x" : 700,
      "timeout" : "30",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "id" : "934c709e.a7c31",
      "pauseType" : "delay",
      "wires" : [
         [
            "757b73dc.a14b5c"
         ]
      ],
      "type" : "delay",
      "name" : ""
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "f2aab9d0.42f8a8",
            "934c709e.a7c31"
         ]
      ],
      "halt_if" : "on",
      "x" : 350,
      "entity_id" : "input_boolean.guest_mode",
      "name" : "If Guest Mode Off",
      "type" : "api-current-state",
      "y" : 80,
      "server" : "e2a02faf.48099",
      "id" : "c283c7e3.723f48"
   },
   {
      "id" : "5d9c3f4c.3afde",
      "y" : 1060,
      "x" : 260,
      "info" : "",
      "type" : "comment",
      "name" : "Relogin to Home Assistant Cloud every hour or after internet outage",
      "z" : "20661f8a.532c4",
      "wires" : []
   },
   {
      "payloadType" : "date",
      "type" : "inject",
      "name" : "Every hour",
      "x" : 110,
      "topic" : "",
      "wires" : [
         [
            "ed3ffca4.b612b"
         ]
      ],
      "payload" : "",
      "z" : "20661f8a.532c4",
      "id" : "c4c54b0.0467db8",
      "once" : false,
      "repeat" : "3600",
      "y" : 1100,
      "crontab" : ""
   },
   {
      "id" : "d45b0f9.d0fc8f",
      "y" : 1100,
      "tls" : "849977e5.257f68",
      "x" : 670,
      "type" : "http request",
      "name" : "",
      "url" : "",
      "ret" : "txt",
      "z" : "20661f8a.532c4",
      "method" : "POST",
      "wires" : [
         [
            "ff28169f.f5c4f8"
         ]
      ]
   },
   {
      "id" : "ed3ffca4.b612b",
      "y" : 1100,
      "func" : "msg.url = 'https://127.0.0.1:8123/api/cloud/logout';\nmsg.headers = {};\nmsg.headers['x-ha-access'] = 'your-api-password';\nmsg.headers['Content-Type'] = 'application/json';\nreturn msg;\n",
      "name" : "Set Logout URL and headers",
      "type" : "function",
      "x" : 360,
      "wires" : [
         [
            "d45b0f9.d0fc8f"
         ]
      ],
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "outputs" : 1
   },
   {
      "y" : 1160,
      "func" : "msg.url = 'https://127.0.0.1:8123/api/cloud/login';\nmsg.payload = '{\"email\": \"walthowd@gmail.com\", \"password\": \"your-cloud-password\"}';\nmsg.headers = {};\nmsg.headers['x-ha-access'] = 'your-api-password';\nmsg.headers['Content-Type'] = 'application/json';\nreturn msg;\n",
      "id" : "125a5fe.a083fa",
      "wires" : [
         [
            "76d2fb86.49daa4"
         ]
      ],
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "outputs" : 1,
      "type" : "function",
      "name" : "Set Login URL, headers and payload",
      "x" : 390
   },
   {
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "125a5fe.a083fa"
         ]
      ],
      "id" : "ff28169f.f5c4f8",
      "pauseType" : "delay",
      "timeout" : "1",
      "x" : 860,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "nbRateUnits" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "drop" : false,
      "y" : 1100,
      "rate" : "1"
   },
   {
      "id" : "76d2fb86.49daa4",
      "y" : 1160,
      "x" : 670,
      "name" : "",
      "type" : "http request",
      "tls" : "849977e5.257f68",
      "wires" : [
         [
            "9d83950a.0fc128"
         ]
      ],
      "ret" : "txt",
      "url" : "",
      "z" : "20661f8a.532c4",
      "method" : "POST"
   },
   {
      "service" : "ios_walts_iphone",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "x" : 1090,
      "name" : "Notify Walt",
      "type" : "api-call-service",
      "data" : "{ \"message\": \"Problem logging back into Home Assistant Cloud\" }",
      "y" : 1160,
      "server" : "e2a02faf.48099",
      "id" : "80cb93b0.f340b",
      "service_domain" : "notify"
   },
   {
      "property" : "statusCode",
      "id" : "9d83950a.0fc128",
      "y" : 1160,
      "rules" : [
         {
            "vt" : "num",
            "v" : "200",
            "t" : "neq"
         }
      ],
      "name" : "Not HTTP 200",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 880,
      "z" : "20661f8a.532c4",
      "outputs" : 1,
      "checkall" : "true",
      "wires" : [
         [
            "80cb93b0.f340b"
         ]
      ]
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "416f2de9.793354"
         ]
      ],
      "halt_if" : "on",
      "x" : 130,
      "type" : "api-current-state",
      "name" : "Internet Connection Off",
      "entity_id" : "binary_sensor.wan",
      "y" : 1260,
      "server" : "e2a02faf.48099",
      "id" : "8e732d86.72c62"
   },
   {
      "y" : 1260,
      "maxtimeoutunits" : "Hour",
      "id" : "416f2de9.793354",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "28f91326.ea172c"
         ],
         []
      ],
      "units" : "Second",
      "duration" : "30",
      "maxtimeout" : "12",
      "maxloops" : "1440",
      "type" : "looptimer",
      "name" : "",
      "x" : 450
   },
   {
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "rate" : "1",
      "y" : 1260,
      "drop" : false,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "5",
      "x" : 680,
      "z" : "20661f8a.532c4",
      "randomFirst" : "1",
      "pauseType" : "delay",
      "id" : "28f91326.ea172c",
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "7063a64e.363828"
         ]
      ]
   },
   {
      "x" : 920,
      "entity_id" : "binary_sensor.wan",
      "name" : "Internet back online",
      "type" : "api-current-state",
      "halt_if" : "off",
      "wires" : [
         [
            "fbf6771c.022678",
            "83d00a78.9de298"
         ]
      ],
      "z" : "20661f8a.532c4",
      "id" : "7063a64e.363828",
      "server" : "e2a02faf.48099",
      "y" : 1260
   },
   {
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "6144906.9ca5b7"
         ]
      ],
      "pauseType" : "delay",
      "id" : "fbf6771c.022678",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "x" : 1140,
      "timeout" : "30",
      "z" : "20661f8a.532c4",
      "randomFirst" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "1",
      "rate" : "1",
      "y" : 1260,
      "drop" : false
   },
   {
      "y" : 1220,
      "id" : "92341b16.5c94f8",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "type" : "comment",
      "name" : "Kick off actions when internet comes back online",
      "x" : 200,
      "info" : ""
   },
   {
      "x" : 1275,
      "name" : "Internet back online",
      "type" : "link out",
      "links" : [
         "9fd862b9.9c79b"
      ],
      "wires" : [],
      "z" : "20661f8a.532c4",
      "id" : "6144906.9ca5b7",
      "y" : 1260
   },
   {
      "outputLabels" : [
         "Internet back online"
      ],
      "id" : "9fd862b9.9c79b",
      "y" : 1160,
      "links" : [
         "6144906.9ca5b7"
      ],
      "x" : 55,
      "name" : "Internet back online",
      "type" : "link in",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "ed3ffca4.b612b"
         ]
      ]
   },
   {
      "service_domain" : "notify",
      "id" : "43df1ee7.8196",
      "server" : "e2a02faf.48099",
      "data" : "{ \"message\": \"msg\" }",
      "y" : 280,
      "x" : 1230,
      "type" : "api-call-service",
      "name" : "Notify Family",
      "wires" : [
         []
      ],
      "service" : "family_iphones",
      "z" : "af1cc9bd.91cc08"
   },
   {
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "type" : "comment",
      "name" : "Setup house for Brenda cleaning",
      "x" : 150,
      "info" : "",
      "y" : 2020,
      "id" : "1871cda0.1172c2"
   },
   {
      "name" : "Turn on all lights",
      "type" : "api-call-service",
      "x" : 1000,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "service_domain" : "light",
      "id" : "acbae0b9.5dc98",
      "server" : "e2a02faf.48099",
      "y" : 2100,
      "data" : "{ \"entity_id\":\"group.all_lights\"}"
   },
   {
      "data" : "{ \"entity_id\":\"group.all_lights\"}",
      "y" : 2260,
      "server" : "e2a02faf.48099",
      "id" : "7a06fdae.711514",
      "service_domain" : "light",
      "service" : "turn_off",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1140,
      "name" : "Turn off all lights",
      "type" : "api-call-service"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "cc403516.9a8fe8",
            "646905d3.acd09c"
         ]
      ],
      "entityidfilter" : "sensor.front_door_access_control",
      "x" : 100,
      "haltifstate" : "23",
      "name" : "Front Door Open",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "y" : 2060,
      "server" : "e2a02faf.48099",
      "id" : "ce50ebf8.19a4a8"
   },
   {
      "wires" : [
         [
            "cc403516.9a8fe8",
            "646905d3.acd09c"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "name" : "Garage Door South",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "x" : 110,
      "haltifstate" : "0",
      "entityidfilter" : "sensor.garage_door_south_tilt_alarm_level",
      "y" : 2100,
      "id" : "ac880dc7.614eb",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "b0b0fc2b.79c11",
      "y" : 2060,
      "halt_if" : "off",
      "x" : 740,
      "name" : "If Brenda scheduled to clean",
      "type" : "api-current-state",
      "entity_id" : "calendar.family_brendacleaning",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "acbae0b9.5dc98",
            "90b2edaa.8205c",
            "ab9723c5.8ceee",
            "ad70e368.5df71",
            "d01e41d3.f6416"
         ]
      ]
   },
   {
      "drop" : false,
      "y" : 2180,
      "rate" : "1",
      "nbRateUnits" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "x" : 980,
      "timeout" : "5",
      "timeoutUnits" : "minutes",
      "rateUnits" : "second",
      "id" : "90b2edaa.8205c",
      "pauseType" : "delay",
      "wires" : [
         [
            "c6fc13c9.117d6"
         ]
      ],
      "type" : "delay",
      "name" : ""
   },
   {
      "wires" : [
         [
            "a1ed71c8.2b9bc",
            "4e3500d.6afcf",
            "4ea8deae.cbe9e"
         ]
      ],
      "send_stop" : false,
      "property_stop" : "traffic",
      "name" : "",
      "type" : "traffic",
      "send_allow" : false,
      "property_allow" : "traffic",
      "id" : "522422e0.51d7cc",
      "negate_stop" : false,
      "differ" : false,
      "z" : "8bb76918.ef6b48",
      "x" : 690,
      "filter_stop" : "red",
      "ignore_case_allow" : false,
      "y" : 2220,
      "filter_allow" : "green",
      "ignore_case_stop" : false,
      "default_start" : false,
      "negate_allow" : false
   },
   {
      "pauseType" : "delay",
      "id" : "a1ed71c8.2b9bc",
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "a9205382.f33e3",
            "8e295be8.89f2f8"
         ]
      ],
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "rate" : "1",
      "drop" : false,
      "y" : 2260,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "30",
      "x" : 900,
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1"
   },
   {
      "pauseType" : "rate",
      "id" : "cc403516.9a8fe8",
      "name" : "Only let one message through 30s",
      "type" : "delay",
      "wires" : [
         [
            "522422e0.51d7cc"
         ]
      ],
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "30",
      "rate" : "1",
      "y" : 2140,
      "drop" : true,
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "x" : 440,
      "timeout" : "5",
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1"
   },
   {
      "id" : "c6fc13c9.117d6",
      "property" : "",
      "reg" : false,
      "y" : 2180,
      "action" : "",
      "rules" : [
         {
            "p" : "traffic",
            "t" : "set",
            "to" : "green",
            "pt" : "msg",
            "tot" : "str"
         }
      ],
      "x" : 1190,
      "type" : "change",
      "name" : "Turn on traffic light",
      "from" : "",
      "z" : "8bb76918.ef6b48",
      "to" : "",
      "wires" : [
         [
            "522422e0.51d7cc",
            "e02c805c.a0bde"
         ]
      ]
   },
   {
      "to" : "",
      "wires" : [
         [
            "522422e0.51d7cc"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 690,
      "type" : "change",
      "name" : "Turn off traffic light",
      "from" : "",
      "rules" : [
         {
            "to" : "red",
            "tot" : "str",
            "pt" : "msg",
            "p" : "traffic",
            "t" : "set"
         }
      ],
      "action" : "",
      "y" : 2280,
      "reg" : false,
      "id" : "4ea8deae.cbe9e",
      "property" : ""
   },
   {
      "y" : 2060,
      "data" : "{ \"message\": \"Brenda started cleaning\" }",
      "server" : "e2a02faf.48099",
      "id" : "ab9723c5.8ceee",
      "service_domain" : "notify",
      "z" : "8bb76918.ef6b48",
      "service" : "family_iphones",
      "wires" : [
         []
      ],
      "name" : "Notify Family",
      "type" : "api-call-service",
      "x" : 990
   },
   {
      "service_domain" : "notify",
      "id" : "4e3500d.6afcf",
      "server" : "e2a02faf.48099",
      "data" : "{ \"message\": \"Brenda finished cleaning\" }",
      "y" : 2220,
      "x" : 910,
      "type" : "api-call-service",
      "name" : "Notify Family",
      "wires" : [
         []
      ],
      "service" : "family_iphones",
      "z" : "8bb76918.ef6b48"
   },
   {
      "wires" : [
         []
      ],
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "x" : 400,
      "name" : "Turn on guest mode",
      "type" : "api-call-service",
      "data" : "{ \"entity_id\": \"input_boolean.guest_mode\"}",
      "y" : 2180,
      "id" : "5e8613ec.9b6e1c",
      "service_domain" : "input_boolean",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 2180,
      "id" : "f20c7348.cd1f",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "5e8613ec.9b6e1c",
            "9951bd64.045bf"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "name" : "Brenda scheduled to clean",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "x" : 130,
      "haltifstate" : "off",
      "entityidfilter" : "calendar.family_brendacleaning"
   },
   {
      "y" : 2220,
      "server" : "e2a02faf.48099",
      "id" : "8e295be8.89f2f8",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "7a06fdae.711514",
            "3652e256.daaefe"
         ]
      ],
      "halt_if" : "home",
      "x" : 1110,
      "entity_id" : "group.family",
      "type" : "api-current-state",
      "name" : "If Family Not Home"
   },
   {
      "y" : 2140,
      "id" : "8af8e7dd.fdec38",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "cc403516.9a8fe8",
            "646905d3.acd09c"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "type" : "server-state-changed",
      "name" : "Garage Entry Door South",
      "entityidfiltertype" : "exact",
      "haltifstate" : "23",
      "x" : 130,
      "entityidfilter" : "sensor.garage_entry_door_south_access_control"
   },
   {
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "timeout" : "5",
      "x" : 440,
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "y" : 2060,
      "rate" : "1",
      "nbRateUnits" : "3",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "wires" : [
         [
            "b0b0fc2b.79c11"
         ]
      ],
      "name" : "Only let one message through 3h",
      "type" : "delay",
      "id" : "646905d3.acd09c",
      "pauseType" : "rate"
   },
   {
      "y" : 2100,
      "id" : "4eb7e513.33ff8c",
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "x" : 350,
      "info" : "",
      "name" : "Leaving",
      "type" : "comment"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "a9205382.f33e3",
      "service_domain" : "input_boolean",
      "data" : "{ \"entity_id\": \"input_boolean.guest_mode\"}",
      "y" : 2300,
      "x" : 1120,
      "name" : "Turn off guest mode",
      "type" : "api-call-service",
      "service" : "turn_off",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ]
   },
   {
      "name" : "If no network maintenance",
      "entity_id" : "input_boolean.network_maintenance",
      "type" : "api-current-state",
      "x" : 400,
      "halt_if" : "off",
      "wires" : [
         [
            "f22628cc.ac40d8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "79aef37.ba4700c",
      "server" : "e2a02faf.48099",
      "y" : 1600
   },
   {
      "x" : 240,
      "name" : "Format device_tracker data",
      "type" : "function",
      "outputs" : 1,
      "z" : "7ae32389.5d604c",
      "noerr" : 0,
      "wires" : [
         [
            "516c338e.65601c"
         ]
      ],
      "id" : "bdfc4800.593338",
      "func" : "newmsg = {};\n\n// Get the person we for this event\n// and their previous location\nperson          = msg.data.old_state.attributes.friendly_name.toLowerCase();\nprevious_loc    = global.get(person + '_previous_loc')||null;\n\n\n// Get the last GPS coordinates for both of us. These get set in a \n// loop in the Utilities tab.\nwalt_lat        = parseFloat(global.get('walt_latitude'))||null;\nwalt_lon        = parseFloat(global.get('walt_longitude'))||null;\ndawn_lat        = parseFloat(global.get('dawn_latitude'))||null;\ndawn_lon        = parseFloat(global.get('dawn_longitude'))||null;\n\n// What direction are we headed?\n//\n// Still in the same zone as before\nif (msg.data.new_state.state == msg.data.old_state.state) {\n    verb        = 'unknown';\n    location    = msg.data.new_state.state;\n// Leaving a zone\n} else if (msg.data.new_state.state == 'not_home') {\n    verb        = 'left';\n    location    = msg.data.old_state.state;\n// Entering a new zone\n} else {    \n    verb        = 'is at';\n    location    = msg.data.new_state.state;\n}\n\n// Do the math to see how far apart we are\nlat_diff        = Math.abs(walt_lat - dawn_lat);\nlon_diff        = Math.abs(walt_lon - dawn_lon);\n\nif ( lat_diff > 0.003 || lon_diff > 0.003 ) {\n    newmsg.apart   = 1;\n} else {\n    newmsg.apart   = 0;\n}\n\n// Does this event have us\n// in the same zone as we were last?\nif (location == previous_loc) {\n    newmsg.samezone = 1;\n    newmsg.previous_loc = previous_loc;\n// If not, update our global variables\n} else {\n    newmsg.samezone = 0;\n    newmsg.previous_loc = previous_loc;\n    global.set(person + '_previous_loc', location);\n}\n\n// Build our message object\nnewmsg.walt_lat = walt_lat;\nnewmsg.walt_lon = walt_lon;\nnewmsg.dawn_lat = dawn_lat;\nnewmsg.dawn_lon = dawn_lon;\nnewmsg.lat_diff = lat_diff;\nnewmsg.lon_diff = lon_diff;\nnewmsg.person   = person;\nnewmsg.loc      = location;\nnewmsg.verb     = verb;\nnewmsg.lat      = msg.data.new_state.attributes.latitude;\nnewmsg.lon      = msg.data.new_state.attributes.longitude;\nnewmsg.payload  = { data: {'message': capitalizeFirstLetter(person) + ' ' + verb + ' ' + location } };\n\nreturn newmsg;\n\n\nfunction capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}",
      "y" : 40
   },
   {
      "z" : "7ae32389.5d604c",
      "checkall" : "true",
      "outputs" : 1,
      "wires" : [
         [
            "4fbed005.8d064"
         ]
      ],
      "rules" : [
         {
            "v" : "0",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "name" : "Stop if in same zone as before",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 850,
      "y" : 40,
      "property" : "samezone",
      "id" : "286ded0b.61d8a2"
   },
   {
      "id" : "39dc733b.2aec8c",
      "y" : 320,
      "complete" : "true",
      "console" : "false",
      "type" : "debug",
      "name" : "unknown events",
      "x" : 840,
      "z" : "7ae32389.5d604c",
      "active" : true,
      "wires" : []
   },
   {
      "wires" : [],
      "active" : true,
      "z" : "7ae32389.5d604c",
      "x" : 830,
      "type" : "debug",
      "name" : "is at events",
      "console" : "false",
      "complete" : "true",
      "y" : 280,
      "id" : "ecbc45f0.2c3ce8"
   },
   {
      "id" : "bad86bdd.a7a558",
      "y" : 240,
      "x" : 830,
      "name" : "left events",
      "type" : "debug",
      "console" : "false",
      "complete" : "true",
      "wires" : [],
      "active" : true,
      "z" : "7ae32389.5d604c"
   },
   {
      "name" : "Current GPS coordinates",
      "type" : "api-render-template",
      "x" : 530,
      "wires" : [
         [
            "15d9d133.57e45f"
         ]
      ],
      "z" : "20661f8a.532c4",
      "template" : "person,latitude,longitude,location\ndawn,{{ states.device_tracker.dawns_iphone.attributes.latitude}},{{ states.device_tracker.dawns_iphone.attributes.longitude}},{{states.device_tracker.dawns_iphone.state}}\nwalt,{{ states.device_tracker.walts_iphone.attributes.latitude}},{{ states.device_tracker.walts_iphone.attributes.longitude}},{{states.device_tracker.walts_iphone.state}}",
      "id" : "7d5c167d.428f28",
      "server" : "e2a02faf.48099",
      "y" : 1020
   },
   {
      "wires" : [
         [
            "84c05d12.13676"
         ]
      ],
      "sep" : ",",
      "z" : "20661f8a.532c4",
      "hdrout" : "",
      "ret" : "\\n",
      "name" : "",
      "type" : "csv",
      "multi" : "one",
      "x" : 710,
      "hdrin" : true,
      "y" : 1020,
      "temp" : "",
      "id" : "15d9d133.57e45f"
   },
   {
      "id" : "84c05d12.13676",
      "func" : "// Set this the first time NodeRed runs, so\n// location tracking logic will work\nprevious_loc    = global.get(msg.payload.person + '_previous_loc')||null;\nif (previous_loc == null){\n    global.set(msg.payload.person + '_previous_loc',msg.payload.location);\n}\n\n// Set our global variables\nglobal.set(msg.payload.person + '_latitude',msg.payload.latitude);\nglobal.set(msg.payload.person + '_longitude',msg.payload.longitude);\nglobal.set(msg.payload.person + '_location',msg.payload.location);\n\nmsg.lat_string = msg.payload.person + '_location';\nmsg.lon_string = msg.payload.person + '_longitude';\nmsg.per_string = msg.payload.person + '_location';\n\nreturn msg;",
      "y" : 1020,
      "x" : 870,
      "type" : "function",
      "name" : "Set global variables",
      "outputs" : 1,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ]
   },
   {
      "type" : "switch",
      "name" : "Stop if together",
      "x" : 1080,
      "propertyType" : "msg",
      "rules" : [
         {
            "vt" : "num",
            "v" : "1",
            "t" : "eq"
         }
      ],
      "wires" : [
         []
      ],
      "z" : "7ae32389.5d604c",
      "checkall" : "true",
      "outputs" : 1,
      "property" : "apart",
      "id" : "4fbed005.8d064",
      "y" : 40
   },
   {
      "type" : "subflow:7ae32389.5d604c",
      "name" : "",
      "id" : "2b84ebf7.0c79a4",
      "x" : 600,
      "wires" : [
         [
            "c21dbb32.350808",
            "99c0bcdb.ffe2",
            "11cac704.acdbc9"
         ],
         [
            "691ff7e.4b75e08"
         ]
      ],
      "y" : 120,
      "z" : "46ed0d55.4c98b4"
   },
   {
      "y" : 80,
      "id" : "58c12668.2cd5a8",
      "z" : "46ed0d55.4c98b4",
      "wires" : [],
      "info" : "",
      "x" : 770,
      "type" : "comment",
      "name" : "Build notification message, check if apart, in same zone and coming or going"
   },
   {
      "y" : 1420,
      "server" : "e2a02faf.48099",
      "id" : "fd2f62df.4e43f",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "395a6ecc.172e32"
         ]
      ],
      "entityidfilter" : "binary_sensor.hallway_thermostat_nest_online",
      "x" : 120,
      "haltifstate" : "on",
      "name" : "Nest thermostat offline",
      "type" : "server-state-changed"
   },
   {
      "wires" : [],
      "z" : "20661f8a.532c4",
      "name" : "Notify me if Nest thermostat is offline",
      "type" : "comment",
      "x" : 170,
      "info" : "",
      "y" : 1380,
      "id" : "85938ce5.61be4"
   },
   {
      "wires" : [
         []
      ],
      "service" : "family_iphones",
      "z" : "20661f8a.532c4",
      "x" : 1090,
      "type" : "api-call-service",
      "name" : "Notify Family",
      "data" : "{ \"message\": \"Nest thermostat is offline\" }",
      "y" : 1420,
      "id" : "92c08326.3198",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "395a6ecc.172e32",
      "y" : 1420,
      "halt_if" : "off",
      "name" : "Stop if internet connection is down",
      "type" : "api-current-state",
      "entity_id" : "binary_sensor.wan",
      "x" : 380,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "3a2960dd.1cb6f"
         ]
      ]
   },
   {
      "type" : "comment",
      "name" : "Fade the family room overhead lights",
      "x" : 170,
      "info" : "",
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "id" : "84f62105.2a38a",
      "y" : 2340
   },
   {
      "payloadType" : "str",
      "type" : "inject",
      "name" : "",
      "x" : 100,
      "topic" : "",
      "wires" : [
         [
            "8fab8bcb.ec6f08"
         ]
      ],
      "payload" : "6:00PM",
      "z" : "8bb76918.ef6b48",
      "id" : "1b95bba1.4c1264",
      "once" : false,
      "repeat" : "",
      "y" : 2380,
      "crontab" : "00 18 * * *"
   },
   {
      "x" : 320,
      "name" : "Family Room Overhead lights on?",
      "type" : "api-current-state",
      "entity_id" : "light.family_room_overhead_lights",
      "halt_if" : "off",
      "wires" : [
         [
            "6dd478f3.d42308"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "8fab8bcb.ec6f08",
      "server" : "e2a02faf.48099",
      "y" : 2380
   },
   {
      "data" : "{ \"entity_id\":\"light.family_room_overhead_lights\", \"brightness\":\"0\",\"transition\":\"1800\"}",
      "y" : 2380,
      "id" : "6dd478f3.d42308",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "x" : 630,
      "name" : "Fade off for next half hour",
      "type" : "api-call-service",
      "mergecontext" : ""
   },
   {
      "y" : 340,
      "data" : "{ \"entity_id\":\"group.speakers\",\"message\":\"Hello there, this is the default message. Walt didn't program me correctly.\" }",
      "server" : "e2a02faf.48099",
      "id" : "f93bf994.15e5b8",
      "service_domain" : "tts",
      "z" : "837bbace.420028",
      "service" : "google_say",
      "wires" : [
         []
      ],
      "type" : "api-call-service",
      "name" : "Speak",
      "x" : 330
   },
   {
      "wires" : [
         [],
         []
      ],
      "y" : 800,
      "z" : "af1cc9bd.91cc08",
      "name" : "",
      "type" : "subflow:837bbace.420028",
      "id" : "e91e1174.d8ddc",
      "x" : 1030
   },
   {
      "z" : "46ed0d55.4c98b4",
      "y" : 140,
      "wires" : [
         [],
         []
      ],
      "type" : "subflow:837bbace.420028",
      "name" : "",
      "id" : "81d992b2.e41e7",
      "x" : 1530
   },
   {
      "y" : 380,
      "id" : "15f0d1a8.3d51ce",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "43404661.90a528"
         ]
      ],
      "z" : "46ed0d55.4c98b4",
      "name" : "Wifes Location Changed",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "x" : 130,
      "haltifstate" : "",
      "entityidfilter" : "group.dawn_tracking"
   },
   {
      "id" : "a19954d6.c6d788",
      "server" : "e2a02faf.48099",
      "y" : 440,
      "haltifstate" : "",
      "x" : 130,
      "name" : "Walts Location Changed",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "entityidfilter" : "group.walt_tracking",
      "wires" : [
         [
            "1483ade6.e40162"
         ]
      ],
      "z" : "46ed0d55.4c98b4"
   },
   {
      "id" : "fdcc21e8.0b72",
      "property" : "payload",
      "repair" : false,
      "y" : 60,
      "propertyType" : "msg",
      "x" : 140,
      "type" : "switch",
      "name" : "Home?",
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "home"
         }
      ],
      "wires" : [
         [
            "c26b0d5c.63039"
         ]
      ],
      "outputs" : 1,
      "checkall" : "true",
      "z" : "63316ec5.c01aa"
   },
   {
      "y" : 320,
      "maxtimeoutunits" : "Minute",
      "id" : "c23cf331.b7496",
      "wires" : [
         [
            "b0396b1e.71f768"
         ],
         []
      ],
      "z" : "63316ec5.c01aa",
      "type" : "looptimer",
      "name" : "",
      "x" : 660,
      "maxtimeout" : "10",
      "units" : "Second",
      "duration" : "5",
      "maxloops" : "120"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "b0396b1e.71f768",
      "y" : 320,
      "halt_if" : "0",
      "name" : "Garage Stairs Motion",
      "type" : "api-current-state",
      "entity_id" : "sensor.garage_stairs_motion_sensor_alarm_level",
      "x" : 880,
      "z" : "63316ec5.c01aa",
      "wires" : [
         [
            "5c3edf03.6c8c9",
            "1ab60923.98bab7"
         ]
      ]
   },
   {
      "y" : 420,
      "action" : "",
      "reg" : false,
      "id" : "5c3edf03.6c8c9",
      "property" : "",
      "wires" : [
         [
            "c23cf331.b7496"
         ]
      ],
      "to" : "",
      "z" : "63316ec5.c01aa",
      "x" : 700,
      "type" : "change",
      "name" : "Stop loop",
      "from" : "",
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "to" : "stop",
            "pt" : "msg",
            "tot" : "str"
         }
      ]
   },
   {
      "x" : 1120,
      "timeout" : "5",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "randomFirst" : "1",
      "z" : "63316ec5.c01aa",
      "nbRateUnits" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "y" : 320,
      "drop" : false,
      "rate" : "1",
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "96f71b34.5ea358"
         ]
      ],
      "id" : "1ab60923.98bab7",
      "pauseType" : "delay"
   },
   {
      "name" : "If home and came up garage stairs within 10 minutes",
      "type" : "subflow:63316ec5.c01aa",
      "x" : 460,
      "id" : "43404661.90a528",
      "z" : "46ed0d55.4c98b4",
      "y" : 380,
      "wires" : [
         [
            "d28d682.8d8cc98"
         ]
      ]
   },
   {
      "name" : "Theme song",
      "type" : "comment",
      "info" : "",
      "x" : 90,
      "wires" : [],
      "z" : "46ed0d55.4c98b4",
      "id" : "faa707fe.651fe8",
      "y" : 340
   },
   {
      "z" : "46ed0d55.4c98b4",
      "y" : 438.888899803162,
      "wires" : [
         [
            "dc0c97dd.b57788"
         ]
      ],
      "x" : 460.000015258789,
      "id" : "1483ade6.e40162",
      "name" : "If home and came up garage stairs within 10 minutes",
      "type" : "subflow:63316ec5.c01aa"
   },
   {
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/whererainbowsneverdie.mp3\" }",
      "y" : 480,
      "server" : "e2a02faf.48099",
      "id" : "1050a6f4.c01fc9",
      "service_domain" : "media_player",
      "service" : "play_media",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         []
      ],
      "x" : 1530,
      "type" : "api-call-service",
      "name" : "Play where rainbows never die"
   },
   {
      "z" : "63316ec5.c01aa",
      "wires" : [
         [
            "96899437.d15718"
         ]
      ],
      "halt_if" : "playing",
      "x" : 1330,
      "entity_id" : "media_player.kitchen_speaker",
      "type" : "api-current-state",
      "name" : "Kitchen media already playing?",
      "y" : 320,
      "server" : "e2a02faf.48099",
      "id" : "96f71b34.5ea358"
   },
   {
      "mergecontext" : "",
      "name" : "Set volume on Kitchen",
      "type" : "api-call-service",
      "x" : 1320,
      "z" : "63316ec5.c01aa",
      "service" : "volume_set",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "service_domain" : "media_player",
      "id" : "96899437.d15718",
      "y" : 420,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"volume_level\":0.5 }"
   },
   {
      "x" : 1289.99993896484,
      "propertyType" : "msg",
      "type" : "switch",
      "name" : "",
      "rules" : [
         {
            "t" : "eq",
            "v" : "1",
            "vt" : "num"
         },
         {
            "vt" : "num",
            "v" : "2",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "vt" : "num",
            "v" : "3"
         }
      ],
      "wires" : [
         [
            "8564aa45.09c308",
            "9aeac2f5.1ac2b"
         ],
         [
            "fea5ff67.7f1f7"
         ],
         []
      ],
      "outputs" : 3,
      "checkall" : "true",
      "z" : "46ed0d55.4c98b4",
      "id" : "fdc23414.943788",
      "property" : "payload",
      "y" : 381.249982833862
   },
   {
      "low" : "1",
      "high" : "3",
      "id" : "3bfb5fd2.949c8",
      "inte" : "true",
      "y" : 381.249982833862,
      "name" : "",
      "type" : "random",
      "x" : 1139.99993896484,
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "fdc23414.943788"
         ]
      ]
   },
   {
      "id" : "8564aa45.09c308",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "y" : 381.249982833862,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/takeiteasy.mp3\" }",
      "name" : "Play take it easy",
      "type" : "api-call-service",
      "x" : 1479.99993896484,
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media"
   },
   {
      "x" : 1509.99993896484,
      "type" : "api-call-service",
      "name" : "Play here comes the sun",
      "wires" : [
         []
      ],
      "service" : "play_media",
      "z" : "46ed0d55.4c98b4",
      "id" : "fea5ff67.7f1f7",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/herecomesthesun.mp3\" }",
      "y" : 421.249982833862
   },
   {
      "x" : 1139.99993896484,
      "name" : "",
      "type" : "random",
      "wires" : [
         [
            "47bcb992.c5d798"
         ]
      ],
      "z" : "46ed0d55.4c98b4",
      "id" : "e03928ff.4d5588",
      "high" : "8",
      "low" : "1",
      "y" : 441.249982833862,
      "inte" : "true"
   },
   {
      "y" : 481.249982833862,
      "id" : "47bcb992.c5d798",
      "property" : "payload",
      "wires" : [
         [
            "1050a6f4.c01fc9"
         ],
         [
            "fb811233.7983b"
         ],
         [
            "7815ac5e.50fc04"
         ],
         [
            "5ff24215.7d65fc"
         ],
         [
            "3722025f.430efe"
         ],
         [
            "a8d5175d.487628"
         ],
         [
            "4cf2632a.01316c"
         ],
         [
            "1a16c8d0.590bc7"
         ]
      ],
      "outputs" : 8,
      "checkall" : "true",
      "z" : "46ed0d55.4c98b4",
      "x" : 1289.99993896484,
      "propertyType" : "msg",
      "type" : "switch",
      "name" : "",
      "rules" : [
         {
            "t" : "eq",
            "vt" : "num",
            "v" : "1"
         },
         {
            "t" : "eq",
            "vt" : "num",
            "v" : "2"
         },
         {
            "v" : "3",
            "vt" : "num",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "v" : "4",
            "vt" : "num"
         },
         {
            "v" : "5",
            "vt" : "num",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "vt" : "num",
            "v" : "6"
         },
         {
            "vt" : "num",
            "v" : "7",
            "t" : "eq"
         },
         {
            "v" : "8",
            "vt" : "num",
            "t" : "eq"
         }
      ]
   },
   {
      "service_domain" : "media_player",
      "id" : "fb811233.7983b",
      "server" : "e2a02faf.48099",
      "y" : 518.750000953674,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/fortunateson.mp3\" }",
      "name" : "Play fortunate son",
      "type" : "api-call-service",
      "x" : 1490,
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media"
   },
   {
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/imperial_march.mp3\" }",
      "y" : 562.500000953674,
      "server" : "e2a02faf.48099",
      "id" : "7815ac5e.50fc04",
      "service_domain" : "media_player",
      "service" : "play_media",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         []
      ],
      "x" : 1490,
      "type" : "api-call-service",
      "name" : "Play imperial march"
   },
   {
      "y" : 60,
      "startTime" : "07:30",
      "endTime" : "20:00",
      "endOffset" : 0,
      "id" : "c26b0d5c.63039",
      "startOffset" : 0,
      "z" : "63316ec5.c01aa",
      "wires" : [
         [
            "20c40273.56f46e"
         ],
         []
      ],
      "lat" : "40.17341",
      "lon" : "-92.58913",
      "x" : 320,
      "type" : "time-range-switch",
      "name" : "Not too early or late"
   },
   {
      "payloadval" : "0",
      "id" : "51dc80d1.06f3f",
      "y" : 2500,
      "units" : "Minute",
      "duration" : "10",
      "name" : "10 minutes",
      "payloadtype" : "num",
      "type" : "stoptimer",
      "x" : 630,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "3eeac3ae.20271c"
         ],
         []
      ]
   },
   {
      "y" : 2500,
      "repair" : false,
      "outputLabels" : [
         "Open",
         "Closed"
      ],
      "property" : "payload",
      "id" : "b52dfdd4.c017a",
      "z" : "8bb76918.ef6b48",
      "outputs" : 2,
      "checkall" : "true",
      "wires" : [
         [
            "51dc80d1.06f3f"
         ],
         [
            "a82417fa.460858"
         ]
      ],
      "rules" : [
         {
            "v" : "open",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "v" : "closed",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "type" : "switch",
      "name" : "Door Open Or Closed",
      "x" : 300,
      "propertyType" : "msg"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "b52dfdd4.c017a"
         ]
      ],
      "entityidfilter" : "sensor.fridge",
      "x" : 110,
      "haltifstate" : "",
      "type" : "server-state-changed",
      "name" : "Fridge Door",
      "entityidfiltertype" : "exact",
      "y" : 2500,
      "server" : "e2a02faf.48099",
      "id" : "e2d734fb.d54b58"
   },
   {
      "property" : "",
      "id" : "a82417fa.460858",
      "y" : 2540,
      "action" : "",
      "reg" : false,
      "from" : "",
      "name" : "Stop timer",
      "type" : "change",
      "x" : 490,
      "rules" : [
         {
            "pt" : "msg",
            "tot" : "str",
            "to" : "STOP",
            "p" : "payload",
            "t" : "set"
         }
      ],
      "wires" : [
         [
            "51dc80d1.06f3f"
         ]
      ],
      "to" : "",
      "z" : "8bb76918.ef6b48"
   },
   {
      "outputs" : 1,
      "z" : "8bb76918.ef6b48",
      "noerr" : 0,
      "wires" : [
         [
            "7fb60480.8206cc",
            "ce2bc2dd.afdbd",
            "3808286d.300a98"
         ]
      ],
      "x" : 830,
      "type" : "function",
      "name" : "Format message",
      "func" : "msg.payload = { data: {'message': 'Fridge door has been open over 10 minutes' } };\n\nreturn msg;",
      "y" : 2500,
      "id" : "3eeac3ae.20271c"
   },
   {
      "id" : "7fb60480.8206cc",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "y" : 2540,
      "data" : "{ \"message\": \"msg\" }",
      "name" : "Notify Family",
      "type" : "api-call-service",
      "x" : 1070,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "family_iphones"
   },
   {
      "id" : "ce2bc2dd.afdbd",
      "x" : 1070,
      "name" : "",
      "type" : "subflow:837bbace.420028",
      "y" : 2580,
      "wires" : [
         [],
         []
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "id" : "c0393928.163bd8",
      "y" : 2460,
      "x" : 100,
      "info" : "",
      "type" : "comment",
      "name" : "Fridge left open",
      "z" : "8bb76918.ef6b48",
      "wires" : []
   },
   {
      "y" : 341.249982833862,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/walkingonsunshine.mp3\" }",
      "server" : "e2a02faf.48099",
      "service_domain" : "media_player",
      "id" : "9aeac2f5.1ac2b",
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media",
      "wires" : [
         []
      ],
      "name" : "Play walking on sunshine",
      "type" : "api-call-service",
      "x" : 1509.99993896484
   },
   {
      "x" : 590,
      "timeout" : "5",
      "timeoutUnits" : "seconds",
      "rateUnits" : "hour",
      "randomFirst" : "1",
      "z" : "63316ec5.c01aa",
      "nbRateUnits" : "3",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "y" : 60,
      "drop" : true,
      "rate" : "1",
      "type" : "delay",
      "name" : "One message per three hours",
      "wires" : [
         [
            "c23cf331.b7496"
         ]
      ],
      "id" : "20c40273.56f46e",
      "pauseType" : "rate"
   },
   {
      "y" : 280,
      "id" : "b90a0792.9b04f8",
      "wires" : [],
      "z" : "63316ec5.c01aa",
      "x" : 740,
      "info" : "",
      "type" : "comment",
      "name" : "Loop and wait for movement on the stairs"
   },
   {
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media",
      "name" : "Play September",
      "type" : "api-call-service",
      "x" : 1479.99995422363,
      "y" : 603.749992370605,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/september.mp3\" }",
      "service_domain" : "media_player",
      "id" : "5ff24215.7d65fc",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "api-call-service",
      "name" : "Play Let it Be",
      "x" : 1469.99995422363,
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "service_domain" : "media_player",
      "id" : "3722025f.430efe",
      "y" : 643.749992370605,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/letitbe.mp3\" }"
   },
   {
      "y" : 683.749992370605,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/withalittlehelp.mp3\" }",
      "server" : "e2a02faf.48099",
      "service_domain" : "media_player",
      "id" : "a8d5175d.487628",
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media",
      "wires" : [
         []
      ],
      "type" : "api-call-service",
      "name" : "Play With a Little Help from my Friends",
      "x" : 1549.99995422363
   },
   {
      "y" : 723.749992370605,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/seaonsoflove.mp3\" }",
      "server" : "e2a02faf.48099",
      "service_domain" : "media_player",
      "id" : "4cf2632a.01316c",
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media",
      "wires" : [
         []
      ],
      "type" : "api-call-service",
      "name" : "Play Seasons of Love",
      "x" : 1499.99995422363
   },
   {
      "y" : 763.749992370605,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/constantsorrow.mp3\" }",
      "id" : "1a16c8d0.590bc7",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media",
      "type" : "api-call-service",
      "name" : "Play Man of Constant Sorrow",
      "x" : 1529.99995422363
   },
   {
      "id" : "83d00a78.9de298",
      "property" : "",
      "reg" : false,
      "y" : 1320,
      "action" : "",
      "rules" : [
         {
            "p" : "payload",
            "t" : "set",
            "tot" : "str",
            "pt" : "msg",
            "to" : "stop"
         }
      ],
      "x" : 680,
      "type" : "change",
      "from" : "",
      "name" : "Stop loop",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "416f2de9.793354"
         ]
      ],
      "to" : ""
   },
   {
      "maxloops" : "15",
      "units" : "Minute",
      "maxtimeout" : "15",
      "duration" : "1",
      "type" : "looptimer",
      "name" : "15 minute loop, checking every minute",
      "x" : 730,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "c6dbf0f.203b41"
         ],
         [
            "92c08326.3198"
         ]
      ],
      "maxtimeoutunits" : "Minute",
      "id" : "3a2960dd.1cb6f",
      "y" : 1420
   },
   {
      "id" : "c6dbf0f.203b41",
      "server" : "e2a02faf.48099",
      "y" : 1480,
      "x" : 1030,
      "type" : "api-current-state",
      "name" : "Nest back online?",
      "entity_id" : "binary_sensor.hallway_thermostat_nest_online",
      "halt_if" : "off",
      "wires" : [
         [
            "65b88bf4.0ede14"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "rules" : [
         {
            "to" : "stop",
            "pt" : "msg",
            "tot" : "str",
            "t" : "set",
            "p" : "payload"
         }
      ],
      "type" : "change",
      "name" : "Stop loop",
      "from" : "",
      "x" : 740,
      "z" : "20661f8a.532c4",
      "to" : "",
      "wires" : [
         [
            "3a2960dd.1cb6f"
         ]
      ],
      "property" : "",
      "id" : "65b88bf4.0ede14",
      "reg" : false,
      "action" : "",
      "y" : 1500
   },
   {
      "wires" : [
         [
            "ad643c5b.60531"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "haltifstate" : "",
      "x" : 100,
      "type" : "server-state-changed",
      "name" : "Mailbox opened",
      "entityidfiltertype" : "exact",
      "entityidfilter" : "sensor.mailbox",
      "y" : 2720,
      "id" : "4d5ee5d4.d7ccdc",
      "server" : "e2a02faf.48099"
   },
   {
      "repair" : false,
      "y" : 2720,
      "id" : "ad643c5b.60531",
      "property" : "payload",
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "wires" : [
         [
            "fbb52f5d.6774a"
         ],
         []
      ],
      "checkall" : "true",
      "outputs" : 2,
      "z" : "8bb76918.ef6b48",
      "propertyType" : "msg",
      "x" : 280,
      "type" : "switch",
      "name" : "Opened",
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "open"
         },
         {
            "t" : "eq",
            "v" : "closed",
            "vt" : "str"
         }
      ]
   },
   {
      "type" : "subflow:c663f7df.ca58b8",
      "name" : "",
      "x" : 530,
      "id" : "fbb52f5d.6774a",
      "z" : "8bb76918.ef6b48",
      "y" : 2720,
      "wires" : [
         [
            "9de2a83.a6bb358",
            "77079ef.8cf8f6",
            "ddb1a0bf.cc37e"
         ]
      ]
   },
   {
      "service_domain" : "notify",
      "id" : "9de2a83.a6bb358",
      "server" : "e2a02faf.48099",
      "y" : 2760,
      "data" : "{ \"message\":\"request_location_update\"}",
      "type" : "api-call-service",
      "name" : "Update Walts location",
      "x" : 1020,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "ios_walts_iphone"
   },
   {
      "data" : "{ \"message\":\"request_location_update\"}",
      "y" : 2720,
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "77079ef.8cf8f6",
      "service" : "ios_dawns_iphone",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1030,
      "type" : "api-call-service",
      "name" : "Update Wifes location"
   },
   {
      "drop" : false,
      "y" : 2780,
      "rate" : "1",
      "nbRateUnits" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "x" : 700,
      "timeout" : "3",
      "timeoutUnits" : "minutes",
      "rateUnits" : "second",
      "id" : "ddb1a0bf.cc37e",
      "pauseType" : "delay",
      "wires" : [
         [
            "427a971c.806c48"
         ]
      ],
      "type" : "delay",
      "name" : "3 minute delay for location update"
   },
   {
      "type" : "subflow:c663f7df.ca58b8",
      "name" : "Family still not home",
      "x" : 720,
      "id" : "427a971c.806c48",
      "y" : 2840,
      "wires" : [
         [
            "8cc864e1.ee5098"
         ]
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "x" : 1610,
      "name" : "Format message",
      "type" : "function",
      "outputs" : 1,
      "noerr" : 0,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "2fb8b888.7994a8"
         ]
      ],
      "id" : "338c1b68.643ad4",
      "y" : 2880,
      "func" : "msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened!' } };\n\nreturn msg;"
   },
   {
      "wires" : [
         []
      ],
      "service" : "family_iphones",
      "z" : "8bb76918.ef6b48",
      "x" : 1830,
      "type" : "api-call-service",
      "name" : "Notify Family",
      "data" : "{ \"message\": \"msg\" }",
      "y" : 2880,
      "service_domain" : "notify",
      "id" : "2fb8b888.7994a8",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "517387c6.b635a8",
      "y" : 2620,
      "info" : "",
      "x" : 140,
      "name" : "Mail and package notifications",
      "type" : "comment",
      "wires" : [],
      "z" : "8bb76918.ef6b48"
   },
   {
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "1",
      "rate" : "1",
      "drop" : false,
      "y" : 120,
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "x" : 360,
      "timeout" : "25",
      "z" : "46ed0d55.4c98b4",
      "randomFirst" : "1",
      "pauseType" : "delay",
      "id" : "788e2d3e.b185a4",
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "2b84ebf7.0c79a4"
         ]
      ]
   },
   {
      "info" : "",
      "x" : 190,
      "type" : "comment",
      "name" : "Track sleeping and in bed bayesian sensors",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "id" : "7778281.c7037d8",
      "y" : 1560
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "2f25245a.48e91c"
         ]
      ],
      "entityidfilter" : "binary_sensor.family_in_bed",
      "haltifstate" : "",
      "x" : 90,
      "name" : "Family in bed",
      "type" : "server-state-changed",
      "y" : 1600,
      "server" : "e2a02faf.48099",
      "id" : "57402989.7ec548"
   },
   {
      "y" : 1640,
      "id" : "3602397.0b6d9c6",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "6b248d00.8f2844"
         ]
      ],
      "z" : "20661f8a.532c4",
      "name" : "Family sleeping",
      "type" : "server-state-changed",
      "x" : 100,
      "haltifstate" : "",
      "entityidfilter" : "binary_sensor.family_sleeping"
   },
   {
      "id" : "2f25245a.48e91c",
      "y" : 1600,
      "x" : 310,
      "type" : "debug",
      "name" : "Bed",
      "complete" : "true",
      "console" : "false",
      "wires" : [],
      "active" : true,
      "z" : "20661f8a.532c4"
   },
   {
      "id" : "6b248d00.8f2844",
      "y" : 1640,
      "x" : 320,
      "type" : "debug",
      "name" : "Sleeping",
      "console" : "false",
      "complete" : "true",
      "wires" : [],
      "active" : true,
      "z" : "20661f8a.532c4"
   },
   {
      "id" : "53da29f5.9c6808",
      "outputLabels" : [
         "No guests",
         "Guests"
      ],
      "func" : "guest_mode      = global.get('guest_mode')||null;\nmsg.guest_mode  = guest_mode;\n\nif(guest_mode == 'off') {\n    msg.abort_alert = 0;\n    return[msg,null];\n} else {\n    msg.abort_alert = 1;\n    return[null,msg];\n}",
      "y" : 156.071426391602,
      "name" : "Is guest mode on?",
      "type" : "function",
      "x" : 198.75,
      "wires" : [
         [
            "8285e427.a52808",
            "7aab0772.4c7a48",
            "27bfb240.31fede"
         ],
         []
      ],
      "noerr" : 0,
      "z" : "837bbace.420028",
      "outputs" : "2"
   },
   {
      "id" : "264e27e2.d38b58",
      "pauseType" : "rate",
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "aebd9c21.e33fc"
         ]
      ],
      "nbRateUnits" : "10",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "drop" : true,
      "y" : 1800,
      "rate" : "1",
      "x" : 720,
      "timeout" : "5",
      "timeoutUnits" : "seconds",
      "rateUnits" : "minute",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48"
   },
   {
      "property" : "payload",
      "id" : "225ea6ad.d070aa",
      "y" : 101,
      "name" : "Home?",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 295,
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "home"
         }
      ],
      "wires" : [
         [
            "39ebd578.aa60fa",
            "bbaa55e4.8d5ba8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "checkall" : "true",
      "outputs" : 1
   },
   {
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup the house automation - Upstairs\" }",
      "y" : 280,
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "82f399bc.7354c8",
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 960,
      "type" : "api-call-service",
      "name" : "Logbook entry"
   },
   {
      "x" : 960,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "99edfdc7.a8032",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup the house automation - Main level and basement\" }",
      "y" : 400
   },
   {
      "y" : 1000,
      "id" : "cf264772.aac4a8",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "b01b30c3.7ec77"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "name" : "Family Awake",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "x" : 90,
      "haltifstate" : "on",
      "entityidfilter" : "binary_sensor.family_sleeping"
   },
   {
      "wires" : [
         [
            "b01b30c3.7ec77"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "haltifstate" : "on",
      "x" : 110,
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "name" : "Family Awake in Bed",
      "entityidfilter" : "binary_sensor.family_in_bed",
      "y" : 1040,
      "id" : "7883ed0e.e29c44",
      "server" : "e2a02faf.48099"
   },
   {
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds",
      "timeout" : "5",
      "x" : 540,
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "4",
      "rate" : "1",
      "y" : 1020,
      "drop" : true,
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "29595b6c.c997f4"
         ]
      ],
      "pauseType" : "rate",
      "id" : "f3f27a31.04bd68"
   },
   {
      "wires" : [
         [
            "6c2cb8e6.f03118"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 760,
      "name" : "Main Level lights already on?",
      "type" : "api-current-state",
      "entity_id" : "group.main_level",
      "halt_if" : "on",
      "y" : 1020,
      "id" : "29595b6c.c997f4",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "3c32ebf7.883b04",
      "y" : 1140,
      "name" : "Turn off coffee grinder",
      "type" : "comment",
      "info" : "",
      "x" : 120,
      "wires" : [],
      "z" : "8bb76918.ef6b48"
   },
   {
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "x" : 1380,
      "y" : 1140,
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turn on the main level lights, upstairs landing and Son2s lamp\" }",
      "service_domain" : "logbook",
      "id" : "35f94b13.cba8a4",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "73889795.a700e8",
      "y" : 1020,
      "halt_if" : "on",
      "name" : "If Guest Mode Off",
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state",
      "x" : 1170,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "ce8445.e7feabb8",
            "35f94b13.cba8a4",
            "6bf1b288.344ccc",
            "bc127838.e440f8",
            "47c3d025.fe7ac"
         ]
      ]
   },
   {
      "endOffset" : 0,
      "endTime" : "10:00",
      "startTime" : "06:00",
      "id" : "b01b30c3.7ec77",
      "y" : 1020,
      "lon" : "",
      "type" : "time-range-switch",
      "name" : "6AM to 10AM",
      "x" : 360,
      "z" : "8bb76918.ef6b48",
      "startOffset" : 0,
      "wires" : [
         [
            "f3f27a31.04bd68"
         ],
         []
      ],
      "lat" : ""
   },
   {
      "halt_if" : "on",
      "entity_id" : "light.philips_lct014_0288ce3f_11",
      "type" : "api-current-state",
      "name" : "Son1s light already on?",
      "x" : 850,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "bf6eb2bf.f3cf4"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "9ff97d14.a2d8e",
      "y" : 1280
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "60801386.316afc",
      "y" : 1320,
      "halt_if" : "on",
      "name" : "Master bedroom light already on?",
      "entity_id" : "light.master_bedroom",
      "type" : "api-current-state",
      "x" : 820,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "50de5197.f732a"
         ]
      ]
   },
   {
      "x" : 1310,
      "type" : "api-call-service",
      "name" : "Turn on Master bedroom lamp at 1%",
      "mergecontext" : "",
      "wires" : [
         [
            "d42c4e19.01a5c"
         ]
      ],
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "service_domain" : "light",
      "id" : "d890e20a.375ec",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"brightness\":\"1\", \"color_temp\":\"236\"}",
      "y" : 1400
   },
   {
      "op2type" : "str",
      "bytopic" : "all",
      "op1" : "1",
      "id" : "72e3d694.804d08",
      "wires" : [
         [
            "bbe2b033.614"
         ]
      ],
      "extend" : false,
      "name" : "Wait thirty seconds",
      "type" : "trigger",
      "units" : "s",
      "y" : 1440,
      "op2" : "0",
      "op1type" : "str",
      "z" : "8bb76918.ef6b48",
      "x" : 1250,
      "reset" : "",
      "duration" : "30"
   },
   {
      "mergecontext" : "",
      "type" : "api-call-service",
      "name" : "Start 10 minute fade in for Master bedroom lamps",
      "x" : 1570,
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "bbe2b033.614",
      "y" : 1440,
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"transition\":\"600\",\"brightness\":\"255\", \"color_temp\":\"236\"}"
   },
   {
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "x" : 1240,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Fade on the light on work days - Son1s Lamp\" }",
      "y" : 1280,
      "id" : "86dd48f7.85d0c8",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 1480,
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Fade on the light on work days - Master bedroom Lamp\" }",
      "id" : "fe9b65ed.5508f8",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "type" : "api-call-service",
      "name" : "Logbook entry",
      "x" : 1240
   },
   {
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Rebooting network gear \" }",
      "y" : 1640,
      "service_domain" : "logbook",
      "id" : "10fc5f28.e36c81",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "x" : 840,
      "name" : "Logbook entry",
      "type" : "api-call-service"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "3841f6fb.417bea",
      "service_domain" : "logbook",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turn down heat and lights off when we are away\" }",
      "y" : 1800,
      "x" : 1220,
      "type" : "api-call-service",
      "name" : "Logbook entry",
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ]
   },
   {
      "x" : 380,
      "type" : "api-call-service",
      "name" : "Logbook entry",
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "service_domain" : "logbook",
      "id" : "9951bd64.045bf",
      "server" : "e2a02faf.48099",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - guest mode turned on\" }",
      "y" : 2220
   },
   {
      "id" : "ad70e368.5df71",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - Brenda in the house\" }",
      "y" : 2060,
      "x" : 1240,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "mergecontext" : "",
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48"
   },
   {
      "y" : 2180,
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - Traffic light turned on, waiting for exit door event\" }",
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "e02c805c.a0bde",
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "wires" : [
         []
      ],
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "x" : 1420
   },
   {
      "x" : 1080,
      "type" : "api-call-service",
      "name" : "Logbook entry",
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "id" : "3808286d.300a98",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Fridge left open\" }",
      "y" : 2500
   },
   {
      "x" : 1410,
      "type" : "api-call-service",
      "name" : "Turn on upstairs landing",
      "wires" : [
         []
      ],
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "id" : "6bf1b288.344ccc",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"light.sengled_e11g13_030b05a4_1\"}",
      "y" : 1020
   },
   {
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "name" : "Turn on Son2's Lamp",
      "type" : "api-call-service",
      "x" : 1400,
      "y" : 1060,
      "data" : "{ \"entity_id\":\"light.colins_lamp\"}",
      "server" : "e2a02faf.48099",
      "id" : "bc127838.e440f8",
      "service_domain" : "light"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "ed4a317.d35a1d",
            "f9f7f1a3.bfa93",
            "70445fd.82f60a",
            "da524a1f.6dd768",
            "eb4e20ed.e3724"
         ]
      ],
      "filetype" : "text",
      "x" : 200,
      "name" : "",
      "type" : "tail",
      "split" : true,
      "y" : 1740,
      "filename" : "/Users/hass/.homeassistant/home-assistant.log",
      "id" : "9f78922.51b117"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [],
      "info" : "",
      "x" : 160,
      "type" : "comment",
      "name" : "Watch the Home Assistant Log file",
      "y" : 1700,
      "id" : "c82ff4c0.f55558"
   },
   {
      "id" : "ed4a317.d35a1d",
      "property" : "payload",
      "y" : 1860,
      "propertyType" : "msg",
      "x" : 540,
      "name" : "Walt's phone rate limit",
      "type" : "switch",
      "rules" : [
         {
            "case" : false,
            "t" : "regex",
            "v" : "iOS push notification rate limits for walts_iphone",
            "vt" : "str"
         }
      ],
      "wires" : [
         [
            "eda75d39.207a6"
         ]
      ],
      "outputs" : 1,
      "checkall" : "true",
      "z" : "20661f8a.532c4"
   },
   {
      "id" : "f9f7f1a3.bfa93",
      "property" : "payload",
      "y" : 1900,
      "propertyType" : "msg",
      "x" : 550,
      "type" : "switch",
      "name" : "Wife's phone rate limit",
      "rules" : [
         {
            "t" : "regex",
            "case" : false,
            "vt" : "str",
            "v" : "iOS push notification rate limits for dawns_iphone"
         }
      ],
      "wires" : [
         [
            "d4678f72.89286"
         ]
      ],
      "outputs" : 1,
      "checkall" : "true",
      "z" : "20661f8a.532c4"
   },
   {
      "id" : "eda75d39.207a6",
      "y" : 1860,
      "func" : "sent        = msg.payload.replace(/.*phone: ([0-9]+) sent.*/, '$1');\nmsg.sent    = sent;\nreturn msg;",
      "type" : "function",
      "name" : "Pull out number of sent messages",
      "x" : 860,
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "outputs" : 1,
      "wires" : [
         [
            "b260c7f9.565ce8"
         ]
      ]
   },
   {
      "y" : 1860,
      "id" : "b260c7f9.565ce8",
      "wires" : [],
      "active" : true,
      "z" : "20661f8a.532c4",
      "x" : 1190,
      "type" : "debug",
      "name" : "number of push to walts phone",
      "complete" : "true",
      "console" : "false"
   },
   {
      "wires" : [
         [
            "8eacbe5a.7b03e"
         ]
      ],
      "outputs" : 1,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "x" : 860,
      "name" : "Pull out number of sent messages",
      "type" : "function",
      "y" : 1900,
      "func" : "sent        = msg.payload.replace(/.*phone: ([0-9]+) sent.*/, '$1');\nmsg.sent    = sent;\nreturn msg;",
      "id" : "d4678f72.89286"
   },
   {
      "y" : 1900,
      "id" : "8eacbe5a.7b03e",
      "active" : true,
      "z" : "20661f8a.532c4",
      "wires" : [],
      "console" : "false",
      "complete" : "true",
      "x" : 1190,
      "type" : "debug",
      "name" : "number of push to dawns phone"
   },
   {
      "y" : 1940,
      "id" : "bfcd5a63.ce7c58",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 1200,
      "info" : "",
      "name" : "TODO: Set these as variables in Home Assistant",
      "type" : "comment"
   },
   {
      "lon" : "-92.58936",
      "type" : "time-range-switch",
      "name" : "Off while sun shines into garage",
      "x" : 330,
      "z" : "af1cc9bd.91cc08",
      "startOffset" : "-90",
      "wires" : [
         [
            "aae0381e.3331d8"
         ],
         []
      ],
      "lat" : "40.17349",
      "endTime" : "sunriseEnd",
      "endOffset" : 0,
      "startTime" : "sunsetStart",
      "id" : "806fa6b.8209558",
      "y" : 140
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "6c2cb8e6.f03118",
      "y" : 1020,
      "halt_if" : "not_home",
      "entity_id" : "group.family",
      "name" : "If Family Home",
      "type" : "api-current-state",
      "x" : 980,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "73889795.a700e8"
         ]
      ]
   },
   {
      "halt_if" : "",
      "x" : 490,
      "type" : "api-current-state",
      "entity_id" : "sensor.ha_uptime_sec",
      "name" : "HA Uptime",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "a7728792.0516b8"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "4d20e83c.3733d8",
      "y" : 900
   },
   {
      "outputs" : 1,
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "wires" : [
         []
      ],
      "x" : 670,
      "name" : "Set global variables",
      "type" : "function",
      "y" : 900,
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "id" : "a7728792.0516b8"
   },
   {
      "wires" : [
         [
            "40333e92.b491c"
         ]
      ],
      "z" : "c663f7df.ca58b8",
      "x" : 470,
      "entity_id" : "sensor.ha_uptime_sec",
      "name" : "HA Uptime",
      "type" : "api-current-state",
      "halt_if" : "",
      "y" : 360,
      "id" : "38d8e92.9caf216",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "40333e92.b491c",
      "y" : 360,
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "name" : "Set global variables",
      "type" : "function",
      "x" : 670,
      "wires" : [
         []
      ],
      "z" : "c663f7df.ca58b8",
      "noerr" : 0,
      "outputs" : 1
   },
   {
      "y" : 520,
      "id" : "5ceee521.890f0c",
      "wires" : [],
      "z" : "c663f7df.ca58b8",
      "name" : "Checks if family mode or guest mode is on, and that HA has not restarted in last ten min",
      "type" : "comment",
      "info" : "",
      "x" : 680
   },
   {
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "ed6284e7.90c288"
         ]
      ],
      "pauseType" : "delay",
      "id" : "27bfb240.31fede",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "x" : 440,
      "timeout" : "2",
      "z" : "837bbace.420028",
      "randomFirst" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "1",
      "rate" : "1",
      "y" : 160,
      "drop" : false
   },
   {
      "send_allow" : false,
      "property_allow" : "payload",
      "id" : "ed6284e7.90c288",
      "negate_stop" : false,
      "wires" : [
         [
            "e0226853.972fa8",
            "4f2a1ec3.af1bc",
            "6b1a171c.7f7368"
         ]
      ],
      "send_stop" : false,
      "property_stop" : "payload",
      "type" : "traffic",
      "name" : "",
      "filter_stop" : "playing",
      "ignore_case_allow" : false,
      "filter_allow" : "off|idle|paused",
      "y" : 220,
      "ignore_case_stop" : false,
      "default_start" : true,
      "negate_allow" : false,
      "differ" : false,
      "z" : "837bbace.420028",
      "x" : 750
   },
   {
      "id" : "7aab0772.4c7a48",
      "server" : "e2a02faf.48099",
      "y" : 108.571451187134,
      "entity_id" : "media_player.kitchen_speaker",
      "name" : "Kitchen media already playing?",
      "type" : "api-current-state",
      "x" : 515,
      "halt_if" : "",
      "wires" : [
         [
            "b4ba7fb4.779ce"
         ]
      ],
      "z" : "837bbace.420028"
   },
   {
      "y" : 67.3214302062988,
      "server" : "e2a02faf.48099",
      "id" : "8285e427.a52808",
      "z" : "837bbace.420028",
      "wires" : [
         [
            "b4ba7fb4.779ce"
         ]
      ],
      "halt_if" : "",
      "entity_id" : "media_player.family_room_speaker",
      "name" : "Family room media already playing?",
      "type" : "api-current-state",
      "x" : 535
   },
   {
      "id" : "1d126bec.7a2554",
      "pauseType" : "rate",
      "wires" : [
         [
            "ed6284e7.90c288"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "drop" : true,
      "y" : 140,
      "rate" : "1",
      "nbRateUnits" : "3",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "837bbace.420028",
      "x" : 1100,
      "timeout" : "5",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second"
   },
   {
      "outputLabels" : [
         "playing",
         "not playing"
      ],
      "property" : "payload",
      "id" : "b4ba7fb4.779ce",
      "y" : 100,
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "playing"
         },
         {
            "t" : "neq",
            "vt" : "str",
            "v" : "playing"
         }
      ],
      "name" : "Playing or not playing",
      "type" : "switch",
      "x" : 840,
      "propertyType" : "msg",
      "z" : "837bbace.420028",
      "outputs" : 2,
      "checkall" : "true",
      "wires" : [
         [
            "ed6284e7.90c288"
         ],
         [
            "1d126bec.7a2554"
         ]
      ]
   },
   {
      "name" : "Set volume on Family Room",
      "type" : "api-call-service",
      "x" : 1000,
      "wires" : [
         []
      ],
      "z" : "837bbace.420028",
      "service" : "volume_set",
      "id" : "4f2a1ec3.af1bc",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "y" : 200,
      "data" : "{ \"entity_id\":\"media_player.family_room_speaker\",\"volume_level\":0.5 }"
   },
   {
      "wires" : [
         []
      ],
      "service" : "volume_set",
      "z" : "837bbace.420028",
      "x" : 980,
      "type" : "api-call-service",
      "name" : "Set volume on Kitchen",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"volume_level\":0.9 }",
      "y" : 240,
      "id" : "6b1a171c.7f7368",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [
         [
            "f93bf994.15e5b8",
            "221ab23b.8631fe"
         ]
      ],
      "type" : "delay",
      "name" : "",
      "pauseType" : "delay",
      "id" : "e0226853.972fa8",
      "z" : "837bbace.420028",
      "randomFirst" : "1",
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "2",
      "x" : 140.357196807861,
      "rate" : "1",
      "y" : 339.28572845459,
      "drop" : false,
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1"
   },
   {
      "id" : "57df38ed.0beee8",
      "y" : 58.5714285714286,
      "x" : 980.714285714286,
      "info" : "",
      "type" : "comment",
      "name" : "If we are playing on either speaker, block the voice message",
      "z" : "837bbace.420028",
      "wires" : []
   },
   {
      "id" : "d28d682.8d8cc98",
      "func" : "greetings = [\n            \"Hooray! Mom is here!\",\n            \"Oh yeah, Mom is back!\",\n            \"Hey, better clean up, your Mom is back!\",\n            \"Woohoo! Mommy is home!\",\n            \"The queen of the castle has returned!\",\n            \"Mom's back!\",\n            \"Mommy is home!\",\n            \"Hey, Mom just got home!\"\n            ];\n\ngreeting = greetings[Math.floor(Math.random()*greetings.length)];\nmsg.payload = { data: {'message': greeting } };\n\nreturn msg;",
      "y" : 382.678510665894,
      "x" : 794.571380615234,
      "type" : "function",
      "name" : "Format message",
      "outputs" : 1,
      "noerr" : 0,
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "b37728c9.fe3df8"
         ]
      ]
   },
   {
      "z" : "46ed0d55.4c98b4",
      "y" : 383.249982833862,
      "wires" : [
         [
            "3bfb5fd2.949c8"
         ],
         []
      ],
      "type" : "subflow:837bbace.420028",
      "name" : "",
      "x" : 973.428527832031,
      "id" : "b37728c9.fe3df8"
   },
   {
      "maxtimeoutunits" : "Hour",
      "id" : "7c67e682.4ceaf8",
      "y" : 430,
      "duration" : "5",
      "maxloops" : "100",
      "units" : "Second",
      "maxtimeout" : "1",
      "name" : "",
      "type" : "looptimer",
      "x" : 425,
      "z" : "837bbace.420028",
      "wires" : [
         [
            "c40c79ae.a075a8",
            "91d8678.a122698"
         ],
         []
      ]
   },
   {
      "y" : 406.428586006165,
      "id" : "c40c79ae.a075a8",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "486f3030.3e37b"
         ]
      ],
      "z" : "837bbace.420028",
      "name" : "Family room media already playing?",
      "type" : "api-current-state",
      "entity_id" : "media_player.family_room_speaker",
      "x" : 696.071361541748,
      "halt_if" : ""
   },
   {
      "y" : 449.285733222961,
      "server" : "e2a02faf.48099",
      "id" : "91d8678.a122698",
      "z" : "837bbace.420028",
      "wires" : [
         [
            "486f3030.3e37b"
         ]
      ],
      "halt_if" : "",
      "name" : "Kitchen media already playing?",
      "type" : "api-current-state",
      "entity_id" : "media_player.kitchen_speaker",
      "x" : 676.071361541748
   },
   {
      "wires" : [
         [
            "9e8babc9.4d8f38"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "id" : "418d9d7f.f1b724",
      "pauseType" : "rate",
      "randomFirst" : "1",
      "z" : "837bbace.420028",
      "timeout" : "5",
      "x" : 1106.07155227661,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "y" : 442.14287853241,
      "rate" : "1",
      "nbRateUnits" : "15",
      "randomUnits" : "seconds",
      "randomLast" : "5"
   },
   {
      "property" : "payload",
      "id" : "486f3030.3e37b",
      "outputLabels" : [
         "playing",
         "not playing"
      ],
      "y" : 440.714297294617,
      "type" : "switch",
      "name" : "Idle?",
      "x" : 928.928607940674,
      "propertyType" : "msg",
      "rules" : [
         {
            "v" : "idle",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "vt" : "str",
            "v" : "idle",
            "t" : "neq"
         }
      ],
      "wires" : [
         [
            "418d9d7f.f1b724"
         ],
         []
      ],
      "z" : "837bbace.420028",
      "outputs" : 2,
      "checkall" : "true"
   },
   {
      "from" : "",
      "type" : "change",
      "name" : "Stop loop",
      "x" : 799.642807551792,
      "rules" : [
         {
            "to" : "stop",
            "tot" : "str",
            "pt" : "msg",
            "p" : "payload",
            "t" : "set"
         }
      ],
      "wires" : [
         [
            "7c67e682.4ceaf8"
         ]
      ],
      "to" : "",
      "z" : "837bbace.420028",
      "property" : "",
      "id" : "9e8babc9.4d8f38",
      "action" : "",
      "y" : 560.714291572571,
      "reg" : false
   },
   {
      "rate" : "1",
      "drop" : false,
      "y" : 460.999995231628,
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "z" : "837bbace.420028",
      "randomFirst" : "1",
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "3",
      "x" : 196.07133102417,
      "pauseType" : "delay",
      "id" : "221ab23b.8631fe",
      "wires" : [
         [
            "7c67e682.4ceaf8"
         ]
      ],
      "type" : "delay",
      "name" : ""
   },
   {
      "name" : "Format message",
      "type" : "function",
      "x" : 796.857116699219,
      "z" : "46ed0d55.4c98b4",
      "noerr" : 0,
      "outputs" : 1,
      "wires" : [
         [
            "ed6d9df1.0fd81"
         ]
      ],
      "id" : "dc0c97dd.b57788",
      "y" : 434.392835617065,
      "func" : "greetings = [\n            \"Hooray! Dad is here!\",\n            \"Oh yeah, Dad is back!\",\n            \"Hey, better get ready to rumble, your Dad is back!\",\n            \"Woohoo! Daddy is home!\",\n            \"The king of the castle has returned!\",\n            \"Dad's back!\",\n            \"Daddy is home!\",\n            \"Hey, Dad just got home!\"\n            ];\n\ngreeting = greetings[Math.floor(Math.random()*greetings.length)];\nmsg.payload = { data: {'message': greeting } };\n\nreturn msg;"
   },
   {
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "e03928ff.4d5588"
         ],
         []
      ],
      "y" : 434.964307785034,
      "name" : "",
      "type" : "subflow:837bbace.420028",
      "id" : "ed6d9df1.0fd81",
      "x" : 975.714263916016
   },
   {
      "id" : "eb96e414.d242a8",
      "y" : 396.428586006165,
      "name" : "Continue on to the output after the speakers are idle",
      "type" : "comment",
      "x" : 220.357128143311,
      "info" : "",
      "z" : "837bbace.420028",
      "wires" : []
   },
   {
      "func" : "guest_mode          = global.get('guest_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.guest_mode      = guest_mode;\n\nif( guest_mode == 'on' || ha_uptime_sec < 180) {\n    msg.abort_alert = 1;\n    return [ msg, null ];\n} else {\n    msg.abort_alert = 0;\n    return [ null, msg ];\n}",
      "y" : 200,
      "outputLabels" : [
         "abort",
         "continue"
      ],
      "id" : "c61527c3.d75f98",
      "outputs" : 2,
      "noerr" : 0,
      "z" : "3844d016.18a29",
      "wires" : [
         [],
         []
      ],
      "x" : 610,
      "type" : "function",
      "name" : "Is guest mode on?"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "a6d97fb.109798",
      "y" : 120,
      "halt_if" : "",
      "x" : 590,
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "name" : "Guest mode",
      "z" : "3844d016.18a29",
      "wires" : [
         [
            "988b49ae.a27c78"
         ]
      ]
   },
   {
      "z" : "3844d016.18a29",
      "noerr" : 0,
      "outputs" : 1,
      "wires" : [
         []
      ],
      "type" : "function",
      "name" : "Set global variables",
      "x" : 790,
      "func" : "global.set('guest_mode',msg.payload);\nreturn msg;",
      "y" : 120,
      "id" : "988b49ae.a27c78"
   },
   {
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "rate" : "1",
      "drop" : false,
      "y" : 200,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "1",
      "x" : 400,
      "z" : "3844d016.18a29",
      "randomFirst" : "1",
      "pauseType" : "delay",
      "id" : "1d2995b.befbb6a",
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "c61527c3.d75f98"
         ]
      ]
   },
   {
      "y" : 80,
      "id" : "421449d8.238b68",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "7e940c76.a90b54"
         ]
      ],
      "z" : "3844d016.18a29",
      "x" : 590,
      "name" : "HA Uptime",
      "entity_id" : "sensor.ha_uptime_sec",
      "type" : "api-current-state",
      "halt_if" : ""
   },
   {
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "y" : 80,
      "id" : "7e940c76.a90b54",
      "wires" : [
         []
      ],
      "outputs" : 1,
      "noerr" : 0,
      "z" : "3844d016.18a29",
      "x" : 790,
      "type" : "function",
      "name" : "Set global variables"
   },
   {
      "type" : "comment",
      "name" : "Checks if guest mode is on, and that HA has not restarted in last three min",
      "info" : "",
      "x" : 770,
      "z" : "3844d016.18a29",
      "wires" : [],
      "id" : "e5466c9c.1ea8",
      "y" : 160
   },
   {
      "y" : 220,
      "id" : "2f9ab588.1d5f3a",
      "z" : "837bbace.420028",
      "wires" : [],
      "type" : "comment",
      "name" : "Continue flow without speaking",
      "x" : 370,
      "info" : ""
   },
   {
      "y" : 400,
      "id" : "998fb1bf.37859",
      "z" : "837bbace.420028",
      "wires" : [],
      "info" : "",
      "x" : 1360,
      "type" : "comment",
      "name" : "Continue flow after speaking is complete"
   },
   {
      "wires" : [
         [],
         []
      ],
      "outputs" : 2,
      "noerr" : 0,
      "z" : "2283eff7.ee9ab",
      "x" : 460,
      "name" : "Is family away?",
      "type" : "function",
      "func" : "family_mode         = global.get('family_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.family_mode     = family_mode;\n\nif( family_mode == 'not_home' && ha_uptime_sec > 600) {\n    msg.abort_alert = 1;\n    return[msg,null];\n} else {\n    msg.abort_alert = 0;\n    return[null,msg];    \n}",
      "y" : 300,
      "id" : "2c2c6211.b4bd2e",
      "outputLabels" : [
         "abort",
         "continue"
      ]
   },
   {
      "wires" : [
         [
            "f722b66a.716df8"
         ]
      ],
      "z" : "2283eff7.ee9ab",
      "name" : "Family Mode",
      "type" : "api-current-state",
      "entity_id" : "group.family",
      "x" : 470,
      "halt_if" : "",
      "y" : 220,
      "id" : "7ed74b51.666eb4",
      "server" : "e2a02faf.48099"
   },
   {
      "noerr" : 0,
      "z" : "2283eff7.ee9ab",
      "outputs" : 1,
      "wires" : [
         []
      ],
      "name" : "Set global variables",
      "type" : "function",
      "x" : 670,
      "func" : "global.set('family_mode',msg.payload);\nreturn msg;",
      "y" : 220,
      "id" : "f722b66a.716df8"
   },
   {
      "id" : "d349f480.c33fe8",
      "pauseType" : "delay",
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "2c2c6211.b4bd2e"
         ]
      ],
      "nbRateUnits" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "drop" : false,
      "y" : 300,
      "rate" : "1",
      "timeout" : "1",
      "x" : 260,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "2283eff7.ee9ab"
   },
   {
      "y" : 180,
      "id" : "341e614.4cf539e",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "51e3ebc5.8916f4"
         ]
      ],
      "z" : "2283eff7.ee9ab",
      "name" : "HA Uptime",
      "type" : "api-current-state",
      "entity_id" : "sensor.ha_uptime_sec",
      "x" : 470,
      "halt_if" : ""
   },
   {
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "y" : 180,
      "id" : "51e3ebc5.8916f4",
      "wires" : [
         []
      ],
      "noerr" : 0,
      "z" : "2283eff7.ee9ab",
      "outputs" : 1,
      "name" : "Set global variables",
      "type" : "function",
      "x" : 670
   },
   {
      "id" : "6c6b0abf.f06134",
      "y" : 260,
      "x" : 620,
      "info" : "",
      "name" : "Checks if family is home and that HA has not restarted in last ten min",
      "type" : "comment",
      "wires" : [],
      "z" : "2283eff7.ee9ab"
   },
   {
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "81d992b2.e41e7"
         ]
      ],
      "y" : 140,
      "id" : "99c0bcdb.ffe2",
      "x" : 1350,
      "type" : "subflow:2283eff7.ee9ab",
      "name" : ""
   },
   {
      "type" : "comment",
      "name" : "Refresh the Z-Wave Graph",
      "x" : 130,
      "info" : "",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "id" : "120f24e0.ee07cb",
      "y" : 1960
   },
   {
      "y" : 2000,
      "crontab" : "",
      "id" : "53f5bc28.d21604",
      "once" : false,
      "repeat" : "3600",
      "wires" : [
         [
            "4a53626f.fbc04c"
         ]
      ],
      "payload" : "",
      "z" : "20661f8a.532c4",
      "name" : "",
      "type" : "inject",
      "payloadType" : "date",
      "x" : 150,
      "topic" : "Once an hour"
   },
   {
      "wires" : [
         []
      ],
      "service" : "z_wave_graph",
      "z" : "20661f8a.532c4",
      "x" : 493.333333333333,
      "type" : "api-call-service",
      "name" : "Call Z-Wave Graph script",
      "data" : "{ }",
      "y" : 2000,
      "service_domain" : "shell_command",
      "id" : "4a53626f.fbc04c",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "df34b472.0288e8",
      "y" : 3120,
      "info" : "",
      "x" : 130,
      "name" : "Turn on/off front porch light",
      "type" : "comment",
      "wires" : [],
      "z" : "8bb76918.ef6b48"
   },
   {
      "y" : 3220,
      "data" : "{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}",
      "server" : "e2a02faf.48099",
      "id" : "e488f20b.25ef8",
      "service_domain" : "light",
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "type" : "api-call-service",
      "name" : "Turn on porch light",
      "x" : 1040
   },
   {
      "name" : "Turn off porch light",
      "type" : "api-call-service",
      "x" : 1040,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_off",
      "service_domain" : "light",
      "id" : "807ecf54.ea8e9",
      "server" : "e2a02faf.48099",
      "y" : 3260,
      "data" : "{\"entity_id\":\"light.front_door_switch_level\"}"
   },
   {
      "month1" : 0,
      "lat" : "40.173508",
      "wires" : [
         [],
         [],
         [
            "3b82a507.5a9cfa"
         ]
      ],
      "oct" : true,
      "month3" : 0,
      "may" : true,
      "day5" : 0,
      "d4" : 0,
      "repeat" : true,
      "fri" : true,
      "w2" : 0,
      "id" : "96d5545b.a80258",
      "outpayload1" : "",
      "month4" : 0,
      "jun" : true,
      "d3" : 0,
      "y" : 3180,
      "feb" : true,
      "odd" : false,
      "w3" : 0,
      "month2" : 0,
      "type" : "bigtimer",
      "mon" : true,
      "z" : "8bb76918.ef6b48",
      "w5" : 0,
      "nov" : true,
      "sep" : true,
      "starttime" : "5004",
      "outtopic" : "",
      "wed" : true,
      "timeout" : 1440,
      "tue" : true,
      "mar" : true,
      "w4" : 0,
      "even" : false,
      "thu" : true,
      "outpayload2" : "",
      "atstart" : false,
      "name" : "Sunset",
      "day3" : 0,
      "jan" : true,
      "sat" : true,
      "w1" : 0,
      "outtext1" : "on",
      "month5" : 0,
      "d5" : 0,
      "lon" : "-92.58988",
      "endoff" : "0",
      "x" : 70,
      "day2" : 0,
      "endtime" : "1425",
      "apr" : true,
      "jul" : true,
      "dec" : true,
      "sun" : true,
      "d2" : 0,
      "aug" : true,
      "outtext2" : "off",
      "day4" : 0,
      "random" : false,
      "startoff" : "-30",
      "day1" : 0,
      "d1" : 0,
      "offs" : 0,
      "suspend" : false
   },
   {
      "property" : "payload",
      "id" : "3b82a507.5a9cfa",
      "y" : 3180,
      "rules" : [
         {
            "t" : "eq",
            "v" : "on",
            "vt" : "str"
         },
         {
            "v" : "off",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "name" : "",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 500,
      "z" : "8bb76918.ef6b48",
      "outputs" : 2,
      "checkall" : "true",
      "wires" : [
         [
            "ffba944b.d03178"
         ],
         [
            "6c1119c4.b527b8"
         ]
      ]
   },
   {
      "id" : "6ef4d34d.bd056c",
      "outputLabels" : [
         "walt",
         "dawn"
      ],
      "func" : "// Clear our msg object as the service call to\n// update our location doesn't seem to like it\nnewmsg = {};\nnewmsg.payload = \"Update\";\n\nif(msg.person == \"walt\") {\n    return[ newmsg, null ];\n} else if(msg.person == \"dawn\") {\n    return[ null, newmsg ];\n}",
      "y" : 60,
      "x" : 1380,
      "name" : "Clear msg and switch",
      "type" : "function",
      "wires" : [
         [
            "2660ad34.a38e12"
         ],
         [
            "411ea.0d815e17"
         ]
      ],
      "outputs" : "2",
      "z" : "46ed0d55.4c98b4",
      "noerr" : 0
   },
   {
      "name" : "Set tracking interval to 1min for Walt's iPhone",
      "type" : "api-call-service",
      "x" : 1760,
      "z" : "46ed0d55.4c98b4",
      "service" : "icloud_set_interval",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "id" : "2660ad34.a38e12",
      "service_domain" : "device_tracker",
      "y" : 40,
      "data" : "{\"device_name\":\"walthowdsiphone\",\"interval\":\"1\"}"
   },
   {
      "y" : 100,
      "data" : "{\"device_name\":\"dawnsiphone\",\"interval\":\"1\"}",
      "id" : "411ea.0d815e17",
      "service_domain" : "device_tracker",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "service" : "icloud_set_interval",
      "type" : "api-call-service",
      "name" : "Set tracking interval to 1min for Wife's iPhone",
      "x" : 1760
   },
   {
      "y" : 3240,
      "id" : "f5e23ad0.db3688",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "b4176d33.03917"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 90,
      "haltifstate" : "off",
      "name" : "Family Asleep",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "entityidfilter" : "binary_sensor.family_sleeping"
   },
   {
      "wires" : [
         [
            "b4176d33.03917"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "name" : "Family in Bed",
      "haltifstate" : "off",
      "x" : 90,
      "entityidfilter" : "binary_sensor.family_in_bed",
      "y" : 3300,
      "id" : "c319e801.2bc398",
      "server" : "e2a02faf.48099"
   },
   {
      "lat" : "",
      "wires" : [
         [
            "c0f05fa8.76369"
         ],
         []
      ],
      "z" : "8bb76918.ef6b48",
      "startOffset" : 0,
      "type" : "time-range-switch",
      "name" : "8PM to midnight",
      "x" : 280,
      "lon" : "",
      "y" : 3260,
      "id" : "b4176d33.03917",
      "endOffset" : 0,
      "endTime" : "24:00",
      "startTime" : "20:00"
   },
   {
      "drop" : true,
      "y" : 3260,
      "rate" : "1",
      "nbRateUnits" : "4",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "timeout" : "5",
      "x" : 470,
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds",
      "id" : "c0f05fa8.76369",
      "pauseType" : "rate",
      "wires" : [
         [
            "6c1119c4.b527b8"
         ]
      ],
      "name" : "",
      "type" : "delay"
   },
   {
      "y" : 3260,
      "id" : "6c1119c4.b527b8",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "807ecf54.ea8e9",
            "643b840c.15f4ac",
            "7d4b932d.fbd30c"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 820,
      "name" : "If Guest Mode Off",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "halt_if" : "on"
   },
   {
      "y" : 3220,
      "id" : "ffba944b.d03178",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "e488f20b.25ef8",
            "c710418b.8078d"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "name" : "If Guest Mode Off",
      "x" : 820,
      "halt_if" : "on"
   },
   {
      "x" : 1030,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "id" : "c710418b.8078d",
      "service_domain" : "logbook",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turning on front porch light\" }",
      "y" : 3180
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "643b840c.15f4ac",
      "y" : 3300,
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turning off front porch light\" }",
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "x" : 1030,
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "wires" : [
         []
      ]
   },
   {
      "id" : "9986ae2c.144e8",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "data" : "{\"entity_id\":\"light.stairs\"}",
      "y" : 80,
      "x" : 690,
      "type" : "api-call-service",
      "name" : "Toggle stairs",
      "mergecontext" : "",
      "wires" : [
         [
            "797998e3.1aab48"
         ]
      ],
      "service" : "toggle",
      "z" : "e0703c90.1a341"
   },
   {
      "topic" : "",
      "x" : 140,
      "payloadType" : "date",
      "type" : "inject",
      "name" : "",
      "z" : "e0703c90.1a341",
      "onceDelay" : 0.1,
      "payload" : "",
      "wires" : [
         [
            "a470daf1.a68cf8"
         ]
      ],
      "once" : false,
      "repeat" : "",
      "id" : "deca1dbf.432f7",
      "crontab" : "",
      "y" : 80
   },
   {
      "id" : "797998e3.1aab48",
      "y" : 80,
      "complete" : "true",
      "console" : false,
      "type" : "debug",
      "name" : "",
      "x" : 910,
      "tostatus" : true,
      "z" : "e0703c90.1a341",
      "active" : true,
      "tosidebar" : true,
      "wires" : []
   },
   {
      "console" : false,
      "complete" : "true",
      "tostatus" : true,
      "x" : 590,
      "type" : "debug",
      "name" : "Entry",
      "active" : true,
      "z" : "e0703c90.1a341",
      "wires" : [],
      "tosidebar" : true,
      "id" : "4a28ac6e.c668e4",
      "y" : 240
   },
   {
      "data" : "{\"entity_id\":\"light.entry\"}",
      "y" : 80,
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "e2f544d5.00e818",
      "service" : "toggle",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "9986ae2c.144e8",
            "4a28ac6e.c668e4"
         ]
      ],
      "mergecontext" : "",
      "x" : 350,
      "type" : "api-call-service",
      "name" : "Toggle entry"
   },
   {
      "startdate" : "2018-02-19T10:00+00:00",
      "wires" : [
         [
            "eb241633.d13588"
         ]
      ],
      "z" : "e0703c90.1a341",
      "x" : 230,
      "type" : "api-get-history",
      "name" : "History test",
      "y" : 160,
      "id" : "a470daf1.a68cf8",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "eb241633.d13588",
      "y" : 240,
      "name" : "History",
      "type" : "debug",
      "tostatus" : true,
      "x" : 400,
      "complete" : "true",
      "console" : false,
      "wires" : [],
      "tosidebar" : true,
      "z" : "e0703c90.1a341",
      "active" : true
   },
   {
      "id" : "7bd120de.5714c",
      "property" : "payload.timeSinceChangedMs",
      "repair" : false,
      "y" : 720,
      "x" : 570,
      "propertyType" : "msg",
      "name" : "Offline for 4 hours",
      "type" : "switch",
      "rules" : [
         {
            "v" : "14400000",
            "vt" : "num",
            "t" : "gt"
         }
      ],
      "wires" : [
         [
            "8e046ec0.60f3e"
         ]
      ],
      "checkall" : "true",
      "outputs" : 1,
      "z" : "10fa16ea.e265b9"
   },
   {
      "checkall" : "true",
      "outputs" : 1,
      "z" : "10fa16ea.e265b9",
      "wires" : [
         [
            "7bd120de.5714c"
         ]
      ],
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "not_home"
         }
      ],
      "x" : 410,
      "propertyType" : "msg",
      "name" : "Offline",
      "type" : "switch",
      "repair" : false,
      "y" : 720,
      "id" : "211c28b0.54bb88",
      "property" : "payload.data.state"
   },
   {
      "func" : "device      = msg.topic.replace(/^.*\\.(.*)/, '$1');\nmsg.payload = { data: {'message': device + ' has been offline for four hours','name':'Node-Red' } };\n\nreturn msg;",
      "y" : 720,
      "id" : "38dddb82.ea4a84",
      "wires" : [
         [
            "a6b1d175.98fc1",
            "5918c5f2.3a4f1c"
         ]
      ],
      "z" : "10fa16ea.e265b9",
      "noerr" : 0,
      "outputs" : 1,
      "name" : "Format message",
      "type" : "function",
      "x" : 950
   },
   {
      "z" : "10fa16ea.e265b9",
      "randomFirst" : "1",
      "timeoutUnits" : "seconds",
      "rateUnits" : "day",
      "x" : 770,
      "timeout" : "5",
      "rate" : "1",
      "drop" : false,
      "y" : 720,
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "1",
      "wires" : [
         [
            "38dddb82.ea4a84"
         ]
      ],
      "type" : "delay",
      "name" : "",
      "pauseType" : "rate",
      "id" : "8e046ec0.60f3e"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "a6b1d175.98fc1",
      "y" : 700,
      "data" : "{ }",
      "mergecontext" : "",
      "name" : "Notify Walt",
      "type" : "api-call-service",
      "x" : 1210,
      "z" : "10fa16ea.e265b9",
      "service" : "ios_walts_iphone",
      "wires" : [
         []
      ]
   },
   {
      "wires" : [
         []
      ],
      "z" : "10fa16ea.e265b9",
      "service" : "log",
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "x" : 1220,
      "mergecontext" : "",
      "y" : 740,
      "data" : "",
      "service_domain" : "logbook",
      "id" : "5918c5f2.3a4f1c",
      "server" : "e2a02faf.48099"
   },
   {
      "x" : 110,
      "type" : "poll-state",
      "entity_id" : "device_tracker.familyroommini",
      "name" : "Family Room Mini",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "705eb8d8.c2b168"
         ]
      ],
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "id" : "a0e46949.272428",
      "updateinterval" : "60",
      "y" : 2120,
      "outputonchanged" : false
   },
   {
      "id" : "7979d4d0.07b99c",
      "outputinitially" : false,
      "server" : "e2a02faf.48099",
      "updateinterval" : "60",
      "y" : 2160,
      "outputonchanged" : false,
      "x" : 90,
      "entity_id" : "device_tracker.kitchenmini",
      "name" : "Kitchen Mini",
      "type" : "poll-state",
      "wires" : [
         [
            "711512fe.cf2cac"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "wires" : [],
      "y" : 2120,
      "z" : "20661f8a.532c4",
      "type" : "subflow:10fa16ea.e265b9",
      "name" : "",
      "x" : 600,
      "id" : "705eb8d8.c2b168"
   },
   {
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "id" : "711512fe.cf2cac",
      "x" : 600,
      "wires" : [],
      "y" : 2160,
      "z" : "20661f8a.532c4"
   },
   {
      "updateinterval" : "60",
      "y" : 2200,
      "outputonchanged" : false,
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "id" : "9f820cc1.aec5a",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "13a88832.41bf98"
         ]
      ],
      "x" : 110,
      "entity_id" : "device_tracker.haydenhumidifier",
      "type" : "poll-state",
      "name" : "Son1 Humidifier"
   },
   {
      "x" : 110,
      "entity_id" : "device_tracker.masterhumidifier",
      "type" : "poll-state",
      "name" : "Master Humidifier",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "3e5eafc1.4faa1"
         ]
      ],
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "id" : "9a386127.2920c",
      "updateinterval" : "60",
      "y" : 2240,
      "outputonchanged" : false
   },
   {
      "x" : 90,
      "entity_id" : "device_tracker.howdorbisat1",
      "name" : "Orbi Satellite",
      "type" : "poll-state",
      "wires" : [
         [
            "1870d4d.0a4be2b"
         ]
      ],
      "z" : "20661f8a.532c4",
      "outputinitially" : false,
      "id" : "e8f8e6e7.caea58",
      "server" : "e2a02faf.48099",
      "updateinterval" : "60",
      "y" : 2280,
      "outputonchanged" : false
   },
   {
      "name" : "Nest Thermostat",
      "entity_id" : "device_tracker.nestthermostat",
      "type" : "poll-state",
      "x" : 100,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "77a6e48d.dec1ec"
         ]
      ],
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "id" : "f58e2756.533a88",
      "y" : 2320,
      "outputonchanged" : false,
      "updateinterval" : "60"
   },
   {
      "updateinterval" : "60",
      "y" : 2360,
      "outputonchanged" : false,
      "outputinitially" : false,
      "id" : "f25943cd.95798",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "3c6c1487.097d5c"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 100,
      "entity_id" : "device_tracker.garageopener",
      "type" : "poll-state",
      "name" : "Garage Opener"
   },
   {
      "y" : 2200,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "id" : "13a88832.41bf98",
      "x" : 600
   },
   {
      "x" : 600,
      "id" : "3e5eafc1.4faa1",
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "z" : "20661f8a.532c4",
      "y" : 2240,
      "wires" : []
   },
   {
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "x" : 600,
      "id" : "1870d4d.0a4be2b",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "y" : 2280
   },
   {
      "type" : "subflow:10fa16ea.e265b9",
      "name" : "",
      "id" : "77a6e48d.dec1ec",
      "x" : 600,
      "wires" : [],
      "y" : 2320,
      "z" : "20661f8a.532c4"
   },
   {
      "z" : "20661f8a.532c4",
      "y" : 2360,
      "wires" : [],
      "type" : "subflow:10fa16ea.e265b9",
      "name" : "",
      "x" : 600,
      "id" : "3c6c1487.097d5c"
   },
   {
      "z" : "20661f8a.532c4",
      "y" : 2400,
      "wires" : [],
      "id" : "1c397c50.a1bcb4",
      "x" : 600,
      "type" : "subflow:10fa16ea.e265b9",
      "name" : ""
   },
   {
      "id" : "493512b3.2658fc",
      "x" : 600,
      "type" : "subflow:10fa16ea.e265b9",
      "name" : "",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "y" : 2440
   },
   {
      "wires" : [],
      "y" : 2480,
      "z" : "20661f8a.532c4",
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "x" : 600,
      "id" : "c67044b1.a536f8"
   },
   {
      "wires" : [],
      "y" : 2520,
      "z" : "20661f8a.532c4",
      "id" : "186044bf.323f5b",
      "x" : 600,
      "type" : "subflow:10fa16ea.e265b9",
      "name" : ""
   },
   {
      "y" : 2560,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "type" : "subflow:10fa16ea.e265b9",
      "name" : "",
      "id" : "6d8de964.7a72f8",
      "x" : 600
   },
   {
      "updateinterval" : "60",
      "outputonchanged" : false,
      "y" : 2400,
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "id" : "648f4a2a.7e6094",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "1c397c50.a1bcb4"
         ]
      ],
      "x" : 90,
      "entity_id" : "device_tracker.colinslamp",
      "type" : "poll-state",
      "name" : "Son2s Lamp"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "493512b3.2658fc"
         ]
      ],
      "x" : 130,
      "name" : "Family Room Floor Lamp",
      "entity_id" : "device_tracker.familyroomfloorlamp",
      "type" : "poll-state",
      "updateinterval" : "60",
      "y" : 2440,
      "outputonchanged" : false,
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "id" : "f7280e01.82523"
   },
   {
      "wires" : [
         [
            "c67044b1.a536f8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 110,
      "entity_id" : "device_tracker.familyroomlamp",
      "type" : "poll-state",
      "name" : "Family Room Lamp",
      "updateinterval" : "60",
      "outputonchanged" : false,
      "y" : 2480,
      "outputinitially" : false,
      "id" : "68dd3d8b.f05994",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "id" : "57eff7bf.51b658",
      "outputonchanged" : false,
      "y" : 2520,
      "updateinterval" : "60",
      "name" : "Living Room Lamp",
      "entity_id" : "device_tracker.livingroomlamps",
      "type" : "poll-state",
      "x" : 110,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "186044bf.323f5b"
         ]
      ]
   },
   {
      "outputonchanged" : false,
      "y" : 2560,
      "updateinterval" : "60",
      "server" : "e2a02faf.48099",
      "id" : "905adc42.a5a65",
      "outputinitially" : false,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "6d8de964.7a72f8"
         ]
      ],
      "entity_id" : "device_tracker.officelamps",
      "name" : "Office Lamps",
      "type" : "poll-state",
      "x" : 90
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 170,
      "info" : "",
      "name" : "Report if any network devices are offline",
      "type" : "comment",
      "y" : 2080,
      "id" : "5d30542b.8b0dfc"
   },
   {
      "y" : 120,
      "id" : "83924e76.ce656",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "4ac59736.e70218"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 360,
      "type" : "api-current-state",
      "name" : "Current house temperature",
      "entity_id" : "climate.hallway_nest",
      "halt_if" : ""
   },
   {
      "id" : "86f5a1b9.97ce5",
      "repeat" : "60",
      "once" : false,
      "y" : 660,
      "crontab" : "",
      "x" : 70,
      "name" : "",
      "type" : "inject",
      "payloadType" : "date",
      "topic" : "",
      "onceDelay" : 0.1,
      "payload" : "",
      "wires" : [
         [
            "83924e76.ce656",
            "ad504a65.d52188",
            "263b2223.8f6b9e",
            "e194ba1b.4f73e8",
            "ccff40bc.f5621",
            "b30cf939.0dc3c8",
            "4a88fb80.e5d3f4",
            "bdbb5e2b.2423d",
            "3abf4613.9bf6ba",
            "979957ce.4c6648",
            "8646cb98.12e708",
            "c836a3d7.3cfba",
            "5a44d302.2472dc",
            "12b38f8e.d928",
            "845ca713.652ef8",
            "e41c2a57.3223d8",
            "83b4b32f.c1391",
            "4a699181.4d185",
            "9c7a6221.e6ca",
            "4d395e23.30c5d",
            "981ce0e8.cdfba",
            "25039e35.ef7072",
            "526d53c5.a3ab2c",
            "7a85784d.5c3d08"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "x" : 600,
      "name" : "",
      "type" : "change",
      "from" : "",
      "rules" : [
         {
            "p" : "payload",
            "t" : "set",
            "tot" : "msg",
            "pt" : "msg",
            "to" : "data.attributes.current_temperature"
         },
         {
            "p" : "topic",
            "t" : "set",
            "to" : "Inside Temp (F)",
            "tot" : "str",
            "pt" : "msg"
         }
      ],
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "to" : "",
      "z" : "7d04740a.ad6adc",
      "id" : "4ac59736.e70218",
      "property" : "",
      "action" : "",
      "y" : 120,
      "reg" : false
   },
   {
      "removeOlder" : 1,
      "z" : "7d04740a.ad6adc",
      "x" : 930,
      "label" : "Temperature",
      "width" : "0",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "chartType" : "line",
      "legend" : "true",
      "ymax" : "",
      "y" : 280,
      "useOneColor" : false,
      "group" : "ea10f06.a52e21",
      "height" : "0",
      "removeOlderUnit" : "86400",
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "order" : 1,
      "cutout" : 0,
      "interpolate" : "linear",
      "name" : "",
      "type" : "ui_chart",
      "ymin" : "",
      "nodata" : "",
      "removeOlderPoints" : "",
      "dot" : false,
      "id" : "5a104785.e8d4c8",
      "xformat" : "HH:mm:ss"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "ad504a65.d52188",
      "y" : 160,
      "halt_if" : "",
      "x" : 380,
      "name" : "Outside temperature",
      "type" : "api-current-state",
      "entity_id" : "sensor.dark_sky_temperature",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "5d63eaa8.7a7f84"
         ]
      ]
   },
   {
      "reg" : false,
      "y" : 160,
      "action" : "",
      "property" : "",
      "id" : "5d63eaa8.7a7f84",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "to" : "",
      "rules" : [
         {
            "to" : "Outside Temp (F)",
            "tot" : "str",
            "pt" : "msg",
            "p" : "topic",
            "t" : "set"
         }
      ],
      "from" : "",
      "name" : "",
      "type" : "change",
      "x" : 600
   },
   {
      "y" : 1620,
      "crontab" : "",
      "id" : "3d2e97bd.8e0468",
      "repeat" : "",
      "once" : false,
      "wires" : [
         [
            "c03971e8.300f3"
         ]
      ],
      "payload" : "[ ]",
      "onceDelay" : 0.1,
      "z" : "7d04740a.ad6adc",
      "name" : "Clear chart",
      "type" : "inject",
      "payloadType" : "str",
      "x" : 140,
      "topic" : ""
   },
   {
      "from" : "",
      "name" : "",
      "type" : "change",
      "x" : 320,
      "rules" : [
         {
            "p" : "payload",
            "t" : "set",
            "tot" : "jsonata",
            "pt" : "msg",
            "to" : "[ ]"
         }
      ],
      "to" : "",
      "wires" : [
         []
      ],
      "z" : "7d04740a.ad6adc",
      "property" : "",
      "id" : "c03971e8.300f3",
      "action" : "",
      "y" : 1620,
      "reg" : false
   },
   {
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "69c5b640.1f58d8"
         ]
      ],
      "halt_if" : "",
      "x" : 380,
      "entity_id" : "sensor.garage_motion_sensor_temperature",
      "type" : "api-current-state",
      "name" : "Garage temperature",
      "y" : 200,
      "server" : "e2a02faf.48099",
      "id" : "263b2223.8f6b9e"
   },
   {
      "rules" : [
         {
            "p" : "topic",
            "t" : "set",
            "to" : "Garage Temp (F)",
            "pt" : "msg",
            "tot" : "str"
         }
      ],
      "x" : 600,
      "type" : "change",
      "from" : "",
      "name" : "",
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "id" : "69c5b640.1f58d8",
      "property" : "",
      "reg" : false,
      "y" : 200,
      "action" : ""
   },
   {
      "id" : "e194ba1b.4f73e8",
      "server" : "e2a02faf.48099",
      "y" : 240,
      "x" : 390,
      "type" : "api-current-state",
      "name" : "Stairs temperature",
      "entity_id" : "sensor.garage_stairs_motion_sensor_temperature",
      "halt_if" : "",
      "wires" : [
         [
            "683f99af.82e308"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "to" : "",
      "rules" : [
         {
            "p" : "topic",
            "t" : "set",
            "pt" : "msg",
            "tot" : "str",
            "to" : "Stairs Temp (F)"
         }
      ],
      "name" : "",
      "from" : "",
      "type" : "change",
      "x" : 600,
      "reg" : false,
      "y" : 240,
      "action" : "",
      "property" : "",
      "id" : "683f99af.82e308"
   },
   {
      "id" : "2cea6c34.1d5b84",
      "format" : "{{value}}",
      "min" : 0,
      "gtype" : "gage",
      "seg2" : "",
      "type" : "ui_gauge",
      "name" : "",
      "wires" : [],
      "order" : 1,
      "max" : "100",
      "title" : "Walt's Phone Battery",
      "height" : "2",
      "y" : 360,
      "group" : "2a707ff1.43daa",
      "label" : "pct",
      "x" : 960,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "2",
      "z" : "7d04740a.ad6adc",
      "seg1" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "ccff40bc.f5621",
      "y" : 360,
      "halt_if" : "",
      "x" : 380,
      "name" : "Walt's phone battery",
      "type" : "api-current-state",
      "entity_id" : "sensor.walt_howds_iphone_battery_level",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "cb7119d2.4ddc68"
         ]
      ]
   },
   {
      "property" : "",
      "id" : "cb7119d2.4ddc68",
      "reg" : false,
      "action" : "",
      "y" : 360,
      "rules" : [
         {
            "pt" : "msg",
            "tot" : "str",
            "to" : "Walt's iPhone X Battery",
            "t" : "set",
            "p" : "topic"
         }
      ],
      "from" : "",
      "name" : "",
      "type" : "change",
      "x" : 600,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "2cea6c34.1d5b84"
         ]
      ],
      "to" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "b30cf939.0dc3c8",
      "y" : 400,
      "halt_if" : "",
      "x" : 380,
      "type" : "api-current-state",
      "entity_id" : "sensor.dawns_iphone_battery_level",
      "name" : "Wife's phone battery",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "bac172a5.2576a"
         ]
      ]
   },
   {
      "property" : "",
      "id" : "bac172a5.2576a",
      "y" : 400,
      "action" : "",
      "reg" : false,
      "name" : "",
      "type" : "change",
      "from" : "",
      "x" : 600,
      "rules" : [
         {
            "p" : "topic",
            "t" : "set",
            "tot" : "str",
            "pt" : "msg",
            "to" : "Wife's iPhone SE Battery"
         }
      ],
      "wires" : [
         [
            "8411402.7b38bc"
         ]
      ],
      "to" : "",
      "z" : "7d04740a.ad6adc"
   },
   {
      "seg1" : "",
      "z" : "7d04740a.ad6adc",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "2",
      "label" : "pct",
      "x" : 960,
      "group" : "2a707ff1.43daa",
      "y" : 400,
      "title" : "Wife's Phone Battery",
      "height" : "2",
      "max" : "100",
      "order" : 3,
      "wires" : [],
      "type" : "ui_gauge",
      "name" : "",
      "seg2" : "",
      "gtype" : "gage",
      "min" : 0,
      "format" : "{{value}}",
      "id" : "8411402.7b38bc"
   },
   {
      "y" : 440,
      "id" : "4a88fb80.e5d3f4",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "6993b677.9229a8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 390,
      "type" : "api-current-state",
      "name" : "Stairs Door Sensor",
      "entity_id" : "zwave.stairs_door",
      "halt_if" : ""
   },
   {
      "id" : "29d65706.f35408",
      "min" : 0,
      "format" : "{{value}}",
      "gtype" : "gage",
      "seg2" : "",
      "name" : "",
      "type" : "ui_gauge",
      "wires" : [],
      "order" : 6,
      "max" : "100",
      "title" : "Stairs Door Battery",
      "height" : "1",
      "y" : 440,
      "group" : "2a707ff1.43daa",
      "x" : 950,
      "label" : "pct",
      "width" : "1",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "z" : "7d04740a.ad6adc",
      "seg1" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "bdbb5e2b.2423d",
      "y" : 480,
      "halt_if" : "",
      "type" : "api-current-state",
      "entity_id" : "zwave.screened_porch_door",
      "name" : "Screened Porch Door Sensor",
      "x" : 360,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "faed0bb3.204208"
         ]
      ]
   },
   {
      "title" : "Screened Porch Door Battery",
      "height" : "1",
      "y" : 480,
      "group" : "2a707ff1.43daa",
      "label" : "pct",
      "x" : 980,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "1",
      "seg1" : "",
      "z" : "7d04740a.ad6adc",
      "id" : "b18d5e95.2d863",
      "gtype" : "gage",
      "format" : "{{value}}",
      "min" : 0,
      "seg2" : "",
      "name" : "",
      "type" : "ui_gauge",
      "max" : "100",
      "wires" : [],
      "order" : 7
   },
   {
      "reg" : false,
      "y" : 440,
      "action" : "",
      "id" : "6993b677.9229a8",
      "property" : "",
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "wires" : [
         [
            "29d65706.f35408"
         ]
      ],
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "pt" : "msg",
            "tot" : "msg",
            "to" : "data.attributes.battery_level"
         }
      ],
      "x" : 600,
      "name" : "",
      "from" : "",
      "type" : "change"
   },
   {
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "wires" : [
         [
            "b18d5e95.2d863"
         ]
      ],
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "to" : "data.attributes.battery_level",
            "tot" : "msg",
            "pt" : "msg"
         }
      ],
      "x" : 600,
      "from" : "",
      "name" : "",
      "type" : "change",
      "reg" : false,
      "y" : 480,
      "action" : "",
      "id" : "faed0bb3.204208",
      "property" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "3abf4613.9bf6ba",
      "y" : 1200,
      "halt_if" : "",
      "name" : "Network Gear Switch",
      "type" : "api-current-state",
      "entity_id" : "zwave.network_gear",
      "x" : 380,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "4b4c7137.f5d61"
         ]
      ]
   },
   {
      "name" : "sentCnt",
      "type" : "change",
      "from" : "",
      "x" : 580,
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "to" : "data.attributes.sentCnt",
            "tot" : "msg",
            "pt" : "msg"
         },
         {
            "t" : "set",
            "p" : "topic",
            "pt" : "msg",
            "tot" : "str",
            "to" : "Sent Count"
         }
      ],
      "to" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "z" : "e7369e7e.c4997",
      "property" : "",
      "id" : "4e7b7986.58bb08",
      "action" : "",
      "y" : 560,
      "reg" : false
   },
   {
      "id" : "214e99ab.4f5526",
      "property" : "",
      "reg" : false,
      "action" : "",
      "y" : 600,
      "rules" : [
         {
            "to" : "data.attributes.sentFailed",
            "tot" : "msg",
            "pt" : "msg",
            "t" : "set",
            "p" : "payload"
         },
         {
            "to" : "Sent Failed",
            "tot" : "str",
            "pt" : "msg",
            "p" : "topic",
            "t" : "set"
         }
      ],
      "x" : 590,
      "type" : "change",
      "from" : "",
      "name" : "sentFailed",
      "z" : "e7369e7e.c4997",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "to" : ""
   },
   {
      "id" : "68eb7364.aad87c",
      "property" : "",
      "reg" : false,
      "action" : "",
      "y" : 640,
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "pt" : "msg",
            "tot" : "msg",
            "to" : "data.attributes.retries"
         },
         {
            "tot" : "str",
            "pt" : "msg",
            "to" : "Retries",
            "p" : "topic",
            "t" : "set"
         }
      ],
      "x" : 570,
      "name" : "retries",
      "type" : "change",
      "from" : "",
      "z" : "e7369e7e.c4997",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "to" : ""
   },
   {
      "property" : "",
      "id" : "54991c1.78ecbe4",
      "reg" : false,
      "y" : 680,
      "action" : "",
      "rules" : [
         {
            "pt" : "msg",
            "tot" : "msg",
            "to" : "data.attributes.receivedCnt",
            "p" : "payload",
            "t" : "set"
         },
         {
            "p" : "topic",
            "t" : "set",
            "pt" : "msg",
            "tot" : "str",
            "to" : "Received Count"
         }
      ],
      "name" : "receivedCnt",
      "from" : "",
      "type" : "change",
      "x" : 590,
      "z" : "e7369e7e.c4997",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "to" : ""
   },
   {
      "y" : 720,
      "action" : "",
      "reg" : false,
      "property" : "",
      "id" : "a3733f2f.b5a8e",
      "to" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "z" : "e7369e7e.c4997",
      "type" : "change",
      "name" : "receivedDups",
      "from" : "",
      "x" : 600,
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "to" : "data.attributes.receivedDups",
            "pt" : "msg",
            "tot" : "msg"
         },
         {
            "p" : "topic",
            "t" : "set",
            "pt" : "msg",
            "tot" : "str",
            "to" : "Received Duplicates"
         }
      ]
   },
   {
      "x" : 610,
      "type" : "change",
      "name" : "receivedUnsolicited",
      "from" : "",
      "rules" : [
         {
            "p" : "payload",
            "t" : "set",
            "pt" : "msg",
            "tot" : "msg",
            "to" : "data.attributes.receivedUnsolicited"
         },
         {
            "p" : "topic",
            "t" : "set",
            "pt" : "msg",
            "tot" : "str",
            "to" : "Received Unsolicited"
         }
      ],
      "to" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "z" : "e7369e7e.c4997",
      "id" : "9fe1c21b.2a6e9",
      "property" : "",
      "y" : 760,
      "action" : "",
      "reg" : false
   },
   {
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "to" : "",
      "z" : "e7369e7e.c4997",
      "type" : "change",
      "name" : "lastRequestRTT",
      "from" : "",
      "x" : 600,
      "rules" : [
         {
            "to" : "data.attributes.lastRequestRTT",
            "tot" : "msg",
            "pt" : "msg",
            "p" : "payload",
            "t" : "set"
         },
         {
            "to" : "Last Request RTT",
            "pt" : "msg",
            "tot" : "str",
            "t" : "set",
            "p" : "topic"
         }
      ],
      "y" : 800,
      "action" : "",
      "reg" : false,
      "property" : "",
      "id" : "9a701131.2f9b"
   },
   {
      "z" : "e7369e7e.c4997",
      "to" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "rules" : [
         {
            "to" : "data.attributes.averageRequestRTT",
            "pt" : "msg",
            "tot" : "msg",
            "t" : "set",
            "p" : "payload"
         },
         {
            "t" : "set",
            "p" : "topic",
            "to" : "Average Request RTT",
            "tot" : "str",
            "pt" : "msg"
         }
      ],
      "x" : 620,
      "from" : "",
      "type" : "change",
      "name" : "averageRequestRTT",
      "reg" : false,
      "y" : 840,
      "action" : "",
      "id" : "50627ed0.f018a",
      "property" : ""
   },
   {
      "y" : 880,
      "action" : "",
      "reg" : false,
      "id" : "6d690bb1.ae7784",
      "property" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "to" : "",
      "z" : "e7369e7e.c4997",
      "x" : 610,
      "name" : "lastResponseRTT",
      "type" : "change",
      "from" : "",
      "rules" : [
         {
            "to" : "data.attributes.lastResponseRTT",
            "pt" : "msg",
            "tot" : "msg",
            "t" : "set",
            "p" : "payload"
         },
         {
            "tot" : "str",
            "pt" : "msg",
            "to" : "Last Response RTT",
            "p" : "topic",
            "t" : "set"
         }
      ]
   },
   {
      "from" : "",
      "name" : "averageResponseRTT",
      "type" : "change",
      "x" : 620,
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "to" : "data.attributes.averageResponseRTT",
            "pt" : "msg",
            "tot" : "msg"
         },
         {
            "t" : "set",
            "p" : "topic",
            "to" : "Average Response RTT",
            "pt" : "msg",
            "tot" : "str"
         }
      ],
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "to" : "",
      "z" : "e7369e7e.c4997",
      "property" : "",
      "id" : "9d2640a3.6c7b",
      "action" : "",
      "y" : 920,
      "reg" : false
   },
   {
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "width" : 0,
      "chartType" : "line",
      "legend" : "true",
      "x" : 960,
      "label" : "Network Gear Switch",
      "useOneColor" : false,
      "group" : "ba683c3d.a294c",
      "ymax" : "",
      "y" : 1200,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "cutout" : 0,
      "interpolate" : "linear",
      "order" : 0,
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "ymin" : "",
      "nodata" : "",
      "removeOlderPoints" : "",
      "type" : "ui_chart",
      "name" : "",
      "id" : "6a65036f.7a8d6c",
      "dot" : false,
      "xformat" : "HH:mm:ss"
   },
   {
      "entity_id" : "zwave.garage_stairs_motion_sensor",
      "name" : "Stairs Motion Sensor",
      "type" : "api-current-state",
      "x" : 380,
      "halt_if" : "",
      "wires" : [
         [
            "18e93cb3.1e9623",
            "faa50576.ce7c68"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "id" : "979957ce.4c6648",
      "server" : "e2a02faf.48099",
      "y" : 520
   },
   {
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "tot" : "msg",
            "pt" : "msg",
            "to" : "data.attributes.battery_level"
         }
      ],
      "x" : 600,
      "from" : "",
      "name" : "",
      "type" : "change",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "824f42b0.6169f"
         ]
      ],
      "to" : "",
      "id" : "18e93cb3.1e9623",
      "property" : "",
      "reg" : false,
      "action" : "",
      "y" : 520
   },
   {
      "type" : "ui_gauge",
      "name" : "",
      "max" : "100",
      "order" : 8,
      "wires" : [],
      "gtype" : "gage",
      "min" : 0,
      "format" : "{{value}}",
      "id" : "824f42b0.6169f",
      "seg2" : "",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "1",
      "label" : "pct",
      "x" : 960,
      "seg1" : "",
      "z" : "7d04740a.ad6adc",
      "title" : "Stairs Motion Battery",
      "height" : "1",
      "group" : "2a707ff1.43daa",
      "y" : 520
   },
   {
      "func" : "\nreturn msg;",
      "y" : 720,
      "id" : "e1f63ff3.8f1c2",
      "z" : "e7369e7e.c4997",
      "noerr" : 0,
      "outputs" : 1,
      "wires" : [
         [
            "4e7b7986.58bb08",
            "214e99ab.4f5526",
            "68eb7364.aad87c",
            "54991c1.78ecbe4",
            "a3733f2f.b5a8e",
            "9fe1c21b.2a6e9",
            "9a701131.2f9b",
            "50627ed0.f018a",
            "6d690bb1.ae7784",
            "9d2640a3.6c7b"
         ]
      ],
      "type" : "function",
      "name" : "",
      "x" : 290
   },
   {
      "outputs" : 1,
      "noerr" : 0,
      "z" : "e7369e7e.c4997",
      "wires" : [
         []
      ],
      "x" : 910,
      "type" : "function",
      "name" : "",
      "func" : "\nreturn msg;",
      "y" : 740,
      "id" : "59f4f478.f3441c"
   },
   {
      "y" : 1200,
      "wires" : [
         [
            "6a65036f.7a8d6c"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "name" : "",
      "type" : "subflow:e7369e7e.c4997",
      "x" : 590,
      "id" : "4b4c7137.f5d61"
   },
   {
      "id" : "c23150db.645b8",
      "dot" : false,
      "xformat" : "HH:mm:ss",
      "interpolate" : "linear",
      "cutout" : 0,
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "order" : 0,
      "ymin" : "",
      "nodata" : "",
      "removeOlderPoints" : "",
      "type" : "ui_chart",
      "name" : "",
      "group" : "ba683c3d.a294c",
      "useOneColor" : false,
      "ymax" : "",
      "y" : 560,
      "removeOlderUnit" : "3600",
      "height" : "6",
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "width" : "6",
      "chartType" : "line",
      "legend" : "true",
      "label" : "Stairs Motion Sensor",
      "x" : 960
   },
   {
      "id" : "faa50576.ce7c68",
      "x" : 590,
      "name" : "",
      "type" : "subflow:e7369e7e.c4997",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "c23150db.645b8"
         ]
      ],
      "y" : 560
   },
   {
      "halt_if" : "",
      "x" : 380,
      "entity_id" : "zwave.garage_motion_sensor",
      "name" : "Garage Motion Sensor",
      "type" : "api-current-state",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "f5f3b176.85c16",
            "88bc8fa7.6d8bc"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "8646cb98.12e708",
      "y" : 600
   },
   {
      "wires" : [
         [
            "8ca429b2.15c378"
         ]
      ],
      "to" : "",
      "z" : "7d04740a.ad6adc",
      "x" : 600,
      "name" : "",
      "type" : "change",
      "from" : "",
      "rules" : [
         {
            "p" : "payload",
            "t" : "set",
            "pt" : "msg",
            "tot" : "msg",
            "to" : "data.attributes.battery_level"
         }
      ],
      "action" : "",
      "y" : 600,
      "reg" : false,
      "id" : "f5f3b176.85c16",
      "property" : ""
   },
   {
      "max" : "100",
      "wires" : [],
      "order" : 9,
      "type" : "ui_gauge",
      "name" : "",
      "seg2" : "",
      "gtype" : "gage",
      "format" : "{{value}}",
      "min" : 0,
      "id" : "8ca429b2.15c378",
      "seg1" : "",
      "z" : "7d04740a.ad6adc",
      "width" : "1",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "label" : "pct",
      "x" : 960,
      "group" : "2a707ff1.43daa",
      "y" : 600,
      "title" : "Garage Motion Battery",
      "height" : "1"
   },
   {
      "x" : 590,
      "id" : "88bc8fa7.6d8bc",
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "wires" : [
         [
            "8fa6e687.1f56c8"
         ]
      ],
      "y" : 640,
      "z" : "7d04740a.ad6adc"
   },
   {
      "name" : "",
      "type" : "ui_chart",
      "nodata" : "",
      "ymin" : "",
      "removeOlderPoints" : "",
      "wires" : [
         [],
         []
      ],
      "order" : 0,
      "useOldStyle" : false,
      "interpolate" : "linear",
      "cutout" : 0,
      "id" : "8fa6e687.1f56c8",
      "dot" : false,
      "xformat" : "HH:mm:ss",
      "x" : 960,
      "label" : "Garage Motion Sensor",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "width" : "6",
      "legend" : "true",
      "chartType" : "line",
      "removeOlder" : 1,
      "z" : "7d04740a.ad6adc",
      "height" : "6",
      "removeOlderUnit" : "3600",
      "ymax" : "",
      "y" : 640,
      "group" : "ba683c3d.a294c",
      "useOneColor" : false
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "c836a3d7.3cfba",
      "y" : 680,
      "halt_if" : "",
      "name" : "Garage Entry Door South Sensor",
      "entity_id" : "zwave.garage_entry_door_south",
      "type" : "api-current-state",
      "x" : 340,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "2bd76c33.095ad4",
            "531b9501.e6fbec"
         ]
      ]
   },
   {
      "reg" : false,
      "y" : 680,
      "action" : "",
      "id" : "2bd76c33.095ad4",
      "property" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "fe24df02.87099"
         ]
      ],
      "to" : "",
      "rules" : [
         {
            "pt" : "msg",
            "tot" : "msg",
            "to" : "data.attributes.battery_level",
            "p" : "payload",
            "t" : "set"
         }
      ],
      "x" : 600,
      "type" : "change",
      "from" : "",
      "name" : ""
   },
   {
      "y" : 680,
      "group" : "2a707ff1.43daa",
      "title" : "Garage Entry Door South",
      "height" : "1",
      "z" : "7d04740a.ad6adc",
      "seg1" : "",
      "label" : "pct",
      "x" : 970,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "1",
      "seg2" : "",
      "id" : "fe24df02.87099",
      "format" : "{{value}}",
      "min" : 0,
      "gtype" : "gage",
      "wires" : [],
      "order" : 10,
      "max" : "100",
      "name" : "",
      "type" : "ui_gauge"
   },
   {
      "x" : 590,
      "id" : "531b9501.e6fbec",
      "name" : "",
      "type" : "subflow:e7369e7e.c4997",
      "wires" : [
         [
            "73cd63c3.485a3c"
         ]
      ],
      "y" : 720,
      "z" : "7d04740a.ad6adc"
   },
   {
      "chartType" : "line",
      "legend" : "true",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "width" : "6",
      "x" : 970,
      "label" : "Garage Entry Door South",
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "removeOlderUnit" : "3600",
      "height" : "6",
      "useOneColor" : false,
      "group" : "ba683c3d.a294c",
      "y" : 720,
      "ymax" : "",
      "removeOlderPoints" : "",
      "ymin" : "",
      "nodata" : "",
      "type" : "ui_chart",
      "name" : "",
      "cutout" : 0,
      "interpolate" : "linear",
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "order" : 0,
      "xformat" : "HH:mm:ss",
      "dot" : false,
      "id" : "73cd63c3.485a3c"
   },
   {
      "id" : "5a44d302.2472dc",
      "server" : "e2a02faf.48099",
      "y" : 760,
      "x" : 350,
      "type" : "api-current-state",
      "name" : "Garage Entry Door North Sensor",
      "entity_id" : "zwave.garage_entry_door_north",
      "halt_if" : "",
      "wires" : [
         [
            "2372a3f2.a1e2bc",
            "5f8e674e.df0c58"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "id" : "2372a3f2.a1e2bc",
      "property" : "",
      "action" : "",
      "y" : 760,
      "reg" : false,
      "x" : 600,
      "type" : "change",
      "name" : "",
      "from" : "",
      "rules" : [
         {
            "to" : "data.attributes.battery_level",
            "tot" : "msg",
            "pt" : "msg",
            "t" : "set",
            "p" : "payload"
         }
      ],
      "to" : "",
      "wires" : [
         [
            "32972418.d0e90c"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "y" : 800,
      "wires" : [
         [
            "c1aee42b.728268"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "x" : 590,
      "id" : "5f8e674e.df0c58"
   },
   {
      "seg2" : "",
      "format" : "{{value}}",
      "min" : 0,
      "gtype" : "gage",
      "id" : "32972418.d0e90c",
      "wires" : [],
      "order" : 11,
      "max" : "100",
      "type" : "ui_gauge",
      "name" : "",
      "group" : "2a707ff1.43daa",
      "y" : 760,
      "height" : "1",
      "title" : "Garage Entry Door North",
      "z" : "7d04740a.ad6adc",
      "seg1" : "",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "1",
      "x" : 970,
      "label" : "pct"
   },
   {
      "xformat" : "HH:mm:ss",
      "id" : "c1aee42b.728268",
      "dot" : false,
      "name" : "",
      "type" : "ui_chart",
      "removeOlderPoints" : "",
      "ymin" : "",
      "nodata" : "",
      "order" : 0,
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "interpolate" : "linear",
      "cutout" : 0,
      "height" : 0,
      "removeOlderUnit" : "3600",
      "y" : 800,
      "ymax" : "",
      "group" : "ba683c3d.a294c",
      "useOneColor" : false,
      "label" : "Garage Entry Door North",
      "x" : 970,
      "legend" : "true",
      "chartType" : "line",
      "width" : 0,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "removeOlder" : 1,
      "z" : "7d04740a.ad6adc"
   },
   {
      "y" : 840,
      "server" : "e2a02faf.48099",
      "id" : "12b38f8e.d928",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "69a3c9ea.bc4958",
            "11073475.85b89c"
         ]
      ],
      "halt_if" : "",
      "entity_id" : "zwave.garage_door_south_tilt",
      "type" : "api-current-state",
      "name" : "Garage Door South TIlt Sensor",
      "x" : 350
   },
   {
      "reg" : false,
      "action" : "",
      "y" : 840,
      "property" : "",
      "id" : "69a3c9ea.bc4958",
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "wires" : [
         [
            "a67b37cd.e327f8"
         ]
      ],
      "rules" : [
         {
            "tot" : "msg",
            "pt" : "msg",
            "to" : "data.attributes.battery_level",
            "p" : "payload",
            "t" : "set"
         }
      ],
      "name" : "",
      "from" : "",
      "type" : "change",
      "x" : 600
   },
   {
      "x" : 590,
      "id" : "11073475.85b89c",
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "y" : 880,
      "wires" : [
         [
            "d1ea5082.8e3cf"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "format" : "{{value}}",
      "min" : 0,
      "gtype" : "gage",
      "id" : "a67b37cd.e327f8",
      "seg2" : "",
      "type" : "ui_gauge",
      "name" : "",
      "order" : 12,
      "wires" : [],
      "max" : "100",
      "title" : "Garage Door South Tilt",
      "height" : "1",
      "group" : "2a707ff1.43daa",
      "y" : 840,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "1",
      "x" : 960,
      "label" : "pct",
      "z" : "7d04740a.ad6adc",
      "seg1" : ""
   },
   {
      "id" : "d1ea5082.8e3cf",
      "dot" : false,
      "xformat" : "HH:mm:ss",
      "interpolate" : "linear",
      "cutout" : 0,
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "order" : 0,
      "ymin" : "",
      "nodata" : "",
      "removeOlderPoints" : "",
      "name" : "",
      "type" : "ui_chart",
      "useOneColor" : false,
      "group" : "ba683c3d.a294c",
      "ymax" : "",
      "y" : 880,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "width" : 0,
      "legend" : "true",
      "chartType" : "line",
      "label" : "Garage Door South Tilt",
      "x" : 960
   },
   {
      "halt_if" : "",
      "name" : "Garage Door South TIlt Sensor",
      "type" : "api-current-state",
      "entity_id" : "zwave.garage_door_north_tilt",
      "x" : 350,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "a4d52a05.5764c8",
            "db484d0f.ecf26"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "845ca713.652ef8",
      "y" : 920
   },
   {
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "e942ef5f.b3516"
         ]
      ],
      "to" : "",
      "rules" : [
         {
            "to" : "data.attributes.battery_level",
            "tot" : "msg",
            "pt" : "msg",
            "t" : "set",
            "p" : "payload"
         }
      ],
      "type" : "change",
      "name" : "",
      "from" : "",
      "x" : 600,
      "reg" : false,
      "action" : "",
      "y" : 920,
      "property" : "",
      "id" : "a4d52a05.5764c8"
   },
   {
      "z" : "7d04740a.ad6adc",
      "y" : 960,
      "wires" : [
         [
            "d4321b8c.015128"
         ]
      ],
      "id" : "db484d0f.ecf26",
      "x" : 590,
      "type" : "subflow:e7369e7e.c4997",
      "name" : ""
   },
   {
      "name" : "",
      "type" : "ui_gauge",
      "wires" : [],
      "order" : 13,
      "max" : "100",
      "id" : "e942ef5f.b3516",
      "format" : "{{value}}",
      "min" : 0,
      "gtype" : "gage",
      "seg2" : "",
      "label" : "pct",
      "x" : 960,
      "width" : "1",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "z" : "7d04740a.ad6adc",
      "seg1" : "",
      "title" : "Garage Door North Tilt",
      "height" : "1",
      "y" : 920,
      "group" : "2a707ff1.43daa"
   },
   {
      "xformat" : "HH:mm:ss",
      "id" : "d4321b8c.015128",
      "dot" : false,
      "removeOlderPoints" : "",
      "nodata" : "",
      "ymin" : "",
      "type" : "ui_chart",
      "name" : "",
      "interpolate" : "linear",
      "cutout" : 0,
      "wires" : [
         [],
         []
      ],
      "order" : 0,
      "useOldStyle" : false,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "useOneColor" : false,
      "group" : "ba683c3d.a294c",
      "y" : 960,
      "ymax" : "",
      "legend" : "true",
      "chartType" : "line",
      "width" : 0,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "x" : 960,
      "label" : "Garage Door North Tilt",
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1
   },
   {
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "3f5d8256.4fc66e"
         ]
      ],
      "halt_if" : "",
      "x" : 390,
      "type" : "api-current-state",
      "name" : "Front Porch Switch",
      "entity_id" : "zwave.front_door_switch",
      "y" : 1160,
      "server" : "e2a02faf.48099",
      "id" : "e41c2a57.3223d8"
   },
   {
      "x" : 590,
      "id" : "3f5d8256.4fc66e",
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "y" : 1160,
      "wires" : [
         [
            "144a6220.e7f98e"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "width" : 0,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "legend" : "true",
      "chartType" : "line",
      "label" : "Front Porch Switch",
      "x" : 950,
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "useOneColor" : false,
      "group" : "ba683c3d.a294c",
      "ymax" : "",
      "y" : 1160,
      "ymin" : "",
      "nodata" : "",
      "removeOlderPoints" : "",
      "name" : "",
      "type" : "ui_chart",
      "cutout" : 0,
      "interpolate" : "linear",
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "order" : 0,
      "dot" : false,
      "id" : "144a6220.e7f98e",
      "xformat" : "HH:mm:ss"
   },
   {
      "wires" : [
         [
            "61ea8e18.0dee7",
            "415fdacd.1dbfd4"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 390,
      "entity_id" : "zwave.front_door",
      "type" : "api-current-state",
      "name" : "Front Door Sensor",
      "halt_if" : "",
      "y" : 1000,
      "id" : "83b4b32f.c1391",
      "server" : "e2a02faf.48099"
   },
   {
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "to" : "data.attributes.battery_level",
            "tot" : "msg",
            "pt" : "msg"
         }
      ],
      "x" : 600,
      "name" : "",
      "type" : "change",
      "from" : "",
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "wires" : [
         [
            "97ff2579.959c88"
         ]
      ],
      "id" : "61ea8e18.0dee7",
      "property" : "",
      "reg" : false,
      "y" : 1000,
      "action" : ""
   },
   {
      "id" : "415fdacd.1dbfd4",
      "x" : 590,
      "name" : "",
      "type" : "subflow:e7369e7e.c4997",
      "z" : "7d04740a.ad6adc",
      "y" : 1040,
      "wires" : [
         [
            "fab9fb1c.4280f8"
         ]
      ]
   },
   {
      "x" : 930,
      "label" : "pct",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "1",
      "seg1" : "",
      "z" : "7d04740a.ad6adc",
      "title" : "Front Door",
      "height" : "1",
      "y" : 1000,
      "group" : "2a707ff1.43daa",
      "name" : "",
      "type" : "ui_gauge",
      "max" : "100",
      "wires" : [],
      "order" : 14,
      "id" : "97ff2579.959c88",
      "gtype" : "gage",
      "format" : "{{value}}",
      "min" : 0,
      "seg2" : ""
   },
   {
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "legend" : "true",
      "chartType" : "line",
      "width" : 0,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "x" : 930,
      "label" : "Front Door",
      "useOneColor" : false,
      "group" : "ba683c3d.a294c",
      "y" : 1040,
      "ymax" : "",
      "removeOlderUnit" : "3600",
      "height" : 0,
      "interpolate" : "linear",
      "cutout" : 0,
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "order" : 0,
      "removeOlderPoints" : "",
      "nodata" : "",
      "ymin" : "",
      "name" : "",
      "type" : "ui_chart",
      "xformat" : "HH:mm:ss",
      "id" : "fab9fb1c.4280f8",
      "dot" : false
   },
   {
      "id" : "4a699181.4d185",
      "server" : "e2a02faf.48099",
      "y" : 1240,
      "type" : "api-current-state",
      "entity_id" : "zwave.coffee_grinder",
      "name" : "Coffee Grinder Switch",
      "x" : 380,
      "halt_if" : "",
      "wires" : [
         [
            "83ce684a.69b968"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "id" : "83ce684a.69b968",
      "x" : 590,
      "name" : "",
      "type" : "subflow:e7369e7e.c4997",
      "z" : "7d04740a.ad6adc",
      "y" : 1240,
      "wires" : [
         [
            "ed4700de.2d9d1"
         ]
      ]
   },
   {
      "dot" : false,
      "id" : "ed4700de.2d9d1",
      "xformat" : "HH:mm:ss",
      "interpolate" : "linear",
      "cutout" : 0,
      "order" : 0,
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "ymin" : "",
      "nodata" : "",
      "removeOlderPoints" : "",
      "name" : "",
      "type" : "ui_chart",
      "useOneColor" : false,
      "group" : "ba683c3d.a294c",
      "ymax" : "",
      "y" : 1240,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "width" : 0,
      "chartType" : "line",
      "legend" : "true",
      "x" : 960,
      "label" : "Coffee Grinder Switch"
   },
   {
      "x" : 350,
      "entity_id" : "zwave.basement_dehumidifier",
      "name" : "Basement Dehumidifier Switch",
      "type" : "api-current-state",
      "halt_if" : "",
      "wires" : [
         [
            "a4d1509b.42126"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "id" : "9c7a6221.e6ca",
      "server" : "e2a02faf.48099",
      "y" : 1280
   },
   {
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "x" : 590,
      "id" : "a4d1509b.42126",
      "wires" : [
         [
            "dbaa68a4.f1b2f8"
         ]
      ],
      "y" : 1280,
      "z" : "7d04740a.ad6adc"
   },
   {
      "removeOlderUnit" : "3600",
      "height" : 0,
      "group" : "ba683c3d.a294c",
      "useOneColor" : false,
      "ymax" : "",
      "y" : 1280,
      "width" : 0,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "chartType" : "line",
      "legend" : "true",
      "label" : "Basement Dehumidifier Switch",
      "x" : 990,
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "dot" : false,
      "id" : "dbaa68a4.f1b2f8",
      "xformat" : "HH:mm:ss",
      "ymin" : "",
      "nodata" : "",
      "removeOlderPoints" : "",
      "name" : "",
      "type" : "ui_chart",
      "interpolate" : "linear",
      "cutout" : 0,
      "order" : 0,
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "4d395e23.30c5d",
      "y" : 1080,
      "halt_if" : "",
      "type" : "api-current-state",
      "entity_id" : "zwave.basement_back_door",
      "name" : "Basement Back Door Sensor",
      "x" : 360,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "803cbc60.1a639",
            "d0a146bf.7b5918"
         ]
      ]
   },
   {
      "type" : "change",
      "from" : "",
      "name" : "",
      "x" : 600,
      "rules" : [
         {
            "to" : "data.attributes.battery_level",
            "tot" : "msg",
            "pt" : "msg",
            "t" : "set",
            "p" : "payload"
         }
      ],
      "wires" : [
         [
            "cde0e900.d52498"
         ]
      ],
      "to" : "",
      "z" : "7d04740a.ad6adc",
      "property" : "",
      "id" : "803cbc60.1a639",
      "action" : "",
      "y" : 1080,
      "reg" : false
   },
   {
      "name" : "",
      "type" : "subflow:e7369e7e.c4997",
      "x" : 590,
      "id" : "d0a146bf.7b5918",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "28b250b9.a384c"
         ]
      ],
      "y" : 1120
   },
   {
      "group" : "2a707ff1.43daa",
      "y" : 1080,
      "title" : "Basement Back Door",
      "height" : "1",
      "z" : "7d04740a.ad6adc",
      "seg1" : "",
      "width" : "1",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "label" : "pct",
      "x" : 960,
      "seg2" : "",
      "format" : "{{value}}",
      "min" : 0,
      "gtype" : "gage",
      "id" : "cde0e900.d52498",
      "wires" : [],
      "order" : 15,
      "max" : "100",
      "type" : "ui_gauge",
      "name" : ""
   },
   {
      "dot" : false,
      "id" : "28b250b9.a384c",
      "xformat" : "HH:mm:ss",
      "interpolate" : "linear",
      "cutout" : 0,
      "useOldStyle" : false,
      "wires" : [
         [],
         []
      ],
      "order" : 0,
      "nodata" : "",
      "ymin" : "",
      "removeOlderPoints" : "",
      "name" : "",
      "type" : "ui_chart",
      "group" : "ba683c3d.a294c",
      "useOneColor" : false,
      "ymax" : "",
      "y" : 1120,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "width" : 0,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "chartType" : "line",
      "legend" : "true",
      "label" : "Basement Back Door",
      "x" : 960
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "981ce0e8.cdfba",
      "y" : 1320,
      "halt_if" : "",
      "x" : 360,
      "type" : "api-current-state",
      "name" : "Network Gear Switch Power",
      "entity_id" : "sensor.network_gear_voltage",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "cb99ff0b.f61cf",
            "21c03bfa.5995a4"
         ]
      ]
   },
   {
      "halt_if" : "",
      "x" : 360,
      "name" : "Coffee Grinder Switch Power",
      "entity_id" : "switch.coffee_grinder_switch",
      "type" : "api-current-state",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "7a3bcad4.5804e4"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "25039e35.ef7072",
      "y" : 1400
   },
   {
      "x" : 600,
      "type" : "change",
      "name" : "",
      "from" : "",
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "to" : "data.attributes.power_consumption",
            "tot" : "msg",
            "pt" : "msg"
         },
         {
            "p" : "topic",
            "t" : "set",
            "to" : "Network Gear Power Consumption",
            "tot" : "str",
            "pt" : "msg"
         }
      ],
      "to" : "",
      "wires" : [
         [
            "f0322859.670ce8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "id" : "cb99ff0b.f61cf",
      "property" : "",
      "action" : "",
      "y" : 1320,
      "reg" : false
   },
   {
      "x" : 600,
      "from" : "",
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "tot" : "msg",
            "pt" : "msg",
            "to" : "data.attributes.power_consumption"
         },
         {
            "t" : "set",
            "p" : "topic",
            "to" : "Coffee Grinder Power Consumption",
            "tot" : "str",
            "pt" : "msg"
         }
      ],
      "to" : "",
      "wires" : [
         [
            "352c5a26.502bb6"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "id" : "7a3bcad4.5804e4",
      "property" : "",
      "y" : 1400,
      "action" : "",
      "reg" : false
   },
   {
      "id" : "f0322859.670ce8",
      "dot" : false,
      "xformat" : "HH:mm:ss",
      "wires" : [
         [],
         []
      ],
      "order" : 3,
      "useOldStyle" : false,
      "cutout" : 0,
      "interpolate" : "linear",
      "name" : "",
      "type" : "ui_chart",
      "nodata" : "",
      "ymin" : "",
      "removeOlderPoints" : "",
      "ymax" : "",
      "y" : 1320,
      "useOneColor" : false,
      "group" : "ea10f06.a52e21",
      "height" : "6",
      "removeOlderUnit" : "3600",
      "removeOlder" : 1,
      "z" : "7d04740a.ad6adc",
      "label" : "Network Gear Power Consumption",
      "x" : 1000,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "width" : "6",
      "chartType" : "line",
      "legend" : "true"
   },
   {
      "nodata" : "",
      "ymin" : "",
      "removeOlderPoints" : "",
      "type" : "ui_chart",
      "name" : "",
      "cutout" : 0,
      "interpolate" : "linear",
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "order" : 5,
      "dot" : false,
      "id" : "352c5a26.502bb6",
      "xformat" : "HH:mm:ss",
      "width" : "6",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "legend" : "true",
      "chartType" : "line",
      "x" : 1000,
      "label" : "Coffee Grinder Power Consumption",
      "z" : "7d04740a.ad6adc",
      "removeOlder" : 1,
      "removeOlderUnit" : "3600",
      "height" : "6",
      "group" : "ea10f06.a52e21",
      "useOneColor" : false,
      "ymax" : "",
      "y" : 1400
   },
   {
      "to" : "",
      "wires" : [
         [
            "f6655737.5ea8f8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "from" : "",
      "name" : "",
      "type" : "change",
      "x" : 600,
      "rules" : [
         {
            "t" : "set",
            "p" : "topic",
            "to" : "Network Gear Input Voltage",
            "tot" : "str",
            "pt" : "msg"
         }
      ],
      "action" : "",
      "y" : 1360,
      "reg" : false,
      "property" : "",
      "id" : "21c03bfa.5995a4"
   },
   {
      "height" : "6",
      "removeOlderUnit" : "3600",
      "ymax" : "",
      "y" : 1360,
      "useOneColor" : false,
      "group" : "ea10f06.a52e21",
      "label" : "Home Input Voltage",
      "x" : 950,
      "width" : "6",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "chartType" : "line",
      "legend" : "true",
      "removeOlder" : 1,
      "z" : "7d04740a.ad6adc",
      "id" : "f6655737.5ea8f8",
      "dot" : false,
      "xformat" : "HH:mm:ss",
      "type" : "ui_chart",
      "name" : "",
      "nodata" : "",
      "ymin" : "",
      "removeOlderPoints" : "",
      "order" : 4,
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "interpolate" : "linear",
      "cutout" : 0
   },
   {
      "halt_if" : "",
      "x" : 350,
      "type" : "api-current-state",
      "name" : "iPad battery",
      "entity_id" : "sensor.howd_ipad_air_battery_level",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "ff3a1cd7.66ee4"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "526d53c5.a3ab2c",
      "y" : 320
   },
   {
      "wires" : [
         [
            "5ad88866.091e98"
         ]
      ],
      "to" : "",
      "z" : "7d04740a.ad6adc",
      "type" : "change",
      "from" : "",
      "name" : "",
      "x" : 600,
      "rules" : [
         {
            "tot" : "str",
            "pt" : "msg",
            "to" : "iPad Air Battery",
            "p" : "topic",
            "t" : "set"
         }
      ],
      "y" : 320,
      "action" : "",
      "reg" : false,
      "property" : "",
      "id" : "ff3a1cd7.66ee4"
   },
   {
      "title" : "iPad Battery",
      "height" : "2",
      "y" : 320,
      "group" : "2a707ff1.43daa",
      "label" : "pct",
      "x" : 930,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "width" : "2",
      "z" : "7d04740a.ad6adc",
      "seg1" : "",
      "id" : "5ad88866.091e98",
      "min" : 0,
      "format" : "{{value}}",
      "gtype" : "gage",
      "seg2" : "",
      "type" : "ui_gauge",
      "name" : "",
      "order" : 5,
      "wires" : [],
      "max" : "100"
   },
   {
      "name" : "Temperature Set point",
      "type" : "api-current-state",
      "entity_id" : "sensor.hallway_thermostat_nest_target",
      "x" : 380,
      "halt_if" : "",
      "wires" : [
         [
            "ec6830aa.140da"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "id" : "bdb229f1.681488",
      "server" : "e2a02faf.48099",
      "y" : 280
   },
   {
      "rules" : [
         {
            "to" : "HVAC Set point (F)",
            "pt" : "msg",
            "tot" : "str",
            "p" : "topic",
            "t" : "set"
         }
      ],
      "x" : 600,
      "from" : "",
      "name" : "",
      "type" : "change",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "to" : "",
      "id" : "ec6830aa.140da",
      "property" : "",
      "reg" : false,
      "y" : 280,
      "action" : ""
   },
   {
      "y" : 80,
      "server" : "e2a02faf.48099",
      "id" : "7a85784d.5c3d08",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "8257b7ad.3e7fc8"
         ]
      ],
      "halt_if" : "",
      "entity_id" : "sensor.hallway_thermostat_nest_humidity",
      "name" : "Current house humidity",
      "type" : "api-current-state",
      "x" : 370
   },
   {
      "rules" : [
         {
            "t" : "set",
            "p" : "topic",
            "to" : "Inside Humidity (%)",
            "tot" : "str",
            "pt" : "msg"
         }
      ],
      "from" : "",
      "type" : "change",
      "name" : "",
      "x" : 600,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "f9d3c081.74441"
         ]
      ],
      "to" : "",
      "property" : "",
      "id" : "8257b7ad.3e7fc8",
      "reg" : false,
      "action" : "",
      "y" : 80
   },
   {
      "label" : "percent",
      "x" : 940,
      "width" : 0,
      "colors" : [
         "#ffff00",
         "#80ff00",
         "#ffff00"
      ],
      "z" : "7d04740a.ad6adc",
      "seg1" : "20",
      "title" : "Inside Humidity",
      "height" : 0,
      "y" : 240,
      "group" : "ea10f06.a52e21",
      "type" : "ui_gauge",
      "name" : "",
      "order" : 2,
      "wires" : [],
      "max" : "100",
      "id" : "f9d3c081.74441",
      "min" : 0,
      "format" : "{{value}}",
      "gtype" : "gage",
      "seg2" : "80"
   },
   {
      "id" : "86624837.767f38",
      "service_domain" : "device_tracker",
      "server" : "e2a02faf.48099",
      "y" : 240,
      "data" : "{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"home\"}",
      "type" : "api-call-service",
      "name" : "Set Walt Home",
      "x" : 1040,
      "mergecontext" : "",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "service" : "see"
   },
   {
      "wires" : [
         [
            "86624837.767f38"
         ]
      ],
      "payload" : "",
      "onceDelay" : 0.1,
      "z" : "e0703c90.1a341",
      "type" : "inject",
      "name" : "",
      "payloadType" : "date",
      "x" : 840,
      "topic" : "",
      "y" : 240,
      "crontab" : "",
      "id" : "b7e2c6b7.7a2fc8",
      "repeat" : "",
      "once" : false
   },
   {
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "edebe89c.2806a8",
            "d7d6305.65421d"
         ]
      ],
      "onceDelay" : 0.1,
      "payload" : "",
      "topic" : "",
      "name" : "",
      "type" : "inject",
      "payloadType" : "date",
      "x" : 820,
      "crontab" : "",
      "y" : 300,
      "once" : false,
      "repeat" : "",
      "id" : "86cf92b4.04c4b"
   },
   {
      "mergecontext" : "",
      "x" : 1050,
      "type" : "api-call-service",
      "name" : "Set Walt Not Home",
      "service" : "see",
      "z" : "e0703c90.1a341",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "service_domain" : "device_tracker",
      "id" : "edebe89c.2806a8",
      "data" : "{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"not_home\"}",
      "y" : 280
   },
   {
      "z" : "8bb76918.ef6b48",
      "y" : 1800,
      "wires" : [
         [
            "264e27e2.d38b58"
         ]
      ],
      "type" : "subflow:c663f7df.ca58b8",
      "name" : "",
      "id" : "3dccda89.1d8a16",
      "x" : 400
   },
   {
      "id" : "b6128bac.d3deb8",
      "y" : 20,
      "name" : "Disabled iCloud2 tracking",
      "type" : "comment",
      "info" : "Underyling library tracks all devies, hoping they fix it:\n\nhttps://github.com/picklepete/pyicloud/issues/142\n",
      "x" : 1210,
      "wires" : [],
      "z" : "46ed0d55.4c98b4"
   },
   {
      "id" : "11cac704.acdbc9",
      "outputLabels" : [
         "walt",
         "dawn"
      ],
      "y" : 220,
      "func" : "if(msg.person == \"walt\") {\n    return[ msg, null ];\n} else if(msg.person == \"dawn\") {\n    return[ null, msg ];\n}",
      "x" : 1350,
      "type" : "function",
      "name" : "Switch user",
      "wires" : [
         [],
         [
            "3a53eed2.e0e1f2"
         ]
      ],
      "outputs" : "2",
      "z" : "46ed0d55.4c98b4",
      "noerr" : 0
   },
   {
      "y" : 320,
      "data" : "{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}",
      "service_domain" : "device_tracker",
      "id" : "d7d6305.65421d",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "service" : "see",
      "name" : "Set Walt Wifi Not Home",
      "type" : "api-call-service",
      "x" : 1070,
      "mergecontext" : ""
   },
   {
      "wires" : [
         [
            "9a1ed94a.6731a8",
            "2ce419c7.fb69b6",
            "38d8e92.9caf216",
            "9239610f.2b97b"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "id" : "d2c9201e.f640e",
      "pauseType" : "delay",
      "randomFirst" : "1",
      "z" : "c663f7df.ca58b8",
      "x" : 140,
      "timeout" : "1",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "y" : 520,
      "drop" : false,
      "rate" : "1",
      "nbRateUnits" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds"
   },
   {
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "a6d97fb.109798",
            "421449d8.238b68",
            "1d2995b.befbb6a"
         ]
      ],
      "pauseType" : "delay",
      "id" : "702132b0.14facc",
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "1",
      "x" : 300,
      "z" : "3844d016.18a29",
      "randomFirst" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "rate" : "1",
      "drop" : false,
      "y" : 100
   },
   {
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "1",
      "x" : 180,
      "z" : "2283eff7.ee9ab",
      "randomFirst" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "rate" : "1",
      "drop" : false,
      "y" : 180,
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "341e614.4cf539e",
            "7ed74b51.666eb4",
            "d349f480.c33fe8"
         ]
      ],
      "pauseType" : "delay",
      "id" : "5904fbc7.300974"
   },
   {
      "id" : "2a39bced.7c2094",
      "y" : 3440,
      "type" : "comment",
      "name" : "Turn off Son2's Lamp and Upstairs Light after main level is off",
      "x" : 240,
      "info" : "",
      "z" : "8bb76918.ef6b48",
      "wires" : []
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "a935ce5c.0d27"
         ]
      ],
      "entityidfilter" : "group.main_level",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "name" : "Main level off",
      "haltifstate" : "on",
      "x" : 110,
      "y" : 3500,
      "server" : "e2a02faf.48099",
      "id" : "3c8b57d9.391eb8"
   },
   {
      "y" : 3500,
      "endOffset" : 0,
      "endTime" : "1:00",
      "startTime" : "20:00",
      "id" : "a935ce5c.0d27",
      "z" : "8bb76918.ef6b48",
      "startOffset" : 0,
      "wires" : [
         [
            "19f125f5.1fc9da"
         ],
         []
      ],
      "lat" : "40.18937",
      "lon" : "-92.58249",
      "name" : "8PM to 1AM",
      "type" : "time-range-switch",
      "x" : 290
   },
   {
      "wires" : [
         [
            "1f05b226.c715fe"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "id" : "19f125f5.1fc9da",
      "pauseType" : "rate",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "x" : 500,
      "timeout" : "5",
      "timeoutUnits" : "seconds",
      "rateUnits" : "hour",
      "y" : 3500,
      "drop" : true,
      "rate" : "1",
      "nbRateUnits" : "5",
      "randomLast" : "5",
      "randomUnits" : "seconds"
   },
   {
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "34710975.2be7e6"
         ]
      ],
      "pauseType" : "delay",
      "id" : "1f05b226.c715fe",
      "timeoutUnits" : "minutes",
      "rateUnits" : "second",
      "x" : 690,
      "timeout" : "10",
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "1",
      "rate" : "1",
      "drop" : false,
      "y" : 3500
   },
   {
      "data" : "{\"entity_id\":\"light.upstairs_hallway_and_colins_lamp\"}",
      "y" : 3500,
      "server" : "e2a02faf.48099",
      "id" : "34710975.2be7e6",
      "service_domain" : "light",
      "service" : "turn_off",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "x" : 990,
      "type" : "api-call-service",
      "name" : "Turn off Son2's Lamp and Upstairs"
   },
   {
      "y" : 1820,
      "repair" : false,
      "property" : "payload",
      "id" : "70445fd.82f60a",
      "z" : "20661f8a.532c4",
      "checkall" : "true",
      "outputs" : 1,
      "wires" : [
         [
            "1a117a6.cfb5586",
            "d39aad46.c7dab"
         ]
      ],
      "rules" : [
         {
            "case" : false,
            "t" : "regex",
            "v" : "^\\d{4}-\\d{2}-\\d{2}.\\d{2}:\\d{2}:\\d{2}.ERROR..MainThread...homeassistant.core..Error executing service..ServiceCall light.turn.*entity_id...light.",
            "vt" : "str"
         }
      ],
      "type" : "switch",
      "name" : "Zigbee light failure",
      "x" : 530,
      "propertyType" : "msg"
   },
   {
      "wires" : [],
      "tosidebar" : true,
      "active" : true,
      "z" : "20661f8a.532c4",
      "x" : 680,
      "tostatus" : false,
      "name" : "Zigbee failure",
      "type" : "debug",
      "console" : false,
      "complete" : "true",
      "y" : 1740,
      "id" : "1a117a6.cfb5586"
   },
   {
      "type" : "function",
      "name" : "Split",
      "x" : 770,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "outputs" : 1,
      "wires" : [
         [
            "495baa2a.02b484"
         ]
      ],
      "id" : "d39aad46.c7dab",
      "func" : "var outputMsgs      = [];\ndomain              = 'light';\nservice             = msg.payload.replace(/.*ServiceCall.light.(.*?):.*/, '$1');\nlights              = msg.payload.split(',');\nlight_check         = /^light\\./;\n\n\nfor (var w in lights) {\n    light           = lights[w].replace(/.*(light.*)\\'.*/, '$1');\n    \n    if(light_check.test(light)) {\n        ha_service_call = {payload: {'domain':domain,'service':service, data: {'entity_id':light} } };\n        \n        brightness_check    = /brightness/g;\n        transition_check    = /transition/g;\n        color_temp_check    = /color_temp/g;\n        number_check        = /^\\d+$/;\n        number_with_dec     = /^\\d+\\.\\d+$/;\n\n        if (brightness_check.test(msg.payload)) {\n            brightness      = msg.payload.replace(/.*brightness.(.*?)[,|>].*/, '$1');\n            \n            if (number_check.test(brightness)) {\n                ha_service_call.payload.data.brightness = brightness;\n            }\n        }\n\n        if (transition_check.test(msg.payload)) {\n            transition      = msg.payload.replace(/.*transition.(.*?)[,|>].*/, '$1');\n            \n            if(number_with_dec.test(transition)) {\n                ha_service_call.payload.data.transition = transition;\n            }\n        }\n        \n        if (color_temp_check.test(msg.payload)) {\n            color_temp      = msg.payload.replace(/.*color_temp.(.*?)[,|>].*/, '$1');\n            \n            if (number_check.test(color_temp)) {\n                ha_service_call.payload.data.color_temp = color_temp;\n            }\n        }        \n        \n        outputMsgs.push(ha_service_call);\n    }\n}\nreturn [ outputMsgs ];",
      "y" : 1820
   },
   {
      "y" : 1780,
      "data" : "",
      "service_domain" : "",
      "id" : "d3dada85.4de268",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "service" : "",
      "type" : "api-call-service",
      "name" : "Retry Zigbee Errors",
      "x" : 1990,
      "mergecontext" : ""
   },
   {
      "id" : "eee940ac.cdaa7",
      "repeat" : "",
      "once" : false,
      "y" : 1860,
      "crontab" : "",
      "x" : 80,
      "name" : "Manual testing",
      "type" : "inject",
      "payloadType" : "str",
      "topic" : "",
      "onceDelay" : "",
      "payload" : "2018-03-01 12:59:33 ERROR (MainThread) [homeassistant.core] Error executing service <ServiceCall light.turn_off: entity_id=['light.philips_lct014_0288ce3f_11', 'light.philips_lct014_0288d38c_11', 'light.philips_lct014_02e80114_11', 'light.philips_lwb014_030e204b_11', 'light.philips_lwb014_0344ad6f_11', 'light.philips_lwb014_035d1e3b_11', 'light.philips_lwb014_035d32c1_11', 'light.sengled_e11g13_03023f6d_1', 'light.sengled_e11g13_030661f5_1', 'light.sengled_e11g13_030666b2_1', 'light.sengled_e11g13_0309206e_1', 'light.sengled_e11g13_03092f6b_1', 'light.sengled_e11g13_030b05a4_1', 'light.sengled_e11g13_030b0923_1', 'light.sengled_e11g13_030b12df_1', 'light.sengled_e11g13_030b1721_1', 'light.sengled_e11g13_030b2f5a_1', 'light.sengled_e11g13_030b44c0_1', 'light.sengled_e11g13_030c0d24_1', 'light.sengled_e11g13_030ce202_1', 'light.sengled_e11g13_030dbdc0_1', 'light.sengled_e11g13_030e019a_1']>\"",
      "wires" : [
         [
            "70445fd.82f60a"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "active" : true,
      "z" : "20661f8a.532c4",
      "tosidebar" : true,
      "wires" : [],
      "complete" : "true",
      "console" : false,
      "tostatus" : false,
      "x" : 1990,
      "name" : "Retry Zigbee errors",
      "type" : "debug",
      "y" : 1740,
      "id" : "234e1a27.dab9e6"
   },
   {
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "rate" : "1",
      "drop" : false,
      "y" : 1780,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "5",
      "x" : 1770,
      "z" : "20661f8a.532c4",
      "randomFirst" : "1",
      "pauseType" : "rate",
      "id" : "275fd6d8.0dfada",
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "234e1a27.dab9e6",
            "d3dada85.4de268"
         ]
      ]
   },
   {
      "x" : 1110,
      "type" : "function",
      "name" : "Format message",
      "wires" : [
         [
            "458872e1.c0257c"
         ]
      ],
      "outputs" : 1,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "id" : "7e44dbaa.f90c64",
      "func" : "msg.payload = { data: {'message': 'Hey guys, no school tomorrow!' } };\n\nreturn msg;",
      "y" : 760
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [],
         []
      ],
      "y" : 760,
      "x" : 1290,
      "id" : "458872e1.c0257c",
      "type" : "subflow:837bbace.420028"
   },
   {
      "id" : "c4d808d1.9fbf48",
      "server" : "e2a02faf.48099",
      "y" : 760,
      "name" : "If family not sleeping",
      "type" : "api-current-state",
      "entity_id" : "binary_sensor.family_sleeping",
      "x" : 900,
      "halt_if" : "on",
      "wires" : [
         [
            "7e44dbaa.f90c64"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "payload" : "2018-03-01 15:35:25 ERROR (MainThread) [homeassistant.core] Error executing service <ServiceCall light.turn_on: entity_id=['light.philips_lct014_0288ce3f_11', 'light.philips_lct014_0288d38c_11', 'light.philips_lct014_02e80114_11', 'light.philips_lwb014_030e204b_11', 'light.philips_lwb014_0344ad6f_11', 'light.philips_lwb014_035d1e3b_11', 'light.philips_lwb014_035d32c1_11', 'light.sengled_e11g13_03023f6d_1', 'light.sengled_e11g13_030661f5_1', 'light.sengled_e11g13_030666b2_1', 'light.sengled_e11g13_0309206e_1', 'light.sengled_e11g13_03092f6b_1', 'light.sengled_e11g13_030b05a4_1', 'light.sengled_e11g13_030b0923_1', 'light.sengled_e11g13_030b12df_1', 'light.sengled_e11g13_030b1721_1', 'light.sengled_e11g13_030b2f5a_1', 'light.sengled_e11g13_030b44c0_1', 'light.sengled_e11g13_030c0d24_1', 'light.sengled_e11g13_030ce202_1', 'light.sengled_e11g13_030dbdc0_1', 'light.sengled_e11g13_030e019a_1']>",
      "onceDelay" : "",
      "wires" : [
         [
            "70445fd.82f60a"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 140,
      "type" : "inject",
      "name" : "Manual testing (turn_on)",
      "payloadType" : "str",
      "topic" : "",
      "y" : 1880,
      "crontab" : "",
      "id" : "3ee33f6f.e20b8",
      "once" : false,
      "repeat" : ""
   },
   {
      "startTime" : "07:00",
      "endTime" : "9:00",
      "endOffset" : 0,
      "id" : "1eee1d2b.7e8613",
      "y" : 600,
      "lon" : "",
      "x" : 950,
      "name" : "7AM to 9AM",
      "type" : "time-range-switch",
      "startOffset" : 0,
      "z" : "8bb76918.ef6b48",
      "lat" : "",
      "wires" : [
         [
            "cb51bdab.52b95"
         ],
         []
      ]
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "daa29e46.da8f8",
      "service_domain" : "cover",
      "data" : "{ \"entity_id\":\"cover.garage_door_south\"}",
      "y" : 660,
      "mergecontext" : "",
      "x" : 1250,
      "name" : "Open Garage Door South",
      "type" : "api-call-service",
      "service" : "open_cover",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ]
   },
   {
      "halt_if" : "255",
      "x" : 1280,
      "name" : "Garage door south already open?",
      "type" : "api-current-state",
      "entity_id" : "sensor.garage_door_south_tilt_alarm_level",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "f211363f.a56138"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "d15b2748.520bb8",
      "y" : 580
   },
   {
      "entity_id" : "sensor.garage_motion_sensor_alarm_level",
      "type" : "api-current-state",
      "name" : "Garage motion active?",
      "x" : 1240,
      "halt_if" : "255",
      "wires" : [
         [
            "daa29e46.da8f8",
            "2102ce02.526672"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "f211363f.a56138",
      "server" : "e2a02faf.48099",
      "y" : 620
   },
   {
      "nbRateUnits" : "3",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "y" : 540,
      "drop" : true,
      "rate" : "1",
      "timeout" : "5",
      "x" : 1220,
      "rateUnits" : "minute",
      "timeoutUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "id" : "cb51bdab.52b95",
      "pauseType" : "rate",
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "d15b2748.520bb8"
         ]
      ]
   },
   {
      "crontab" : "",
      "y" : 1780,
      "once" : false,
      "repeat" : "",
      "id" : "118b7aeb.742dc5",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "70445fd.82f60a"
         ]
      ],
      "onceDelay" : "",
      "payload" : "2018-03-02 06:51:11 ERROR (MainThread) [homeassistant.core] Error executing service <ServiceCall light.turn_on: transition=600.0, brightness=255, entity_id=['light.philips_lct014_02e80114_11']>",
      "topic" : "",
      "name" : "Single light failure with brightness and transition",
      "payloadType" : "str",
      "type" : "inject",
      "x" : 220
   },
   {
      "onceDelay" : "",
      "payload" : "2018-03-02 10:20:56 ERROR (MainThread) [homeassistant.core] Error executing service <ServiceCall light.turn_on: brightness=197, entity_id=['light.sengled_e11g13_030dbdc0_1']>",
      "wires" : [
         [
            "70445fd.82f60a"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 170,
      "payloadType" : "str",
      "type" : "inject",
      "name" : "Single light failure with brightness",
      "topic" : "",
      "y" : 1820,
      "crontab" : "",
      "id" : "c0bc4851.a5ec78",
      "once" : false,
      "repeat" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "id" : "d40e196a.cb2728",
      "updateinterval" : "60",
      "y" : 380,
      "outputonchanged" : false,
      "x" : 130,
      "entity_id" : "cover.garage_door_south",
      "name" : "Garage Door South",
      "type" : "poll-state",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "d47ff605.02ade8"
         ]
      ]
   },
   {
      "wires" : [
         [
            "d17db1a2.05091"
         ]
      ],
      "z" : "e0703c90.1a341",
      "checkall" : "true",
      "outputs" : 1,
      "name" : "",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 310,
      "rules" : [
         {
            "vt" : "str",
            "v" : "unavailable",
            "t" : "eq"
         }
      ],
      "y" : 380,
      "repair" : false,
      "property" : "payload",
      "id" : "d47ff605.02ade8"
   },
   {
      "pauseType" : "rate",
      "id" : "d17db1a2.05091",
      "wires" : [
         [
            "96b6730f.b2adc"
         ]
      ],
      "type" : "delay",
      "name" : "",
      "rate" : "1",
      "drop" : false,
      "y" : 380,
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "6",
      "z" : "e0703c90.1a341",
      "randomFirst" : "1",
      "timeoutUnits" : "seconds",
      "rateUnits" : "hour",
      "x" : 480,
      "timeout" : "5"
   },
   {
      "z" : "e0703c90.1a341",
      "service" : "ios_walts_iphone",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "x" : 670,
      "y" : 380,
      "data" : "{ \"message\":\"Garage door opener unavailable\"}",
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "96b6730f.b2adc"
   },
   {
      "wires" : [],
      "z" : "e0703c90.1a341",
      "type" : "comment",
      "name" : "Troubleshooting Garage door opener going unavailable",
      "x" : 220,
      "info" : "",
      "y" : 340,
      "id" : "573e951f.e8b80c"
   },
   {
      "mergecontext" : "",
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "x" : 1220,
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "2102ce02.526672",
      "y" : 700,
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Opening garage door south\" }"
   },
   {
      "id" : "99ba9e9b.721a1",
      "y" : 460,
      "type" : "comment",
      "name" : "Update Walt's location when Homekit switch is flipped",
      "x" : 220,
      "info" : "",
      "z" : "e0703c90.1a341",
      "wires" : []
   },
   {
      "id" : "d9694c67.a204d",
      "server" : "e2a02faf.48099",
      "y" : 500,
      "haltifstate" : "",
      "x" : 150,
      "name" : "Walt's Homekit Location",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "entityidfilter" : "input_boolean.walt_homekit",
      "wires" : [
         [
            "d9958b07.d289a8"
         ]
      ],
      "z" : "e0703c90.1a341"
   },
   {
      "y" : 500,
      "repair" : false,
      "outputLabels" : [
         "home",
         "away"
      ],
      "property" : "payload",
      "id" : "d9958b07.d289a8",
      "z" : "e0703c90.1a341",
      "checkall" : "true",
      "outputs" : 2,
      "wires" : [
         [
            "d1b8c7cb.487788",
            "dab55c8e.23a78"
         ],
         [
            "9041a2bd.1a3bd",
            "86b5c2d1.d853a",
            "d67927e1.0a67f8"
         ]
      ],
      "rules" : [
         {
            "v" : "on",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "vt" : "str",
            "v" : "off",
            "t" : "eq"
         }
      ],
      "type" : "switch",
      "name" : "",
      "x" : 370,
      "propertyType" : "msg"
   },
   {
      "mergecontext" : "",
      "type" : "api-call-service",
      "name" : "Set Walt Home",
      "x" : 600,
      "z" : "e0703c90.1a341",
      "service" : "see",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "service_domain" : "device_tracker",
      "id" : "d1b8c7cb.487788",
      "y" : 480,
      "data" : "{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"home\"}"
   },
   {
      "service_domain" : "device_tracker",
      "id" : "9041a2bd.1a3bd",
      "server" : "e2a02faf.48099",
      "data" : "{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}",
      "y" : 520,
      "x" : 610,
      "name" : "Set Walt Not Home",
      "type" : "api-call-service",
      "mergecontext" : "",
      "wires" : [
         []
      ],
      "service" : "see",
      "z" : "e0703c90.1a341"
   },
   {
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "service" : "see",
      "name" : "Set Walt Wifi Not Home",
      "type" : "api-call-service",
      "x" : 630,
      "mergecontext" : "",
      "y" : 560,
      "data" : "{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}",
      "id" : "86b5c2d1.d853a",
      "service_domain" : "device_tracker",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 440,
      "data" : "{ \"message\":\"Homekit marked you as home\"}",
      "service_domain" : "notify",
      "id" : "dab55c8e.23a78",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "service" : "ios_walts_iphone",
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "x" : 590,
      "mergecontext" : ""
   },
   {
      "z" : "e0703c90.1a341",
      "service" : "ios_walts_iphone",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "x" : 590,
      "y" : 600,
      "data" : "{ \"message\":\"Homekit marked you as away\"}",
      "server" : "e2a02faf.48099",
      "id" : "d67927e1.0a67f8",
      "service_domain" : "notify"
   },
   {
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turn on coffee grinder\" }",
      "y" : 1060,
      "id" : "f0c63942.6650c8",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "x" : 740,
      "type" : "api-call-service",
      "name" : "Logbook entry",
      "mergecontext" : ""
   },
   {
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "x" : 740,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "mergecontext" : "",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turn off coffee grinder\" }",
      "y" : 1180,
      "service_domain" : "logbook",
      "id" : "ec29f7b8.4f4088",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "d3c8f1eb.30ea4",
      "y" : 660,
      "entityidfilter" : "sensor.master_bathroom_motion_sensor",
      "x" : 130,
      "haltifstate" : "",
      "entityidfiltertype" : "substring",
      "type" : "server-state-changed",
      "name" : "Master Bath Motion Sensor",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "30b9f1c1.43613e"
         ]
      ]
   },
   {
      "checkall" : "true",
      "outputs" : 2,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "f4d9b55f.a0ccb8",
            "56ee825a.cd305c"
         ],
         [
            "f4d9b55f.a0ccb8"
         ]
      ],
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "motion detected"
         },
         {
            "v" : "standby",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "x" : 370,
      "propertyType" : "msg",
      "type" : "switch",
      "name" : "",
      "repair" : false,
      "y" : 660,
      "outputLabels" : [
         "motion",
         "standby"
      ],
      "id" : "30b9f1c1.43613e",
      "property" : "payload"
   },
   {
      "units" : "Minute",
      "duration" : "10",
      "payloadtype" : "num",
      "type" : "stoptimer",
      "name" : "10min",
      "x" : 570,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "3070c147.7bb1fe"
         ],
         []
      ],
      "payloadval" : "0",
      "id" : "f4d9b55f.a0ccb8",
      "y" : 720
   },
   {
      "z" : "e0703c90.1a341",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "name" : "Turn on living room lights",
      "type" : "api-call-service",
      "x" : 1050,
      "y" : 660,
      "data" : "{\"entity_id\":\"light.living_room\"}",
      "server" : "e2a02faf.48099",
      "id" : "4cdd3888.656168",
      "service_domain" : "light"
   },
   {
      "wires" : [
         []
      ],
      "service" : "turn_off",
      "z" : "e0703c90.1a341",
      "x" : 1050,
      "name" : "Turn off living room lights",
      "type" : "api-call-service",
      "mergecontext" : "",
      "data" : "{\"entity_id\":\"light.living_room\"}",
      "y" : 700,
      "id" : "15d526d9.97cdd9",
      "service_domain" : "light",
      "server" : "e2a02faf.48099"
   },
   {
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "f4d9b55f.a0ccb8"
         ]
      ],
      "entityidfilter" : "light.living_room",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "name" : "Living room lights on",
      "haltifstate" : "off",
      "x" : 150,
      "y" : 700,
      "server" : "e2a02faf.48099",
      "id" : "77160de8.334bf4"
   },
   {
      "id" : "418cfb2d.87edb4",
      "y" : 620,
      "name" : "Testing Bruh multisensor",
      "type" : "comment",
      "info" : "",
      "x" : 130,
      "z" : "e0703c90.1a341",
      "wires" : []
   },
   {
      "wires" : [
         [
            "3070c147.7bb1fe"
         ]
      ],
      "payload" : "",
      "onceDelay" : 0.1,
      "z" : "e0703c90.1a341",
      "type" : "inject",
      "name" : "",
      "payloadType" : "date",
      "x" : 698,
      "topic" : "",
      "y" : 765,
      "crontab" : "",
      "id" : "e4d2a9e3.ae2c98",
      "repeat" : "",
      "once" : false
   },
   {
      "payloadType" : "str",
      "name" : "Offline bulb",
      "type" : "inject",
      "x" : 310,
      "topic" : "",
      "wires" : [
         [
            "70445fd.82f60a"
         ]
      ],
      "payload" : "2018-03-06 08:17:15 ERROR (MainThread) [homeassistant.core] Error executing service <ServiceCall light.turn_off: entity_id=['light.sengled_e11g13_030661f5_1']>",
      "onceDelay" : "",
      "z" : "20661f8a.532c4",
      "id" : "4e54fee5.7bfd9",
      "repeat" : "",
      "once" : false,
      "y" : 1860,
      "crontab" : ""
   },
   {
      "outputs" : "1",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "9db1de39.e0145",
            "8db2436f.d29c5"
         ]
      ],
      "lower" : "",
      "x" : 960,
      "name" : "",
      "type" : "counter",
      "upper" : "",
      "step" : "1",
      "y" : 1820,
      "mode" : "increment",
      "id" : "495baa2a.02b484",
      "init" : "0"
   },
   {
      "y" : 1740,
      "id" : "9db1de39.e0145",
      "payloadval" : "0",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "291fbbf.51bb644"
         ],
         []
      ],
      "duration" : "30",
      "units" : "Second",
      "x" : 1130,
      "type" : "stoptimer",
      "name" : "",
      "payloadtype" : "num"
   },
   {
      "wires" : [
         [
            "495baa2a.02b484",
            "9db1de39.e0145"
         ]
      ],
      "to" : "",
      "z" : "20661f8a.532c4",
      "x" : 900,
      "from" : "",
      "name" : "Reset counter and stop timer",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "p" : "reset",
            "tot" : "str",
            "pt" : "msg",
            "to" : "true"
         },
         {
            "to" : "stop",
            "pt" : "msg",
            "tot" : "str",
            "t" : "set",
            "p" : "payload"
         }
      ],
      "action" : "",
      "y" : 1660,
      "reg" : false,
      "id" : "291fbbf.51bb644",
      "property" : ""
   },
   {
      "checkall" : "true",
      "outputs" : 3,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "eadfc4e6.40f328"
         ],
         [
            "984fceb.5bee93",
            "eadfc4e6.40f328"
         ],
         [
            "4245ce66.f40be"
         ]
      ],
      "rules" : [
         {
            "t" : "lt",
            "vt" : "num",
            "v" : "50"
         },
         {
            "v2t" : "num",
            "t" : "btwn",
            "vt" : "num",
            "v2" : "59",
            "v" : "51"
         },
         {
            "t" : "gte",
            "vt" : "num",
            "v" : "60"
         }
      ],
      "x" : 1150,
      "propertyType" : "msg",
      "name" : "Stop after 50",
      "type" : "switch",
      "repair" : false,
      "y" : 1800,
      "id" : "8db2436f.d29c5",
      "property" : "count"
   },
   {
      "y" : 1820,
      "func" : "entity_id       = msg.payload.data.entity_id;\nmsg.template    = '{{ states.' + entity_id + '.attributes.friendly_name }}';\nreturn msg;",
      "id" : "4245ce66.f40be",
      "wires" : [
         [
            "304e148d.faf4fc"
         ]
      ],
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "outputs" : 1,
      "name" : "Format template",
      "type" : "function",
      "x" : 1360
   },
   {
      "type" : "api-render-template",
      "name" : "Get friendly name",
      "x" : 1550,
      "wires" : [
         [
            "21d9f974.c96176"
         ]
      ],
      "z" : "20661f8a.532c4",
      "id" : "304e148d.faf4fc",
      "template" : "",
      "server" : "e2a02faf.48099",
      "y" : 1820
   },
   {
      "id" : "21d9f974.c96176",
      "y" : 1820,
      "func" : "light        = msg.payload;\nmsg.payload = { data: {'message': light + ' has been failing to respond' } };\n\nreturn msg;",
      "name" : "Format message",
      "type" : "function",
      "x" : 1750,
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "outputs" : 1,
      "wires" : [
         [
            "c5e59cbe.36777"
         ]
      ]
   },
   {
      "mergecontext" : "",
      "x" : 2050,
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "service" : "ios_walts_iphone",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "id" : "ac282f7a.f96d1",
      "service_domain" : "notify",
      "data" : "{ \"message\": \"msg\" }",
      "y" : 1820
   },
   {
      "z" : "20661f8a.532c4",
      "start" : "",
      "wires" : [
         [
            "ac282f7a.f96d1",
            "f5858ee8.ef201"
         ]
      ],
      "gap" : "",
      "x" : 1910,
      "type" : "rbe",
      "name" : "",
      "func" : "rbe",
      "y" : 1820,
      "inout" : "out",
      "id" : "c5e59cbe.36777",
      "property" : "payload"
   },
   {
      "id" : "35fa1b54.a80924",
      "x" : 2450,
      "type" : "subflow:837bbace.420028",
      "name" : "",
      "z" : "20661f8a.532c4",
      "wires" : [
         [],
         []
      ],
      "y" : 1860
   },
   {
      "name" : "If Guest Mode Off",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "x" : 2070,
      "halt_if" : "on",
      "wires" : [
         [
            "250d62d6.69ffce"
         ]
      ],
      "z" : "20661f8a.532c4",
      "id" : "f5858ee8.ef201",
      "server" : "e2a02faf.48099",
      "y" : 1860
   },
   {
      "id" : "3070c147.7bb1fe",
      "server" : "e2a02faf.48099",
      "y" : 700,
      "x" : 810,
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "name" : "If Guest Mode Off",
      "halt_if" : "on",
      "wires" : [
         [
            "15d526d9.97cdd9"
         ]
      ],
      "z" : "e0703c90.1a341"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "6799d54f.e4485c"
         ]
      ],
      "to" : "",
      "rules" : [
         {
            "p" : "reset",
            "t" : "delete",
            "pt" : "msg"
         }
      ],
      "name" : "",
      "type" : "change",
      "from" : "",
      "x" : 1370,
      "reg" : false,
      "action" : "",
      "y" : 1780,
      "property" : "",
      "id" : "eadfc4e6.40f328"
   },
   {
      "rules" : [
         {
            "t" : "neq",
            "v" : "stop",
            "vt" : "str"
         }
      ],
      "propertyType" : "msg",
      "x" : 1580,
      "type" : "switch",
      "name" : "Don't forward stops",
      "outputs" : 1,
      "checkall" : "true",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "275fd6d8.0dfada"
         ]
      ],
      "id" : "6799d54f.e4485c",
      "property" : "payload",
      "repair" : false,
      "y" : 1780
   },
   {
      "y" : 660,
      "id" : "45e5a80.bbcad58",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "4cdd3888.656168"
         ]
      ],
      "z" : "e0703c90.1a341",
      "type" : "api-current-state",
      "name" : "If Guest Mode Off",
      "entity_id" : "input_boolean.guest_mode",
      "x" : 810,
      "halt_if" : "on"
   },
   {
      "id" : "250d62d6.69ffce",
      "server" : "e2a02faf.48099",
      "y" : 1860,
      "x" : 2270,
      "entity_id" : "binary_sensor.family_in_bed",
      "name" : "If Family Not in Bed",
      "type" : "api-current-state",
      "halt_if" : "on",
      "wires" : [
         [
            "35fa1b54.a80924"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "y" : 840,
      "id" : "ba05682d.0f6d08",
      "z" : "e0703c90.1a341",
      "wires" : [],
      "type" : "comment",
      "name" : "Trash alerts",
      "x" : 90,
      "info" : ""
   },
   {
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "81383a3d.900de8"
         ]
      ],
      "to" : "",
      "rules" : [
         {
            "pt" : "msg",
            "tot" : "msg",
            "to" : "payload",
            "p" : "data.new_state.attributes.message",
            "t" : "set"
         }
      ],
      "name" : "Set calendar message",
      "from" : "",
      "type" : "change",
      "x" : 680,
      "reg" : false,
      "y" : 880,
      "action" : "",
      "property" : "",
      "id" : "98d6083b.c5ab08"
   },
   {
      "send_stop" : false,
      "wires" : [
         [
            "3a44bdce.4a4d02",
            "db6ad876.60e6f8"
         ]
      ],
      "name" : "Store message then release",
      "type" : "traffic",
      "property_stop" : "topic",
      "property_allow" : "topic",
      "send_allow" : false,
      "negate_stop" : false,
      "id" : "f52e1cad.84706",
      "differ" : true,
      "z" : "e0703c90.1a341",
      "x" : 1140,
      "ignore_case_stop" : false,
      "y" : 880,
      "filter_allow" : "release",
      "filter_stop" : "stop",
      "ignore_case_allow" : false,
      "negate_allow" : false,
      "default_start" : false
   },
   {
      "wires" : [
         [
            "f52e1cad.84706",
            "79de734c.dfd87c"
         ]
      ],
      "start" : "",
      "z" : "e0703c90.1a341",
      "name" : "",
      "type" : "rbe",
      "x" : 870,
      "gap" : "",
      "y" : 880,
      "func" : "rbe",
      "property" : "payload",
      "id" : "81383a3d.900de8",
      "inout" : "out"
   },
   {
      "outputs" : 1,
      "noerr" : 0,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "98d6083b.c5ab08"
         ]
      ],
      "x" : 480,
      "type" : "function",
      "name" : "Test event",
      "y" : 920,
      "func" : "msg = {\"topic\":\"calendar.family_test\",\"payload\":\"on\",\"data\":{\"entity_id\":\"calendar.family_test\",\"state\":\"on\",\"attributes\":{\"message\":\"Test HA\",\"all_day\":false,\"offset_reached\":false,\"start_time\":\"2018-03-07 09:20:00\",\"end_time\":\"2018-03-07 10:20:00\",\"location\":null,\"description\":null,\"friendly_name\":\"Test\"},\"last_changed\":\"2018-03-07T16:11:08.342731+00:00\",\"last_updated\":\"2018-03-07T16:11:08.342731+00:00\"},\"_msgid\":\"23634ce2.5ee614\"};\nreturn msg;",
      "id" : "ba3e2d7e.929a9"
   },
   {
      "crontab" : "",
      "y" : 920,
      "repeat" : "",
      "once" : false,
      "id" : "a8979656.f79e68",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "ba3e2d7e.929a9"
         ]
      ],
      "onceDelay" : 0.1,
      "payload" : "",
      "topic" : "",
      "payloadType" : "date",
      "name" : "",
      "type" : "inject",
      "x" : 340
   },
   {
      "y" : 980,
      "crontab" : "00 19 * * 2",
      "id" : "e4942cc9.b9e64",
      "once" : false,
      "repeat" : "",
      "onceDelay" : "",
      "payload" : "",
      "wires" : [
         [
            "ea946146.19916"
         ]
      ],
      "z" : "e0703c90.1a341",
      "x" : 140,
      "payloadType" : "date",
      "name" : "7:00PM on Tuesdays",
      "type" : "inject",
      "topic" : ""
   },
   {
      "maxtimeoutunits" : "Hour",
      "id" : "ea946146.19916",
      "y" : 980,
      "units" : "Minute",
      "duration" : "1",
      "maxtimeout" : "5",
      "maxloops" : "300",
      "type" : "looptimer",
      "name" : "Loop until midnight",
      "x" : 390,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "bb9b18e.b305ce8"
         ],
         []
      ]
   },
   {
      "id" : "bb9b18e.b305ce8",
      "server" : "e2a02faf.48099",
      "y" : 980,
      "type" : "api-current-state",
      "entity_id" : "group.family",
      "name" : "If Family Home",
      "x" : 620,
      "halt_if" : "not_home",
      "wires" : [
         [
            "8cbdd1d7.14233"
         ]
      ],
      "z" : "e0703c90.1a341"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "8cbdd1d7.14233",
      "y" : 1020,
      "halt_if" : "on",
      "x" : 630,
      "entity_id" : "input_boolean.guest_mode",
      "name" : "If Guest Mode Off",
      "type" : "api-current-state",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "d511f848.9ab4b8"
         ]
      ]
   },
   {
      "property" : "",
      "id" : "2d3370c0.43c4f",
      "reg" : false,
      "y" : 1060,
      "action" : "",
      "rules" : [
         {
            "tot" : "str",
            "pt" : "msg",
            "to" : "stop",
            "p" : "payload",
            "t" : "set"
         }
      ],
      "type" : "change",
      "name" : "Stop loop",
      "from" : "",
      "x" : 360,
      "z" : "e0703c90.1a341",
      "to" : "",
      "wires" : [
         [
            "ea946146.19916"
         ]
      ]
   },
   {
      "y" : 1060,
      "id" : "d511f848.9ab4b8",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "2d3370c0.43c4f",
            "8ab8883a.310048",
            "3f0d697b.12f776"
         ]
      ],
      "z" : "e0703c90.1a341",
      "x" : 630,
      "name" : "If Family not in bed",
      "entity_id" : "binary_sensor.family_in_bed",
      "type" : "api-current-state",
      "halt_if" : "on"
   },
   {
      "func" : "calendar_check      = /calendar/g;\nrecycling_week      = msg.week % 2;\nmsg.recycling_week  = recycling_week;\n\nif(calendar_check.test(msg.topic)) {\n    reminder = msg.payload;\n} else if (recycling_week == 1) {\n    reminder = 'Hey everyone, it is recycling and a trash day tomorrow, so don\\'t forget to set out both bins!';\n} else  {\n    reminder = 'Hey guys, just letting you know that it is a trash day tomorrow!';\n}\n\nmsg.payload = { data: {'message': reminder } };\nreturn msg;",
      "y" : 880,
      "id" : "df6a615b.6b48f",
      "noerr" : 0,
      "z" : "e0703c90.1a341",
      "outputs" : 1,
      "wires" : [
         [
            "ae6fb219.5f97e",
            "27bbb230.6300de",
            "7088f84b.970538"
         ]
      ],
      "name" : "Format message",
      "type" : "function",
      "x" : 1790
   },
   {
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "service" : "family_iphones",
      "name" : "Notify Family",
      "type" : "api-call-service",
      "x" : 2010,
      "y" : 880,
      "data" : "{ \"message\": \"msg\" }",
      "id" : "27bbb230.6300de",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "subflow:837bbace.420028",
      "name" : "",
      "x" : 2010,
      "id" : "7088f84b.970538",
      "z" : "e0703c90.1a341",
      "wires" : [
         [],
         []
      ],
      "y" : 920
   },
   {
      "action" : "",
      "y" : 1060,
      "reg" : false,
      "property" : "",
      "id" : "8ab8883a.310048",
      "to" : "",
      "wires" : [
         [
            "f52e1cad.84706"
         ]
      ],
      "z" : "e0703c90.1a341",
      "from" : "",
      "type" : "change",
      "name" : "Release messages",
      "x" : 1110,
      "rules" : [
         {
            "to" : "release",
            "pt" : "msg",
            "tot" : "str",
            "t" : "set",
            "p" : "topic"
         }
      ]
   },
   {
      "console" : false,
      "complete" : "true",
      "name" : "Trash notification",
      "type" : "debug",
      "tostatus" : false,
      "x" : 2030,
      "z" : "e0703c90.1a341",
      "active" : true,
      "wires" : [],
      "tosidebar" : true,
      "id" : "ae6fb219.5f97e",
      "y" : 840
   },
   {
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "40f8aeda.2038c"
         ]
      ],
      "id" : "3a44bdce.4a4d02",
      "pauseType" : "rate",
      "timeout" : "5",
      "x" : 1400,
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "e0703c90.1a341",
      "nbRateUnits" : "5",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "y" : 880,
      "drop" : true,
      "rate" : "1"
   },
   {
      "rules" : [
         {
            "tot" : "str",
            "pt" : "msg",
            "to" : "stop",
            "t" : "set",
            "p" : "topic"
         },
         {
            "to" : "true",
            "pt" : "msg",
            "tot" : "str",
            "p" : "reset",
            "t" : "set"
         }
      ],
      "type" : "change",
      "from" : "",
      "name" : "Hold messages and reset",
      "x" : 890,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "f52e1cad.84706",
            "3f0d697b.12f776"
         ]
      ],
      "to" : "",
      "property" : "",
      "id" : "db6ad876.60e6f8",
      "reg" : false,
      "action" : "",
      "y" : 960
   },
   {
      "nbRateUnits" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "y" : 1020,
      "drop" : false,
      "rate" : "1",
      "timeout" : "5",
      "x" : 1270,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "randomFirst" : "1",
      "z" : "e0703c90.1a341",
      "id" : "3f0d697b.12f776",
      "pauseType" : "delay",
      "name" : "Send default trash msg through after traffic light is green",
      "type" : "delay",
      "wires" : [
         [
            "f52e1cad.84706"
         ]
      ]
   },
   {
      "id" : "ae430f40.30184",
      "server" : "e2a02faf.48099",
      "y" : 880,
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "name" : "Trash calendar event",
      "x" : 110,
      "haltifstate" : "off",
      "entityidfilter" : "calendar.family_trash",
      "wires" : [
         [
            "342e637c.9c3eac",
            "98d6083b.c5ab08"
         ]
      ],
      "z" : "e0703c90.1a341"
   },
   {
      "y" : 800,
      "id" : "79de734c.dfd87c",
      "tosidebar" : true,
      "wires" : [],
      "z" : "e0703c90.1a341",
      "active" : true,
      "type" : "debug",
      "name" : "",
      "tostatus" : false,
      "x" : 1050,
      "complete" : "true",
      "console" : false
   },
   {
      "type" : "inject",
      "payloadType" : "date",
      "name" : "",
      "x" : 800,
      "topic" : "",
      "wires" : [
         [
            "3f0d697b.12f776",
            "8ab8883a.310048"
         ]
      ],
      "onceDelay" : 0.1,
      "payload" : "",
      "z" : "e0703c90.1a341",
      "id" : "7805f7df.c61e68",
      "repeat" : "",
      "once" : false,
      "y" : 1140,
      "crontab" : ""
   },
   {
      "id" : "342e637c.9c3eac",
      "y" : 820,
      "complete" : "true",
      "console" : false,
      "tostatus" : false,
      "x" : 380,
      "type" : "debug",
      "name" : "calendar",
      "active" : true,
      "z" : "e0703c90.1a341",
      "tosidebar" : true,
      "wires" : []
   },
   {
      "outputLabels" : [
         "mail today",
         ""
      ],
      "property" : "payload",
      "id" : "7b9958b4.4cb178",
      "y" : 2840,
      "repair" : false,
      "rules" : [
         {
            "vt" : "num",
            "v" : "0",
            "t" : "gt"
         },
         {
            "t" : "eq",
            "v" : "0",
            "vt" : "num"
         }
      ],
      "type" : "switch",
      "name" : "Getting mail today?",
      "propertyType" : "msg",
      "x" : 1190,
      "z" : "8bb76918.ef6b48",
      "checkall" : "true",
      "outputs" : 2,
      "wires" : [
         [
            "61219e2c.c5abc"
         ],
         [
            "9fa9ebf.98c6b18"
         ]
      ]
   },
   {
      "wires" : [
         [
            "2099798b.f2cac6",
            "a613073.219f1f8"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "pauseType" : "rate",
      "id" : "61219e2c.c5abc",
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1",
      "timeoutUnits" : "seconds",
      "rateUnits" : "hour",
      "x" : 1400,
      "timeout" : "5",
      "rate" : "1",
      "y" : 2820,
      "drop" : false,
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "nbRateUnits" : "12"
   },
   {
      "id" : "2099798b.f2cac6",
      "y" : 2800,
      "func" : "msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened! Here is a preview of what is inside', data: { attachment: {'url': 'https://your-hostname.duckdns.org:65443/local/todays_mails.gif' } } } };\nreturn msg;",
      "x" : 1610,
      "type" : "function",
      "name" : "Format message",
      "outputs" : 1,
      "z" : "8bb76918.ef6b48",
      "noerr" : 0,
      "wires" : [
         [
            "6d9826d4.5db198",
            "e6492064.9d6cc",
            "d3e879e3.58e108"
         ]
      ]
   },
   {
      "x" : 1840,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "mergecontext" : "",
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "service_domain" : "logbook",
      "id" : "d3e879e3.58e108",
      "server" : "e2a02faf.48099",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Sent today's mail notification to family iphones\" }",
      "y" : 2800
   },
   {
      "y" : 2760,
      "data" : "{ \"message\": \"msg\" }",
      "id" : "e6492064.9d6cc",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "family_iphones",
      "name" : "Notify Family",
      "type" : "api-call-service",
      "x" : 1830,
      "mergecontext" : ""
   },
   {
      "y" : 2720,
      "id" : "6d9826d4.5db198",
      "active" : true,
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "tosidebar" : true,
      "complete" : "true",
      "console" : false,
      "tostatus" : false,
      "x" : 1840,
      "type" : "debug",
      "name" : "ios attachment"
   },
   {
      "y" : 2900,
      "id" : "252555e5.89fe8a",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "2600fd70.b71d62"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "name" : "UPS Package Count",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "haltifstate" : "",
      "x" : 110,
      "entityidfilter" : "sensor.ups_packages"
   },
   {
      "type" : "switch",
      "name" : "Getting packages today?",
      "x" : 330,
      "propertyType" : "msg",
      "rules" : [
         {
            "t" : "gt",
            "v" : "0",
            "vt" : "num"
         }
      ],
      "wires" : [
         [
            "6bafb7a8.48d718"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "outputs" : 1,
      "checkall" : "true",
      "property" : "payload",
      "id" : "2600fd70.b71d62",
      "outputLabels" : [
         "packages today"
      ],
      "y" : 2900,
      "repair" : false
   },
   {
      "nbRateUnits" : "12",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "drop" : false,
      "y" : 2900,
      "rate" : "1",
      "x" : 580,
      "timeout" : "5",
      "timeoutUnits" : "seconds",
      "rateUnits" : "hour",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "id" : "6bafb7a8.48d718",
      "pauseType" : "rate",
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "bdd5f6ea.5b02a8"
         ]
      ]
   },
   {
      "x" : 790,
      "type" : "function",
      "name" : "Format message",
      "outputs" : 1,
      "z" : "8bb76918.ef6b48",
      "noerr" : 0,
      "wires" : [
         [
            "c6fe9605.c4c968",
            "d3e82cff.465fb",
            "9c860b0d.e8f808"
         ]
      ],
      "id" : "bdd5f6ea.5b02a8",
      "func" : "packages    = msg.payload;\n\nif ( packages == 1 ) {\n   msg.payload = { data: {'message': 'There is one UPS package scheduled for delivery today' } }; \n   return msg;\n} else if ( packages > 1) {\n     msg.payload = { data: {'message': 'There are ' + packages + 'UPS packages scheduled for delivery today' } }; \n    return msg;\n}\n\n",
      "y" : 2900
   },
   {
      "data" : "{ \"message\": \"msg\" }",
      "y" : 2940,
      "service_domain" : "notify",
      "id" : "d3e82cff.465fb",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "service" : "family_iphones",
      "z" : "8bb76918.ef6b48",
      "x" : 1010,
      "type" : "api-call-service",
      "name" : "Notify Family",
      "mergecontext" : ""
   },
   {
      "wires" : [
         []
      ],
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "x" : 1020,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "mergecontext" : "",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Sent today's UPS notification to family iphones\" }",
      "y" : 2900,
      "service_domain" : "logbook",
      "id" : "9c860b0d.e8f808",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 2980,
      "id" : "c6fe9605.c4c968",
      "wires" : [],
      "tosidebar" : true,
      "z" : "8bb76918.ef6b48",
      "active" : true,
      "type" : "debug",
      "name" : "UPS",
      "tostatus" : false,
      "x" : 990,
      "complete" : "true",
      "console" : false
   },
   {
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "name" : "FedEx Package Count",
      "haltifstate" : "",
      "x" : 120,
      "entityidfilter" : "sensor.fedex_packages",
      "wires" : [
         [
            "acaf4cb0.53eee"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "9c2bb52a.0cb1f8",
      "server" : "e2a02faf.48099",
      "y" : 3020
   },
   {
      "propertyType" : "msg",
      "x" : 350,
      "type" : "switch",
      "name" : "Getting packages today?",
      "rules" : [
         {
            "v" : "0",
            "vt" : "num",
            "t" : "gt"
         }
      ],
      "wires" : [
         [
            "1752e18.9be231f"
         ]
      ],
      "checkall" : "true",
      "outputs" : 1,
      "z" : "8bb76918.ef6b48",
      "id" : "acaf4cb0.53eee",
      "property" : "payload",
      "outputLabels" : [
         "packages today"
      ],
      "repair" : false,
      "y" : 3020
   },
   {
      "pauseType" : "rate",
      "id" : "1752e18.9be231f",
      "wires" : [
         [
            "2c53ab2.78b5454"
         ]
      ],
      "type" : "delay",
      "name" : "",
      "rate" : "1",
      "drop" : false,
      "y" : 3020,
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "12",
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1",
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds",
      "timeout" : "5",
      "x" : 580
   },
   {
      "func" : "packages    = msg.payload;\n\nif ( packages == 1 ) {\n   msg.payload = { data: {'message': 'There is one FedEx package scheduled for delivery today' } }; \n   return msg;\n} else if ( packages > 1) {\n     msg.payload = { data: {'message': 'There are ' + packages + 'FedEx packages scheduled for delivery today' } }; \n    return msg;\n}\n\n",
      "y" : 3020,
      "id" : "2c53ab2.78b5454",
      "wires" : [
         [
            "1933376a.d42b99",
            "3d9cb194.60c38e",
            "4d80792.ba6c288"
         ]
      ],
      "noerr" : 0,
      "z" : "8bb76918.ef6b48",
      "outputs" : 1,
      "name" : "Format message",
      "type" : "function",
      "x" : 790
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "3d9cb194.60c38e",
      "service_domain" : "notify",
      "y" : 3060,
      "data" : "{ \"message\": \"msg\" }",
      "mergecontext" : "",
      "type" : "api-call-service",
      "name" : "Notify Family",
      "x" : 1010,
      "z" : "8bb76918.ef6b48",
      "service" : "family_iphones",
      "wires" : [
         []
      ]
   },
   {
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Sent today's FedEx notification to family iphones\" }",
      "y" : 3020,
      "server" : "e2a02faf.48099",
      "id" : "4d80792.ba6c288",
      "service_domain" : "logbook",
      "service" : "log",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "x" : 1020,
      "name" : "Logbook entry",
      "type" : "api-call-service"
   },
   {
      "wires" : [],
      "tosidebar" : true,
      "z" : "8bb76918.ef6b48",
      "active" : true,
      "type" : "debug",
      "name" : "FedEx",
      "tostatus" : false,
      "x" : 990,
      "console" : false,
      "complete" : "true",
      "y" : 3100,
      "id" : "1933376a.d42b99"
   },
   {
      "id" : "e8ab7a97.aebad8",
      "y" : 540,
      "x" : 190,
      "info" : "",
      "name" : "Convert MQTT Telemetry Messages to State",
      "type" : "comment",
      "wires" : [],
      "z" : "20661f8a.532c4"
   },
   {
      "wires" : [
         [
            "7b9958b4.4cb178"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 990,
      "name" : "USPS Mail Count",
      "entity_id" : "sensor.usps_mail",
      "type" : "api-current-state",
      "halt_if" : "0",
      "y" : 2840,
      "id" : "8cc864e1.ee5098",
      "server" : "e2a02faf.48099"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "fc2abf73.e3faf"
         ]
      ],
      "payload" : "",
      "onceDelay" : "",
      "topic" : "",
      "name" : "Every five minutes in the morning",
      "type" : "inject",
      "payloadType" : "date",
      "x" : 180,
      "crontab" : "*/5 7-9 * * *",
      "y" : 2660,
      "repeat" : "",
      "once" : false,
      "id" : "2dafba01.dd8f36"
   },
   {
      "data" : "{ }",
      "y" : 2660,
      "id" : "fc2abf73.e3faf",
      "service_domain" : "shell_command",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "service" : "usps_mail_check",
      "z" : "8bb76918.ef6b48",
      "x" : 980,
      "type" : "api-call-service",
      "name" : "Check USPS for mail",
      "mergecontext" : ""
   },
   {
      "outputs" : 1,
      "noerr" : 0,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "4343aed7.1de17"
         ]
      ],
      "x" : 1610,
      "name" : "Format message",
      "type" : "function",
      "y" : 2840,
      "func" : "msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened!' } };\n\nreturn msg;",
      "id" : "a613073.219f1f8"
   },
   {
      "z" : "8bb76918.ef6b48",
      "y" : 2840,
      "wires" : [
         [],
         []
      ],
      "name" : "",
      "type" : "subflow:837bbace.420028",
      "id" : "4343aed7.1de17",
      "x" : 1830
   },
   {
      "x" : 1400,
      "timeout" : "5",
      "timeoutUnits" : "seconds",
      "rateUnits" : "hour",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "nbRateUnits" : "12",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "drop" : false,
      "y" : 2860,
      "rate" : "1",
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "338c1b68.643ad4",
            "a613073.219f1f8"
         ]
      ],
      "id" : "9fa9ebf.98c6b18",
      "pauseType" : "rate"
   },
   {
      "y" : 480,
      "retain" : "",
      "id" : "aa058212.22903",
      "broker" : "4238db6e.227ed4",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "qos" : "",
      "type" : "mqtt out",
      "name" : "Inject MQTT message",
      "x" : 960,
      "topic" : ""
   },
   {
      "outputinitially" : true,
      "id" : "fa0e1050.7a5",
      "server" : "e2a02faf.48099",
      "y" : 460,
      "outputonchanged" : true,
      "updateinterval" : "600",
      "name" : "Garage Door North Tilt Sensor",
      "entity_id" : "sensor.garage_door_north_tilt_alarm_level",
      "type" : "poll-state",
      "x" : 140,
      "wires" : [
         [
            "22c2e627.52eada"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "property" : "",
      "id" : "71f0672.dc0b298",
      "reg" : false,
      "y" : 420,
      "action" : "",
      "rules" : [
         {
            "pt" : "msg",
            "tot" : "str",
            "to" : "garage/door/north/status",
            "p" : "topic",
            "t" : "set"
         },
         {
            "p" : "payload",
            "t" : "set",
            "to" : "open",
            "pt" : "msg",
            "tot" : "str"
         }
      ],
      "type" : "change",
      "name" : "Set to open",
      "from" : "",
      "x" : 650,
      "z" : "20661f8a.532c4",
      "to" : "",
      "wires" : [
         [
            "aa058212.22903"
         ]
      ]
   },
   {
      "repair" : false,
      "y" : 460,
      "outputLabels" : [
         "open",
         "closed"
      ],
      "id" : "22c2e627.52eada",
      "property" : "payload.data.state",
      "checkall" : "true",
      "outputs" : 2,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "71f0672.dc0b298"
         ],
         [
            "e2e08c0a.d8e6f"
         ]
      ],
      "rules" : [
         {
            "vt" : "num",
            "v" : "255",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "vt" : "num",
            "v" : "0"
         }
      ],
      "propertyType" : "msg",
      "x" : 400,
      "type" : "switch",
      "name" : "Open or closed"
   },
   {
      "z" : "20661f8a.532c4",
      "to" : "",
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "rules" : [
         {
            "t" : "set",
            "p" : "topic",
            "pt" : "msg",
            "tot" : "str",
            "to" : "garage/door/north/status"
         },
         {
            "pt" : "msg",
            "tot" : "str",
            "to" : "closed",
            "t" : "set",
            "p" : "payload"
         }
      ],
      "name" : "Set to closed",
      "type" : "change",
      "from" : "",
      "x" : 650,
      "reg" : false,
      "y" : 460,
      "action" : "",
      "property" : "",
      "id" : "e2e08c0a.d8e6f"
   },
   {
      "updateinterval" : "600",
      "outputonchanged" : true,
      "y" : 500,
      "server" : "e2a02faf.48099",
      "outputinitially" : true,
      "id" : "5dfee8bc.d7ced8",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "3799e27a.ff923e"
         ]
      ],
      "x" : 150,
      "type" : "poll-state",
      "entity_id" : "sensor.garage_door_south_tilt_alarm_level",
      "name" : "Garage Door South Tilt Sensor"
   },
   {
      "y" : 500,
      "repair" : false,
      "property" : "payload.data.state",
      "id" : "3799e27a.ff923e",
      "outputLabels" : [
         "open",
         "closed"
      ],
      "wires" : [
         [
            "321280b2.e8f25"
         ],
         [
            "8f04b30f.555a5"
         ]
      ],
      "z" : "20661f8a.532c4",
      "outputs" : 2,
      "checkall" : "true",
      "type" : "switch",
      "name" : "Open or closed",
      "x" : 400,
      "propertyType" : "msg",
      "rules" : [
         {
            "vt" : "num",
            "v" : "255",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "vt" : "num",
            "v" : "0"
         }
      ]
   },
   {
      "z" : "20661f8a.532c4",
      "to" : "",
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "rules" : [
         {
            "tot" : "str",
            "pt" : "msg",
            "to" : "garage/door/south/status",
            "p" : "topic",
            "t" : "set"
         },
         {
            "tot" : "str",
            "pt" : "msg",
            "to" : "open",
            "p" : "payload",
            "t" : "set"
         }
      ],
      "name" : "Set to open",
      "from" : "",
      "type" : "change",
      "x" : 650,
      "reg" : false,
      "y" : 500,
      "action" : "",
      "property" : "",
      "id" : "321280b2.e8f25"
   },
   {
      "property" : "",
      "id" : "8f04b30f.555a5",
      "action" : "",
      "y" : 540,
      "reg" : false,
      "type" : "change",
      "name" : "Set to closed",
      "from" : "",
      "x" : 650,
      "rules" : [
         {
            "t" : "set",
            "p" : "topic",
            "to" : "garage/door/south/status",
            "tot" : "str",
            "pt" : "msg"
         },
         {
            "p" : "payload",
            "t" : "set",
            "pt" : "msg",
            "tot" : "str",
            "to" : "closed"
         }
      ],
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "to" : "",
      "z" : "20661f8a.532c4"
   },
   {
      "wires" : [],
      "z" : "20661f8a.532c4",
      "info" : "",
      "x" : 220,
      "type" : "comment",
      "name" : "Keep garage door opener state in sync with tilt sensors",
      "y" : 420,
      "id" : "dc5184fb.4e2c88"
   },
   {
      "id" : "10ed59cd.cd0fe6",
      "y" : 1200,
      "x" : 120,
      "info" : "",
      "type" : "comment",
      "name" : "Speak calendar alerts",
      "wires" : [],
      "z" : "e0703c90.1a341"
   },
   {
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "c243e0a2.0e49b",
            "db0ab9b3.199738"
         ]
      ],
      "entityidfilter" : "calendar.family",
      "name" : "Family Calendar Events",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "x" : 120,
      "haltifstate" : "off",
      "y" : 1240,
      "server" : "e2a02faf.48099",
      "id" : "41bc15f1.aa68dc"
   },
   {
      "id" : "d2ec2226.09f8",
      "func" : "msg.payload = { data: {'message': 'You have an event on the family calendar. Here it is..... ' + msg.payload } };\nreturn msg;",
      "y" : 1240,
      "x" : 830,
      "type" : "function",
      "name" : "Format message",
      "wires" : [
         [
            "27f7e6fb.4964ba",
            "ccb53ba4.31baa8"
         ]
      ],
      "outputs" : 1,
      "noerr" : 0,
      "z" : "e0703c90.1a341"
   },
   {
      "name" : "",
      "type" : "subflow:837bbace.420028",
      "x" : 1330,
      "id" : "4c31056f.f176ac",
      "y" : 1320,
      "wires" : [
         [],
         []
      ],
      "z" : "e0703c90.1a341"
   },
   {
      "property" : "",
      "id" : "c243e0a2.0e49b",
      "action" : "",
      "y" : 1240,
      "reg" : false,
      "name" : "Set calendar message",
      "type" : "change",
      "from" : "",
      "x" : 380,
      "rules" : [
         {
            "t" : "move",
            "p" : "data.new_state.attributes.message",
            "to" : "payload",
            "pt" : "msg",
            "tot" : "msg"
         }
      ],
      "wires" : [
         [
            "ccaff6dc.1b45c8",
            "a66b441a.b36ed8"
         ]
      ],
      "to" : "",
      "z" : "e0703c90.1a341"
   },
   {
      "x" : 1010,
      "tostatus" : false,
      "type" : "debug",
      "name" : "format",
      "complete" : "true",
      "console" : false,
      "wires" : [],
      "tosidebar" : true,
      "active" : true,
      "z" : "e0703c90.1a341",
      "id" : "27f7e6fb.4964ba",
      "y" : 1380
   },
   {
      "active" : true,
      "z" : "e0703c90.1a341",
      "wires" : [],
      "tosidebar" : true,
      "console" : false,
      "complete" : "true",
      "x" : 790,
      "tostatus" : false,
      "type" : "debug",
      "name" : "set",
      "y" : 1200,
      "id" : "dc63a1f5.0ff2b"
   },
   {
      "property" : "payload",
      "id" : "ccaff6dc.1b45c8",
      "outputLabels" : [
         "Trash",
         "Cleaning",
         "Everything else"
      ],
      "y" : 1240,
      "repair" : false,
      "name" : "Filter",
      "type" : "switch",
      "x" : 570,
      "propertyType" : "msg",
      "rules" : [
         {
            "vt" : "str",
            "v" : "trash",
            "t" : "cont"
         },
         {
            "v" : "Brenda",
            "vt" : "str",
            "t" : "cont"
         },
         {
            "t" : "nnull"
         }
      ],
      "wires" : [
         [],
         [],
         [
            "d2ec2226.09f8",
            "dc63a1f5.0ff2b",
            "1ef54d6c.454ad3"
         ]
      ],
      "z" : "e0703c90.1a341",
      "checkall" : "false",
      "outputs" : 3
   },
   {
      "name" : "Week of the year",
      "type" : "moment",
      "outputType" : "msg",
      "topic" : "",
      "wires" : [
         [
            "df6a615b.6b48f"
         ]
      ],
      "id" : "40f8aeda.2038c",
      "inputType" : "date",
      "locale" : "en_US",
      "format" : "w",
      "adjAmount" : 0,
      "output" : "week",
      "x" : 1590,
      "adjType" : "days",
      "input" : "",
      "outTz" : "America/Chicago",
      "z" : "e0703c90.1a341",
      "y" : 880,
      "inTz" : "America/Chicago",
      "adjDir" : "add"
   },
   {
      "crontab" : "",
      "y" : 1920,
      "once" : false,
      "repeat" : "",
      "id" : "abff5a3d.d4fa68",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "70445fd.82f60a"
         ]
      ],
      "payload" : "2018-03-08 12:06:23 ERROR (MainThread) [homeassistant.core] Error executing service <ServiceCall light.turn_on: entity_id=['light.philips_lct014_0288d38c_11'], brightness=1>",
      "onceDelay" : "",
      "topic" : "",
      "type" : "inject",
      "name" : "Single light failure with brightness as final item",
      "payloadType" : "str",
      "x" : 190
   },
   {
      "name" : "Set Son1's Lamp dusk color temp",
      "type" : "api-call-service",
      "x" : 1090,
      "mergecontext" : "",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "service" : "turn_on",
      "id" : "b6d5e113.f2a72",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "y" : 1440,
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"color_temp\":\"400\"}"
   },
   {
      "type" : "api-call-service",
      "name" : "Set Master Bedroom dusk Color temp",
      "x" : 1090,
      "mergecontext" : "",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "service" : "turn_on",
      "id" : "f7e46600.c4e6e8",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "y" : 1520,
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"color_temp\":\"400\"}"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "224378b6.00fbd8",
      "y" : 1480,
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"color_temp\":\"442\"}",
      "mergecontext" : "",
      "name" : "Set Son1's Lamp night color temp",
      "type" : "api-call-service",
      "x" : 1090,
      "z" : "e0703c90.1a341",
      "service" : "turn_on",
      "wires" : [
         []
      ]
   },
   {
      "service" : "turn_on",
      "z" : "e0703c90.1a341",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "x" : 1090,
      "type" : "api-call-service",
      "name" : "Set Master Bedroom night Color temp",
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"color_temp\":\"442\"}",
      "y" : 1560,
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "b5a2f744.7e5e68"
   },
   {
      "id" : "2100c4a4.dd22cc",
      "y" : 1420,
      "info" : "",
      "x" : 170,
      "type" : "comment",
      "name" : "Set evening color temperatures",
      "wires" : [],
      "z" : "e0703c90.1a341"
   },
   {
      "x" : 304,
      "tostatus" : false,
      "name" : "event",
      "type" : "debug",
      "complete" : "true",
      "console" : false,
      "tosidebar" : true,
      "wires" : [],
      "active" : true,
      "z" : "e0703c90.1a341",
      "id" : "db0ab9b3.199738",
      "y" : 1171
   },
   {
      "complete" : "true",
      "console" : false,
      "type" : "debug",
      "name" : "calendar msg",
      "x" : 460,
      "tostatus" : false,
      "z" : "e0703c90.1a341",
      "active" : true,
      "tosidebar" : true,
      "wires" : [],
      "id" : "a66b441a.b36ed8",
      "y" : 1120
   },
   {
      "console" : false,
      "complete" : "true",
      "type" : "debug",
      "name" : "filter",
      "tostatus" : false,
      "x" : 610,
      "z" : "e0703c90.1a341",
      "active" : true,
      "tosidebar" : true,
      "wires" : [],
      "id" : "1ef54d6c.454ad3",
      "y" : 1160
   },
   {
      "y" : 1258,
      "id" : "b49823ca.a4a83",
      "tosidebar" : true,
      "wires" : [],
      "active" : true,
      "z" : "e0703c90.1a341",
      "x" : 1338,
      "tostatus" : false,
      "name" : "final voice",
      "type" : "debug",
      "console" : false,
      "complete" : "payload"
   },
   {
      "wires" : [
         [
            "9d995075.a0e87"
         ]
      ],
      "onceDelay" : 0.1,
      "payload" : "",
      "z" : "e0703c90.1a341",
      "type" : "inject",
      "payloadType" : "date",
      "name" : "",
      "x" : 80,
      "topic" : "",
      "y" : 1300,
      "crontab" : "",
      "id" : "c3fc5a77.8506d8",
      "repeat" : "",
      "once" : false
   },
   {
      "y" : 1300,
      "func" : "msg = {\"topic\":\"calendar.family\",\"payload\":\"on\",\"data\":{\"entity_id\":\"calendar.family\",\"old_state\":{\"entity_id\":\"calendar.family\",\"state\":\"off\",\"attributes\":{\"message\":\"Test of automatically speaking calendar alerts\",\"all_day\":false,\"offset_reached\":false,\"start_time\":\"2018-03-08 13:30:00\",\"end_time\":\"2018-03-08 14:30:00\",\"location\":null,\"description\":null,\"friendly_name\":\"Family\"},\"last_changed\":\"2018-03-08T19:26:52.999318+00:00\",\"last_updated\":\"2018-03-08T19:26:52.999318+00:00\"},\"new_state\":{\"entity_id\":\"calendar.family\",\"state\":\"on\",\"attributes\":{\"message\":\"Test of automatically speaking calendar alerts\",\"all_day\":false,\"offset_reached\":false,\"start_time\":\"2018-03-08 13:30:00\",\"end_time\":\"2018-03-08 14:30:00\",\"location\":null,\"description\":null,\"friendly_name\":\"Family\"},\"last_changed\":\"2018-03-08T19:30:51.821381+00:00\",\"last_updated\":\"2018-03-08T19:30:51.821381+00:00\"}},\"_msgid\":\"43b2501.49f13b\"}\nreturn msg;",
      "id" : "9d995075.a0e87",
      "wires" : [
         [
            "c243e0a2.0e49b"
         ]
      ],
      "noerr" : 0,
      "z" : "e0703c90.1a341",
      "outputs" : 1,
      "name" : "test msg",
      "type" : "function",
      "x" : 220
   },
   {
      "y" : 1260,
      "wires" : [
         [
            "b49823ca.a4a83",
            "4c31056f.f176ac"
         ]
      ],
      "z" : "e0703c90.1a341",
      "x" : 1120,
      "id" : "ccb53ba4.31baa8",
      "name" : "",
      "type" : "subflow:2283eff7.ee9ab"
   },
   {
      "id" : "489a3d27.ac4b84",
      "startTime" : "sunsetStart",
      "endTime" : "sunset",
      "endOffset" : 0,
      "y" : 1420,
      "x" : 430,
      "name" : "Golden Hour",
      "type" : "time-range-switch",
      "lon" : "-92.58936",
      "lat" : "40.17349",
      "wires" : [
         [
            "a0edc4fc.99ca98"
         ],
         []
      ],
      "startOffset" : "-15",
      "z" : "e0703c90.1a341"
   },
   {
      "type" : "delay",
      "name" : "",
      "wires" : [
         [
            "a78f27ac.9ec7d8",
            "9727d853.175ed8"
         ]
      ],
      "pauseType" : "rate",
      "id" : "a0edc4fc.99ca98",
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds",
      "timeout" : "5",
      "x" : 660,
      "z" : "e0703c90.1a341",
      "randomFirst" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "12",
      "rate" : "1",
      "drop" : true,
      "y" : 1440
   },
   {
      "id" : "a7007d2b.4c344",
      "outputinitially" : false,
      "server" : "e2a02faf.48099",
      "updateinterval" : "600",
      "outputonchanged" : true,
      "y" : 1460,
      "x" : 120,
      "entity_id" : "light.philips_lct014_0288ce3f_11",
      "name" : "Son1s Lamp",
      "type" : "poll-state",
      "wires" : [
         [
            "4fc96a58.db6fe4"
         ]
      ],
      "z" : "e0703c90.1a341"
   },
   {
      "name" : "",
      "type" : "switch",
      "propertyType" : "msg",
      "x" : 290,
      "rules" : [
         {
            "t" : "eq",
            "v" : "on",
            "vt" : "str"
         }
      ],
      "wires" : [
         [
            "489a3d27.ac4b84",
            "23e9cfd5.c84ac"
         ]
      ],
      "z" : "e0703c90.1a341",
      "checkall" : "true",
      "outputs" : 1,
      "property" : "payload.data.state",
      "id" : "4fc96a58.db6fe4",
      "y" : 1460,
      "repair" : false
   },
   {
      "z" : "e0703c90.1a341",
      "startOffset" : "0",
      "wires" : [
         [
            "ea5e2205.de942"
         ],
         []
      ],
      "lat" : "40.17349",
      "lon" : "-92.58936",
      "type" : "time-range-switch",
      "name" : "Sunset",
      "x" : 410,
      "y" : 1480,
      "endOffset" : 0,
      "endTime" : "dusk",
      "startTime" : "sunset",
      "id" : "23e9cfd5.c84ac"
   },
   {
      "id" : "ea5e2205.de942",
      "pauseType" : "rate",
      "wires" : [
         [
            "e9fe8b78.2c3198",
            "700be555.ebd80c"
         ]
      ],
      "type" : "delay",
      "name" : "",
      "y" : 1480,
      "drop" : true,
      "rate" : "1",
      "nbRateUnits" : "12",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "randomFirst" : "1",
      "z" : "e0703c90.1a341",
      "timeout" : "5",
      "x" : 660,
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds"
   },
   {
      "id" : "bc6ca2c4.e421b",
      "startTime" : "sunsetStart",
      "endTime" : "sunset",
      "endOffset" : 0,
      "y" : 1520,
      "x" : 430,
      "type" : "time-range-switch",
      "name" : "Golden Hour",
      "lon" : "-92.58936",
      "lat" : "40.17349",
      "wires" : [
         [
            "a3e21405.e818f8"
         ],
         []
      ],
      "startOffset" : "-15",
      "z" : "e0703c90.1a341"
   },
   {
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds",
      "timeout" : "5",
      "x" : 660,
      "z" : "e0703c90.1a341",
      "randomFirst" : "1",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "12",
      "rate" : "1",
      "y" : 1520,
      "drop" : true,
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "a78f27ac.9ec7d8",
            "42ad379b.233f18"
         ]
      ],
      "pauseType" : "rate",
      "id" : "a3e21405.e818f8"
   },
   {
      "x" : 120,
      "type" : "poll-state",
      "entity_id" : "light.master_bedroom",
      "name" : "Master Bedroom",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "a56469c7.36c808"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "7015dadb.d21cf4",
      "outputinitially" : false,
      "updateinterval" : "600",
      "y" : 1540,
      "outputonchanged" : true
   },
   {
      "z" : "e0703c90.1a341",
      "outputs" : 1,
      "checkall" : "true",
      "wires" : [
         [
            "bc6ca2c4.e421b",
            "6be06e5f.a9ca3"
         ]
      ],
      "rules" : [
         {
            "vt" : "str",
            "v" : "on",
            "t" : "eq"
         }
      ],
      "type" : "switch",
      "name" : "",
      "propertyType" : "msg",
      "x" : 290,
      "y" : 1540,
      "repair" : false,
      "property" : "payload.data.state",
      "id" : "a56469c7.36c808"
   },
   {
      "y" : 1580,
      "id" : "6be06e5f.a9ca3",
      "endTime" : "dusk",
      "endOffset" : 0,
      "startTime" : "sunset",
      "wires" : [
         [
            "2b377ade.a2ae56"
         ],
         []
      ],
      "lat" : "40.17349",
      "z" : "e0703c90.1a341",
      "startOffset" : "0",
      "type" : "time-range-switch",
      "name" : "Sunset",
      "x" : 410,
      "lon" : "-92.58936"
   },
   {
      "wires" : [
         [
            "e9fe8b78.2c3198",
            "e2a533e2.ff00c"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "id" : "2b377ade.a2ae56",
      "pauseType" : "rate",
      "randomFirst" : "1",
      "z" : "e0703c90.1a341",
      "timeout" : "5",
      "x" : 660,
      "rateUnits" : "hour",
      "timeoutUnits" : "seconds",
      "y" : 1560,
      "drop" : true,
      "rate" : "1",
      "nbRateUnits" : "12",
      "randomUnits" : "seconds",
      "randomLast" : "5"
   },
   {
      "id" : "a78f27ac.9ec7d8",
      "y" : 1370,
      "tostatus" : false,
      "x" : 796,
      "type" : "debug",
      "name" : "dusk",
      "console" : false,
      "complete" : "true",
      "wires" : [],
      "tosidebar" : true,
      "active" : true,
      "z" : "e0703c90.1a341"
   },
   {
      "tosidebar" : true,
      "wires" : [],
      "z" : "e0703c90.1a341",
      "active" : true,
      "name" : "sunset",
      "type" : "debug",
      "x" : 752,
      "tostatus" : false,
      "console" : false,
      "complete" : "payload",
      "y" : 1621,
      "id" : "e9fe8b78.2c3198"
   },
   {
      "y" : 1740,
      "id" : "71ea898e.baa5d8",
      "wires" : [],
      "z" : "e0703c90.1a341",
      "type" : "comment",
      "name" : "Schlage front door lock",
      "x" : 140,
      "info" : ""
   },
   {
      "z" : "e0703c90.1a341",
      "service" : "lock",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "name" : "Lock front door",
      "type" : "api-call-service",
      "x" : 320,
      "y" : 1780,
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "server" : "e2a02faf.48099",
      "id" : "c72348d0.0974d8",
      "service_domain" : "lock"
   },
   {
      "z" : "e0703c90.1a341",
      "service" : "unlock",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "type" : "api-call-service",
      "name" : "Unlock front door",
      "x" : 330,
      "y" : 1820,
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "server" : "e2a02faf.48099",
      "id" : "a169014d.22aa4",
      "service_domain" : "lock"
   },
   {
      "id" : "8d8cbb41.da8c88",
      "once" : false,
      "repeat" : "",
      "y" : 1780,
      "crontab" : "",
      "name" : "",
      "payloadType" : "date",
      "type" : "inject",
      "x" : 120,
      "topic" : "",
      "wires" : [
         [
            "c72348d0.0974d8"
         ]
      ],
      "payload" : "",
      "onceDelay" : 0.1,
      "z" : "e0703c90.1a341"
   },
   {
      "id" : "5547efb4.48782",
      "repeat" : "",
      "once" : false,
      "y" : 1820,
      "crontab" : "",
      "name" : "",
      "type" : "inject",
      "payloadType" : "date",
      "x" : 120,
      "topic" : "",
      "wires" : [
         [
            "a169014d.22aa4"
         ]
      ],
      "payload" : "",
      "onceDelay" : 0.1,
      "z" : "e0703c90.1a341"
   },
   {
      "wires" : [
         []
      ],
      "service" : "lock",
      "z" : "8bb76918.ef6b48",
      "x" : 1220,
      "type" : "api-call-service",
      "name" : "Lock front door",
      "mergecontext" : "",
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "y" : 2000,
      "service_domain" : "lock",
      "id" : "6c92f048.18abb",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "d01e41d3.f6416",
      "service_domain" : "lock",
      "y" : 2140,
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "mergecontext" : "",
      "type" : "api-call-service",
      "name" : "Unlock front door",
      "x" : 1010,
      "z" : "8bb76918.ef6b48",
      "service" : "unlock",
      "wires" : [
         []
      ]
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "lock",
      "id" : "3652e256.daaefe",
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "y" : 2260,
      "mergecontext" : "",
      "x" : 1340,
      "type" : "api-call-service",
      "name" : "Lock front door",
      "service" : "lock",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ]
   },
   {
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "y" : 3340,
      "server" : "e2a02faf.48099",
      "id" : "7d4b932d.fbd30c",
      "service_domain" : "lock",
      "service" : "lock",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "x" : 1040,
      "type" : "api-call-service",
      "name" : "Lock front door"
   },
   {
      "topic" : "",
      "name" : "",
      "payloadType" : "date",
      "type" : "inject",
      "x" : 576,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "9727d853.175ed8"
         ]
      ],
      "onceDelay" : 0.1,
      "payload" : "",
      "repeat" : "",
      "once" : false,
      "id" : "93c9692c.df3478",
      "crontab" : "",
      "y" : 1338
   },
   {
      "y" : 1440,
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "id" : "9727d853.175ed8",
      "outputs" : 1,
      "z" : "e0703c90.1a341",
      "noerr" : 0,
      "wires" : [
         [
            "b6d5e113.f2a72"
         ]
      ],
      "x" : 840,
      "name" : "Clear msg",
      "type" : "function"
   },
   {
      "x" : 840,
      "name" : "Clear msg",
      "type" : "function",
      "outputs" : 1,
      "noerr" : 0,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "224378b6.00fbd8"
         ]
      ],
      "id" : "700be555.ebd80c",
      "y" : 1480,
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;"
   },
   {
      "outputs" : 1,
      "z" : "e0703c90.1a341",
      "noerr" : 0,
      "wires" : [
         [
            "f7e46600.c4e6e8"
         ]
      ],
      "x" : 840,
      "name" : "Clear msg",
      "type" : "function",
      "y" : 1520,
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "id" : "42ad379b.233f18"
   },
   {
      "x" : 840,
      "type" : "function",
      "name" : "Clear msg",
      "wires" : [
         [
            "b5a2f744.7e5e68"
         ]
      ],
      "outputs" : 1,
      "z" : "e0703c90.1a341",
      "noerr" : 0,
      "id" : "e2a533e2.ff00c",
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "y" : 1560
   },
   {
      "y" : 2000,
      "id" : "7328843a.d6899c",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "666cf580.c2ab4c"
         ]
      ],
      "z" : "e0703c90.1a341",
      "x" : 770,
      "entity_id" : "light.philips_lct014_0288ce3f_11",
      "type" : "api-current-state",
      "name" : "Son1s light already on?",
      "halt_if" : ""
   },
   {
      "halt_if" : "on",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.no_school_mode",
      "name" : "If No School mode",
      "x" : 470,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "7328843a.d6899c"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "2a44c3a1.2fc89c",
      "y" : 2000
   },
   {
      "x" : 150,
      "payloadType" : "str",
      "name" : "",
      "type" : "inject",
      "topic" : "",
      "payload" : "6:50 on weekdays",
      "wires" : [
         [
            "2a44c3a1.2fc89c"
         ]
      ],
      "z" : "e0703c90.1a341",
      "id" : "1e0d36a4.6c8a09",
      "repeat" : "",
      "once" : false,
      "y" : 2000,
      "crontab" : "50 06 * * 1,2,3,4,5"
   },
   {
      "z" : "e0703c90.1a341",
      "active" : true,
      "tosidebar" : true,
      "wires" : [],
      "console" : false,
      "complete" : "true",
      "type" : "debug",
      "name" : "",
      "x" : 1013,
      "tostatus" : false,
      "y" : 1991,
      "id" : "666cf580.c2ab4c"
   },
   {
      "name" : "Clear msg",
      "type" : "function",
      "x" : 1060,
      "wires" : [
         [
            "4321f595.99043c",
            "ce971dc7.47848",
            "86dd48f7.85d0c8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "noerr" : 0,
      "outputs" : 1,
      "id" : "bf6eb2bf.f3cf4",
      "y" : 1320,
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;"
   },
   {
      "wires" : [
         [
            "d890e20a.375ec",
            "72e3d694.804d08",
            "fe9b65ed.5508f8"
         ]
      ],
      "outputs" : 1,
      "z" : "8bb76918.ef6b48",
      "noerr" : 0,
      "x" : 1060,
      "type" : "function",
      "name" : "Clear msg",
      "y" : 1440,
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "id" : "50de5197.f732a"
   },
   {
      "y" : 1320,
      "op2" : "0",
      "op1type" : "str",
      "z" : "8bb76918.ef6b48",
      "reset" : "",
      "duration" : "3",
      "x" : 1510,
      "op2type" : "str",
      "op1" : "1",
      "bytopic" : "all",
      "id" : "b2e1971a.100438",
      "extend" : false,
      "wires" : [
         [
            "e04cd686.d71298"
         ]
      ],
      "units" : "s",
      "name" : "Wait three seconds",
      "type" : "trigger"
   },
   {
      "mergecontext" : "",
      "x" : 1720,
      "name" : "Set color temperature",
      "type" : "api-call-service",
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "e04cd686.d71298",
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"brightness\":\"1\", \"color_temp\":\"236\"}",
      "y" : 1320
   },
   {
      "op1type" : "str",
      "y" : 1400,
      "op2" : "0",
      "x" : 1570,
      "reset" : "",
      "duration" : "3",
      "z" : "8bb76918.ef6b48",
      "id" : "d42c4e19.01a5c",
      "bytopic" : "all",
      "op1" : "1",
      "op2type" : "str",
      "type" : "trigger",
      "name" : "Wait three seconds",
      "units" : "s",
      "wires" : [
         [
            "1b5f7ab8.52fe45"
         ]
      ],
      "extend" : false
   },
   {
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "mergecontext" : "",
      "name" : "Set color temperature",
      "type" : "api-call-service",
      "x" : 1780,
      "y" : 1400,
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"brightness\":\"1\", \"color_temp\":\"236\"}",
      "server" : "e2a02faf.48099",
      "id" : "1b5f7ab8.52fe45",
      "service_domain" : "light"
   },
   {
      "payloadval" : "0",
      "id" : "1776e4a3.24d8ab",
      "y" : 2060,
      "payloadtype" : "num",
      "type" : "stoptimer",
      "name" : "",
      "x" : 1500,
      "duration" : "1",
      "units" : "Minute",
      "wires" : [
         [
            "8f0c8c19.0eaac"
         ],
         []
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "z" : "20661f8a.532c4",
      "secure" : true,
      "wires" : [],
      "name" : "walthowd@gmail.com",
      "type" : "e-mail",
      "x" : 2240,
      "y" : 2060,
      "dname" : "",
      "server" : "smtp.gmail.com",
      "id" : "f764ac54.e0fa4",
      "port" : "465"
   },
   {
      "gap" : "",
      "name" : "",
      "type" : "rbe",
      "x" : 1870,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "e15da42.be21a58"
         ]
      ],
      "start" : "",
      "inout" : "out",
      "property" : "payload",
      "id" : "b38e7b92.e76e78",
      "y" : 2040,
      "func" : "rbe"
   },
   {
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "timeout" : "5",
      "x" : 2020,
      "rateUnits" : "minute",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "y" : 2040,
      "rate" : "1",
      "nbRateUnits" : "10",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "wires" : [
         [
            "f764ac54.e0fa4",
            "be0ef2f5.b8c65",
            "ea9a86d3.c745c8"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "id" : "e15da42.be21a58",
      "pauseType" : "rate"
   },
   {
      "x" : 1690,
      "name" : "Format message",
      "type" : "change",
      "from" : "",
      "rules" : [
         {
            "to" : "Nothing written to Home Assistant log file in the last minute. Is Home Assistant still working? Restarting Home Assistant. ",
            "pt" : "msg",
            "tot" : "str",
            "p" : "payload",
            "t" : "set"
         },
         {
            "to" : "Home Assistant Log file not updating",
            "pt" : "msg",
            "tot" : "str",
            "t" : "set",
            "p" : "topic"
         }
      ],
      "wires" : [
         [
            "b38e7b92.e76e78"
         ]
      ],
      "to" : "",
      "z" : "20661f8a.532c4",
      "id" : "8f0c8c19.0eaac",
      "property" : "",
      "y" : 2060,
      "action" : "",
      "reg" : false
   },
   {
      "timer" : "60",
      "wires" : [
         [],
         [],
         []
      ],
      "z" : "20661f8a.532c4",
      "oldrc" : false,
      "name" : "Restart Home Assistant",
      "type" : "exec",
      "x" : 2450,
      "addpay" : false,
      "y" : 2000,
      "append" : "",
      "command" : "/Users/hass/.homeassistant/start.sh restart",
      "useSpawn" : "false",
      "id" : "fdeb4324.2366e"
   },
   {
      "id" : "684a6b8f.f4d354",
      "negate_stop" : false,
      "send_allow" : false,
      "property_allow" : "topic",
      "property_stop" : "topic",
      "type" : "traffic",
      "name" : "",
      "wires" : [
         [
            "2bf46485.6d730c",
            "80dcc785.d26e68"
         ]
      ],
      "send_stop" : false,
      "default_start" : false,
      "negate_allow" : false,
      "filter_stop" : "stop",
      "ignore_case_allow" : false,
      "y" : 2000,
      "filter_allow" : "go",
      "ignore_case_stop" : false,
      "x" : 1490,
      "differ" : false,
      "z" : "20661f8a.532c4"
   },
   {
      "checkall" : "true",
      "outputs" : 1,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "684a6b8f.f4d354"
         ]
      ],
      "rules" : [
         {
            "case" : false,
            "t" : "regex",
            "v" : "^AssertionError",
            "vt" : "str"
         }
      ],
      "propertyType" : "msg",
      "x" : 520,
      "name" : "AssertionError",
      "type" : "switch",
      "repair" : false,
      "y" : 1940,
      "id" : "da524a1f.6dd768",
      "property" : "payload"
   },
   {
      "y" : 1920,
      "action" : "",
      "reg" : false,
      "property" : "",
      "id" : "984fceb.5bee93",
      "wires" : [
         [
            "684a6b8f.f4d354",
            "bea03df4.55f04"
         ]
      ],
      "to" : "",
      "z" : "20661f8a.532c4",
      "type" : "change",
      "name" : "",
      "from" : "",
      "x" : 1480,
      "rules" : [
         {
            "to" : "go",
            "tot" : "str",
            "pt" : "msg",
            "t" : "set",
            "p" : "topic"
         }
      ]
   },
   {
      "id" : "bea03df4.55f04",
      "payloadval" : "0",
      "y" : 1920,
      "duration" : "1",
      "units" : "Minute",
      "x" : 1700,
      "payloadtype" : "num",
      "type" : "stoptimer",
      "name" : "",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "2bf46485.6d730c"
         ],
         []
      ]
   },
   {
      "id" : "2bf46485.6d730c",
      "property" : "",
      "action" : "",
      "y" : 1920,
      "reg" : false,
      "x" : 1920,
      "from" : "",
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "pt" : "msg",
            "tot" : "str",
            "to" : "stop",
            "t" : "set",
            "p" : "topic"
         }
      ],
      "wires" : [
         [
            "684a6b8f.f4d354"
         ]
      ],
      "to" : "",
      "z" : "20661f8a.532c4"
   },
   {
      "z" : "20661f8a.532c4",
      "to" : "",
      "wires" : [
         [
            "b38e7b92.e76e78"
         ]
      ],
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "tot" : "str",
            "pt" : "msg",
            "to" : "50+ Zigbee errors and AssertionErrors logged. Restarting Home Assistant. "
         },
         {
            "t" : "set",
            "p" : "topic",
            "pt" : "msg",
            "tot" : "str",
            "to" : "Home Assistant Zigbee and AssertionErrors"
         }
      ],
      "name" : "Format message",
      "type" : "change",
      "from" : "",
      "x" : 1690,
      "reg" : false,
      "y" : 2020,
      "action" : "",
      "property" : "",
      "id" : "80dcc785.d26e68"
   },
   {
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "rate" : "1",
      "y" : 2060,
      "drop" : true,
      "rateUnits" : "second",
      "timeoutUnits" : "seconds",
      "timeout" : "5",
      "x" : 1290,
      "z" : "20661f8a.532c4",
      "randomFirst" : "1",
      "pauseType" : "rate",
      "id" : "eb4e20ed.e3724",
      "name" : "",
      "type" : "delay",
      "wires" : [
         [
            "1776e4a3.24d8ab"
         ]
      ]
   },
   {
      "id" : "64060e4b.f1468",
      "once" : true,
      "repeat" : "60",
      "y" : 2140,
      "crontab" : "",
      "x" : 1130,
      "name" : "",
      "payloadType" : "date",
      "type" : "inject",
      "topic" : "",
      "onceDelay" : "60",
      "payload" : "",
      "wires" : [
         [
            "d72edd5d.ae209"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "name" : "",
      "type" : "http request",
      "x" : 1310,
      "tls" : "849977e5.257f68",
      "wires" : [
         [
            "971a0fcf.0b2b8"
         ]
      ],
      "method" : "GET",
      "z" : "20661f8a.532c4",
      "ret" : "txt",
      "url" : "https://127.0.0.1:8123",
      "id" : "d72edd5d.ae209",
      "y" : 2140
   },
   {
      "checkall" : "true",
      "outputs" : 1,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "f7a6cfea.d4577",
            "d5293219.47e9e"
         ]
      ],
      "rules" : [
         {
            "v" : "ECONNREFUSED",
            "vt" : "str",
            "t" : "cont"
         }
      ],
      "propertyType" : "msg",
      "x" : 1474,
      "type" : "switch",
      "name" : "",
      "repair" : false,
      "y" : 2140,
      "id" : "971a0fcf.0b2b8",
      "property" : "payload"
   },
   {
      "id" : "f7a6cfea.d4577",
      "property" : "",
      "reg" : false,
      "y" : 2100,
      "action" : "",
      "rules" : [
         {
            "t" : "set",
            "p" : "payload",
            "tot" : "str",
            "pt" : "msg",
            "to" : "Can't reach port 8123 on local host for Home Assistant. Restarting Home Assistant. "
         },
         {
            "pt" : "msg",
            "tot" : "str",
            "to" : "Home Assistant Port not reachable",
            "p" : "topic",
            "t" : "set"
         }
      ],
      "x" : 1690,
      "name" : "Format message",
      "type" : "change",
      "from" : "",
      "z" : "20661f8a.532c4",
      "to" : "",
      "wires" : [
         [
            "b38e7b92.e76e78"
         ]
      ]
   },
   {
      "id" : "ea9a86d3.c745c8",
      "useSpawn" : "false",
      "command" : "cp /Users/hass/.homeassistant/home-assistant.log home-assistant.log.crash",
      "append" : "",
      "y" : 1940,
      "addpay" : false,
      "x" : 2270,
      "type" : "exec",
      "name" : "Copy Home Assistant Log file",
      "oldrc" : false,
      "z" : "20661f8a.532c4",
      "wires" : [
         [],
         [],
         []
      ],
      "timer" : "60"
   },
   {
      "wires" : [
         [
            "fdeb4324.2366e"
         ]
      ],
      "name" : "",
      "type" : "delay",
      "id" : "be0ef2f5.b8c65",
      "pauseType" : "delay",
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "x" : 2200,
      "timeout" : "10",
      "timeoutUnits" : "seconds",
      "rateUnits" : "second",
      "y" : 2000,
      "drop" : false,
      "rate" : "1",
      "nbRateUnits" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds"
   },
   {
      "name" : "HTTP Error",
      "type" : "debug",
      "tostatus" : false,
      "x" : 1660,
      "console" : true,
      "complete" : "true",
      "wires" : [],
      "tosidebar" : true,
      "z" : "20661f8a.532c4",
      "active" : true,
      "id" : "d5293219.47e9e",
      "y" : 2185
   },
   {
      "y" : 2100,
      "id" : "1b53664d.bf955a",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "type" : "comment",
      "name" : "Monitor the Home Assistant port",
      "info" : "",
      "x" : 1150
   },
   {
      "halt_if" : "off",
      "x" : 600,
      "name" : "If Main Level off",
      "type" : "api-current-state",
      "entity_id" : "group.main_level",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "45e5a80.bbcad58"
         ]
      ],
      "server" : "e2a02faf.48099",
      "id" : "56ee825a.cd305c",
      "y" : 660
   },
   {
      "service_domain" : "light",
      "id" : "47c3d025.fe7ac",
      "server" : "e2a02faf.48099",
      "y" : 980,
      "data" : "{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}",
      "type" : "api-call-service",
      "name" : "Turn on porch light",
      "x" : 1390,
      "mergecontext" : "",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on"
   },
   {
      "y" : 3380,
      "data" : "{\"entity_id\":\"light.front_door_switch_level\"}",
      "service_domain" : "light",
      "id" : "374fc028.b2f11",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_off",
      "name" : "Turn off porch light",
      "type" : "api-call-service",
      "x" : 1050
   },
   {
      "month3" : 0,
      "oct" : true,
      "month1" : 0,
      "wires" : [
         [],
         [],
         [
            "50b527cc.b89c28"
         ]
      ],
      "lat" : "40.173508",
      "fri" : true,
      "repeat" : true,
      "w2" : 0,
      "id" : "ce9436c2.3b03e8",
      "may" : true,
      "d4" : 0,
      "day5" : 0,
      "jun" : true,
      "d3" : 0,
      "outpayload1" : "",
      "month4" : 0,
      "odd" : false,
      "y" : 3360,
      "feb" : true,
      "month2" : 0,
      "type" : "bigtimer",
      "w3" : 0,
      "mon" : true,
      "outtopic" : "",
      "wed" : true,
      "tue" : true,
      "timeout" : 1440,
      "z" : "8bb76918.ef6b48",
      "starttime" : "5000",
      "w5" : 0,
      "nov" : true,
      "sep" : true,
      "w4" : 0,
      "mar" : true,
      "even" : false,
      "outpayload2" : "",
      "name" : "90 minutes after sunrise",
      "atstart" : false,
      "thu" : true,
      "outtext1" : "on",
      "w1" : 0,
      "sat" : true,
      "day3" : 0,
      "jan" : true,
      "lon" : "-92.58988",
      "x" : 130,
      "endoff" : "90",
      "month5" : 0,
      "d5" : 0,
      "d2" : 0,
      "aug" : true,
      "sun" : true,
      "endtime" : "5003",
      "day2" : 0,
      "dec" : true,
      "jul" : true,
      "apr" : true,
      "outtext2" : "off",
      "day4" : 0,
      "day1" : 0,
      "random" : false,
      "startoff" : "0",
      "offs" : 0,
      "suspend" : false,
      "d1" : 0
   },
   {
      "checkall" : "true",
      "outputs" : 2,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [],
         [
            "374fc028.b2f11"
         ]
      ],
      "rules" : [
         {
            "v" : "on",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "v" : "off",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "x" : 490,
      "propertyType" : "msg",
      "type" : "switch",
      "name" : "",
      "y" : 3360,
      "id" : "50b527cc.b89c28",
      "property" : "payload"
   }
]
