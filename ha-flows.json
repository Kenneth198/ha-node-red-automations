[
   {
      "type" : "tab",
      "label" : "Home Automation",
      "info" : "",
      "id" : "8bb76918.ef6b48",
      "disabled" : false
   },
   {
      "disabled" : false,
      "id" : "46ed0d55.4c98b4",
      "type" : "tab",
      "label" : "Location Tracking",
      "info" : ""
   },
   {
      "label" : "Notifications",
      "info" : "",
      "type" : "tab",
      "id" : "4fa6bb30.5a4f94",
      "disabled" : false
   },
   {
      "disabled" : false,
      "type" : "tab",
      "label" : "Security",
      "info" : "",
      "id" : "af1cc9bd.91cc08"
   },
   {
      "disabled" : false,
      "info" : "",
      "label" : "Utilities",
      "type" : "tab",
      "id" : "20661f8a.532c4"
   },
   {
      "type" : "tab",
      "info" : "",
      "label" : "Dashboard",
      "id" : "7d04740a.ad6adc",
      "disabled" : false
   },
   {
      "disabled" : false,
      "id" : "e0703c90.1a341",
      "label" : "Dev",
      "info" : "",
      "type" : "tab"
   },
   {
      "name" : "Stop if family is home or guest mode on",
      "type" : "subflow",
      "in" : [
         {
            "wires" : [
               {
                  "id" : "d2c9201e.f640e"
               }
            ],
            "x" : 40,
            "y" : 560
         }
      ],
      "info" : "",
      "out" : [
         {
            "y" : 560,
            "wires" : [
               {
                  "port" : 1,
                  "id" : "caba1d6f.2e38"
               }
            ],
            "x" : 1060
         }
      ],
      "id" : "c663f7df.ca58b8"
   },
   {
      "info" : "",
      "id" : "7ae32389.5d604c",
      "outputLabels" : [
         "Left Zone",
         "Entered new zone apart from spouse"
      ],
      "in" : [
         {
            "x" : 40,
            "wires" : [
               {
                  "id" : "bdfc4800.593338"
               }
            ],
            "y" : 40
         }
      ],
      "type" : "subflow",
      "out" : [
         {
            "y" : 120,
            "x" : 820,
            "wires" : [
               {
                  "port" : 0,
                  "id" : "516c338e.65601c"
               }
            ]
         },
         {
            "x" : 1240,
            "wires" : [
               {
                  "id" : "4fbed005.8d064",
                  "port" : 0
               }
            ],
            "y" : 40
         }
      ],
      "inputLabels" : [
         "Device tracker event"
      ],
      "name" : "Format payload and geozone logic"
   },
   {
      "out" : [
         {
            "x" : 1315.49995040894,
            "wires" : [
               {
                  "id" : "418d9d7f.f1b724",
                  "port" : 0
               }
            ],
            "y" : 438.714291572571
         },
         {
            "y" : 260,
            "wires" : [
               {
                  "port" : 1,
                  "id" : "53da29f5.9c6808"
               }
            ],
            "x" : 360
         }
      ],
      "outputLabels" : [
         "Speak, no guests, normal output",
         "No speaks, guest mode on, continue flow"
      ],
      "id" : "837bbace.420028",
      "type" : "subflow",
      "info" : "",
      "in" : [
         {
            "y" : 151.071425437927,
            "wires" : [
               {
                  "id" : "53da29f5.9c6808"
               }
            ],
            "x" : 34.9999961853027
         }
      ],
      "name" : "Voice Alerts"
   },
   {
      "id" : "63316ec5.c01aa",
      "out" : [
         {
            "y" : 320,
            "wires" : [
               {
                  "id" : "96f71b34.5ea358",
                  "port" : 0
               }
            ],
            "x" : 1560
         }
      ],
      "in" : [
         {
            "x" : 40,
            "wires" : [
               {
                  "id" : "fdcc21e8.0b72"
               }
            ],
            "y" : 60
         }
      ],
      "info" : "",
      "type" : "subflow",
      "name" : "Play theme song"
   },
   {
      "name" : "Stop if guest mode is on",
      "out" : [
         {
            "wires" : [
               {
                  "id" : "c61527c3.d75f98",
                  "port" : 1
               }
            ],
            "x" : 1080,
            "y" : 200
         }
      ],
      "id" : "3844d016.18a29",
      "type" : "subflow",
      "info" : "",
      "in" : [
         {
            "x" : 200,
            "wires" : [
               {
                  "id" : "702132b0.14facc"
               }
            ],
            "y" : 180
         }
      ]
   },
   {
      "in" : [
         {
            "wires" : [
               {
                  "id" : "5904fbc7.300974"
               }
            ],
            "x" : 80,
            "y" : 300
         }
      ],
      "info" : "",
      "type" : "subflow",
      "out" : [
         {
            "x" : 980,
            "wires" : [
               {
                  "id" : "2c2c6211.b4bd2e",
                  "port" : 1
               }
            ],
            "y" : 300
         }
      ],
      "id" : "2283eff7.ee9ab",
      "name" : "Stop if family is away"
   },
   {
      "name" : "Device offline for four hours",
      "in" : [
         {
            "y" : 720,
            "wires" : [
               {
                  "id" : "211c28b0.54bb88"
               }
            ],
            "x" : 200
         }
      ],
      "info" : "",
      "type" : "subflow",
      "id" : "10fa16ea.e265b9",
      "out" : []
   },
   {
      "name" : "ZWave Stats",
      "out" : [
         {
            "wires" : [
               {
                  "id" : "59f4f478.f3441c",
                  "port" : 0
               }
            ],
            "x" : 1040,
            "y" : 740
         }
      ],
      "id" : "e7369e7e.c4997",
      "in" : [
         {
            "y" : 720,
            "x" : 120,
            "wires" : [
               {
                  "id" : "e1f63ff3.8f1c2"
               }
            ]
         }
      ],
      "info" : "",
      "type" : "subflow"
   },
   {
      "info" : "",
      "in" : [
         {
            "y" : 260,
            "x" : 80,
            "wires" : [
               {
                  "id" : "9b844b56.2fdbb8"
               }
            ]
         }
      ],
      "type" : "subflow",
      "out" : [
         {
            "x" : 880,
            "wires" : [
               {
                  "id" : "15e8c84c.e7f1f8",
                  "port" : 0
               }
            ],
            "y" : 280
         }
      ],
      "id" : "451ca7d8.fa5568",
      "name" : "Stop if family is home"
   },
   {
      "name" : "Stop if guest mode or vacation mode is on",
      "info" : "",
      "in" : [
         {
            "wires" : [
               {
                  "id" : "38f48943.994b56"
               }
            ],
            "x" : 100,
            "y" : 220
         }
      ],
      "type" : "subflow",
      "out" : [
         {
            "wires" : [
               {
                  "port" : 1,
                  "id" : "91b3d307.2c4ad"
               }
            ],
            "x" : 1220,
            "y" : 280
         }
      ],
      "id" : "be9b5775.eaa798"
   },
   {
      "type" : "server",
      "id" : "e2a02faf.48099",
      "pass" : "your-api-password",
      "z" : "",
      "url" : "https://your-hostname.duckdns.org:8123",
      "name" : "Home Assistant"
   },
   {
      "type" : "mqtt-broker",
      "birthTopic" : "",
      "keepalive" : "60",
      "clientid" : "node-red",
      "cleansession" : true,
      "willTopic" : "",
      "willQos" : "0",
      "z" : "",
      "birthQos" : "0",
      "willPayload" : "",
      "compatmode" : false,
      "id" : "4238db6e.227ed4",
      "birthPayload" : "",
      "usetls" : false,
      "broker" : "localhost",
      "port" : "1883"
   },
   {
      "id" : "849977e5.257f68",
      "cert" : "",
      "z" : "",
      "verifyservercert" : false,
      "caname" : "",
      "type" : "tls-config",
      "ca" : "",
      "name" : "HASS-TLS",
      "certname" : "",
      "key" : "",
      "keyname" : ""
   },
   {
      "name" : "Home",
      "icon" : "dashboard",
      "order" : 2,
      "z" : "",
      "id" : "ac8be8.7ad34418",
      "type" : "ui_tab"
   },
   {
      "type" : "ui_group",
      "collapse" : false,
      "order" : 1,
      "tab" : "ac8be8.7ad34418",
      "name" : "Environmental",
      "id" : "ea10f06.a52e21",
      "width" : "6",
      "disp" : true,
      "z" : ""
   },
   {
      "type" : "ui_base",
      "id" : "baaae33d.2423a",
      "theme" : {
         "name" : "theme-dark",
         "customTheme" : {
            "name" : "Untitled Theme 1",
            "baseColor" : "#4B7930",
            "baseFont" : "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
            "default" : "#4B7930"
         },
         "lightTheme" : {
            "edited" : true,
            "reset" : false,
            "baseFont" : "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
            "default" : "#0094CE",
            "baseColor" : "#0094CE"
         },
         "darkTheme" : {
            "baseColor" : "#097479",
            "edited" : true,
            "reset" : false,
            "default" : "#097479",
            "baseFont" : "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
         },
         "themeState" : {
            "group-borderColor" : {
               "edited" : false,
               "value" : "#555555"
            },
            "base-font" : {
               "value" : "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "widget-borderColor" : {
               "value" : "#333333",
               "edited" : false
            },
            "page-backgroundColor" : {
               "value" : "#111111",
               "edited" : false
            },
            "page-titlebar-backgroundColor" : {
               "edited" : false,
               "value" : "#097479"
            },
            "group-backgroundColor" : {
               "edited" : false,
               "value" : "#333333"
            },
            "widget-textColor" : {
               "edited" : false,
               "value" : "#eeeeee"
            },
            "widget-backgroundColor" : {
               "value" : "#097479",
               "edited" : false
            },
            "group-textColor" : {
               "edited" : false,
               "value" : "#0eb8c0"
            },
            "page-sidebar-backgroundColor" : {
               "value" : "#000000",
               "edited" : false
            },
            "base-color" : {
               "default" : "#097479",
               "value" : "#097479",
               "edited" : false
            }
         }
      },
      "site" : {
         "dateFormat" : "DD/MM/YYYY",
         "allowSwipe" : "false",
         "sizes" : {
            "cx" : 6,
            "sy" : 96,
            "px" : 0,
            "sx" : 96,
            "py" : 0,
            "gx" : 6,
            "cy" : 6,
            "gy" : 6
         },
         "hideToolbar" : "true",
         "name" : "Home Assistant Graphs"
      }
   },
   {
      "z" : "",
      "disp" : true,
      "id" : "2a707ff1.43daa",
      "width" : "6",
      "collapse" : false,
      "name" : "Batteries",
      "tab" : "ac8be8.7ad34418",
      "order" : 3,
      "type" : "ui_group"
   },
   {
      "collapse" : false,
      "order" : 4,
      "tab" : "ac8be8.7ad34418",
      "name" : "Z-Wave",
      "type" : "ui_group",
      "z" : "",
      "id" : "ba683c3d.a294c",
      "width" : "6",
      "disp" : true
   },
   {
      "type" : "ui_group",
      "collapse" : false,
      "tab" : "ac8be8.7ad34418",
      "name" : "Thermostat",
      "order" : 2,
      "disp" : true,
      "id" : "3edec13b.9cc3ee",
      "width" : "6",
      "z" : ""
   },
   {
      "wires" : [
         [
            "3a8d7ef3.299a02"
         ]
      ],
      "x" : 130,
      "entityidfiltertype" : "exact",
      "z" : "8bb76918.ef6b48",
      "id" : "1a0e0be.bd5b6f4",
      "server" : "e2a02faf.48099",
      "name" : "Garage Entry Door South",
      "y" : 300,
      "entityidfilter" : "sensor.garage_entry_door_south_access_control",
      "haltifstate" : "",
      "type" : "server-state-changed"
   },
   {
      "propertyType" : "msg",
      "id" : "3a8d7ef3.299a02",
      "outputLabels" : [
         "Open",
         "Closed"
      ],
      "wires" : [
         [
            "bbd5969b.0b3d18",
            "39ebd578.aa60fa",
            "59d7405f.fa55b",
            "987a7121.805bf",
            "7efe7fd2.e123f"
         ],
         []
      ],
      "x" : 350,
      "z" : "8bb76918.ef6b48",
      "property" : "payload",
      "type" : "switch",
      "outputs" : 2,
      "rules" : [
         {
            "v" : "22",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "v" : "23",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "y" : 340,
      "checkall" : "true",
      "name" : "Door Open"
   },
   {
      "name" : "If Garage Stairs Motion not Detected",
      "halt_if" : "255",
      "y" : 280,
      "entity_id" : "sensor.garage_stairs_motion_sensor_alarm_level",
      "type" : "api-current-state",
      "wires" : [
         [
            "bf6901d7.16c1d"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 690,
      "id" : "39ebd578.aa60fa",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 440,
      "name" : "Main Level Lights on",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1060,
      "data" : "{ \"entity_id\": \"scene.main_level_lights\" }",
      "service" : "turn_on",
      "service_domain" : "scene",
      "id" : "b621c0a7.2c659",
      "server" : "e2a02faf.48099"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1030,
      "data" : "{ \"entity_id\": \"climate.hallway_nest\", \"temperature\": 72 }",
      "service" : "set_temperature",
      "service_domain" : "climate",
      "server" : "e2a02faf.48099",
      "id" : "bbe74c77.d0d3a",
      "y" : 320,
      "name" : "Turn on heat",
      "type" : "api-call-service"
   },
   {
      "name" : "Garage Entry Door North",
      "y" : 360,
      "haltifstate" : "",
      "entityidfilter" : "sensor.garage_entry_door_north_access_control",
      "type" : "server-state-changed",
      "entityidfiltertype" : "exact",
      "wires" : [
         [
            "3a8d7ef3.299a02"
         ]
      ],
      "x" : 130,
      "z" : "8bb76918.ef6b48",
      "id" : "f3d3eb4e.a4db78",
      "server" : "e2a02faf.48099"
   },
   {
      "x" : 110,
      "wires" : [
         [
            "7d00680.09c4698"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "entityidfiltertype" : "exact",
      "server" : "e2a02faf.48099",
      "id" : "9d716b1f.76be58",
      "name" : "Garage Door South",
      "y" : 440,
      "haltifstate" : "",
      "entityidfilter" : "sensor.garage_door_south_tilt_alarm_level",
      "type" : "server-state-changed"
   },
   {
      "entityidfiltertype" : "exact",
      "wires" : [
         [
            "7d00680.09c4698"
         ]
      ],
      "x" : 110,
      "z" : "8bb76918.ef6b48",
      "id" : "e4398abd.6c2ec8",
      "server" : "e2a02faf.48099",
      "name" : "Garage Door North",
      "haltifstate" : "",
      "y" : 500,
      "entityidfilter" : "sensor.garage_door_north_tilt_alarm_level",
      "type" : "server-state-changed"
   },
   {
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "id" : "7d00680.09c4698",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "8740e0c5.05e3f",
            "4aeea995.5b1608",
            "59d7405f.fa55b"
         ],
         [
            "4aeea995.5b1608"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 340,
      "outputs" : 2,
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "255"
         },
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "0"
         }
      ],
      "type" : "switch",
      "checkall" : "true",
      "name" : "Motion or Open ",
      "y" : 520
   },
   {
      "x" : 100,
      "wires" : [
         [
            "7d00680.09c4698"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "entityidfiltertype" : "exact",
      "id" : "7530c76d.e29608",
      "server" : "e2a02faf.48099",
      "haltifstate" : "",
      "y" : 560,
      "entityidfilter" : "sensor.garage_motion_sensor_alarm_level",
      "name" : "Garage Motion ",
      "type" : "server-state-changed"
   },
   {
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "8740e0c5.05e3f",
      "data" : "{ \"entity_id\":\"light.garage\"}",
      "service" : "turn_on",
      "x" : 1060,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "type" : "api-call-service",
      "name" : "Turn on garage lights",
      "y" : 640
   },
   {
      "x" : 540,
      "wires" : [
         [
            "8740e0c5.05e3f",
            "4aeea995.5b1608",
            "1eee1d2b.7e8613"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "server" : "e2a02faf.48099",
      "id" : "bbd5969b.0b3d18",
      "y" : 480,
      "halt_if" : "0",
      "name" : "If Garage Stairs Motion Detected",
      "type" : "api-current-state",
      "entity_id" : "sensor.garage_stairs_motion_sensor_alarm_level"
   },
   {
      "payloadtype" : "num",
      "type" : "stoptimer",
      "y" : 680,
      "name" : "10min",
      "payloadval" : "0",
      "id" : "4aeea995.5b1608",
      "x" : 770,
      "wires" : [
         [
            "ffbd0a93.915c18"
         ],
         []
      ],
      "z" : "8bb76918.ef6b48",
      "units" : "Minute",
      "duration" : "10"
   },
   {
      "service_domain" : "light",
      "id" : "ffbd0a93.915c18",
      "server" : "e2a02faf.48099",
      "service" : "turn_off",
      "data" : "{ \"entity_id\":\"light.garage\"}",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1060,
      "type" : "api-call-service",
      "name" : "Turn off garage lights",
      "y" : 680
   },
   {
      "payloadType" : "str",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "91165e1b.35eaa",
            "b01b30c3.7ec77",
            "ad516266.0ddec"
         ]
      ],
      "x" : 130,
      "id" : "146bfc92.3b9763",
      "once" : false,
      "topic" : "",
      "y" : 1100,
      "payload" : "7:15 on weekdays",
      "crontab" : "15 07 * * 1,2,3,4,5",
      "name" : "",
      "type" : "inject",
      "repeat" : ""
   },
   {
      "name" : "Turn on Coffee Grinder",
      "y" : 1100,
      "type" : "api-call-service",
      "service" : "turn_on",
      "data" : "{ \"entity_id\":\"switch.coffee_grinder_switch\" }",
      "x" : 760,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "bead0d7e.cf404",
      "service_domain" : "switch",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 1140,
      "name" : "65 seconds",
      "payloadtype" : "num",
      "type" : "stoptimer",
      "wires" : [
         [
            "124b1ca6.1bbc33",
            "ec29f7b8.4f4088"
         ],
         []
      ],
      "x" : 550,
      "units" : "Second",
      "duration" : "65",
      "z" : "8bb76918.ef6b48",
      "payloadval" : "0",
      "id" : "a71ae479.af01e8"
   },
   {
      "data" : "{ \"entity_id\":\"switch.coffee_grinder_switch\" }",
      "service" : "turn_off",
      "wires" : [
         []
      ],
      "x" : 760,
      "z" : "8bb76918.ef6b48",
      "server" : "e2a02faf.48099",
      "service_domain" : "switch",
      "id" : "124b1ca6.1bbc33",
      "name" : "Turn off Coffee Grinder",
      "y" : 1140,
      "type" : "api-call-service"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "scene",
      "id" : "ce8445.e7feabb8",
      "data" : "{ \"entity_id\": \"scene.main_level_lights\" }",
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1620,
      "type" : "api-call-service",
      "mergecontext" : "",
      "name" : "Main Level Lights on",
      "y" : 1100
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "40ea396b.d3d228",
      "x" : 110,
      "wires" : [
         [
            "91165e1b.35eaa"
         ]
      ],
      "entityidfiltertype" : "exact",
      "z" : "8bb76918.ef6b48",
      "type" : "server-state-changed",
      "name" : "Coffee Grinder on",
      "entityidfilter" : "switch.coffee_grinder_switch",
      "y" : 1180,
      "haltifstate" : "off"
   },
   {
      "type" : "server-state-changed",
      "name" : "Garage Stairs Motion ",
      "y" : 780,
      "entityidfilter" : "sensor.garage_stairs_motion_sensor_alarm_level",
      "haltifstate" : "",
      "id" : "db8011c6.b04b2",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "b30b715.575c99"
         ]
      ],
      "entityidfiltertype" : "exact",
      "x" : 120,
      "z" : "8bb76918.ef6b48"
   },
   {
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "255"
         },
         {
            "v" : "0",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "outputs" : 2,
      "type" : "switch",
      "checkall" : "true",
      "name" : "Motion",
      "y" : 780,
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "id" : "b30b715.575c99",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "b1f458eb.3dd1c8",
            "1d3c0969.8169d7",
            "a93cf8a2.ddae58"
         ],
         [
            "b1f458eb.3dd1c8"
         ]
      ],
      "x" : 340,
      "z" : "8bb76918.ef6b48"
   },
   {
      "name" : "10min",
      "y" : 860,
      "payloadtype" : "num",
      "type" : "stoptimer",
      "units" : "Minute",
      "wires" : [
         [
            "5e29a7d9.981a38",
            "67dc5799.2aa338"
         ],
         []
      ],
      "x" : 590,
      "z" : "8bb76918.ef6b48",
      "duration" : "10",
      "id" : "b1f458eb.3dd1c8",
      "payloadval" : "0"
   },
   {
      "name" : "Turn on stairs lights",
      "mergecontext" : "",
      "y" : 820,
      "type" : "api-call-service",
      "data" : "{ \"entity_id\":\"light.stairs\"}",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "x" : 970,
      "z" : "8bb76918.ef6b48",
      "service_domain" : "light",
      "id" : "1d3c0969.8169d7",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "api-call-service",
      "y" : 860,
      "name" : "Turn off stairs lights",
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "5e29a7d9.981a38",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 970,
      "data" : "{ \"entity_id\":\"light.stairs\"}",
      "service" : "turn_off"
   },
   {
      "y" : 780,
      "name" : "Turn on basement lights",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "x" : 990,
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "data" : "{ \"entity_id\":\"light.basement\"}",
      "service_domain" : "light",
      "id" : "76acb4c6.9160dc",
      "server" : "e2a02faf.48099"
   },
   {
      "data" : "{ \"entity_id\":\"light.basement\"}",
      "service" : "turn_off",
      "x" : 990,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "1bb8b0a0.e9c35f",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "name" : "Turn off basement lights",
      "y" : 900,
      "type" : "api-call-service"
   },
   {
      "data" : "{ \"entity_id\":\"light.basement\"}",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1070,
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "7efe7fd2.e123f",
      "name" : "Turn on basement lights",
      "y" : 520,
      "type" : "api-call-service"
   },
   {
      "wires" : [
         [
            "79aef37.ba4700c"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 130,
      "id" : "cf5d9bba.b5f088",
      "server" : "e2a02faf.48099",
      "y" : 2220,
      "name" : "Internet Connection Off",
      "halt_if" : "on",
      "type" : "api-current-state",
      "entity_id" : "binary_sensor.wan"
   },
   {
      "data" : "{ \"entity_id\":\"switch.network_gear_switch\" }",
      "service" : "turn_off",
      "x" : 860,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "server" : "e2a02faf.48099",
      "service_domain" : "switch",
      "id" : "c1d6a8c7.4cab18",
      "name" : "Turn off network gear",
      "y" : 2220,
      "type" : "api-call-service"
   },
   {
      "y" : 2300,
      "name" : "Turn on network gear",
      "type" : "api-call-service",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1040,
      "data" : "{ \"entity_id\":\"switch.network_gear_switch\" }",
      "service" : "turn_on",
      "service_domain" : "switch",
      "id" : "25068d9f.cc5212",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [
         [
            "c1d6a8c7.4cab18",
            "682c9d9d.1eb284",
            "10fc5f28.e36c81"
         ],
         []
      ],
      "duration" : "5",
      "x" : 620,
      "units" : "Minute",
      "z" : "8bb76918.ef6b48",
      "payloadval" : "0",
      "id" : "f22628cc.ac40d8",
      "y" : 2220,
      "name" : "5 minutes",
      "payloadtype" : "num",
      "type" : "stoptimer"
   },
   {
      "name" : "Internet Connection On",
      "halt_if" : "off",
      "y" : 2260,
      "type" : "api-current-state",
      "entity_id" : "binary_sensor.wan",
      "x" : 130,
      "wires" : [
         [
            "b718ffe5.e62ed"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "9853f453.50be08",
      "server" : "e2a02faf.48099"
   },
   {
      "from" : "",
      "id" : "b718ffe5.e62ed",
      "to" : "",
      "x" : 450,
      "wires" : [
         [
            "f22628cc.ac40d8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "property" : "",
      "action" : "",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "str",
            "pt" : "msg",
            "to" : "STOP",
            "p" : "payload"
         }
      ],
      "y" : 2260,
      "name" : "Stop timer",
      "reg" : false
   },
   {
      "extend" : false,
      "x" : 840,
      "wires" : [
         [
            "25068d9f.cc5212"
         ]
      ],
      "duration" : "1",
      "units" : "min",
      "z" : "8bb76918.ef6b48",
      "id" : "682c9d9d.1eb284",
      "op2type" : "str",
      "reset" : "",
      "name" : "Wait one minute",
      "op1" : "1",
      "op1type" : "str",
      "y" : 2300,
      "type" : "trigger",
      "op2" : "0"
   },
   {
      "id" : "3941333.1bea2cc",
      "server" : "e2a02faf.48099",
      "entityidfiltertype" : "exact",
      "wires" : [
         [
            "225ea6ad.d070aa"
         ]
      ],
      "x" : 90,
      "z" : "8bb76918.ef6b48",
      "type" : "server-state-changed",
      "name" : "Family Home",
      "y" : 100,
      "haltifstate" : "",
      "entityidfilter" : "group.family"
   },
   {
      "y" : 240,
      "name" : "Turn on humidifiers",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1050,
      "data" : "{ \"entity_id\":\"group.humidifiers\"}",
      "service" : "turn_on",
      "service_domain" : "switch",
      "id" : "13058d3c.4a1843",
      "server" : "e2a02faf.48099"
   },
   {
      "info" : "",
      "id" : "fe6e17d.7399ee8",
      "x" : 190,
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "type" : "comment",
      "y" : 2180,
      "name" : "Reboot network gear if the internet goes down"
   },
   {
      "y" : 960,
      "name" : "Turn on the main level lights and grind coffee on work days",
      "type" : "comment",
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "x" : 230,
      "info" : "",
      "id" : "26bb4b56.bc97c4"
   },
   {
      "type" : "comment",
      "name" : "Setup the house when we come through the garage or get marked as home",
      "y" : 40,
      "id" : "45612f2e.90bd4",
      "info" : "",
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "x" : 290
   },
   {
      "x" : 260,
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "id" : "96646703.d7b4e8",
      "info" : "",
      "name" : "Turn on garage stair lights and basement when motion is detected",
      "y" : 740,
      "type" : "comment"
   },
   {
      "x" : 130,
      "wires" : [
         [
            "f4fbb4a2.6646c8",
            "788e2d3e.b185a4"
         ]
      ],
      "entityidfiltertype" : "exact",
      "z" : "46ed0d55.4c98b4",
      "id" : "6334923.fe4cb6c",
      "server" : "e2a02faf.48099",
      "name" : "Wifes Location Changed",
      "y" : 80,
      "haltifstate" : "",
      "entityidfilter" : "device_tracker.wifes_iphone",
      "type" : "server-state-changed"
   },
   {
      "type" : "api-call-service",
      "y" : 220,
      "name" : "Notify Walt",
      "id" : "3a53eed2.e0e1f2",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "x" : 1510,
      "z" : "46ed0d55.4c98b4",
      "data" : "{ \"message\":\"msg\"}",
      "service" : "ios_walts_iphone"
   },
   {
      "wires" : [],
      "x" : 200,
      "z" : "8bb76918.ef6b48",
      "id" : "c2c0219.fb1f7e",
      "info" : "",
      "name" : "Turn down heat and lights off when we are away",
      "y" : 2380,
      "type" : "comment"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "4873ca94.1b2854"
         ]
      ],
      "x" : 90,
      "entityidfiltertype" : "exact",
      "id" : "60513f16.1f5fa",
      "server" : "e2a02faf.48099",
      "name" : "Family Status",
      "y" : 2420,
      "entityidfilter" : "group.family",
      "haltifstate" : "",
      "type" : "server-state-changed"
   },
   {
      "name" : "Notify Walt",
      "y" : 2460,
      "type" : "api-call-service",
      "data" : "{ \"message\": \"Nobody home, turning down heat and lights off\" }",
      "service" : "ios_walts_iphone",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1210,
      "service_domain" : "notify",
      "id" : "675ad3ec.c9f2ac",
      "server" : "e2a02faf.48099"
   },
   {
      "data" : "{ \"entity_id\": \"climate.hallway_nest\", \"temperature\": 67 }",
      "service" : "set_temperature",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1220,
      "service_domain" : "climate",
      "server" : "e2a02faf.48099",
      "id" : "e5bfca9b.0f87d8",
      "name" : "Turn down heat",
      "y" : 2500,
      "type" : "api-call-service"
   },
   {
      "y" : 2540,
      "name" : "Turn off all lights",
      "type" : "api-call-service",
      "x" : 1220,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"entity_id\":\"group.all_lights\"}",
      "service" : "turn_off",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "66765f49.da2d4"
   },
   {
      "name" : "Turn off humidifiers",
      "y" : 2580,
      "type" : "api-call-service",
      "service" : "turn_off",
      "data" : "{ \"entity_id\":\"group.humidifiers\"}",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1230,
      "service_domain" : "switch",
      "id" : "9c7dd40f.bd1fe8",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "150c6f5d.e6ca51",
      "wires" : [
         [
            "91468204.28d44",
            "788e2d3e.b185a4"
         ]
      ],
      "x" : 130,
      "entityidfiltertype" : "exact",
      "z" : "46ed0d55.4c98b4",
      "type" : "server-state-changed",
      "name" : "Walts Location Changed",
      "y" : 160,
      "haltifstate" : "",
      "entityidfilter" : "device_tracker.walts_iphone"
   },
   {
      "type" : "server-state-changed",
      "entityidfilter" : "sensor.stairs_door_access_control",
      "y" : 820,
      "haltifstate" : "",
      "name" : "Garage Stairs Door",
      "id" : "39ba4084.595b4",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "c131478b.afbc58"
         ]
      ],
      "x" : 110,
      "z" : "8bb76918.ef6b48",
      "entityidfiltertype" : "exact"
   },
   {
      "checkall" : "true",
      "name" : "Door Open Or Closed",
      "y" : 840,
      "rules" : [
         {
            "v" : "22",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "23"
         }
      ],
      "outputs" : 2,
      "type" : "switch",
      "property" : "payload",
      "wires" : [
         [
            "1d3c0969.8169d7",
            "b1f458eb.3dd1c8",
            "a93cf8a2.ddae58"
         ],
         [
            "b1f458eb.3dd1c8"
         ]
      ],
      "x" : 340,
      "z" : "8bb76918.ef6b48",
      "outputLabels" : [
         "Open",
         "Closed"
      ],
      "id" : "c131478b.afbc58",
      "propertyType" : "msg"
   },
   {
      "info" : "",
      "id" : "c8335c96.7174b",
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "x" : 150,
      "type" : "comment",
      "y" : 1240,
      "name" : "Fade on the lights on work days"
   },
   {
      "once" : false,
      "id" : "6c027bc7.81fd34",
      "x" : 130,
      "wires" : [
         [
            "7638c76a.be3b08"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "payloadType" : "str",
      "repeat" : "",
      "type" : "inject",
      "name" : "",
      "crontab" : "50 06 * * 1,2,3,4,5",
      "payload" : "6:50 on weekdays",
      "y" : 1280,
      "topic" : ""
   },
   {
      "type" : "api-call-service",
      "y" : 1320,
      "mergecontext" : "",
      "name" : "Turn on Son1s lamp at 1%",
      "id" : "4321f595.99043c",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "x" : 1380,
      "wires" : [
         [
            "b2e1971a.100438"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"brightness\":\"1\", \"color_temp\":\"236\"}",
      "service" : "turn_on"
   },
   {
      "type" : "trigger",
      "op2" : "0",
      "bytopic" : "all",
      "op2type" : "str",
      "extend" : false,
      "units" : "s",
      "z" : "8bb76918.ef6b48",
      "duration" : "30",
      "wires" : [
         [
            "1607ea57.3a5706"
         ]
      ],
      "name" : "Wait thirty seconds",
      "op1type" : "str",
      "op1" : "1",
      "y" : 1360,
      "id" : "ce971dc7.47848",
      "reset" : "",
      "x" : 1350
   },
   {
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "1607ea57.3a5706",
      "x" : 1540,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"transition\":\"600\",\"brightness\":\"255\", \"color_temp\":\"236\"}",
      "service" : "turn_on",
      "type" : "api-call-service",
      "y" : 1360,
      "mergecontext" : "",
      "name" : "Start 10 minute fade in for Son1's lamp"
   },
   {
      "randomFirst" : "1",
      "wires" : [
         [
            "a71ae479.af01e8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "rate" : "1",
      "nbRateUnits" : "30",
      "drop" : true,
      "timeoutUnits" : "seconds",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "x" : 380,
      "timeout" : "5",
      "id" : "91165e1b.35eaa",
      "y" : 1140,
      "name" : "",
      "pauseType" : "rate",
      "rateUnits" : "second"
   },
   {
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "x" : 380,
      "data" : "{ \"message\":\"request_location_update\"}",
      "service" : "ios_walts_iphone",
      "id" : "f4fbb4a2.6646c8",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "y" : 80,
      "name" : "Update Walts location",
      "type" : "api-call-service"
   },
   {
      "data" : "{ \"message\":\"request_location_update\"}",
      "service" : "ios_wifes_iphone",
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "x" : 410,
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "91468204.28d44",
      "name" : "Update Wifes location",
      "y" : 160,
      "type" : "api-call-service"
   },
   {
      "type" : "api-call-service",
      "y" : 560,
      "name" : "Turn on stairs lights",
      "id" : "59d7405f.fa55b",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1050,
      "data" : "{ \"entity_id\":\"light.stairs\"}",
      "service" : "turn_on"
   },
   {
      "info" : "",
      "id" : "d76067c.1179398",
      "wires" : [],
      "z" : "46ed0d55.4c98b4",
      "x" : 100,
      "type" : "comment",
      "y" : 40,
      "name" : "Location tracking"
   },
   {
      "id" : "ad07ccbe.d3089",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "c283c7e3.723f48"
         ]
      ],
      "entityidfiltertype" : "substring",
      "x" : 130,
      "z" : "20661f8a.532c4",
      "type" : "server-state-changed",
      "name" : "Guests on WiFi Network",
      "entityidfilter" : "group.guests",
      "y" : 80,
      "haltifstate" : "not_home"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "x" : 980,
      "data" : "{ \"entity_id\": \"input_boolean.guest_mode\"}",
      "service" : "turn_on",
      "id" : "757b73dc.a14b5c",
      "service_domain" : "input_boolean",
      "server" : "e2a02faf.48099",
      "y" : 80,
      "name" : "Turn on guest mode",
      "type" : "api-call-service"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "e53093b7.f93ed",
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "x" : 950,
      "data" : "{ \"message\": \"Guest Home while family is away\" }",
      "service" : "ios_walts_iphone",
      "type" : "api-call-service",
      "y" : 120,
      "name" : "Notify Walt"
   },
   {
      "repeat" : "",
      "type" : "inject",
      "name" : "",
      "crontab" : "00 22 * * *",
      "topic" : "",
      "y" : 160,
      "payload" : "10:00PM",
      "once" : false,
      "id" : "54c0e6b3.abfcd8",
      "payloadType" : "str",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "f59cfbf.f051108"
         ]
      ],
      "x" : 110
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "f59cfbf.f051108",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "79371887.3b47a8"
         ]
      ],
      "x" : 350,
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state",
      "y" : 160,
      "name" : "If Guest Mode On",
      "halt_if" : "off"
   },
   {
      "type" : "api-call-service",
      "y" : 160,
      "name" : "Notify Walt",
      "service_domain" : "notify",
      "id" : "79371887.3b47a8",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "x" : 950,
      "data" : "{ \"message\": \"Guest mode will remain enabled until manually turned off\" }",
      "service" : "ios_walts_iphone"
   },
   {
      "wires" : [],
      "x" : 130,
      "z" : "20661f8a.532c4",
      "id" : "963d39c2.10c038",
      "info" : "",
      "name" : "Guest mode management",
      "y" : 40,
      "type" : "comment"
   },
   {
      "x" : 730,
      "wires" : [
         [
            "e53093b7.f93ed"
         ]
      ],
      "z" : "20661f8a.532c4",
      "id" : "f2aab9d0.42f8a8",
      "server" : "e2a02faf.48099",
      "y" : 120,
      "halt_if" : "home",
      "name" : "If Family Not Home",
      "type" : "api-current-state",
      "entity_id" : "group.family"
   },
   {
      "info" : "",
      "id" : "90f77d40.3903b",
      "wires" : [],
      "x" : 130,
      "z" : "20661f8a.532c4",
      "type" : "comment",
      "y" : 220,
      "name" : "Battery checks for sensors"
   },
   {
      "id" : "fee1fc92.269e3",
      "server" : "e2a02faf.48099",
      "x" : 140,
      "wires" : [
         [
            "5cce42bc.9494dc"
         ]
      ],
      "z" : "20661f8a.532c4",
      "type" : "server-state-changed",
      "name" : "Battery Status of all sensors",
      "haltifstate" : "",
      "y" : 260,
      "entityidfilter" : "sensor.battery_status"
   },
   {
      "id" : "3fc03062.fc3f1",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "service" : "ios_walts_iphone",
      "data" : "{ \"message\": \"Guest Home while family is away\" }",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "x" : 950,
      "type" : "api-call-service",
      "name" : "Notify Walt",
      "y" : 260
   },
   {
      "func" : "msg.payload = { data: {'message': 'Check battery ' + msg.payload } };\nreturn msg;",
      "wires" : [
         [
            "3fc03062.fc3f1"
         ]
      ],
      "noerr" : 0,
      "x" : 610,
      "z" : "20661f8a.532c4",
      "id" : "5cce42bc.9494dc",
      "name" : "Format battery message",
      "y" : 260,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "id" : "e23ad481.fbf788",
      "once" : false,
      "wires" : [
         [
            "2b751637.8120da"
         ]
      ],
      "x" : 110,
      "z" : "20661f8a.532c4",
      "payloadType" : "date",
      "repeat" : "",
      "type" : "inject",
      "crontab" : "0 0-23 * * *",
      "name" : "On the hour",
      "payload" : "",
      "y" : 360,
      "topic" : ""
   },
   {
      "data" : "{ }",
      "service" : "query_cableone_data_usage",
      "wires" : [
         []
      ],
      "x" : 1000,
      "z" : "20661f8a.532c4",
      "id" : "2b751637.8120da",
      "service_domain" : "shell_command",
      "server" : "e2a02faf.48099",
      "name" : "Query CableONE data usage",
      "mergecontext" : "",
      "y" : 360,
      "type" : "api-call-service"
   },
   {
      "wires" : [],
      "x" : 160,
      "z" : "20661f8a.532c4",
      "id" : "389de39c.59885c",
      "info" : "",
      "name" : "Query CableONE Data Cap Usage",
      "y" : 320,
      "type" : "comment"
   },
   {
      "broker" : "4238db6e.227ed4",
      "x" : 110,
      "wires" : [
         [
            "7e030515.6e8c9c"
         ]
      ],
      "z" : "20661f8a.532c4",
      "id" : "6b60a3bf.63e32c",
      "qos" : "1",
      "name" : "All MQTT Messages",
      "topic" : "#",
      "y" : 580,
      "type" : "mqtt in"
   },
   {
      "wires" : [
         [
            "cdbb849e.19b978"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 400,
      "noerr" : 0,
      "func" : "tele_check = /^tele/;\npower_check = /POWER/g;\n\nif (tele_check.test(msg.topic) && power_check.test(msg.payload)) {\n    new_payload     = msg.payload.replace(/.*POWER..\\\"([A-Z]+)\\\".*/, '$1');\n    msg.payload     = new_payload;\n\n    new_topic       = msg.topic.replace(/(\\w+).(\\w+).(\\w+)/, 'stat/$2/POWER');\n    msg.topic       = new_topic;\n    \n    msg.altered     = 1;\n}\n\nreturn msg;",
      "id" : "7e030515.6e8c9c",
      "y" : 580,
      "name" : "Reformat telemetry to state",
      "type" : "function",
      "outputs" : 1
   },
   {
      "propertyType" : "msg",
      "id" : "cdbb849e.19b978",
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "x" : 690,
      "z" : "20661f8a.532c4",
      "property" : "altered",
      "type" : "switch",
      "rules" : [
         {
            "v" : "1",
            "t" : "eq",
            "vt" : "num"
         }
      ],
      "outputs" : 1,
      "y" : 580,
      "name" : "If message reformatted",
      "checkall" : "true"
   },
   {
      "name" : "Front Door",
      "y" : 200,
      "entityidfilter" : "sensor.front_door_access_control",
      "haltifstate" : "",
      "type" : "server-state-changed",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "x" : 80,
      "id" : "7048c9bb.ae4a88",
      "server" : "e2a02faf.48099"
   },
   {
      "entityidfiltertype" : "substring",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "x" : 120,
      "z" : "af1cc9bd.91cc08",
      "server" : "e2a02faf.48099",
      "id" : "fbdea74.98dba58",
      "entityidfilter" : "sensor.basement_back_door_access_control",
      "y" : 260,
      "haltifstate" : "",
      "name" : "Basement Back Door",
      "type" : "server-state-changed"
   },
   {
      "type" : "server-state-changed",
      "name" : "Screened Porch Door",
      "y" : 320,
      "haltifstate" : "",
      "entityidfilter" : "sensor.screened_porch_door_access_control",
      "id" : "2b44a923.01bb36",
      "server" : "e2a02faf.48099",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "x" : 120
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "485b946f.1e2f3c",
      "x" : 130,
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "type" : "server-state-changed",
      "name" : "Garage Entry Door South",
      "y" : 380,
      "entityidfilter" : "sensor.garage_entry_door_south_access_control",
      "haltifstate" : ""
   },
   {
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "x" : 130,
      "server" : "e2a02faf.48099",
      "id" : "4f2dcef4.36e7",
      "name" : "Garage Entry Door North",
      "y" : 440,
      "entityidfilter" : "sensor.garage_entry_door_north_access_control",
      "haltifstate" : "",
      "type" : "server-state-changed"
   },
   {
      "y" : 500,
      "entityidfilter" : "sensor.stairs_door_access_control",
      "haltifstate" : "",
      "name" : "Garage Stairs Door",
      "type" : "server-state-changed",
      "wires" : [
         [
            "ed027925.58a1f8"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 110,
      "id" : "d55c9490.ae4028",
      "server" : "e2a02faf.48099"
   },
   {
      "propertyType" : "msg",
      "outputLabels" : [
         "Open",
         "Closed"
      ],
      "id" : "ed027925.58a1f8",
      "wires" : [
         [
            "62c7725c.883fcc"
         ],
         [
            "62c7725c.883fcc"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 480,
      "property" : "payload",
      "type" : "switch",
      "rules" : [
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "22"
         },
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "23"
         }
      ],
      "outputs" : 2,
      "y" : 280,
      "checkall" : "true",
      "name" : "Doors Open or Closed"
   },
   {
      "wires" : [
         [
            "806fa6b.8209558"
         ]
      ],
      "entityidfiltertype" : "substring",
      "x" : 100,
      "z" : "af1cc9bd.91cc08",
      "server" : "e2a02faf.48099",
      "id" : "1537323c.cb698e",
      "haltifstate" : "",
      "y" : 140,
      "entityidfilter" : "sensor.garage_motion_sensor_alarm_level",
      "name" : "Garage Motion ",
      "type" : "server-state-changed"
   },
   {
      "type" : "server-state-changed",
      "y" : 80,
      "haltifstate" : "",
      "entityidfilter" : "sensor.garage_stairs_motion_sensor_alarm_level",
      "name" : "Garage Stairs Motion ",
      "server" : "e2a02faf.48099",
      "id" : "b6f8910d.0609f",
      "x" : 120,
      "wires" : [
         [
            "aae0381e.3331d8"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "entityidfiltertype" : "substring"
   },
   {
      "checkall" : "true",
      "name" : "Motion",
      "y" : 80,
      "outputs" : 2,
      "rules" : [
         {
            "v" : "255",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "0"
         }
      ],
      "type" : "switch",
      "property" : "payload",
      "wires" : [
         [
            "62c7725c.883fcc"
         ],
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 480,
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "id" : "aae0381e.3331d8",
      "propertyType" : "msg"
   },
   {
      "y" : 40,
      "name" : "Alerts if motion or doors move when we are not home",
      "type" : "comment",
      "x" : 220,
      "wires" : [],
      "z" : "af1cc9bd.91cc08",
      "info" : "",
      "id" : "9f775522.889818"
   },
   {
      "x" : 150,
      "wires" : [],
      "z" : "af1cc9bd.91cc08",
      "id" : "80e2c411.0090f8",
      "info" : "",
      "name" : "Alert if doors are open too long",
      "y" : 560,
      "type" : "comment"
   },
   {
      "duration" : "15",
      "wires" : [
         [
            "d2624da.51817b"
         ],
         []
      ],
      "x" : 1030,
      "units" : "Minute",
      "z" : "af1cc9bd.91cc08",
      "payloadval" : "0",
      "id" : "5e54acc4.be8764",
      "y" : 680,
      "name" : "15 minutes",
      "payloadtype" : "num",
      "type" : "stoptimer"
   },
   {
      "wires" : [
         [
            "5e54acc4.be8764"
         ]
      ],
      "x" : 690,
      "z" : "af1cc9bd.91cc08",
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "5d71175.ba67de8",
      "y" : 800,
      "reg" : false,
      "name" : "Stop timer",
      "type" : "change",
      "rules" : [
         {
            "pt" : "msg",
            "to" : "STOP",
            "p" : "payload",
            "tot" : "str",
            "t" : "set"
         }
      ]
   },
   {
      "type" : "api-call-service",
      "name" : "Notify Family",
      "y" : 760,
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "id" : "848e6e46.320ba",
      "service" : "family_iphones",
      "data" : "{ \"message\": \"msg\" }",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         []
      ],
      "x" : 1030
   },
   {
      "x" : 80,
      "wires" : [
         [
            "1523c8b7.aeee17"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "id" : "498e7861.71c078",
      "server" : "e2a02faf.48099",
      "entityidfilter" : "sensor.front_door_access_control",
      "y" : 600,
      "haltifstate" : "",
      "name" : "Front Door",
      "type" : "server-state-changed"
   },
   {
      "name" : "Basement Back Door",
      "entityidfilter" : "sensor.basement_back_door_access_control",
      "y" : 660,
      "haltifstate" : "",
      "type" : "server-state-changed",
      "x" : 120,
      "wires" : [
         [
            "1523c8b7.aeee17"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "id" : "d41be6a.29d7018",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [
         [
            "1523c8b7.aeee17"
         ]
      ],
      "x" : 120,
      "z" : "af1cc9bd.91cc08",
      "server" : "e2a02faf.48099",
      "id" : "84b50263.7170f",
      "name" : "Screened Porch Door",
      "haltifstate" : "",
      "y" : 720,
      "entityidfilter" : "sensor.screened_porch_door_access_control",
      "type" : "server-state-changed"
   },
   {
      "outputs" : 2,
      "rules" : [
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "22"
         },
         {
            "v" : "23",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "type" : "switch",
      "name" : "Door Open Or Closed",
      "checkall" : "true",
      "y" : 640,
      "outputLabels" : [
         "Open",
         "Closed"
      ],
      "id" : "1523c8b7.aeee17",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "5571cb3c.251cd4",
            "7c9a4d6b.764174"
         ],
         [
            "5d71175.ba67de8"
         ]
      ],
      "x" : 380,
      "z" : "af1cc9bd.91cc08"
   },
   {
      "entityidfiltertype" : "substring",
      "wires" : [
         [
            "e65236da.3530a8"
         ]
      ],
      "x" : 110,
      "z" : "af1cc9bd.91cc08",
      "server" : "e2a02faf.48099",
      "id" : "3bca974f.3b27c8",
      "name" : "Garage Door South",
      "y" : 780,
      "haltifstate" : "",
      "entityidfilter" : "sensor.garage_door_south_tilt_alarm_level",
      "type" : "server-state-changed"
   },
   {
      "wires" : [
         [
            "e65236da.3530a8"
         ]
      ],
      "x" : 110,
      "z" : "af1cc9bd.91cc08",
      "id" : "793a4734.9d54b8",
      "server" : "e2a02faf.48099",
      "name" : "Garage Door North",
      "entityidfilter" : "sensor.garage_door_north_tilt_alarm_level",
      "y" : 840,
      "haltifstate" : "",
      "type" : "server-state-changed"
   },
   {
      "outputs" : 2,
      "rules" : [
         {
            "v" : "255",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "v" : "0",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "repair" : false,
      "type" : "switch",
      "checkall" : "true",
      "name" : "Garage Door Open Or Closed",
      "y" : 800,
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "id" : "e65236da.3530a8",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "5571cb3c.251cd4"
         ],
         [
            "5d71175.ba67de8"
         ]
      ],
      "x" : 410,
      "z" : "af1cc9bd.91cc08"
   },
   {
      "y" : 720,
      "name" : "Format message",
      "type" : "function",
      "outputs" : 1,
      "wires" : [
         [
            "848e6e46.320ba",
            "e91e1174.d8ddc"
         ]
      ],
      "x" : 1050,
      "z" : "af1cc9bd.91cc08",
      "noerr" : 0,
      "func" : "door        = msg.topic.replace(/^.*\\.(.*)_(access|alarm).*/, '$1');\ndoor        = door.replace(/_/g, ' ');\nmsg.payload = { data: {'message': door + ' has been open over 15 minutes' } };\n\nreturn msg;",
      "id" : "d2624da.51817b"
   },
   {
      "halt_if" : "0",
      "name" : "If Garage Motion Detected",
      "y" : 100,
      "entity_id" : "sensor.garage_motion_sensor_alarm_level",
      "type" : "api-current-state",
      "wires" : [
         [
            "56e5a29c.1d958c"
         ]
      ],
      "x" : 640,
      "z" : "8bb76918.ef6b48",
      "server" : "e2a02faf.48099",
      "id" : "987a7121.805bf"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "group.family",
      "y" : 140,
      "name" : "If Family Not Home",
      "halt_if" : "home",
      "id" : "56e5a29c.1d958c",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "7c8a5c3d.31e5d4"
         ]
      ],
      "x" : 610,
      "z" : "8bb76918.ef6b48"
   },
   {
      "name" : "Turn on master bedroom",
      "y" : 120,
      "type" : "api-call-service",
      "data" : "{ \"entity_id\":\"light.master_bedroom\"}",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "x" : 1070,
      "z" : "8bb76918.ef6b48",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "6dbf538f.d536cc"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1070,
      "data" : "{ \"entity_id\":\"light.sengled_e11g13_030b05a4_1\"}",
      "service" : "turn_on",
      "id" : "e295d74a.c6f488",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "y" : 80,
      "name" : "Turn on upstairs landing",
      "type" : "api-call-service"
   },
   {
      "y" : 160,
      "name" : "Turn on Son1's Lamp",
      "type" : "api-call-service",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1070,
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\"}",
      "service" : "turn_on",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "3d015f18.990dd"
   },
   {
      "x" : 1060,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"entity_id\":\"light.colins_lamp\"}",
      "service" : "turn_on",
      "service_domain" : "light",
      "id" : "62f28eac.1bcf4",
      "server" : "e2a02faf.48099",
      "y" : 200,
      "name" : "Turn on Son2's Lamp",
      "type" : "api-call-service"
   },
   {
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "8e9cdb7d.9f1268"
         ]
      ],
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "nbRateUnits" : "30",
      "id" : "2b9c3b21.c9bee4",
      "x" : 600,
      "timeout" : "5",
      "pauseType" : "rate",
      "rateUnits" : "minute",
      "y" : 220,
      "name" : ""
   },
   {
      "type" : "comment",
      "name" : "Upstairs",
      "y" : 40,
      "id" : "6fec6164.86ae9",
      "info" : "",
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "x" : 1020
   },
   {
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "x" : 1020,
      "id" : "a673cf79.c8467",
      "info" : "",
      "name" : "Main Level",
      "y" : 360,
      "type" : "comment"
   },
   {
      "y" : 480,
      "name" : "Basement and garage",
      "type" : "comment",
      "wires" : [],
      "x" : 1060,
      "z" : "8bb76918.ef6b48",
      "info" : "",
      "id" : "7aa9e081.06fd1"
   },
   {
      "name" : "Update Walts location",
      "y" : 80,
      "type" : "api-call-service",
      "data" : "{ \"message\":\"request_location_update\"}",
      "service" : "ios_walts_iphone",
      "x" : 1260,
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "service_domain" : "notify",
      "id" : "b58f2da5.6fc3e",
      "server" : "e2a02faf.48099"
   },
   {
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "id" : "555e84d9.56d97c",
      "data" : "{ \"message\":\"request_location_update\"}",
      "service" : "ios_wifes_iphone",
      "wires" : [
         []
      ],
      "x" : 1270,
      "z" : "af1cc9bd.91cc08",
      "type" : "api-call-service",
      "name" : "Update Wifes location",
      "y" : 120
   },
   {
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "drop" : false,
      "nbRateUnits" : "1",
      "timeoutUnits" : "minutes",
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "b3cae960.eb0e38"
         ]
      ],
      "pauseType" : "delay",
      "rateUnits" : "second",
      "y" : 140,
      "name" : "3 minute delay for location update",
      "id" : "c2286c26.27939",
      "x" : 800,
      "timeout" : "3"
   },
   {
      "id" : "ee75ae12.67511",
      "func" : "door        = msg.topic.replace(/^.*\\.(.*)_(access|alarm).*/, '$1');\ndoor        = door.replace(/_/g, ' ');\nmsg.payload = { data: {'message': door + ' opened three minutes ago while family was out' } };\n\nreturn msg;",
      "noerr" : 0,
      "wires" : [
         [
            "43df1ee7.8196"
         ]
      ],
      "x" : 990,
      "z" : "af1cc9bd.91cc08",
      "outputs" : 1,
      "type" : "function",
      "name" : "Format message",
      "y" : 280
   },
   {
      "id" : "a13e1986.19edf8",
      "box" : "OptionC",
      "server" : "imap.email.com",
      "useSSL" : true,
      "protocol" : "IMAP",
      "disposition" : "None",
      "wires" : [
         [
            "df1ac37.1976c4"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 70,
      "port" : "993",
      "repeat" : "300",
      "type" : "e-mail in",
      "name" : "",
      "y" : 680
   },
   {
      "wires" : [
         [
            "532a6fa1.bf616"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 260,
      "property" : "from",
      "propertyType" : "msg",
      "id" : "df1ac37.1976c4",
      "y" : 680,
      "checkall" : "true",
      "name" : "From Mary Immaculate",
      "type" : "switch",
      "outputs" : 1,
      "rules" : [
         {
            "vt" : "str",
            "t" : "cont",
            "v" : "optioncalerts.com"
         }
      ]
   },
   {
      "id" : "532a6fa1.bf616",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "55b89320.b29b5c",
            "b3b40a7a.3d42d8",
            "c4d808d1.9fbf48"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 480,
      "outputs" : 1,
      "rules" : [
         {
            "t" : "cont",
            "vt" : "str",
            "v" : "no school"
         }
      ],
      "type" : "switch",
      "name" : "No school?",
      "checkall" : "true",
      "y" : 680
   },
   {
      "name" : "Turn on \"no school mode\"",
      "y" : 680,
      "type" : "api-call-service",
      "data" : "{ \"entity_id\":\"no_school_mode\"} ",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "x" : 920,
      "z" : "20661f8a.532c4",
      "service_domain" : "input_boolean",
      "id" : "55b89320.b29b5c",
      "server" : "e2a02faf.48099"
   },
   {
      "data" : "{ \"message\": \"No School tomorrow\" }",
      "service" : "family_iphones",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "x" : 870,
      "id" : "b3b40a7a.3d42d8",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "name" : "Notify Family",
      "y" : 720,
      "type" : "api-call-service"
   },
   {
      "x" : 270,
      "wires" : [
         [
            "2d27c7ec.756e78",
            "b83f778e.8a82a8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "server" : "e2a02faf.48099",
      "id" : "3c5a303e.c31d8",
      "y" : 820,
      "name" : "If No School Mode On",
      "halt_if" : "off",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.no_school_mode"
   },
   {
      "payloadType" : "str",
      "x" : 90,
      "wires" : [
         [
            "3c5a303e.c31d8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "id" : "94fd5cd4.065a1",
      "once" : false,
      "y" : 820,
      "topic" : "",
      "payload" : "9:00am",
      "crontab" : "00 09 * * *",
      "name" : "",
      "type" : "inject",
      "repeat" : ""
   },
   {
      "service_domain" : "input_boolean",
      "id" : "2d27c7ec.756e78",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"no_school_mode\"} ",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "x" : 710,
      "type" : "api-call-service",
      "name" : "Turn on \"no school mode\"",
      "y" : 820
   },
   {
      "service_domain" : "notify",
      "id" : "b83f778e.8a82a8",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "x" : 660,
      "z" : "20661f8a.532c4",
      "data" : "{ \"message\": \"Turning off no school mode - Alarm clocks will go off normally tomorrow morning\" }",
      "service" : "family_iphones",
      "type" : "api-call-service",
      "y" : 860,
      "name" : "Notify Family"
   },
   {
      "info" : "",
      "id" : "c2c4376f.76f138",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 130,
      "type" : "comment",
      "y" : 640,
      "name" : "Monitor for no school days"
   },
   {
      "info" : "",
      "id" : "640c31ce.7db44",
      "wires" : [],
      "x" : 130,
      "z" : "20661f8a.532c4",
      "type" : "comment",
      "y" : 780,
      "name" : "Turn off no school mode"
   },
   {
      "name" : "If No School mode",
      "halt_if" : "on",
      "y" : 1280,
      "type" : "api-current-state",
      "entity_id" : "input_boolean.no_school_mode",
      "wires" : [
         [
            "9ff97d14.a2d8e",
            "60801386.316afc"
         ]
      ],
      "x" : 670,
      "z" : "8bb76918.ef6b48",
      "id" : "b966d79e.a1f698",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "630ca5d3.5e759c",
      "server" : "e2a02faf.48099",
      "x" : 420,
      "wires" : [
         [
            "55b89320.b29b5c",
            "b3b40a7a.3d42d8",
            "c4d808d1.9fbf48"
         ]
      ],
      "z" : "20661f8a.532c4",
      "type" : "server-state-changed",
      "name" : "Family Calendar - No school event",
      "y" : 720,
      "haltifstate" : "off",
      "entityidfilter" : "calendar.family_sleepin"
   },
   {
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "1",
      "drop" : false,
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "3028dd0a.dc3952",
            "717049d9.26fc08"
         ]
      ],
      "randomFirst" : "1",
      "rate" : "1",
      "name" : "",
      "y" : 180,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "timeout" : "30",
      "x" : 620,
      "id" : "691ff7e.4b75e08"
   },
   {
      "y" : 180,
      "name" : "Still in triggered zone or just passing through?",
      "type" : "function",
      "outputs" : "2",
      "x" : 1040,
      "wires" : [
         [
            "c21dbb32.350808",
            "99c0bcdb.ffe2",
            "11cac704.acdbc9"
         ],
         []
      ],
      "noerr" : 0,
      "z" : "46ed0d55.4c98b4",
      "func" : "walt_updated_loc = global.get('walt_location')||null;\nwife_updated_loc = global.get('wife_location')||null;\n\nmsg.wife_updated_loc = wife_updated_loc;\nmsg.walt_updated_loc = walt_updated_loc;\n\nif (msg.person == 'walt' && (walt_updated_loc == msg.loc)) {\n    node.status({fill:\"green\",shape:\"dot\",text:\"Still in triggered geozone, sending message\"});\n    msg.passing_through = 0;\n    return[ msg,null ];\n} else if (msg.person == 'wife' && (wife_updated_loc == msg.loc)) {\n    node.status({fill:\"green\",shape:\"dot\",text:\"Still in triggered geozone, sending message\"});\n    msg.passing_through = 0;\n    return[ msg,null ];\n} else {\n    node.status({fill:\"red\",shape:\"ring\",text:\"Just passing through geozone, stopping flow\"});\n    msg.passing_through = 1;\n    return [ null,msg ];\n}",
      "outputLabels" : [
         "Still in triggered zone",
         "Passing through"
      ],
      "id" : "9845c56b.21d638"
   },
   {
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "drop" : false,
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "9845c56b.21d638"
         ]
      ],
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 180,
      "id" : "3028dd0a.dc3952",
      "timeout" : "10",
      "x" : 780
   },
   {
      "wires" : [
         [
            "bad86bdd.a7a558"
         ],
         [
            "286ded0b.61d8a2",
            "ecbc45f0.2c3ce8"
         ],
         [
            "39dc733b.2aec8c"
         ]
      ],
      "z" : "7ae32389.5d604c",
      "x" : 540,
      "property" : "verb",
      "propertyType" : "msg",
      "id" : "516c338e.65601c",
      "y" : 40,
      "name" : "Leaving or entering a zone?",
      "checkall" : "true",
      "type" : "switch",
      "outputs" : 3,
      "rules" : [
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "left"
         },
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "is at"
         },
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "unknown"
         }
      ]
   },
   {
      "name" : "Clear msg and switch",
      "y" : 200,
      "outputs" : "2",
      "type" : "function",
      "func" : "// Clear our msg object as the service call to\n// update our location doesn't seem to like it\nnewmsg = {};\nnewmsg.payload = \"Update\";\n\nif(msg.person == \"walt\") {\n    return[ newmsg, null ];\n} else if(msg.person == \"wife\") {\n    return[ null, newmsg ];\n}",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "f4fbb4a2.6646c8"
         ],
         [
            "91468204.28d44"
         ]
      ],
      "x" : 160,
      "noerr" : 0,
      "outputLabels" : [
         "walt",
         "wife"
      ],
      "id" : "717049d9.26fc08"
   },
   {
      "lon" : "-92.5825",
      "id" : "5571cb3c.251cd4",
      "wires" : [
         [
            "763a9ad3.14a7e4"
         ],
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 630,
      "startTime" : "sunsetStart",
      "endOffset" : 0,
      "type" : "time-range-switch",
      "lat" : "40.18937",
      "endTime" : "wife",
      "startOffset" : 0,
      "y" : 620,
      "name" : "Night"
   },
   {
      "type" : "debug",
      "console" : "false",
      "y" : 100,
      "complete" : "true",
      "name" : "FinalNotify",
      "active" : true,
      "id" : "c21dbb32.350808",
      "z" : "46ed0d55.4c98b4",
      "wires" : [],
      "x" : 1350
   },
   {
      "type" : "api-current-state",
      "entity_id" : "group.family",
      "y" : 980,
      "halt_if" : "",
      "name" : "Family Mode",
      "server" : "e2a02faf.48099",
      "id" : "1debd879.7d8d08",
      "wires" : [
         [
            "9652ab51.5bae68"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 490
   },
   {
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "y" : 940,
      "halt_if" : "",
      "name" : "Guest mode",
      "server" : "e2a02faf.48099",
      "id" : "fc9e2d66.62f4e",
      "wires" : [
         [
            "dfab892.528a878"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 490
   },
   {
      "once" : false,
      "id" : "3b870494.1a05ac",
      "wires" : [
         [
            "fc9e2d66.62f4e",
            "1debd879.7d8d08",
            "7d5c167d.428f28",
            "4d20e83c.3733d8",
            "8c4a9c3e.b7c28",
            "168f8d.7a22d074"
         ]
      ],
      "x" : 150,
      "z" : "20661f8a.532c4",
      "payloadType" : "date",
      "repeat" : "10",
      "type" : "inject",
      "crontab" : "",
      "name" : "",
      "payload" : "",
      "y" : 940,
      "topic" : "Every 10sec"
   },
   {
      "type" : "comment",
      "name" : "Turn our input booleans to global variables",
      "y" : 900,
      "id" : "d827ee6e.e7ed7",
      "info" : "",
      "x" : 180,
      "wires" : [],
      "z" : "20661f8a.532c4"
   },
   {
      "name" : "Set global variables",
      "y" : 940,
      "outputs" : 1,
      "type" : "function",
      "func" : "global.set('guest_mode',msg.payload);\nreturn msg;",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "x" : 670,
      "noerr" : 0,
      "id" : "dfab892.528a878"
   },
   {
      "id" : "9652ab51.5bae68",
      "func" : "global.set('family_mode',msg.payload);\nreturn msg;",
      "noerr" : 0,
      "wires" : [
         []
      ],
      "x" : 670,
      "z" : "20661f8a.532c4",
      "outputs" : 1,
      "type" : "function",
      "name" : "Set global variables",
      "y" : 980
   },
   {
      "type" : "function",
      "outputs" : 2,
      "y" : 560,
      "name" : "Is family home or guest mode on?",
      "id" : "caba1d6f.2e38",
      "outputLabels" : [
         "abort",
         "continue"
      ],
      "z" : "c663f7df.ca58b8",
      "wires" : [
         [],
         []
      ],
      "x" : 520,
      "noerr" : 0,
      "func" : "family_mode         = global.get('family_mode')||null;\nguest_mode          = global.get('guest_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.family_mode     = family_mode;\nmsg.guest_mode      = guest_mode;\n\nif( family_mode == 'home' || guest_mode == 'on' || ha_uptime_sec < 600) {\n    msg.abort_alert = 1;\n    return [ msg, null ];\n} else {\n     msg.abort_alert = 0;\n    return [ null, msg ];   \n}"
   },
   {
      "z" : "c663f7df.ca58b8",
      "wires" : [
         [
            "9fff04c1.ef0688"
         ]
      ],
      "x" : 470,
      "server" : "e2a02faf.48099",
      "id" : "2ce419c7.fb69b6",
      "name" : "Family Mode",
      "halt_if" : "",
      "y" : 440,
      "entity_id" : "group.family",
      "type" : "api-current-state"
   },
   {
      "id" : "9a1ed94a.6731a8",
      "server" : "e2a02faf.48099",
      "x" : 470,
      "wires" : [
         [
            "d85f38d8.e12fb8"
         ]
      ],
      "z" : "c663f7df.ca58b8",
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state",
      "y" : 400,
      "name" : "Guest mode",
      "halt_if" : ""
   },
   {
      "func" : "global.set('guest_mode',msg.payload);\nreturn msg;",
      "noerr" : 0,
      "wires" : [
         []
      ],
      "x" : 670,
      "z" : "c663f7df.ca58b8",
      "id" : "d85f38d8.e12fb8",
      "name" : "Set global variables",
      "y" : 400,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "func" : "global.set('family_mode',msg.payload);\nreturn msg;",
      "noerr" : 0,
      "wires" : [
         []
      ],
      "x" : 670,
      "z" : "c663f7df.ca58b8",
      "id" : "9fff04c1.ef0688",
      "name" : "Set global variables",
      "y" : 440,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "caba1d6f.2e38"
         ]
      ],
      "z" : "c663f7df.ca58b8",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "1",
      "drop" : false,
      "id" : "9239610f.2b97b",
      "timeout" : "1",
      "x" : 280,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 560
   },
   {
      "id" : "62c7725c.883fcc",
      "type" : "subflow:c663f7df.ca58b8",
      "name" : "",
      "y" : 60,
      "wires" : [
         [
            "b58f2da5.6fc3e",
            "555e84d9.56d97c",
            "c2286c26.27939"
         ]
      ],
      "x" : 750,
      "z" : "af1cc9bd.91cc08"
   },
   {
      "type" : "subflow:c663f7df.ca58b8",
      "id" : "b3cae960.eb0e38",
      "x" : 760,
      "wires" : [
         [
            "ee75ae12.67511"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "y" : 220,
      "name" : "Family still not home"
   },
   {
      "name" : "",
      "y" : 2420,
      "startOffset" : 0,
      "endTime" : "21:00",
      "lat" : "40.18944",
      "type" : "time-range-switch",
      "endOffset" : 0,
      "wires" : [
         [
            "675ad3ec.c9f2ac",
            "e5bfca9b.0f87d8",
            "66765f49.da2d4",
            "9c7dd40f.bd1fe8",
            "6c92f048.18abb"
         ],
         [
            "3841f6fb.417bea"
         ]
      ],
      "x" : 930,
      "startTime" : "07:30",
      "z" : "8bb76918.ef6b48",
      "lon" : "-92.58257",
      "id" : "aebd9c21.e33fc"
   },
   {
      "x" : 770,
      "wires" : [
         [
            "e295d74a.c6f488",
            "6dbf538f.d536cc",
            "3d015f18.990dd",
            "62f28eac.1bcf4",
            "13058d3c.4a1843",
            "82f399bc.7354c8",
            "bbe74c77.d0d3a"
         ],
         []
      ],
      "startTime" : "07:00",
      "z" : "8bb76918.ef6b48",
      "lon" : "",
      "id" : "8e9cdb7d.9f1268",
      "y" : 220,
      "name" : "7AM to 9PM",
      "endOffset" : 0,
      "type" : "time-range-switch",
      "lat" : "",
      "endTime" : "21:00",
      "startOffset" : 0
   },
   {
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "757b73dc.a14b5c"
         ]
      ],
      "rate" : "1",
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "1",
      "drop" : false,
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "x" : 700,
      "timeout" : "30",
      "id" : "934c709e.a7c31",
      "y" : 80,
      "name" : "",
      "pauseType" : "delay",
      "rateUnits" : "second"
   },
   {
      "wires" : [
         [
            "f2aab9d0.42f8a8",
            "934c709e.a7c31"
         ]
      ],
      "x" : 350,
      "z" : "20661f8a.532c4",
      "id" : "c283c7e3.723f48",
      "server" : "e2a02faf.48099",
      "y" : 80,
      "name" : "If Guest Mode Off",
      "halt_if" : "on",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode"
   },
   {
      "y" : 1180,
      "name" : "Relogin to Home Assistant Cloud every hour or after internet outage",
      "type" : "comment",
      "wires" : [],
      "x" : 260,
      "z" : "20661f8a.532c4",
      "info" : "",
      "id" : "5d9c3f4c.3afde"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "ed3ffca4.b612b"
         ]
      ],
      "x" : 110,
      "payloadType" : "date",
      "once" : false,
      "id" : "c4c54b0.0467db8",
      "crontab" : "",
      "name" : "Every hour",
      "payload" : "",
      "topic" : "",
      "y" : 1220,
      "repeat" : "3600",
      "type" : "inject"
   },
   {
      "url" : "",
      "x" : 670,
      "wires" : [
         [
            "ff28169f.f5c4f8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "ret" : "txt",
      "tls" : "849977e5.257f68",
      "id" : "d45b0f9.d0fc8f",
      "method" : "POST",
      "y" : 1220,
      "name" : "",
      "type" : "http request"
   },
   {
      "id" : "ed3ffca4.b612b",
      "wires" : [
         [
            "d45b0f9.d0fc8f"
         ]
      ],
      "x" : 360,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "func" : "msg.url = 'https://127.0.0.1:8123/api/cloud/logout';\nmsg.headers = {};\nmsg.headers['x-ha-access'] = 'your-api-password';\nmsg.headers['Content-Type'] = 'application/json';\nreturn msg;\n",
      "type" : "function",
      "outputs" : 1,
      "y" : 1220,
      "name" : "Set Logout URL and headers"
   },
   {
      "type" : "function",
      "outputs" : 1,
      "y" : 1280,
      "name" : "Set Login URL, headers and payload",
      "id" : "125a5fe.a083fa",
      "wires" : [
         [
            "76d2fb86.49daa4"
         ]
      ],
      "x" : 390,
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "func" : "msg.url = 'https://127.0.0.1:8123/api/cloud/login';\nmsg.payload = '{\"email\": \"your-email-address@email.com\", \"password\": \"your-cloud-password\"}';\nmsg.headers = {};\nmsg.headers['x-ha-access'] = 'your-api-password';\nmsg.headers['Content-Type'] = 'application/json';\nreturn msg;\n"
   },
   {
      "timeout" : "1",
      "x" : 860,
      "id" : "ff28169f.f5c4f8",
      "name" : "",
      "y" : 1220,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "125a5fe.a083fa"
         ]
      ],
      "rate" : "1",
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "1",
      "drop" : false,
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5"
   },
   {
      "tls" : "849977e5.257f68",
      "id" : "76d2fb86.49daa4",
      "method" : "POST",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "9d83950a.0fc128"
         ]
      ],
      "x" : 670,
      "url" : "",
      "ret" : "txt",
      "type" : "http request",
      "y" : 1280,
      "name" : ""
   },
   {
      "y" : 1280,
      "name" : "Notify Walt",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "x" : 1090,
      "z" : "20661f8a.532c4",
      "service" : "ios_walts_iphone",
      "data" : "{ \"message\": \"Problem logging back into Home Assistant Cloud\" }",
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "80cb93b0.f340b"
   },
   {
      "propertyType" : "msg",
      "id" : "9d83950a.0fc128",
      "x" : 880,
      "wires" : [
         [
            "80cb93b0.f340b"
         ]
      ],
      "z" : "20661f8a.532c4",
      "property" : "statusCode",
      "type" : "switch",
      "rules" : [
         {
            "t" : "neq",
            "vt" : "num",
            "v" : "200"
         }
      ],
      "outputs" : 1,
      "y" : 1280,
      "checkall" : "true",
      "name" : "Not HTTP 200"
   },
   {
      "x" : 130,
      "wires" : [
         [
            "416f2de9.793354"
         ]
      ],
      "z" : "20661f8a.532c4",
      "server" : "e2a02faf.48099",
      "id" : "8e732d86.72c62",
      "name" : "Internet Connection Off",
      "halt_if" : "on",
      "y" : 1380,
      "entity_id" : "binary_sensor.wan",
      "type" : "api-current-state"
   },
   {
      "wires" : [
         [
            "28f91326.ea172c"
         ],
         []
      ],
      "duration" : "30",
      "x" : 450,
      "units" : "Second",
      "z" : "20661f8a.532c4",
      "id" : "416f2de9.793354",
      "name" : "",
      "maxloops" : "1440",
      "y" : 1380,
      "maxtimeoutunits" : "Hour",
      "maxtimeout" : "12",
      "type" : "looptimer"
   },
   {
      "id" : "28f91326.ea172c",
      "x" : 680,
      "timeout" : "5",
      "pauseType" : "delay",
      "rateUnits" : "second",
      "y" : 1380,
      "name" : "",
      "rate" : "1",
      "wires" : [
         [
            "7063a64e.363828"
         ]
      ],
      "z" : "20661f8a.532c4",
      "randomFirst" : "1",
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "nbRateUnits" : "1"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "7063a64e.363828",
      "x" : 920,
      "wires" : [
         [
            "fbf6771c.022678",
            "83d00a78.9de298"
         ]
      ],
      "z" : "20661f8a.532c4",
      "type" : "api-current-state",
      "entity_id" : "binary_sensor.wan",
      "y" : 1380,
      "halt_if" : "off",
      "name" : "Internet back online"
   },
   {
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "drop" : false,
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "1",
      "rate" : "1",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "6144906.9ca5b7"
         ]
      ],
      "randomFirst" : "1",
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 1380,
      "id" : "fbf6771c.022678",
      "timeout" : "30",
      "x" : 1140
   },
   {
      "type" : "comment",
      "name" : "Kick off actions when internet comes back online",
      "y" : 1340,
      "id" : "92341b16.5c94f8",
      "info" : "",
      "wires" : [],
      "x" : 200,
      "z" : "20661f8a.532c4"
   },
   {
      "links" : [
         "9fd862b9.9c79b"
      ],
      "y" : 1380,
      "name" : "Internet back online",
      "type" : "link out",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 1275,
      "id" : "6144906.9ca5b7"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "ed3ffca4.b612b"
         ]
      ],
      "x" : 55,
      "outputLabels" : [
         "Internet back online"
      ],
      "id" : "9fd862b9.9c79b",
      "name" : "Internet back online",
      "links" : [
         "6144906.9ca5b7"
      ],
      "y" : 1280,
      "type" : "link in"
   },
   {
      "service_domain" : "notify",
      "id" : "43df1ee7.8196",
      "server" : "e2a02faf.48099",
      "service" : "family_iphones",
      "data" : "{ \"message\": \"msg\" }",
      "x" : 1230,
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "type" : "api-call-service",
      "name" : "Notify Family",
      "y" : 280
   },
   {
      "type" : "comment",
      "y" : 2640,
      "name" : "Setup house for Brenda cleaning",
      "info" : "",
      "id" : "1871cda0.1172c2",
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "x" : 150
   },
   {
      "y" : 2720,
      "name" : "Turn on all lights",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "x" : 1000,
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "data" : "{ \"entity_id\":\"group.all_lights\"}",
      "service_domain" : "light",
      "id" : "acbae0b9.5dc98",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "7a06fdae.711514",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1140,
      "data" : "{ \"entity_id\":\"group.all_lights\"}",
      "service" : "turn_off",
      "type" : "api-call-service",
      "y" : 2880,
      "name" : "Turn off all lights"
   },
   {
      "wires" : [
         [
            "cc403516.9a8fe8",
            "646905d3.acd09c"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 100,
      "entityidfiltertype" : "exact",
      "id" : "ce50ebf8.19a4a8",
      "server" : "e2a02faf.48099",
      "entityidfilter" : "sensor.front_door_access_control",
      "y" : 2680,
      "haltifstate" : "23",
      "name" : "Front Door Open",
      "type" : "server-state-changed"
   },
   {
      "wires" : [
         [
            "cc403516.9a8fe8",
            "646905d3.acd09c"
         ]
      ],
      "x" : 110,
      "entityidfiltertype" : "exact",
      "z" : "8bb76918.ef6b48",
      "id" : "ac880dc7.614eb",
      "server" : "e2a02faf.48099",
      "name" : "Garage Door South",
      "y" : 2720,
      "entityidfilter" : "sensor.garage_door_south_tilt_alarm_level",
      "haltifstate" : "0",
      "type" : "server-state-changed"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "acbae0b9.5dc98",
            "90b2edaa.8205c",
            "ab9723c5.8ceee",
            "ad70e368.5df71"
         ]
      ],
      "x" : 740,
      "server" : "e2a02faf.48099",
      "id" : "b0b0fc2b.79c11",
      "name" : "If Brenda scheduled to clean",
      "halt_if" : "off",
      "y" : 2680,
      "type" : "api-current-state",
      "entity_id" : "calendar.family_brendacleaning"
   },
   {
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 2760,
      "id" : "90b2edaa.8205c",
      "timeout" : "5",
      "x" : 980,
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "timeoutUnits" : "minutes",
      "drop" : false,
      "nbRateUnits" : "1",
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "c6fc13c9.117d6"
         ]
      ]
   },
   {
      "id" : "522422e0.51d7cc",
      "negate_allow" : false,
      "ignore_case_allow" : false,
      "filter_allow" : "green",
      "x" : 690,
      "property_allow" : "traffic",
      "property_stop" : "traffic",
      "differ" : false,
      "filter_stop" : "red",
      "name" : "",
      "ignore_case_stop" : false,
      "y" : 2840,
      "negate_stop" : false,
      "wires" : [
         [
            "a1ed71c8.2b9bc",
            "4e3500d.6afcf",
            "4ea8deae.cbe9e"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "send_stop" : false,
      "default_start" : false,
      "type" : "traffic",
      "send_allow" : false
   },
   {
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 2880,
      "id" : "a1ed71c8.2b9bc",
      "timeout" : "30",
      "x" : 900,
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "rate" : "1",
      "wires" : [
         [
            "a9205382.f33e3",
            "8e295be8.89f2f8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1"
   },
   {
      "x" : 440,
      "timeout" : "5",
      "id" : "cc403516.9a8fe8",
      "y" : 2760,
      "name" : "Only let one message through 30s",
      "pauseType" : "rate",
      "rateUnits" : "second",
      "wires" : [
         [
            "522422e0.51d7cc"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1",
      "rate" : "1",
      "nbRateUnits" : "30",
      "drop" : true,
      "timeoutUnits" : "seconds",
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds"
   },
   {
      "rules" : [
         {
            "p" : "traffic",
            "pt" : "msg",
            "to" : "green",
            "tot" : "str",
            "t" : "set"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "Turn on traffic light",
      "y" : 2760,
      "id" : "c6fc13c9.117d6",
      "from" : "",
      "action" : "",
      "property" : "",
      "x" : 1190,
      "wires" : [
         [
            "522422e0.51d7cc",
            "e02c805c.a0bde"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "to" : ""
   },
   {
      "name" : "Turn off traffic light",
      "reg" : false,
      "y" : 2900,
      "rules" : [
         {
            "p" : "traffic",
            "pt" : "msg",
            "to" : "red",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "type" : "change",
      "action" : "",
      "property" : "",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "522422e0.51d7cc"
         ]
      ],
      "x" : 690,
      "to" : "",
      "id" : "4ea8deae.cbe9e",
      "from" : ""
   },
   {
      "data" : "{ \"message\": \"Brenda started cleaning\" }",
      "service" : "family_iphones",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 990,
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "id" : "ab9723c5.8ceee",
      "name" : "Notify Family",
      "y" : 2680,
      "type" : "api-call-service"
   },
   {
      "name" : "Notify Family",
      "y" : 2840,
      "type" : "api-call-service",
      "data" : "{ \"message\": \"Brenda finished cleaning\" }",
      "service" : "family_iphones",
      "x" : 910,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "4e3500d.6afcf",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099"
   },
   {
      "data" : "{ \"entity_id\": \"input_boolean.guest_mode\"}",
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 400,
      "server" : "e2a02faf.48099",
      "service_domain" : "input_boolean",
      "id" : "5e8613ec.9b6e1c",
      "name" : "Turn on guest mode",
      "y" : 2800,
      "type" : "api-call-service"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "f20c7348.cd1f",
      "x" : 130,
      "wires" : [
         [
            "5e8613ec.9b6e1c",
            "9951bd64.045bf",
            "d01e41d3.f6416"
         ]
      ],
      "entityidfiltertype" : "exact",
      "z" : "8bb76918.ef6b48",
      "type" : "server-state-changed",
      "entityidfilter" : "calendar.family_brendacleaning",
      "y" : 2800,
      "haltifstate" : "off",
      "name" : "Brenda scheduled to clean"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "8e295be8.89f2f8",
      "x" : 1110,
      "wires" : [
         [
            "7a06fdae.711514",
            "3652e256.daaefe"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "type" : "api-current-state",
      "entity_id" : "group.family",
      "halt_if" : "home",
      "name" : "If Family Not Home",
      "y" : 2840
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "8af8e7dd.fdec38",
      "wires" : [
         [
            "cc403516.9a8fe8",
            "646905d3.acd09c"
         ]
      ],
      "x" : 130,
      "z" : "8bb76918.ef6b48",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "entityidfilter" : "sensor.garage_entry_door_south_access_control",
      "y" : 2760,
      "haltifstate" : "23",
      "name" : "Garage Entry Door South"
   },
   {
      "pauseType" : "rate",
      "rateUnits" : "hour",
      "y" : 2680,
      "name" : "Only let one message through 3h",
      "id" : "646905d3.acd09c",
      "x" : 440,
      "timeout" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "nbRateUnits" : "3",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "b0b0fc2b.79c11"
         ]
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "info" : "",
      "id" : "4eb7e513.33ff8c",
      "wires" : [],
      "x" : 350,
      "z" : "8bb76918.ef6b48",
      "type" : "comment",
      "y" : 2720,
      "name" : "Leaving"
   },
   {
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1120,
      "data" : "{ \"entity_id\": \"input_boolean.guest_mode\"}",
      "service" : "turn_off",
      "service_domain" : "input_boolean",
      "id" : "a9205382.f33e3",
      "server" : "e2a02faf.48099",
      "y" : 2920,
      "name" : "Turn off guest mode",
      "type" : "api-call-service"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "input_boolean.network_maintenance",
      "halt_if" : "off",
      "name" : "If no network maintenance",
      "y" : 2220,
      "id" : "79aef37.ba4700c",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "f22628cc.ac40d8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 400
   },
   {
      "func" : "newmsg = {};\n\n// Get the person we for this event\n// and their previous location\nperson          = msg.data.old_state.attributes.friendly_name.toLowerCase();\nprevious_loc    = global.get(person + '_previous_loc')||null;\n\n\n// Get the last GPS coordinates for both of us. These get set in a \n// loop in the Utilities tab.\nwalt_lat        = parseFloat(global.get('walt_latitude'))||null;\nwalt_lon        = parseFloat(global.get('walt_longitude'))||null;\nwife_lat        = parseFloat(global.get('wife_latitude'))||null;\nwife_lon        = parseFloat(global.get('wife_longitude'))||null;\n\n// What direction are we headed?\n//\n// Still in the same zone as before\nif (msg.data.new_state.state == msg.data.old_state.state) {\n    verb        = 'unknown';\n    location    = msg.data.new_state.state;\n// Leaving a zone\n} else if (msg.data.new_state.state == 'not_home') {\n    verb        = 'left';\n    location    = msg.data.old_state.state;\n// Entering a new zone\n} else {    \n    verb        = 'is at';\n    location    = msg.data.new_state.state;\n}\n\n// Do the math to see how far apart we are\nlat_diff        = Math.abs(walt_lat - wife_lat);\nlon_diff        = Math.abs(walt_lon - wife_lon);\n\nif ( lat_diff > 0.003 || lon_diff > 0.003 ) {\n    newmsg.apart   = 1;\n} else {\n    newmsg.apart   = 0;\n}\n\n// Does this event have us\n// in the same zone as we were last?\nif (location == previous_loc) {\n    newmsg.samezone = 1;\n    newmsg.previous_loc = previous_loc;\n// If not, update our global variables\n} else {\n    newmsg.samezone = 0;\n    newmsg.previous_loc = previous_loc;\n    global.set(person + '_previous_loc', location);\n}\n\n// Build our message object\nnewmsg.walt_lat = walt_lat;\nnewmsg.walt_lon = walt_lon;\nnewmsg.wife_lat = wife_lat;\nnewmsg.wife_lon = wife_lon;\nnewmsg.lat_diff = lat_diff;\nnewmsg.lon_diff = lon_diff;\nnewmsg.person   = person;\nnewmsg.loc      = location;\nnewmsg.verb     = verb;\nnewmsg.lat      = msg.data.new_state.attributes.latitude;\nnewmsg.lon      = msg.data.new_state.attributes.longitude;\nnewmsg.payload  = { data: {'message': capitalizeFirstLetter(person) + ' ' + verb + ' ' + location } };\n\nreturn newmsg;\n\n\nfunction capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}",
      "wires" : [
         [
            "516c338e.65601c"
         ]
      ],
      "noerr" : 0,
      "x" : 240,
      "z" : "7ae32389.5d604c",
      "id" : "bdfc4800.593338",
      "name" : "Format device_tracker data",
      "y" : 40,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "wires" : [
         [
            "4fbed005.8d064"
         ]
      ],
      "z" : "7ae32389.5d604c",
      "x" : 850,
      "property" : "samezone",
      "propertyType" : "msg",
      "id" : "286ded0b.61d8a2",
      "y" : 40,
      "checkall" : "true",
      "name" : "Stop if in same zone as before",
      "type" : "switch",
      "outputs" : 1,
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "0"
         }
      ]
   },
   {
      "y" : 320,
      "complete" : "true",
      "name" : "unknown events",
      "type" : "debug",
      "console" : "false",
      "wires" : [],
      "z" : "7ae32389.5d604c",
      "x" : 840,
      "active" : true,
      "id" : "39dc733b.2aec8c"
   },
   {
      "active" : true,
      "id" : "ecbc45f0.2c3ce8",
      "wires" : [],
      "x" : 830,
      "z" : "7ae32389.5d604c",
      "type" : "debug",
      "console" : "false",
      "y" : 280,
      "complete" : "true",
      "name" : "is at events"
   },
   {
      "id" : "bad86bdd.a7a558",
      "active" : true,
      "z" : "7ae32389.5d604c",
      "wires" : [],
      "x" : 830,
      "console" : "false",
      "type" : "debug",
      "complete" : "true",
      "name" : "left events",
      "y" : 240
   },
   {
      "wires" : [
         [
            "15d9d133.57e45f"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 530,
      "id" : "7d5c167d.428f28",
      "server" : "e2a02faf.48099",
      "name" : "Current GPS coordinates",
      "y" : 1100,
      "template" : "person,latitude,longitude,location\nwife,{{ states.device_tracker.wifes_iphone.attributes.latitude}},{{ states.device_tracker.wifes_iphone.attributes.longitude}},{{states.device_tracker.wifes_iphone.state}}\nwalt,{{ states.device_tracker.walts_iphone.attributes.latitude}},{{ states.device_tracker.walts_iphone.attributes.longitude}},{{states.device_tracker.walts_iphone.state}}",
      "type" : "api-render-template"
   },
   {
      "hdrin" : true,
      "wires" : [
         [
            "84c05d12.13676"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 710,
      "ret" : "\\n",
      "hdrout" : "",
      "temp" : "",
      "sep" : ",",
      "id" : "15d9d133.57e45f",
      "y" : 1100,
      "multi" : "one",
      "name" : "",
      "type" : "csv"
   },
   {
      "y" : 1100,
      "name" : "Set global variables",
      "type" : "function",
      "outputs" : 1,
      "wires" : [
         []
      ],
      "x" : 870,
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "func" : "// Set this the first time NodeRed runs, so\n// location tracking logic will work\nprevious_loc    = global.get(msg.payload.person + '_previous_loc')||null;\nif (previous_loc === null){\n    global.set(msg.payload.person + '_previous_loc',msg.payload.location);\n}\n\n// Set our global variables\nglobal.set(msg.payload.person + '_latitude',msg.payload.latitude);\nglobal.set(msg.payload.person + '_longitude',msg.payload.longitude);\nglobal.set(msg.payload.person + '_location',msg.payload.location);\n\nmsg.lat_string = msg.payload.person + '_location';\nmsg.lon_string = msg.payload.person + '_longitude';\nmsg.per_string = msg.payload.person + '_location';\n\nreturn msg;",
      "id" : "84c05d12.13676"
   },
   {
      "wires" : [
         []
      ],
      "z" : "7ae32389.5d604c",
      "x" : 1080,
      "property" : "apart",
      "propertyType" : "msg",
      "id" : "4fbed005.8d064",
      "y" : 40,
      "name" : "Stop if together",
      "checkall" : "true",
      "type" : "switch",
      "rules" : [
         {
            "v" : "1",
            "vt" : "num",
            "t" : "eq"
         }
      ],
      "outputs" : 1
   },
   {
      "id" : "2b84ebf7.0c79a4",
      "type" : "subflow:7ae32389.5d604c",
      "name" : "",
      "y" : 120,
      "wires" : [
         [
            "c21dbb32.350808",
            "99c0bcdb.ffe2",
            "11cac704.acdbc9"
         ],
         [
            "691ff7e.4b75e08"
         ]
      ],
      "x" : 600,
      "z" : "46ed0d55.4c98b4"
   },
   {
      "wires" : [],
      "x" : 770,
      "z" : "46ed0d55.4c98b4",
      "info" : "",
      "id" : "58c12668.2cd5a8",
      "y" : 80,
      "name" : "Build notification message, check if apart, in same zone and coming or going",
      "type" : "comment"
   },
   {
      "id" : "fd2f62df.4e43f",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "395a6ecc.172e32"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 120,
      "type" : "server-state-changed",
      "name" : "Nest thermostat offline",
      "haltifstate" : "on",
      "y" : 1540,
      "entityidfilter" : "binary_sensor.hallway_thermostat_nest_online"
   },
   {
      "x" : 170,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "id" : "85938ce5.61be4",
      "info" : "",
      "name" : "Notify me if Nest thermostat is offline",
      "y" : 1500,
      "type" : "comment"
   },
   {
      "y" : 1540,
      "name" : "Notify Family",
      "type" : "api-call-service",
      "x" : 1090,
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "service" : "family_iphones",
      "data" : "{ \"message\": \"Nest thermostat is offline\" }",
      "service_domain" : "notify",
      "id" : "92c08326.3198",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "395a6ecc.172e32",
      "server" : "e2a02faf.48099",
      "x" : 380,
      "wires" : [
         [
            "3a2960dd.1cb6f"
         ]
      ],
      "z" : "20661f8a.532c4",
      "entity_id" : "binary_sensor.wan",
      "type" : "api-current-state",
      "name" : "Stop if internet connection is down",
      "halt_if" : "off",
      "y" : 1540
   },
   {
      "y" : 340,
      "name" : "Speak",
      "type" : "api-call-service",
      "x" : 330,
      "wires" : [
         []
      ],
      "z" : "837bbace.420028",
      "data" : "{ \"entity_id\":\"group.speakers\",\"message\":\"Hello there, this is the default message. Walt didn't program me correctly.\" }",
      "service" : "google_say",
      "service_domain" : "tts",
      "id" : "f93bf994.15e5b8",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "subflow:837bbace.420028",
      "id" : "e91e1174.d8ddc",
      "y" : 800,
      "x" : 1030,
      "wires" : [
         [],
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "name" : ""
   },
   {
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [],
         []
      ],
      "x" : 1690,
      "y" : 140,
      "name" : "",
      "type" : "subflow:837bbace.420028",
      "id" : "81d992b2.e41e7"
   },
   {
      "wires" : [
         [
            "43404661.90a528"
         ]
      ],
      "x" : 130,
      "entityidfiltertype" : "exact",
      "z" : "46ed0d55.4c98b4",
      "id" : "15f0d1a8.3d51ce",
      "server" : "e2a02faf.48099",
      "haltifstate" : "",
      "y" : 380,
      "entityidfilter" : "group.wife_tracking",
      "name" : "Wifes Location Changed",
      "type" : "server-state-changed"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "a19954d6.c6d788",
      "wires" : [
         [
            "1483ade6.e40162"
         ]
      ],
      "x" : 130,
      "z" : "46ed0d55.4c98b4",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "haltifstate" : "",
      "y" : 440,
      "entityidfilter" : "group.walt_tracking",
      "name" : "Walts Location Changed"
   },
   {
      "property" : "payload",
      "z" : "63316ec5.c01aa",
      "wires" : [
         [
            "c26b0d5c.63039"
         ]
      ],
      "x" : 140,
      "id" : "fdcc21e8.0b72",
      "propertyType" : "msg",
      "checkall" : "true",
      "name" : "Home?",
      "y" : 60,
      "outputs" : 1,
      "rules" : [
         {
            "v" : "home",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "type" : "switch",
      "repair" : false
   },
   {
      "name" : "",
      "maxloops" : "120",
      "y" : 320,
      "maxtimeoutunits" : "Minute",
      "maxtimeout" : "10",
      "type" : "looptimer",
      "units" : "Second",
      "wires" : [
         [
            "b0396b1e.71f768"
         ],
         []
      ],
      "x" : 660,
      "duration" : "5",
      "z" : "63316ec5.c01aa",
      "id" : "c23cf331.b7496"
   },
   {
      "entity_id" : "sensor.garage_stairs_motion_sensor_alarm_level",
      "type" : "api-current-state",
      "y" : 320,
      "name" : "Garage Stairs Motion",
      "halt_if" : "0",
      "server" : "e2a02faf.48099",
      "id" : "b0396b1e.71f768",
      "wires" : [
         [
            "5c3edf03.6c8c9",
            "1ab60923.98bab7"
         ]
      ],
      "x" : 880,
      "z" : "63316ec5.c01aa"
   },
   {
      "id" : "5c3edf03.6c8c9",
      "from" : "",
      "property" : "",
      "action" : "",
      "to" : "",
      "wires" : [
         [
            "c23cf331.b7496"
         ]
      ],
      "z" : "63316ec5.c01aa",
      "x" : 700,
      "rules" : [
         {
            "p" : "payload",
            "to" : "stop",
            "pt" : "msg",
            "tot" : "str",
            "t" : "set"
         }
      ],
      "type" : "change",
      "name" : "Stop loop",
      "reg" : false,
      "y" : 420
   },
   {
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "63316ec5.c01aa",
      "wires" : [
         [
            "96f71b34.5ea358"
         ]
      ],
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "drop" : false,
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "id" : "1ab60923.98bab7",
      "timeout" : "5",
      "x" : 1120,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 320
   },
   {
      "type" : "subflow:63316ec5.c01aa",
      "id" : "43404661.90a528",
      "y" : 380,
      "x" : 460,
      "wires" : [
         [
            "d28d682.8d8cc98"
         ]
      ],
      "z" : "46ed0d55.4c98b4",
      "name" : "If home and came up garage stairs within 10 minutes"
   },
   {
      "type" : "comment",
      "name" : "Theme song",
      "y" : 340,
      "id" : "faa707fe.651fe8",
      "info" : "",
      "z" : "46ed0d55.4c98b4",
      "wires" : [],
      "x" : 90
   },
   {
      "wires" : [
         [
            "dc0c97dd.b57788"
         ]
      ],
      "x" : 460.000015258789,
      "z" : "46ed0d55.4c98b4",
      "y" : 438.888899803162,
      "name" : "If home and came up garage stairs within 10 minutes",
      "type" : "subflow:63316ec5.c01aa",
      "id" : "1483ade6.e40162"
   },
   {
      "x" : 1530,
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/whererainbowsneverdie.mp3\" }",
      "id" : "1050a6f4.c01fc9",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "y" : 480,
      "name" : "Play where rainbows never die",
      "type" : "api-call-service"
   },
   {
      "entity_id" : "media_player.kitchen_speaker",
      "type" : "api-current-state",
      "y" : 320,
      "name" : "Kitchen media already playing?",
      "halt_if" : "playing",
      "id" : "96f71b34.5ea358",
      "server" : "e2a02faf.48099",
      "x" : 1330,
      "wires" : [
         [
            "96899437.d15718"
         ]
      ],
      "z" : "63316ec5.c01aa"
   },
   {
      "type" : "api-call-service",
      "y" : 420,
      "mergecontext" : "",
      "name" : "Set volume on Kitchen",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "id" : "96899437.d15718",
      "x" : 1320,
      "wires" : [
         []
      ],
      "z" : "63316ec5.c01aa",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"volume_level\":0.5 }",
      "service" : "volume_set"
   },
   {
      "type" : "switch",
      "repair" : false,
      "rules" : [
         {
            "v" : "1",
            "t" : "eq",
            "vt" : "num"
         },
         {
            "v" : "2",
            "vt" : "num",
            "t" : "eq"
         },
         {
            "v" : "3",
            "vt" : "num",
            "t" : "eq"
         }
      ],
      "outputs" : 3,
      "y" : 381.249982833862,
      "name" : "",
      "checkall" : "true",
      "propertyType" : "msg",
      "id" : "fdc23414.943788",
      "wires" : [
         [
            "9aeac2f5.1ac2b"
         ],
         [
            "8564aa45.09c308"
         ],
         [
            "fea5ff67.7f1f7"
         ]
      ],
      "x" : 1289.99993896484,
      "z" : "46ed0d55.4c98b4",
      "property" : "payload"
   },
   {
      "id" : "3bfb5fd2.949c8",
      "wires" : [
         [
            "fdc23414.943788"
         ]
      ],
      "x" : 1139.99993896484,
      "low" : "1",
      "z" : "46ed0d55.4c98b4",
      "property" : "payload",
      "type" : "random",
      "inte" : "true",
      "y" : 381.249982833862,
      "high" : "3",
      "name" : ""
   },
   {
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "id" : "8564aa45.09c308",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/takeiteasy.mp3\" }",
      "service" : "play_media",
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "x" : 1479.99993896484,
      "type" : "api-call-service",
      "name" : "Play take it easy",
      "y" : 381.249982833862
   },
   {
      "y" : 421.249982833862,
      "name" : "Play here comes the sun",
      "type" : "api-call-service",
      "x" : 1509.99993896484,
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/herecomesthesun.mp3\" }",
      "service" : "play_media",
      "id" : "fea5ff67.7f1f7",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "random",
      "y" : 441.249982833862,
      "inte" : "true",
      "name" : "",
      "high" : "8",
      "id" : "e03928ff.4d5588",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "47bcb992.c5d798"
         ]
      ],
      "x" : 1139.99993896484,
      "low" : "1"
   },
   {
      "type" : "switch",
      "outputs" : 8,
      "rules" : [
         {
            "vt" : "num",
            "t" : "eq",
            "v" : "1"
         },
         {
            "v" : "2",
            "t" : "eq",
            "vt" : "num"
         },
         {
            "v" : "3",
            "t" : "eq",
            "vt" : "num"
         },
         {
            "v" : "4",
            "vt" : "num",
            "t" : "eq"
         },
         {
            "v" : "5",
            "t" : "eq",
            "vt" : "num"
         },
         {
            "v" : "6",
            "t" : "eq",
            "vt" : "num"
         },
         {
            "t" : "eq",
            "vt" : "num",
            "v" : "7"
         },
         {
            "v" : "8",
            "vt" : "num",
            "t" : "eq"
         }
      ],
      "y" : 481.249982833862,
      "checkall" : "true",
      "name" : "",
      "propertyType" : "msg",
      "id" : "47bcb992.c5d798",
      "x" : 1289.99993896484,
      "wires" : [
         [
            "1050a6f4.c01fc9"
         ],
         [
            "fb811233.7983b"
         ],
         [
            "7815ac5e.50fc04"
         ],
         [
            "5ff24215.7d65fc"
         ],
         [
            "3722025f.430efe"
         ],
         [
            "a8d5175d.487628"
         ],
         [
            "4cf2632a.01316c"
         ],
         [
            "1a16c8d0.590bc7"
         ]
      ],
      "z" : "46ed0d55.4c98b4",
      "property" : "payload"
   },
   {
      "y" : 518.750000953674,
      "name" : "Play fortunate son",
      "type" : "api-call-service",
      "x" : 1490,
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "service" : "play_media",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/fortunateson.mp3\" }",
      "service_domain" : "media_player",
      "id" : "fb811233.7983b",
      "server" : "e2a02faf.48099"
   },
   {
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         []
      ],
      "x" : 1490,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/imperial_march.mp3\" }",
      "service" : "play_media",
      "server" : "e2a02faf.48099",
      "service_domain" : "media_player",
      "id" : "7815ac5e.50fc04",
      "y" : 562.500000953674,
      "name" : "Play imperial march",
      "type" : "api-call-service"
   },
   {
      "y" : 60,
      "name" : "Not too early or late",
      "type" : "time-range-switch",
      "endOffset" : 0,
      "startOffset" : 0,
      "lat" : "40.17341",
      "endTime" : "20:00",
      "x" : 320,
      "wires" : [
         [
            "20c40273.56f46e"
         ],
         []
      ],
      "startTime" : "07:30",
      "z" : "63316ec5.c01aa",
      "lon" : "-92.58913",
      "id" : "c26b0d5c.63039"
   },
   {
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/walkingonsunshine.mp3\" }",
      "service" : "play_media",
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "x" : 1509.99993896484,
      "service_domain" : "media_player",
      "id" : "9aeac2f5.1ac2b",
      "server" : "e2a02faf.48099",
      "name" : "Play walking on sunshine",
      "y" : 341.249982833862,
      "type" : "api-call-service"
   },
   {
      "id" : "20c40273.56f46e",
      "x" : 590,
      "timeout" : "5",
      "pauseType" : "rate",
      "rateUnits" : "hour",
      "y" : 60,
      "name" : "One message per three hours",
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "63316ec5.c01aa",
      "wires" : [
         [
            "c23cf331.b7496"
         ]
      ],
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "drop" : true,
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "3"
   },
   {
      "wires" : [],
      "x" : 740,
      "z" : "63316ec5.c01aa",
      "id" : "b90a0792.9b04f8",
      "info" : "",
      "name" : "Loop and wait for movement on the stairs",
      "y" : 280,
      "type" : "comment"
   },
   {
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "x" : 1479.99995422363,
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/september.mp3\" }",
      "service" : "play_media",
      "server" : "e2a02faf.48099",
      "service_domain" : "media_player",
      "id" : "5ff24215.7d65fc",
      "y" : 603.749992370605,
      "name" : "Play September",
      "type" : "api-call-service"
   },
   {
      "y" : 643.749992370605,
      "name" : "Play Let it Be",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "x" : 1469.99995422363,
      "z" : "46ed0d55.4c98b4",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/letitbe.mp3\" }",
      "service" : "play_media",
      "id" : "3722025f.430efe",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "api-call-service",
      "y" : 683.749992370605,
      "name" : "Play With a Little Help from my Friends",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "id" : "a8d5175d.487628",
      "x" : 1549.99995422363,
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/withalittlehelp.mp3\" }",
      "service" : "play_media"
   },
   {
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "x" : 1499.99995422363,
      "service" : "play_media",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/seaonsoflove.mp3\" }",
      "server" : "e2a02faf.48099",
      "service_domain" : "media_player",
      "id" : "4cf2632a.01316c",
      "y" : 723.749992370605,
      "name" : "Play Seasons of Love",
      "type" : "api-call-service"
   },
   {
      "name" : "Play Man of Constant Sorrow",
      "y" : 763.749992370605,
      "type" : "api-call-service",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/constantsorrow.mp3\" }",
      "service" : "play_media",
      "wires" : [
         []
      ],
      "x" : 1529.99995422363,
      "z" : "46ed0d55.4c98b4",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "id" : "1a16c8d0.590bc7"
   },
   {
      "wires" : [
         [
            "416f2de9.793354"
         ]
      ],
      "x" : 680,
      "z" : "20661f8a.532c4",
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "83d00a78.9de298",
      "y" : 1440,
      "reg" : false,
      "name" : "Stop loop",
      "type" : "change",
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "p" : "payload",
            "pt" : "msg",
            "to" : "stop"
         }
      ]
   },
   {
      "wires" : [
         [
            "c6dbf0f.203b41"
         ],
         [
            "92c08326.3198"
         ]
      ],
      "units" : "Minute",
      "x" : 730,
      "duration" : "1",
      "z" : "20661f8a.532c4",
      "id" : "3a2960dd.1cb6f",
      "y" : 1540,
      "maxtimeoutunits" : "Minute",
      "name" : "15 minute loop, checking every minute",
      "maxloops" : "15",
      "type" : "looptimer",
      "maxtimeout" : "15"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "binary_sensor.hallway_thermostat_nest_online",
      "halt_if" : "off",
      "name" : "Nest back online?",
      "y" : 1600,
      "id" : "c6dbf0f.203b41",
      "server" : "e2a02faf.48099",
      "x" : 1030,
      "wires" : [
         [
            "65b88bf4.0ede14"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "rules" : [
         {
            "t" : "set",
            "tot" : "str",
            "p" : "payload",
            "pt" : "msg",
            "to" : "stop"
         }
      ],
      "type" : "change",
      "name" : "Stop loop",
      "reg" : false,
      "y" : 1620,
      "id" : "65b88bf4.0ede14",
      "from" : "",
      "property" : "",
      "action" : "",
      "to" : "",
      "wires" : [
         [
            "3a2960dd.1cb6f"
         ]
      ],
      "x" : 740,
      "z" : "20661f8a.532c4"
   },
   {
      "timeout" : "25",
      "x" : 360,
      "id" : "788e2d3e.b185a4",
      "name" : "",
      "y" : 120,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "2b84ebf7.0c79a4"
         ]
      ],
      "randomFirst" : "1",
      "rate" : "1",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay"
   },
   {
      "name" : "Is guest mode on?",
      "y" : 156.071426391602,
      "outputs" : "2",
      "type" : "function",
      "func" : "guest_mode      = global.get('guest_mode')||null;\nquiet_mode      = global.get('quiet_mode')||null;\n\nmsg.guest_mode  = guest_mode;\nmsg.quiet_mode  = quiet_mode;\n\nif(guest_mode == 'on' || quiet_mode == 'on') {\n    msg.abort_alert = 1;\n    return[null,msg];    \n} else {\n    msg.abort_alert = 0;\n    return[msg,null];\n}",
      "x" : 198.75,
      "wires" : [
         [
            "8285e427.a52808",
            "7aab0772.4c7a48",
            "27bfb240.31fede"
         ],
         []
      ],
      "noerr" : 0,
      "z" : "837bbace.420028",
      "id" : "53da29f5.9c6808",
      "outputLabels" : [
         "No guests",
         "Guests"
      ]
   },
   {
      "nbRateUnits" : "10",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "aebd9c21.e33fc"
         ]
      ],
      "rate" : "1",
      "name" : "",
      "y" : 2420,
      "rateUnits" : "minute",
      "pauseType" : "rate",
      "timeout" : "5",
      "x" : 720,
      "id" : "264e27e2.d38b58"
   },
   {
      "rules" : [
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "home"
         }
      ],
      "outputs" : 1,
      "type" : "switch",
      "checkall" : "true",
      "name" : "Home?",
      "y" : 101,
      "id" : "225ea6ad.d070aa",
      "propertyType" : "msg",
      "property" : "payload",
      "x" : 295,
      "wires" : [
         [
            "7c8a5c3d.31e5d4",
            "61508967.a44508"
         ]
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "type" : "api-call-service",
      "y" : 280,
      "name" : "Logbook entry",
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "82f399bc.7354c8",
      "x" : 1040,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup the house automation - Upstairs\" }",
      "service" : "log"
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1040,
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup the house automation - Main level and basement\" }",
      "service" : "log",
      "id" : "99edfdc7.a8032",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "y" : 400,
      "name" : "Logbook entry",
      "type" : "api-call-service"
   },
   {
      "haltifstate" : "on",
      "y" : 1000,
      "entityidfilter" : "binary_sensor.family_sleeping",
      "name" : "Family Awake",
      "type" : "server-state-changed",
      "wires" : [
         [
            "b01b30c3.7ec77"
         ]
      ],
      "entityidfiltertype" : "exact",
      "x" : 90,
      "z" : "8bb76918.ef6b48",
      "id" : "cf264772.aac4a8",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "server-state-changed",
      "entityidfilter" : "binary_sensor.family_in_bed",
      "y" : 1040,
      "haltifstate" : "on",
      "name" : "Family Awake in Bed",
      "server" : "e2a02faf.48099",
      "id" : "7883ed0e.e29c44",
      "entityidfiltertype" : "exact",
      "wires" : [
         [
            "b01b30c3.7ec77"
         ]
      ],
      "x" : 110,
      "z" : "8bb76918.ef6b48"
   },
   {
      "id" : "f3f27a31.04bd68",
      "timeout" : "5",
      "x" : 540,
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "name" : "",
      "y" : 1020,
      "rate" : "1",
      "wires" : [
         [
            "29595b6c.c997f4"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "4",
      "drop" : true
   },
   {
      "entity_id" : "group.main_level",
      "type" : "api-current-state",
      "name" : "Main Level lights already on?",
      "halt_if" : "on",
      "y" : 1020,
      "server" : "e2a02faf.48099",
      "id" : "29595b6c.c997f4",
      "x" : 760,
      "wires" : [
         [
            "6c2cb8e6.f03118"
         ]
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "id" : "3c32ebf7.883b04",
      "info" : "",
      "wires" : [],
      "x" : 120,
      "z" : "8bb76918.ef6b48",
      "type" : "comment",
      "name" : "Turn off coffee grinder",
      "y" : 1140
   },
   {
      "type" : "api-call-service",
      "name" : "Logbook entry",
      "y" : 1140,
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "id" : "35f94b13.cba8a4",
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turn on the main level lights, upstairs landing and Son2s lamp\" }",
      "x" : 1600,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "y" : 1020,
      "name" : "6AM to 10AM",
      "endOffset" : 0,
      "type" : "time-range-switch",
      "endTime" : "10:00",
      "lat" : "",
      "startOffset" : 0,
      "wires" : [
         [
            "f3f27a31.04bd68"
         ],
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 360,
      "startTime" : "06:00",
      "lon" : "",
      "id" : "b01b30c3.7ec77"
   },
   {
      "name" : "Son1s light already on?",
      "halt_if" : "on",
      "y" : 1280,
      "type" : "api-current-state",
      "entity_id" : "light.philips_lct014_0288ce3f_11",
      "wires" : [
         [
            "bf6eb2bf.f3cf4"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 950,
      "id" : "9ff97d14.a2d8e",
      "server" : "e2a02faf.48099"
   },
   {
      "name" : "Master bedroom light already on?",
      "halt_if" : "on",
      "y" : 1320,
      "type" : "api-current-state",
      "entity_id" : "light.master_bedroom",
      "x" : 920,
      "wires" : [
         [
            "50de5197.f732a"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "server" : "e2a02faf.48099",
      "id" : "60801386.316afc"
   },
   {
      "name" : "Turn on Master bedroom lamp at 1%",
      "mergecontext" : "",
      "y" : 1400,
      "type" : "api-call-service",
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"brightness\":\"1\", \"color_temp\":\"236\"}",
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "d42c4e19.01a5c"
         ]
      ],
      "x" : 1410,
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "d890e20a.375ec"
   },
   {
      "id" : "72e3d694.804d08",
      "reset" : "",
      "x" : 1350,
      "name" : "Wait thirty seconds",
      "op1type" : "str",
      "op1" : "1",
      "y" : 1440,
      "op2type" : "str",
      "extend" : false,
      "duration" : "30",
      "units" : "s",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "bbe2b033.614"
         ]
      ],
      "op2" : "0",
      "type" : "trigger",
      "bytopic" : "all"
   },
   {
      "type" : "api-call-service",
      "y" : 1440,
      "mergecontext" : "",
      "name" : "Start 10 minute fade in for Master bedroom lamps",
      "id" : "bbe2b033.614",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1570,
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"transition\":\"600\",\"brightness\":\"255\", \"color_temp\":\"236\"}",
      "service" : "turn_on"
   },
   {
      "y" : 1280,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "x" : 1340,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Fade on the light on work days - Son1s Lamp\" }",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "id" : "86dd48f7.85d0c8"
   },
   {
      "y" : 1480,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "x" : 1340,
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Fade on the light on work days - Master bedroom Lamp\" }",
      "service_domain" : "logbook",
      "id" : "fe9b65ed.5508f8",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [
         []
      ],
      "x" : 840,
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Rebooting network gear \" }",
      "service" : "log",
      "id" : "10fc5f28.e36c81",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "y" : 2260,
      "name" : "Logbook entry",
      "type" : "api-call-service"
   },
   {
      "type" : "api-call-service",
      "y" : 2420,
      "name" : "Logbook entry",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "id" : "3841f6fb.417bea",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1220,
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turn down heat and lights off when we are away\" }"
   },
   {
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "id" : "9951bd64.045bf",
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - guest mode turned on\" }",
      "wires" : [
         []
      ],
      "x" : 380,
      "z" : "8bb76918.ef6b48",
      "type" : "api-call-service",
      "name" : "Logbook entry",
      "y" : 2840
   },
   {
      "service_domain" : "logbook",
      "id" : "ad70e368.5df71",
      "server" : "e2a02faf.48099",
      "x" : 1240,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - Brenda in the house\" }",
      "type" : "api-call-service",
      "y" : 2680,
      "name" : "Logbook entry",
      "mergecontext" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "e02c805c.a0bde",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1400,
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - Traffic light turned on, waiting for exit door event\" }",
      "type" : "api-call-service",
      "y" : 2760,
      "name" : "Logbook entry"
   },
   {
      "type" : "api-call-service",
      "name" : "Turn on upstairs landing",
      "y" : 1020,
      "service_domain" : "light",
      "id" : "6bf1b288.344ccc",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"light.sengled_e11g13_030b05a4_1\"}",
      "service" : "turn_on",
      "x" : 1630,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "bc127838.e440f8",
      "data" : "{ \"entity_id\":\"light.colins_lamp\"}",
      "service" : "turn_on",
      "x" : 1620,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "type" : "api-call-service",
      "name" : "Turn on Son2's Lamp",
      "y" : 1060
   },
   {
      "type" : "tail",
      "filetype" : "text",
      "filename" : "/Users/hass/.homeassistant/home-assistant.log",
      "y" : 1860,
      "name" : "",
      "id" : "9f78922.51b117",
      "split" : true,
      "x" : 200,
      "wires" : [
         [
            "ed4a317.d35a1d",
            "f9f7f1a3.bfa93",
            "70445fd.82f60a",
            "da524a1f.6dd768",
            "eb4e20ed.e3724"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "type" : "comment",
      "y" : 1820,
      "name" : "Watch the Home Assistant Log file",
      "info" : "",
      "id" : "c82ff4c0.f55558",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 160
   },
   {
      "id" : "ed4a317.d35a1d",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "eda75d39.207a6"
         ]
      ],
      "x" : 540,
      "z" : "20661f8a.532c4",
      "outputs" : 1,
      "rules" : [
         {
            "v" : "iOS push notification rate limits for walts_iphone",
            "case" : false,
            "vt" : "str",
            "t" : "regex"
         }
      ],
      "type" : "switch",
      "name" : "Walt's phone rate limit",
      "checkall" : "true",
      "y" : 1980
   },
   {
      "property" : "payload",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "d4678f72.89286"
         ]
      ],
      "x" : 550,
      "id" : "f9f7f1a3.bfa93",
      "propertyType" : "msg",
      "checkall" : "true",
      "name" : "Wife's phone rate limit",
      "y" : 2020,
      "rules" : [
         {
            "case" : false,
            "vt" : "str",
            "t" : "regex",
            "v" : "iOS push notification rate limits for wifes_iphone"
         }
      ],
      "outputs" : 1,
      "type" : "switch"
   },
   {
      "name" : "Pull out number of sent messages",
      "y" : 1980,
      "outputs" : 1,
      "type" : "function",
      "func" : "sent        = msg.payload.replace(/.*phone: ([0-9]+) sent.*/, '$1');\nmsg.sent    = sent;\nreturn msg;",
      "x" : 860,
      "wires" : [
         [
            "b260c7f9.565ce8"
         ]
      ],
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "id" : "eda75d39.207a6"
   },
   {
      "console" : "false",
      "type" : "debug",
      "name" : "number of push to walts phone",
      "complete" : "true",
      "y" : 1980,
      "id" : "b260c7f9.565ce8",
      "active" : true,
      "x" : 1190,
      "wires" : [],
      "z" : "20661f8a.532c4"
   },
   {
      "name" : "Pull out number of sent messages",
      "y" : 2020,
      "outputs" : 1,
      "type" : "function",
      "func" : "sent        = msg.payload.replace(/.*phone: ([0-9]+) sent.*/, '$1');\nmsg.sent    = sent;\nreturn msg;",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "8eacbe5a.7b03e"
         ]
      ],
      "x" : 860,
      "noerr" : 0,
      "id" : "d4678f72.89286"
   },
   {
      "x" : 1190,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "active" : true,
      "id" : "8eacbe5a.7b03e",
      "y" : 2020,
      "name" : "number of push to wifes phone",
      "complete" : "true",
      "type" : "debug",
      "console" : "false"
   },
   {
      "info" : "",
      "id" : "bfcd5a63.ce7c58",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 1200,
      "type" : "comment",
      "y" : 2060,
      "name" : "TODO: Set these as variables in Home Assistant"
   },
   {
      "wires" : [
         [
            "aae0381e.3331d8"
         ],
         []
      ],
      "x" : 330,
      "startTime" : "sunsetStart",
      "z" : "af1cc9bd.91cc08",
      "id" : "806fa6b.8209558",
      "lon" : "-92.58936",
      "y" : 140,
      "name" : "Off while sun shines into garage",
      "endOffset" : 0,
      "type" : "time-range-switch",
      "lat" : "40.17349",
      "endTime" : "sunriseEnd",
      "startOffset" : "-90"
   },
   {
      "id" : "6c2cb8e6.f03118",
      "server" : "e2a02faf.48099",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "293da600.9a431a"
         ]
      ],
      "x" : 980,
      "type" : "api-current-state",
      "entity_id" : "group.family",
      "name" : "If Family Home",
      "halt_if" : "not_home",
      "y" : 1020
   },
   {
      "id" : "4d20e83c.3733d8",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "a7728792.0516b8"
         ]
      ],
      "x" : 490,
      "z" : "20661f8a.532c4",
      "entity_id" : "sensor.ha_uptime_sec",
      "type" : "api-current-state",
      "y" : 900,
      "name" : "HA Uptime",
      "halt_if" : ""
   },
   {
      "y" : 900,
      "name" : "Set global variables",
      "type" : "function",
      "outputs" : 1,
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "x" : 670,
      "noerr" : 0,
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "id" : "a7728792.0516b8"
   },
   {
      "name" : "HA Uptime",
      "halt_if" : "",
      "y" : 360,
      "entity_id" : "sensor.ha_uptime_sec",
      "type" : "api-current-state",
      "z" : "c663f7df.ca58b8",
      "wires" : [
         [
            "40333e92.b491c"
         ]
      ],
      "x" : 470,
      "id" : "38d8e92.9caf216",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [
         []
      ],
      "noerr" : 0,
      "x" : 670,
      "z" : "c663f7df.ca58b8",
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "id" : "40333e92.b491c",
      "y" : 360,
      "name" : "Set global variables",
      "type" : "function",
      "outputs" : 1
   },
   {
      "type" : "comment",
      "name" : "Checks if family mode or guest mode is on, and that HA has not restarted in last ten min",
      "y" : 520,
      "id" : "5ceee521.890f0c",
      "info" : "",
      "z" : "c663f7df.ca58b8",
      "wires" : [],
      "x" : 680
   },
   {
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "rate" : "1",
      "z" : "837bbace.420028",
      "wires" : [
         [
            "ed6284e7.90c288"
         ]
      ],
      "randomFirst" : "1",
      "pauseType" : "delay",
      "rateUnits" : "second",
      "y" : 160,
      "name" : "",
      "id" : "27bfb240.31fede",
      "x" : 440,
      "timeout" : "2"
   },
   {
      "default_start" : true,
      "type" : "traffic",
      "send_allow" : false,
      "negate_stop" : false,
      "wires" : [
         [
            "e0226853.972fa8",
            "4f2a1ec3.af1bc",
            "6b1a171c.7f7368"
         ]
      ],
      "z" : "837bbace.420028",
      "send_stop" : false,
      "differ" : false,
      "filter_stop" : "playing",
      "ignore_case_stop" : false,
      "name" : "",
      "y" : 220,
      "negate_allow" : false,
      "id" : "ed6284e7.90c288",
      "ignore_case_allow" : false,
      "filter_allow" : "off|idle|paused",
      "x" : 750,
      "property_stop" : "payload",
      "property_allow" : "payload"
   },
   {
      "z" : "837bbace.420028",
      "wires" : [
         [
            "b4ba7fb4.779ce"
         ]
      ],
      "x" : 515,
      "server" : "e2a02faf.48099",
      "id" : "7aab0772.4c7a48",
      "y" : 108.571451187134,
      "name" : "Kitchen media already playing?",
      "halt_if" : "",
      "type" : "api-current-state",
      "entity_id" : "media_player.kitchen_speaker"
   },
   {
      "wires" : [
         [
            "b4ba7fb4.779ce"
         ]
      ],
      "x" : 535,
      "z" : "837bbace.420028",
      "id" : "8285e427.a52808",
      "server" : "e2a02faf.48099",
      "y" : 67.3214302062988,
      "halt_if" : "",
      "name" : "Family room media already playing?",
      "type" : "api-current-state",
      "entity_id" : "media_player.family_room_speaker"
   },
   {
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "ed6284e7.90c288"
         ]
      ],
      "z" : "837bbace.420028",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "nbRateUnits" : "3",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "id" : "1d126bec.7a2554",
      "timeout" : "5",
      "x" : 1100,
      "rateUnits" : "second",
      "pauseType" : "rate",
      "name" : "",
      "y" : 140
   },
   {
      "outputLabels" : [
         "playing",
         "not playing"
      ],
      "id" : "b4ba7fb4.779ce",
      "propertyType" : "msg",
      "property" : "payload",
      "z" : "837bbace.420028",
      "wires" : [
         [
            "ed6284e7.90c288"
         ],
         [
            "1d126bec.7a2554"
         ]
      ],
      "x" : 840,
      "outputs" : 2,
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "playing"
         },
         {
            "vt" : "str",
            "t" : "neq",
            "v" : "playing"
         }
      ],
      "type" : "switch",
      "name" : "Playing or not playing",
      "checkall" : "true",
      "y" : 100
   },
   {
      "name" : "Set volume on Family Room",
      "y" : 200,
      "type" : "api-call-service",
      "data" : "{ \"entity_id\":\"media_player.family_room_speaker\",\"volume_level\":0.5 }",
      "service" : "volume_set",
      "x" : 1000,
      "wires" : [
         []
      ],
      "z" : "837bbace.420028",
      "id" : "4f2a1ec3.af1bc",
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099"
   },
   {
      "service_domain" : "media_player",
      "server" : "e2a02faf.48099",
      "id" : "6b1a171c.7f7368",
      "x" : 980,
      "wires" : [
         []
      ],
      "z" : "837bbace.420028",
      "data" : "{ \"entity_id\":\"media_player.kitchen_speaker\",\"volume_level\":0.9 }",
      "service" : "volume_set",
      "type" : "api-call-service",
      "y" : 240,
      "name" : "Set volume on Kitchen"
   },
   {
      "pauseType" : "delay",
      "rateUnits" : "second",
      "y" : 339.28572845459,
      "name" : "",
      "id" : "e0226853.972fa8",
      "x" : 140.357196807861,
      "timeout" : "2",
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "837bbace.420028",
      "wires" : [
         [
            "f93bf994.15e5b8",
            "221ab23b.8631fe"
         ]
      ]
   },
   {
      "x" : 980.714285714286,
      "wires" : [],
      "z" : "837bbace.420028",
      "id" : "57df38ed.0beee8",
      "info" : "",
      "name" : "If we are playing on either speaker, block the voice message",
      "y" : 58.5714285714286,
      "type" : "comment"
   },
   {
      "name" : "Format message",
      "y" : 382.678510665894,
      "outputs" : 1,
      "type" : "function",
      "func" : "greetings = [\n            \"Hooray! Mom is here!\",\n            \"Oh yeah, Mom is back!\",\n            \"Hey, better clean up, your Mom is back!\",\n            \"Woohoo! Mommy is home!\",\n            \"The queen of the castle has returned!\",\n            \"Mom's back!\",\n            \"Mommy is home!\",\n            \"Hey, Mom just got home!\"\n            ];\n\ngreeting = greetings[Math.floor(Math.random()*greetings.length)];\nmsg.payload = { data: {'message': greeting } };\n\nreturn msg;",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "b37728c9.fe3df8"
         ]
      ],
      "x" : 794.571380615234,
      "noerr" : 0,
      "id" : "d28d682.8d8cc98"
   },
   {
      "name" : "",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "3bfb5fd2.949c8"
         ],
         []
      ],
      "x" : 973.428527832031,
      "y" : 383.249982833862,
      "id" : "b37728c9.fe3df8",
      "type" : "subflow:837bbace.420028"
   },
   {
      "maxtimeout" : "1",
      "type" : "looptimer",
      "maxloops" : "100",
      "name" : "",
      "maxtimeoutunits" : "Hour",
      "y" : 430,
      "id" : "7c67e682.4ceaf8",
      "wires" : [
         [
            "c40c79ae.a075a8",
            "91d8678.a122698"
         ],
         []
      ],
      "units" : "Second",
      "x" : 425,
      "duration" : "5",
      "z" : "837bbace.420028"
   },
   {
      "y" : 406.428586006165,
      "halt_if" : "",
      "name" : "Family room media already playing?",
      "entity_id" : "media_player.family_room_speaker",
      "type" : "api-current-state",
      "x" : 696.071361541748,
      "wires" : [
         [
            "486f3030.3e37b"
         ]
      ],
      "z" : "837bbace.420028",
      "server" : "e2a02faf.48099",
      "id" : "c40c79ae.a075a8"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "media_player.kitchen_speaker",
      "halt_if" : "",
      "name" : "Kitchen media already playing?",
      "y" : 449.285733222961,
      "server" : "e2a02faf.48099",
      "id" : "91d8678.a122698",
      "wires" : [
         [
            "486f3030.3e37b"
         ]
      ],
      "z" : "837bbace.420028",
      "x" : 676.071361541748
   },
   {
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "837bbace.420028",
      "wires" : [
         [
            "9e8babc9.4d8f38"
         ]
      ],
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "15",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "id" : "418d9d7f.f1b724",
      "x" : 1106.07155227661,
      "timeout" : "5",
      "pauseType" : "rate",
      "rateUnits" : "second",
      "y" : 442.14287853241,
      "name" : ""
   },
   {
      "propertyType" : "msg",
      "id" : "486f3030.3e37b",
      "outputLabels" : [
         "playing",
         "not playing"
      ],
      "wires" : [
         [
            "418d9d7f.f1b724"
         ],
         []
      ],
      "z" : "837bbace.420028",
      "x" : 928.928607940674,
      "property" : "payload",
      "type" : "switch",
      "outputs" : 2,
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "idle"
         },
         {
            "v" : "idle",
            "vt" : "str",
            "t" : "neq"
         }
      ],
      "y" : 440.714297294617,
      "name" : "Idle?",
      "checkall" : "true"
   },
   {
      "rules" : [
         {
            "p" : "payload",
            "pt" : "msg",
            "to" : "stop",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "Stop loop",
      "y" : 560.714291572571,
      "id" : "9e8babc9.4d8f38",
      "from" : "",
      "action" : "",
      "property" : "",
      "wires" : [
         [
            "7c67e682.4ceaf8"
         ]
      ],
      "x" : 799.642807551792,
      "z" : "837bbace.420028",
      "to" : ""
   },
   {
      "wires" : [
         [
            "7c67e682.4ceaf8"
         ]
      ],
      "z" : "837bbace.420028",
      "randomFirst" : "1",
      "rate" : "1",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "timeout" : "3",
      "x" : 196.07133102417,
      "id" : "221ab23b.8631fe",
      "name" : "",
      "y" : 460.999995231628,
      "rateUnits" : "second",
      "pauseType" : "delay"
   },
   {
      "id" : "dc0c97dd.b57788",
      "func" : "greetings = [\n            \"Hooray! Dad is here!\",\n            \"Oh yeah, Dad is back!\",\n            \"Hey, better get ready to rumble, your Dad is back!\",\n            \"Woohoo! Daddy is home!\",\n            \"The king of the castle has returned!\",\n            \"Dad's back!\",\n            \"Daddy is home!\",\n            \"Hey, Dad just got home!\"\n            ];\n\ngreeting = greetings[Math.floor(Math.random()*greetings.length)];\nmsg.payload = { data: {'message': greeting } };\n\nreturn msg;",
      "wires" : [
         [
            "ed6d9df1.0fd81"
         ]
      ],
      "x" : 796.857116699219,
      "z" : "46ed0d55.4c98b4",
      "noerr" : 0,
      "outputs" : 1,
      "type" : "function",
      "name" : "Format message",
      "y" : 434.392835617065
   },
   {
      "id" : "ed6d9df1.0fd81",
      "type" : "subflow:837bbace.420028",
      "name" : "",
      "wires" : [
         [
            "e03928ff.4d5588"
         ],
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "x" : 975.714263916016,
      "y" : 434.964307785034
   },
   {
      "name" : "Continue on to the output after the speakers are idle",
      "y" : 396.428586006165,
      "type" : "comment",
      "z" : "837bbace.420028",
      "wires" : [],
      "x" : 220.357128143311,
      "id" : "eb96e414.d242a8",
      "info" : ""
   },
   {
      "y" : 200,
      "name" : "Is guest mode on?",
      "type" : "function",
      "outputs" : 2,
      "noerr" : 0,
      "wires" : [
         [],
         []
      ],
      "x" : 610,
      "z" : "3844d016.18a29",
      "func" : "guest_mode          = global.get('guest_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.guest_mode      = guest_mode;\n\nif( guest_mode == 'on' || ha_uptime_sec < 180) {\n    msg.abort_alert = 1;\n    return [ msg, null ];\n} else {\n    msg.abort_alert = 0;\n    return [ null, msg ];\n}",
      "id" : "c61527c3.d75f98",
      "outputLabels" : [
         "abort",
         "continue"
      ]
   },
   {
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "halt_if" : "",
      "name" : "Guest mode",
      "y" : 120,
      "id" : "a6d97fb.109798",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "988b49ae.a27c78"
         ]
      ],
      "x" : 590,
      "z" : "3844d016.18a29"
   },
   {
      "wires" : [
         []
      ],
      "z" : "3844d016.18a29",
      "x" : 790,
      "noerr" : 0,
      "func" : "global.set('guest_mode',msg.payload);\nreturn msg;",
      "id" : "988b49ae.a27c78",
      "y" : 120,
      "name" : "Set global variables",
      "type" : "function",
      "outputs" : 1
   },
   {
      "rate" : "1",
      "z" : "3844d016.18a29",
      "wires" : [
         [
            "c61527c3.d75f98"
         ]
      ],
      "randomFirst" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "id" : "1d2995b.befbb6a",
      "timeout" : "1",
      "x" : 400,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 200
   },
   {
      "y" : 80,
      "name" : "HA Uptime",
      "halt_if" : "",
      "type" : "api-current-state",
      "entity_id" : "sensor.ha_uptime_sec",
      "z" : "3844d016.18a29",
      "wires" : [
         [
            "7e940c76.a90b54"
         ]
      ],
      "x" : 590,
      "server" : "e2a02faf.48099",
      "id" : "421449d8.238b68"
   },
   {
      "id" : "7e940c76.a90b54",
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "wires" : [
         []
      ],
      "noerr" : 0,
      "x" : 790,
      "z" : "3844d016.18a29",
      "outputs" : 1,
      "type" : "function",
      "name" : "Set global variables",
      "y" : 80
   },
   {
      "type" : "comment",
      "name" : "Checks if guest mode is on, and that HA has not restarted in last three min",
      "y" : 160,
      "id" : "e5466c9c.1ea8",
      "info" : "",
      "wires" : [],
      "z" : "3844d016.18a29",
      "x" : 770
   },
   {
      "x" : 370,
      "wires" : [],
      "z" : "837bbace.420028",
      "info" : "",
      "id" : "2f9ab588.1d5f3a",
      "y" : 220,
      "name" : "Continue flow without speaking",
      "type" : "comment"
   },
   {
      "type" : "comment",
      "y" : 400,
      "name" : "Continue flow after speaking is complete",
      "info" : "",
      "id" : "998fb1bf.37859",
      "wires" : [],
      "z" : "837bbace.420028",
      "x" : 1360
   },
   {
      "y" : 300,
      "name" : "Is family away?",
      "type" : "function",
      "outputs" : 2,
      "x" : 460,
      "wires" : [
         [],
         []
      ],
      "noerr" : 0,
      "z" : "2283eff7.ee9ab",
      "func" : "family_mode         = global.get('family_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.family_mode     = family_mode;\n\nif( family_mode == 'not_home' && ha_uptime_sec > 600) {\n    msg.abort_alert = 1;\n    return[msg,null];\n} else {\n    msg.abort_alert = 0;\n    return[null,msg];    \n}",
      "id" : "2c2c6211.b4bd2e",
      "outputLabels" : [
         "abort",
         "continue"
      ]
   },
   {
      "entity_id" : "group.family",
      "type" : "api-current-state",
      "name" : "Family Mode",
      "halt_if" : "",
      "y" : 220,
      "server" : "e2a02faf.48099",
      "id" : "7ed74b51.666eb4",
      "z" : "2283eff7.ee9ab",
      "wires" : [
         [
            "f722b66a.716df8"
         ]
      ],
      "x" : 470
   },
   {
      "id" : "f722b66a.716df8",
      "wires" : [
         []
      ],
      "noerr" : 0,
      "x" : 670,
      "z" : "2283eff7.ee9ab",
      "func" : "global.set('family_mode',msg.payload);\nreturn msg;",
      "type" : "function",
      "outputs" : 1,
      "y" : 220,
      "name" : "Set global variables"
   },
   {
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "2283eff7.ee9ab",
      "wires" : [
         [
            "2c2c6211.b4bd2e"
         ]
      ],
      "pauseType" : "delay",
      "rateUnits" : "second",
      "y" : 300,
      "name" : "",
      "id" : "d349f480.c33fe8",
      "x" : 260,
      "timeout" : "1"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "sensor.ha_uptime_sec",
      "y" : 180,
      "halt_if" : "",
      "name" : "HA Uptime",
      "id" : "341e614.4cf539e",
      "server" : "e2a02faf.48099",
      "x" : 470,
      "wires" : [
         [
            "51e3ebc5.8916f4"
         ]
      ],
      "z" : "2283eff7.ee9ab"
   },
   {
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "wires" : [
         []
      ],
      "z" : "2283eff7.ee9ab",
      "x" : 670,
      "noerr" : 0,
      "id" : "51e3ebc5.8916f4",
      "name" : "Set global variables",
      "y" : 180,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "name" : "Checks if family is home and that HA has not restarted in last ten min",
      "y" : 260,
      "type" : "comment",
      "z" : "2283eff7.ee9ab",
      "wires" : [],
      "x" : 620,
      "id" : "6c6b0abf.f06134",
      "info" : ""
   },
   {
      "type" : "subflow:2283eff7.ee9ab",
      "id" : "99c0bcdb.ffe2",
      "z" : "46ed0d55.4c98b4",
      "wires" : [
         [
            "79c82ba9.4d4844"
         ]
      ],
      "x" : 1350,
      "y" : 140,
      "name" : ""
   },
   {
      "id" : "120f24e0.ee07cb",
      "info" : "",
      "x" : 130,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "type" : "comment",
      "name" : "Refresh the Z-Wave Graph",
      "y" : 2080
   },
   {
      "id" : "53f5bc28.d21604",
      "once" : false,
      "wires" : [
         [
            "4a53626f.fbc04c"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 150,
      "payloadType" : "date",
      "type" : "inject",
      "repeat" : "3600",
      "payload" : "",
      "topic" : "Once an hour",
      "y" : 2120,
      "crontab" : "",
      "name" : ""
   },
   {
      "service_domain" : "shell_command",
      "id" : "4a53626f.fbc04c",
      "server" : "e2a02faf.48099",
      "data" : "{ }",
      "service" : "z_wave_graph",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "x" : 493.333333333333,
      "type" : "api-call-service",
      "name" : "Call Z-Wave Graph script",
      "y" : 2120
   },
   {
      "outputs" : "2",
      "type" : "function",
      "name" : "Clear msg and switch",
      "y" : 60,
      "id" : "6ef4d34d.bd056c",
      "outputLabels" : [
         "walt",
         "wife"
      ],
      "func" : "// Clear our msg object as the service call to\n// update our location doesn't seem to like it\nnewmsg = {};\nnewmsg.payload = \"Update\";\n\nif(msg.person == \"walt\") {\n    return[ newmsg, null ];\n} else if(msg.person == \"wife\") {\n    return[ null, newmsg ];\n}",
      "wires" : [
         [
            "2660ad34.a38e12"
         ],
         [
            "411ea.0d815e17"
         ]
      ],
      "x" : 1380,
      "z" : "46ed0d55.4c98b4",
      "noerr" : 0
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "device_tracker",
      "id" : "2660ad34.a38e12",
      "service" : "icloud_set_interval",
      "data" : "{\"device_name\":\"your-email-addresssiphone\",\"interval\":\"1\"}",
      "x" : 1760,
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "type" : "api-call-service",
      "name" : "Set tracking interval to 1min for Walt's iPhone",
      "y" : 40
   },
   {
      "service_domain" : "device_tracker",
      "server" : "e2a02faf.48099",
      "id" : "411ea.0d815e17",
      "data" : "{\"device_name\":\"wifesiphone\",\"interval\":\"1\"}",
      "service" : "icloud_set_interval",
      "x" : 1760,
      "wires" : [
         []
      ],
      "z" : "46ed0d55.4c98b4",
      "type" : "api-call-service",
      "name" : "Set tracking interval to 1min for Wife's iPhone",
      "y" : 100
   },
   {
      "service_domain" : "light",
      "id" : "9986ae2c.144e8",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "797998e3.1aab48"
         ]
      ],
      "x" : 690,
      "z" : "e0703c90.1a341",
      "data" : "{\"entity_id\":\"light.stairs\"}",
      "service" : "toggle",
      "type" : "api-call-service",
      "y" : 80,
      "mergecontext" : "",
      "name" : "Toggle stairs"
   },
   {
      "id" : "deca1dbf.432f7",
      "once" : false,
      "onceDelay" : 0.1,
      "x" : 140,
      "wires" : [
         [
            "a470daf1.a68cf8"
         ]
      ],
      "z" : "e0703c90.1a341",
      "payloadType" : "date",
      "repeat" : "",
      "type" : "inject",
      "name" : "",
      "crontab" : "",
      "payload" : "",
      "y" : 80,
      "topic" : ""
   },
   {
      "tosidebar" : true,
      "wires" : [],
      "x" : 910,
      "z" : "e0703c90.1a341",
      "id" : "797998e3.1aab48",
      "active" : true,
      "complete" : "true",
      "name" : "",
      "tostatus" : true,
      "y" : 80,
      "console" : false,
      "type" : "debug"
   },
   {
      "wires" : [],
      "x" : 590,
      "z" : "e0703c90.1a341",
      "tosidebar" : true,
      "active" : true,
      "id" : "4a28ac6e.c668e4",
      "y" : 240,
      "complete" : "true",
      "tostatus" : true,
      "name" : "Entry",
      "type" : "debug",
      "console" : false
   },
   {
      "name" : "Toggle entry",
      "mergecontext" : "",
      "y" : 80,
      "type" : "api-call-service",
      "data" : "{\"entity_id\":\"light.entry\"}",
      "service" : "toggle",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "9986ae2c.144e8",
            "4a28ac6e.c668e4"
         ]
      ],
      "x" : 350,
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "e2f544d5.00e818"
   },
   {
      "wires" : [
         [
            "eb241633.d13588"
         ]
      ],
      "x" : 230,
      "z" : "e0703c90.1a341",
      "id" : "a470daf1.a68cf8",
      "server" : "e2a02faf.48099",
      "startdate" : "2018-02-19T10:00+00:00",
      "name" : "History test",
      "y" : 160,
      "type" : "api-get-history"
   },
   {
      "active" : true,
      "id" : "eb241633.d13588",
      "wires" : [],
      "x" : 400,
      "z" : "e0703c90.1a341",
      "tosidebar" : true,
      "type" : "debug",
      "console" : false,
      "y" : 240,
      "complete" : "true",
      "tostatus" : true,
      "name" : "History"
   },
   {
      "outputs" : 1,
      "rules" : [
         {
            "v" : "14400000",
            "t" : "gt",
            "vt" : "num"
         }
      ],
      "type" : "switch",
      "repair" : false,
      "name" : "Offline for 4 hours",
      "checkall" : "true",
      "y" : 720,
      "id" : "7bd120de.5714c",
      "propertyType" : "msg",
      "property" : "payload.timeSinceChangedMs",
      "wires" : [
         [
            "8e046ec0.60f3e"
         ]
      ],
      "z" : "10fa16ea.e265b9",
      "x" : 570
   },
   {
      "outputs" : 1,
      "rules" : [
         {
            "v" : "not_home",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "type" : "switch",
      "repair" : false,
      "name" : "Offline",
      "checkall" : "true",
      "y" : 720,
      "id" : "211c28b0.54bb88",
      "propertyType" : "msg",
      "property" : "payload.data.state",
      "wires" : [
         [
            "7bd120de.5714c"
         ]
      ],
      "z" : "10fa16ea.e265b9",
      "x" : 410
   },
   {
      "func" : "device      = msg.topic.replace(/^.*\\.(.*)/, '$1');\nmsg.payload = { data: {'message': device + ' has been offline for four hours','name':'Node-Red' } };\n\nreturn msg;",
      "wires" : [
         [
            "5918c5f2.3a4f1c"
         ]
      ],
      "x" : 950,
      "z" : "10fa16ea.e265b9",
      "noerr" : 0,
      "id" : "38dddb82.ea4a84",
      "name" : "Format message",
      "y" : 740,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "randomFirst" : "1",
      "z" : "10fa16ea.e265b9",
      "wires" : [
         [
            "38dddb82.ea4a84",
            "7aee7e9e.273f6"
         ]
      ],
      "rate" : "1",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "timeout" : "5",
      "x" : 770,
      "id" : "8e046ec0.60f3e",
      "name" : "",
      "y" : 720,
      "rateUnits" : "day",
      "pauseType" : "rate"
   },
   {
      "service" : "ios_walts_iphone",
      "data" : "{ }",
      "wires" : [
         []
      ],
      "z" : "10fa16ea.e265b9",
      "x" : 1210,
      "service_domain" : "notify",
      "id" : "a6b1d175.98fc1",
      "server" : "e2a02faf.48099",
      "mergecontext" : "",
      "name" : "Notify Walt",
      "y" : 700,
      "type" : "api-call-service"
   },
   {
      "x" : 1220,
      "wires" : [
         []
      ],
      "z" : "10fa16ea.e265b9",
      "data" : "",
      "service" : "log",
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "5918c5f2.3a4f1c",
      "y" : 740,
      "name" : "Logbook entry",
      "mergecontext" : "",
      "type" : "api-call-service"
   },
   {
      "id" : "a0e46949.272428",
      "server" : "e2a02faf.48099",
      "outputonchanged" : false,
      "wires" : [
         [
            "705eb8d8.c2b168"
         ]
      ],
      "x" : 110,
      "z" : "20661f8a.532c4",
      "updateinterval" : "60",
      "entity_id" : "device_tracker.familyroommini",
      "type" : "poll-state",
      "outputinitially" : false,
      "name" : "Family Room Mini",
      "y" : 2240
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "711512fe.cf2cac"
         ]
      ],
      "x" : 90,
      "outputonchanged" : false,
      "server" : "e2a02faf.48099",
      "id" : "7979d4d0.07b99c",
      "y" : 2280,
      "outputinitially" : false,
      "name" : "Kitchen Mini",
      "entity_id" : "device_tracker.kitchenmini",
      "updateinterval" : "60",
      "type" : "poll-state"
   },
   {
      "id" : "705eb8d8.c2b168",
      "type" : "subflow:10fa16ea.e265b9",
      "name" : "",
      "wires" : [],
      "x" : 600,
      "z" : "20661f8a.532c4",
      "y" : 2240
   },
   {
      "wires" : [],
      "x" : 600,
      "z" : "20661f8a.532c4",
      "y" : 2280,
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "id" : "711512fe.cf2cac"
   },
   {
      "outputonchanged" : false,
      "wires" : [
         [
            "13a88832.41bf98"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 110,
      "id" : "9f820cc1.aec5a",
      "server" : "e2a02faf.48099",
      "outputinitially" : false,
      "name" : "Son1 Humidifier",
      "y" : 2320,
      "updateinterval" : "60",
      "entity_id" : "device_tracker.haydenhumidifier",
      "type" : "poll-state"
   },
   {
      "wires" : [
         [
            "3e5eafc1.4faa1"
         ]
      ],
      "x" : 110,
      "z" : "20661f8a.532c4",
      "outputonchanged" : false,
      "server" : "e2a02faf.48099",
      "id" : "9a386127.2920c",
      "y" : 2360,
      "name" : "Master Humidifier",
      "outputinitially" : false,
      "entity_id" : "device_tracker.masterhumidifier",
      "type" : "poll-state",
      "updateinterval" : "60"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "e8f8e6e7.caea58",
      "outputonchanged" : false,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "1870d4d.0a4be2b"
         ]
      ],
      "x" : 90,
      "entity_id" : "device_tracker.howdorbisat1",
      "updateinterval" : "60",
      "type" : "poll-state",
      "outputinitially" : false,
      "name" : "Orbi Satellite",
      "y" : 2400
   },
   {
      "name" : "Nest Thermostat",
      "outputinitially" : false,
      "y" : 2440,
      "updateinterval" : "60",
      "entity_id" : "device_tracker.nestthermostat",
      "type" : "poll-state",
      "outputonchanged" : false,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "77a6e48d.dec1ec"
         ]
      ],
      "x" : 100,
      "id" : "f58e2756.533a88",
      "server" : "e2a02faf.48099"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "f25943cd.95798",
      "wires" : [
         [
            "3c6c1487.097d5c"
         ]
      ],
      "x" : 100,
      "z" : "20661f8a.532c4",
      "outputonchanged" : false,
      "entity_id" : "device_tracker.garageopener",
      "updateinterval" : "60",
      "type" : "poll-state",
      "y" : 2480,
      "outputinitially" : false,
      "name" : "Garage Opener"
   },
   {
      "id" : "13a88832.41bf98",
      "type" : "subflow:10fa16ea.e265b9",
      "name" : "",
      "y" : 2320,
      "x" : 600,
      "wires" : [],
      "z" : "20661f8a.532c4"
   },
   {
      "type" : "subflow:10fa16ea.e265b9",
      "id" : "3e5eafc1.4faa1",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 600,
      "y" : 2360,
      "name" : ""
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 600,
      "y" : 2400,
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "id" : "1870d4d.0a4be2b"
   },
   {
      "id" : "77a6e48d.dec1ec",
      "type" : "subflow:10fa16ea.e265b9",
      "name" : "",
      "y" : 2440,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 600
   },
   {
      "y" : 2480,
      "wires" : [],
      "x" : 600,
      "z" : "20661f8a.532c4",
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "id" : "3c6c1487.097d5c"
   },
   {
      "name" : "",
      "y" : 2520,
      "x" : 600,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "id" : "1c397c50.a1bcb4",
      "type" : "subflow:10fa16ea.e265b9"
   },
   {
      "name" : "",
      "y" : 2560,
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 600,
      "id" : "493512b3.2658fc",
      "type" : "subflow:10fa16ea.e265b9"
   },
   {
      "y" : 2600,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 600,
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "id" : "c67044b1.a536f8"
   },
   {
      "name" : "",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 600,
      "y" : 2640,
      "id" : "186044bf.323f5b",
      "type" : "subflow:10fa16ea.e265b9"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 600,
      "y" : 2680,
      "name" : "",
      "type" : "subflow:10fa16ea.e265b9",
      "id" : "6d8de964.7a72f8"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "1c397c50.a1bcb4"
         ]
      ],
      "x" : 90,
      "outputonchanged" : false,
      "server" : "e2a02faf.48099",
      "id" : "648f4a2a.7e6094",
      "y" : 2520,
      "outputinitially" : false,
      "name" : "Son2s Lamp",
      "updateinterval" : "60",
      "entity_id" : "device_tracker.colinslamp",
      "type" : "poll-state"
   },
   {
      "x" : 130,
      "wires" : [
         [
            "493512b3.2658fc"
         ]
      ],
      "z" : "20661f8a.532c4",
      "outputonchanged" : false,
      "id" : "f7280e01.82523",
      "server" : "e2a02faf.48099",
      "y" : 2560,
      "name" : "Family Room Floor Lamp",
      "outputinitially" : false,
      "updateinterval" : "60",
      "entity_id" : "device_tracker.familyroomfloorlamp",
      "type" : "poll-state"
   },
   {
      "updateinterval" : "60",
      "entity_id" : "device_tracker.familyroomlamp",
      "type" : "poll-state",
      "name" : "Family Room Lamp",
      "outputinitially" : false,
      "y" : 2600,
      "server" : "e2a02faf.48099",
      "id" : "68dd3d8b.f05994",
      "outputonchanged" : false,
      "wires" : [
         [
            "c67044b1.a536f8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 110
   },
   {
      "outputinitially" : false,
      "name" : "Living Room Lamp",
      "y" : 2640,
      "entity_id" : "device_tracker.livingroomlamps",
      "updateinterval" : "60",
      "type" : "poll-state",
      "outputonchanged" : false,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "186044bf.323f5b"
         ]
      ],
      "x" : 110,
      "server" : "e2a02faf.48099",
      "id" : "57eff7bf.51b658"
   },
   {
      "updateinterval" : "60",
      "entity_id" : "device_tracker.officelamps",
      "type" : "poll-state",
      "name" : "Office Lamps",
      "outputinitially" : false,
      "y" : 2680,
      "id" : "905adc42.a5a65",
      "server" : "e2a02faf.48099",
      "outputonchanged" : false,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "6d8de964.7a72f8"
         ]
      ],
      "x" : 90
   },
   {
      "info" : "",
      "id" : "5d30542b.8b0dfc",
      "wires" : [],
      "x" : 170,
      "z" : "20661f8a.532c4",
      "type" : "comment",
      "y" : 2200,
      "name" : "Report if any network devices are offline"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "83924e76.ce656",
      "wires" : [
         [
            "4ac59736.e70218"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 360,
      "entity_id" : "climate.hallway_nest",
      "type" : "api-current-state",
      "halt_if" : "",
      "name" : "Current house temperature",
      "y" : 120
   },
   {
      "type" : "inject",
      "repeat" : "60",
      "payload" : "",
      "y" : 660,
      "topic" : "",
      "crontab" : "",
      "name" : "",
      "once" : false,
      "id" : "86f5a1b9.97ce5",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "83924e76.ce656",
            "ad504a65.d52188",
            "263b2223.8f6b9e",
            "e194ba1b.4f73e8",
            "ccff40bc.f5621",
            "b30cf939.0dc3c8",
            "4a88fb80.e5d3f4",
            "bdbb5e2b.2423d",
            "3abf4613.9bf6ba",
            "979957ce.4c6648",
            "8646cb98.12e708",
            "c836a3d7.3cfba",
            "5a44d302.2472dc",
            "12b38f8e.d928",
            "845ca713.652ef8",
            "e41c2a57.3223d8",
            "83b4b32f.c1391",
            "4a699181.4d185",
            "9c7a6221.e6ca",
            "4d395e23.30c5d",
            "981ce0e8.cdfba",
            "25039e35.ef7072",
            "526d53c5.a3ab2c",
            "7a85784d.5c3d08"
         ]
      ],
      "x" : 70,
      "payloadType" : "date",
      "onceDelay" : 0.1
   },
   {
      "id" : "4ac59736.e70218",
      "from" : "",
      "action" : "",
      "property" : "",
      "x" : 600,
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "rules" : [
         {
            "p" : "payload",
            "to" : "data.attributes.current_temperature",
            "pt" : "msg",
            "t" : "set",
            "tot" : "msg"
         },
         {
            "p" : "topic",
            "pt" : "msg",
            "to" : "Inside Temp (F)",
            "tot" : "str",
            "t" : "set"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "",
      "y" : 120
   },
   {
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "width" : "0",
      "ymin" : "",
      "order" : 1,
      "legend" : "true",
      "removeOlder" : 1,
      "height" : "0",
      "removeOlderUnit" : "86400",
      "cutout" : 0,
      "label" : "Temperature",
      "useOldStyle" : false,
      "type" : "ui_chart",
      "x" : 930,
      "dot" : false,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "5a104785.e8d4c8",
      "useOneColor" : false,
      "removeOlderPoints" : "",
      "ymax" : "",
      "xformat" : "HH:mm:ss",
      "name" : "",
      "interpolate" : "linear",
      "y" : 280,
      "nodata" : "",
      "chartType" : "line",
      "group" : "ea10f06.a52e21"
   },
   {
      "id" : "ad504a65.d52188",
      "server" : "e2a02faf.48099",
      "x" : 380,
      "wires" : [
         [
            "5d63eaa8.7a7f84"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "type" : "api-current-state",
      "entity_id" : "sensor.dark_sky_temperature",
      "y" : 160,
      "name" : "Outside temperature",
      "halt_if" : ""
   },
   {
      "name" : "",
      "reg" : false,
      "y" : 160,
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "to" : "Outside Temp (F)",
            "pt" : "msg"
         }
      ],
      "type" : "change",
      "property" : "",
      "action" : "",
      "to" : "",
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "x" : 600,
      "z" : "7d04740a.ad6adc",
      "id" : "5d63eaa8.7a7f84",
      "from" : ""
   },
   {
      "onceDelay" : 0.1,
      "wires" : [
         [
            "c03971e8.300f3"
         ]
      ],
      "x" : 120,
      "z" : "7d04740a.ad6adc",
      "payloadType" : "str",
      "id" : "3d2e97bd.8e0468",
      "once" : false,
      "name" : "Clear chart",
      "crontab" : "",
      "payload" : "[ ]",
      "y" : 2420,
      "topic" : "",
      "repeat" : "",
      "type" : "inject"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "jsonata",
            "pt" : "msg",
            "to" : "[ ]",
            "p" : "payload"
         }
      ],
      "y" : 2420,
      "reg" : false,
      "name" : "",
      "from" : "",
      "id" : "c03971e8.300f3",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         []
      ],
      "x" : 300,
      "to" : "",
      "action" : "",
      "property" : ""
   },
   {
      "type" : "api-current-state",
      "entity_id" : "sensor.garage_motion_sensor_temperature",
      "y" : 200,
      "name" : "Garage temperature",
      "halt_if" : "",
      "id" : "263b2223.8f6b9e",
      "server" : "e2a02faf.48099",
      "x" : 380,
      "wires" : [
         [
            "69c5b640.1f58d8"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "x" : 600,
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "69c5b640.1f58d8",
      "y" : 200,
      "reg" : false,
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "to" : "Garage Temp (F)",
            "pt" : "msg",
            "p" : "topic",
            "t" : "set",
            "tot" : "str"
         }
      ]
   },
   {
      "halt_if" : "",
      "name" : "Stairs temperature",
      "y" : 240,
      "type" : "api-current-state",
      "entity_id" : "sensor.garage_stairs_motion_sensor_temperature",
      "wires" : [
         [
            "683f99af.82e308"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 390,
      "id" : "e194ba1b.4f73e8",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "683f99af.82e308",
      "from" : "",
      "action" : "",
      "property" : "",
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "x" : 600,
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "rules" : [
         {
            "p" : "topic",
            "to" : "Stairs Temp (F)",
            "pt" : "msg",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "type" : "change",
      "name" : "",
      "reg" : false,
      "y" : 240
   },
   {
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "2cea6c34.1d5b84",
      "x" : 960,
      "max" : "100",
      "gtype" : "gage",
      "seg1" : "",
      "group" : "2a707ff1.43daa",
      "y" : 360,
      "min" : 0,
      "name" : "",
      "seg2" : "",
      "width" : "2",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "format" : "{{value}}",
      "type" : "ui_gauge",
      "label" : "pct",
      "height" : "2",
      "title" : "Walt's Phone Battery",
      "order" : 1
   },
   {
      "wires" : [
         [
            "cb7119d2.4ddc68"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 380,
      "server" : "e2a02faf.48099",
      "id" : "ccff40bc.f5621",
      "name" : "Walt's phone battery",
      "halt_if" : "",
      "y" : 360,
      "entity_id" : "sensor.walt_howds_iphone_battery_level",
      "type" : "api-current-state"
   },
   {
      "name" : "",
      "reg" : false,
      "y" : 360,
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "pt" : "msg",
            "to" : "Walt's iPhone X Battery",
            "p" : "topic"
         }
      ],
      "type" : "change",
      "action" : "",
      "property" : "",
      "x" : 600,
      "wires" : [
         [
            "2cea6c34.1d5b84"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "id" : "cb7119d2.4ddc68",
      "from" : ""
   },
   {
      "x" : 380,
      "wires" : [
         [
            "bac172a5.2576a"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "server" : "e2a02faf.48099",
      "id" : "b30cf939.0dc3c8",
      "name" : "Wife's phone battery",
      "halt_if" : "",
      "y" : 400,
      "entity_id" : "sensor.wifes_iphone_battery_level",
      "type" : "api-current-state"
   },
   {
      "y" : 400,
      "reg" : false,
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "pt" : "msg",
            "to" : "Wife's iPhone SE Battery"
         }
      ],
      "to" : "",
      "wires" : [
         [
            "8411402.7b38bc"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 600,
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "bac172a5.2576a"
   },
   {
      "format" : "{{value}}",
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "width" : "2",
      "title" : "Wife's Phone Battery",
      "order" : 3,
      "height" : "2",
      "type" : "ui_gauge",
      "label" : "pct",
      "x" : 960,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "8411402.7b38bc",
      "name" : "",
      "seg2" : "",
      "y" : 400,
      "min" : 0,
      "group" : "2a707ff1.43daa",
      "max" : "100",
      "gtype" : "gage",
      "seg1" : ""
   },
   {
      "wires" : [
         [
            "6993b677.9229a8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 390,
      "server" : "e2a02faf.48099",
      "id" : "4a88fb80.e5d3f4",
      "halt_if" : "",
      "name" : "Stairs Door Sensor",
      "y" : 440,
      "entity_id" : "zwave.stairs_door",
      "type" : "api-current-state"
   },
   {
      "label" : "pct",
      "type" : "ui_gauge",
      "height" : "1",
      "order" : 6,
      "title" : "Stairs Door Battery",
      "width" : "1",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "format" : "{{value}}",
      "seg1" : "",
      "max" : "100",
      "gtype" : "gage",
      "group" : "2a707ff1.43daa",
      "min" : 0,
      "y" : 440,
      "seg2" : "",
      "name" : "",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "29d65706.f35408",
      "x" : 950
   },
   {
      "halt_if" : "",
      "name" : "Screened Porch Door Sensor",
      "y" : 480,
      "entity_id" : "zwave.screened_porch_door",
      "type" : "api-current-state",
      "wires" : [
         [
            "faed0bb3.204208"
         ]
      ],
      "x" : 360,
      "z" : "7d04740a.ad6adc",
      "server" : "e2a02faf.48099",
      "id" : "bdbb5e2b.2423d"
   },
   {
      "width" : "1",
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "format" : "{{value}}",
      "label" : "pct",
      "type" : "ui_gauge",
      "height" : "1",
      "order" : 7,
      "title" : "Screened Porch Door Battery",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "b18d5e95.2d863",
      "x" : 980,
      "seg1" : "",
      "max" : "100",
      "gtype" : "gage",
      "group" : "2a707ff1.43daa",
      "min" : 0,
      "y" : 480,
      "seg2" : "",
      "name" : ""
   },
   {
      "to" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "29d65706.f35408"
         ]
      ],
      "x" : 600,
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "6993b677.9229a8",
      "y" : 440,
      "name" : "",
      "reg" : false,
      "type" : "change",
      "rules" : [
         {
            "pt" : "msg",
            "to" : "data.attributes.battery_level",
            "p" : "payload",
            "tot" : "msg",
            "t" : "set"
         }
      ]
   },
   {
      "reg" : false,
      "name" : "",
      "y" : 480,
      "rules" : [
         {
            "tot" : "msg",
            "t" : "set",
            "pt" : "msg",
            "to" : "data.attributes.battery_level",
            "p" : "payload"
         }
      ],
      "type" : "change",
      "property" : "",
      "action" : "",
      "to" : "",
      "wires" : [
         [
            "b18d5e95.2d863"
         ]
      ],
      "x" : 600,
      "z" : "7d04740a.ad6adc",
      "id" : "faed0bb3.204208",
      "from" : ""
   },
   {
      "halt_if" : "",
      "name" : "Network Gear Switch",
      "y" : 1200,
      "entity_id" : "zwave.network_gear",
      "type" : "api-current-state",
      "wires" : [
         [
            "4b4c7137.f5d61"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 380,
      "id" : "3abf4613.9bf6ba",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 560,
      "reg" : false,
      "name" : "sentCnt",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "payload",
            "pt" : "msg",
            "to" : "data.attributes.sentCnt"
         },
         {
            "p" : "topic",
            "to" : "Sent Count",
            "pt" : "msg",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "to" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "x" : 580,
      "z" : "e7369e7e.c4997",
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "4e7b7986.58bb08"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "payload",
            "to" : "data.attributes.sentFailed",
            "pt" : "msg"
         },
         {
            "p" : "topic",
            "pt" : "msg",
            "to" : "Sent Failed",
            "tot" : "str",
            "t" : "set"
         }
      ],
      "y" : 600,
      "name" : "sentFailed",
      "reg" : false,
      "from" : "",
      "id" : "214e99ab.4f5526",
      "to" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "z" : "e7369e7e.c4997",
      "x" : 590,
      "property" : "",
      "action" : ""
   },
   {
      "rules" : [
         {
            "tot" : "msg",
            "t" : "set",
            "p" : "payload",
            "pt" : "msg",
            "to" : "data.attributes.retries"
         },
         {
            "t" : "set",
            "tot" : "str",
            "pt" : "msg",
            "to" : "Retries",
            "p" : "topic"
         }
      ],
      "type" : "change",
      "name" : "retries",
      "reg" : false,
      "y" : 640,
      "id" : "68eb7364.aad87c",
      "from" : "",
      "property" : "",
      "action" : "",
      "to" : "",
      "z" : "e7369e7e.c4997",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "x" : 570
   },
   {
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "payload",
            "pt" : "msg",
            "to" : "data.attributes.receivedCnt"
         },
         {
            "t" : "set",
            "tot" : "str",
            "p" : "topic",
            "to" : "Received Count",
            "pt" : "msg"
         }
      ],
      "type" : "change",
      "name" : "receivedCnt",
      "reg" : false,
      "y" : 680,
      "id" : "54991c1.78ecbe4",
      "from" : "",
      "action" : "",
      "property" : "",
      "z" : "e7369e7e.c4997",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "x" : 590,
      "to" : ""
   },
   {
      "id" : "a3733f2f.b5a8e",
      "from" : "",
      "action" : "",
      "property" : "",
      "x" : 600,
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "z" : "e7369e7e.c4997",
      "to" : "",
      "rules" : [
         {
            "pt" : "msg",
            "to" : "data.attributes.receivedDups",
            "p" : "payload",
            "tot" : "msg",
            "t" : "set"
         },
         {
            "p" : "topic",
            "to" : "Received Duplicates",
            "pt" : "msg",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "receivedDups",
      "y" : 720
   },
   {
      "y" : 760,
      "reg" : false,
      "name" : "receivedUnsolicited",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "payload",
            "pt" : "msg",
            "to" : "data.attributes.receivedUnsolicited"
         },
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "to" : "Received Unsolicited",
            "pt" : "msg"
         }
      ],
      "to" : "",
      "x" : 610,
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "z" : "e7369e7e.c4997",
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "9fe1c21b.2a6e9"
   },
   {
      "rules" : [
         {
            "tot" : "msg",
            "t" : "set",
            "pt" : "msg",
            "to" : "data.attributes.lastRequestRTT",
            "p" : "payload"
         },
         {
            "p" : "topic",
            "to" : "Last Request RTT",
            "pt" : "msg",
            "tot" : "str",
            "t" : "set"
         }
      ],
      "type" : "change",
      "name" : "lastRequestRTT",
      "reg" : false,
      "y" : 800,
      "id" : "9a701131.2f9b",
      "from" : "",
      "action" : "",
      "property" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "x" : 600,
      "z" : "e7369e7e.c4997",
      "to" : ""
   },
   {
      "from" : "",
      "id" : "50627ed0.f018a",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "x" : 620,
      "z" : "e7369e7e.c4997",
      "to" : "",
      "action" : "",
      "property" : "",
      "type" : "change",
      "rules" : [
         {
            "p" : "payload",
            "to" : "data.attributes.averageRequestRTT",
            "pt" : "msg",
            "tot" : "msg",
            "t" : "set"
         },
         {
            "tot" : "str",
            "t" : "set",
            "pt" : "msg",
            "to" : "Average Request RTT",
            "p" : "topic"
         }
      ],
      "y" : 840,
      "reg" : false,
      "name" : "averageRequestRTT"
   },
   {
      "from" : "",
      "id" : "6d690bb1.ae7784",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "z" : "e7369e7e.c4997",
      "x" : 610,
      "to" : "",
      "action" : "",
      "property" : "",
      "type" : "change",
      "rules" : [
         {
            "tot" : "msg",
            "t" : "set",
            "p" : "payload",
            "pt" : "msg",
            "to" : "data.attributes.lastResponseRTT"
         },
         {
            "p" : "topic",
            "pt" : "msg",
            "to" : "Last Response RTT",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "y" : 880,
      "name" : "lastResponseRTT",
      "reg" : false
   },
   {
      "id" : "9d2640a3.6c7b",
      "from" : "",
      "property" : "",
      "action" : "",
      "to" : "",
      "wires" : [
         [
            "59f4f478.f3441c"
         ]
      ],
      "z" : "e7369e7e.c4997",
      "x" : 620,
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "pt" : "msg",
            "to" : "data.attributes.averageResponseRTT",
            "p" : "payload"
         },
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "to" : "Average Response RTT",
            "pt" : "msg"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "averageResponseRTT",
      "y" : 920
   },
   {
      "removeOlderPoints" : "",
      "useOneColor" : false,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "6a65036f.7a8d6c",
      "ymax" : "",
      "dot" : false,
      "x" : 960,
      "group" : "ba683c3d.a294c",
      "chartType" : "line",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "y" : 1200,
      "nodata" : "",
      "interpolate" : "linear",
      "width" : 0,
      "ymin" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [],
         []
      ],
      "cutout" : 0,
      "type" : "ui_chart",
      "useOldStyle" : false,
      "label" : "Network Gear Switch",
      "legend" : "true",
      "order" : 0,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "removeOlder" : 1
   },
   {
      "name" : "Stairs Motion Sensor",
      "halt_if" : "",
      "y" : 520,
      "entity_id" : "zwave.garage_stairs_motion_sensor",
      "type" : "api-current-state",
      "x" : 380,
      "wires" : [
         [
            "18e93cb3.1e9623",
            "faa50576.ce7c68"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "server" : "e2a02faf.48099",
      "id" : "979957ce.4c6648"
   },
   {
      "y" : 520,
      "reg" : false,
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "payload",
            "to" : "data.attributes.battery_level",
            "pt" : "msg"
         }
      ],
      "x" : 600,
      "wires" : [
         [
            "824f42b0.6169f"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "18e93cb3.1e9623"
   },
   {
      "label" : "pct",
      "type" : "ui_gauge",
      "height" : "1",
      "order" : 8,
      "title" : "Stairs Motion Battery",
      "width" : "1",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "format" : "{{value}}",
      "seg1" : "",
      "max" : "100",
      "gtype" : "gage",
      "group" : "2a707ff1.43daa",
      "min" : 0,
      "y" : 520,
      "seg2" : "",
      "name" : "",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "824f42b0.6169f",
      "x" : 960
   },
   {
      "id" : "e1f63ff3.8f1c2",
      "func" : "\nreturn msg;",
      "wires" : [
         [
            "4e7b7986.58bb08",
            "214e99ab.4f5526",
            "68eb7364.aad87c",
            "54991c1.78ecbe4",
            "a3733f2f.b5a8e",
            "9fe1c21b.2a6e9",
            "9a701131.2f9b",
            "50627ed0.f018a",
            "6d690bb1.ae7784",
            "9d2640a3.6c7b"
         ]
      ],
      "x" : 290,
      "noerr" : 0,
      "z" : "e7369e7e.c4997",
      "outputs" : 1,
      "type" : "function",
      "name" : "",
      "y" : 720
   },
   {
      "name" : "",
      "y" : 740,
      "outputs" : 1,
      "type" : "function",
      "func" : "\nreturn msg;",
      "wires" : [
         []
      ],
      "noerr" : 0,
      "x" : 910,
      "z" : "e7369e7e.c4997",
      "id" : "59f4f478.f3441c"
   },
   {
      "id" : "4b4c7137.f5d61",
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "wires" : [
         [
            "6a65036f.7a8d6c"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 590,
      "y" : 1200
   },
   {
      "x" : 960,
      "dot" : false,
      "ymax" : "",
      "useOneColor" : false,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "c23150db.645b8",
      "removeOlderPoints" : "",
      "interpolate" : "linear",
      "y" : 560,
      "nodata" : "",
      "xformat" : "HH:mm:ss",
      "name" : "",
      "group" : "ba683c3d.a294c",
      "chartType" : "line",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [],
         []
      ],
      "ymin" : "",
      "width" : "6",
      "removeOlder" : 1,
      "height" : "6",
      "removeOlderUnit" : "3600",
      "order" : 0,
      "legend" : "true",
      "label" : "Stairs Motion Sensor",
      "type" : "ui_chart",
      "useOldStyle" : false,
      "cutout" : 0
   },
   {
      "name" : "",
      "x" : 590,
      "wires" : [
         [
            "c23150db.645b8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "y" : 560,
      "id" : "faa50576.ce7c68",
      "type" : "subflow:e7369e7e.c4997"
   },
   {
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "f5f3b176.85c16",
            "88bc8fa7.6d8bc"
         ]
      ],
      "x" : 380,
      "id" : "8646cb98.12e708",
      "server" : "e2a02faf.48099",
      "halt_if" : "",
      "name" : "Garage Motion Sensor",
      "y" : 600,
      "entity_id" : "zwave.garage_motion_sensor",
      "type" : "api-current-state"
   },
   {
      "property" : "",
      "action" : "",
      "to" : "",
      "wires" : [
         [
            "8ca429b2.15c378"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 600,
      "id" : "f5f3b176.85c16",
      "from" : "",
      "name" : "",
      "reg" : false,
      "y" : 600,
      "rules" : [
         {
            "pt" : "msg",
            "to" : "data.attributes.battery_level",
            "p" : "payload",
            "t" : "set",
            "tot" : "msg"
         }
      ],
      "type" : "change"
   },
   {
      "min" : 0,
      "y" : 600,
      "seg2" : "",
      "name" : "",
      "seg1" : "",
      "max" : "100",
      "gtype" : "gage",
      "group" : "2a707ff1.43daa",
      "x" : 960,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "8ca429b2.15c378",
      "height" : "1",
      "order" : 9,
      "title" : "Garage Motion Battery",
      "label" : "pct",
      "type" : "ui_gauge",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "format" : "{{value}}",
      "width" : "1"
   },
   {
      "y" : 640,
      "x" : 590,
      "wires" : [
         [
            "8fa6e687.1f56c8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "name" : "",
      "type" : "subflow:e7369e7e.c4997",
      "id" : "88bc8fa7.6d8bc"
   },
   {
      "ymax" : "",
      "removeOlderPoints" : "",
      "useOneColor" : false,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "8fa6e687.1f56c8",
      "dot" : false,
      "x" : 960,
      "chartType" : "line",
      "group" : "ba683c3d.a294c",
      "nodata" : "",
      "y" : 640,
      "interpolate" : "linear",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "ymin" : "",
      "width" : "6",
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "useOldStyle" : false,
      "type" : "ui_chart",
      "label" : "Garage Motion Sensor",
      "cutout" : 0,
      "height" : "6",
      "removeOlderUnit" : "3600",
      "removeOlder" : 1,
      "legend" : "true",
      "order" : 0
   },
   {
      "name" : "Garage Entry Door South Sensor",
      "halt_if" : "",
      "y" : 680,
      "entity_id" : "zwave.garage_entry_door_south",
      "type" : "api-current-state",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "2bd76c33.095ad4",
            "531b9501.e6fbec"
         ]
      ],
      "x" : 340,
      "server" : "e2a02faf.48099",
      "id" : "c836a3d7.3cfba"
   },
   {
      "id" : "2bd76c33.095ad4",
      "from" : "",
      "action" : "",
      "property" : "",
      "x" : 600,
      "wires" : [
         [
            "fe24df02.87099"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "rules" : [
         {
            "p" : "payload",
            "to" : "data.attributes.battery_level",
            "pt" : "msg",
            "t" : "set",
            "tot" : "msg"
         }
      ],
      "type" : "change",
      "name" : "",
      "reg" : false,
      "y" : 680
   },
   {
      "x" : 970,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "fe24df02.87099",
      "y" : 680,
      "min" : 0,
      "name" : "",
      "seg2" : "",
      "max" : "100",
      "gtype" : "gage",
      "seg1" : "",
      "group" : "2a707ff1.43daa",
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "format" : "{{value}}",
      "width" : "1",
      "height" : "1",
      "title" : "Garage Entry Door South",
      "order" : 10,
      "type" : "ui_gauge",
      "label" : "pct"
   },
   {
      "type" : "subflow:e7369e7e.c4997",
      "id" : "531b9501.e6fbec",
      "y" : 720,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "73cd63c3.485a3c"
         ]
      ],
      "x" : 590,
      "name" : ""
   },
   {
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "ymin" : "",
      "width" : "6",
      "removeOlder" : 1,
      "removeOlderUnit" : "3600",
      "height" : "6",
      "order" : 0,
      "legend" : "true",
      "label" : "Garage Entry Door South",
      "type" : "ui_chart",
      "useOldStyle" : false,
      "cutout" : 0,
      "x" : 970,
      "dot" : false,
      "ymax" : "",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "useOneColor" : false,
      "id" : "73cd63c3.485a3c",
      "removeOlderPoints" : "",
      "interpolate" : "linear",
      "nodata" : "",
      "y" : 720,
      "xformat" : "HH:mm:ss",
      "name" : "",
      "group" : "ba683c3d.a294c",
      "chartType" : "line"
   },
   {
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "2372a3f2.a1e2bc",
            "5f8e674e.df0c58"
         ]
      ],
      "x" : 350,
      "server" : "e2a02faf.48099",
      "id" : "5a44d302.2472dc",
      "name" : "Garage Entry Door North Sensor",
      "halt_if" : "",
      "y" : 760,
      "entity_id" : "zwave.garage_entry_door_north",
      "type" : "api-current-state"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "payload",
            "to" : "data.attributes.battery_level",
            "pt" : "msg"
         }
      ],
      "y" : 760,
      "reg" : false,
      "name" : "",
      "from" : "",
      "id" : "2372a3f2.a1e2bc",
      "wires" : [
         [
            "32972418.d0e90c"
         ]
      ],
      "x" : 600,
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "action" : "",
      "property" : ""
   },
   {
      "type" : "subflow:e7369e7e.c4997",
      "id" : "5f8e674e.df0c58",
      "y" : 800,
      "x" : 590,
      "wires" : [
         [
            "c1aee42b.728268"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "name" : ""
   },
   {
      "seg1" : "",
      "gtype" : "gage",
      "max" : "100",
      "group" : "2a707ff1.43daa",
      "min" : 0,
      "y" : 760,
      "seg2" : "",
      "name" : "",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "32972418.d0e90c",
      "x" : 970,
      "label" : "pct",
      "type" : "ui_gauge",
      "height" : "1",
      "order" : 11,
      "title" : "Garage Entry Door North",
      "width" : "1",
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "format" : "{{value}}"
   },
   {
      "useOneColor" : false,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "c1aee42b.728268",
      "removeOlderPoints" : "",
      "ymax" : "",
      "x" : 970,
      "dot" : false,
      "group" : "ba683c3d.a294c",
      "chartType" : "line",
      "xformat" : "HH:mm:ss",
      "name" : "",
      "interpolate" : "linear",
      "y" : 800,
      "nodata" : "",
      "width" : 0,
      "ymin" : "",
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "cutout" : 0,
      "label" : "Garage Entry Door North",
      "useOldStyle" : false,
      "type" : "ui_chart",
      "order" : 0,
      "legend" : "true",
      "removeOlder" : 1,
      "removeOlderUnit" : "3600",
      "height" : 0
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "12b38f8e.d928",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "69a3c9ea.bc4958",
            "11073475.85b89c"
         ]
      ],
      "x" : 350,
      "entity_id" : "zwave.garage_door_south_tilt",
      "type" : "api-current-state",
      "name" : "Garage Door South TIlt Sensor",
      "halt_if" : "",
      "y" : 840
   },
   {
      "y" : 840,
      "name" : "",
      "reg" : false,
      "type" : "change",
      "rules" : [
         {
            "to" : "data.attributes.battery_level",
            "pt" : "msg",
            "p" : "payload",
            "t" : "set",
            "tot" : "msg"
         }
      ],
      "x" : 600,
      "wires" : [
         [
            "a67b37cd.e327f8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "69a3c9ea.bc4958"
   },
   {
      "type" : "subflow:e7369e7e.c4997",
      "id" : "11073475.85b89c",
      "y" : 880,
      "x" : 590,
      "wires" : [
         [
            "d1ea5082.8e3cf"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "name" : ""
   },
   {
      "group" : "2a707ff1.43daa",
      "seg1" : "",
      "max" : "100",
      "gtype" : "gage",
      "seg2" : "",
      "name" : "",
      "min" : 0,
      "y" : 840,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "a67b37cd.e327f8",
      "x" : 960,
      "label" : "pct",
      "type" : "ui_gauge",
      "order" : 12,
      "title" : "Garage Door South Tilt",
      "height" : "1",
      "width" : "1",
      "format" : "{{value}}",
      "z" : "7d04740a.ad6adc",
      "wires" : []
   },
   {
      "removeOlderPoints" : "",
      "id" : "d1ea5082.8e3cf",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "useOneColor" : false,
      "ymax" : "",
      "dot" : false,
      "x" : 960,
      "chartType" : "line",
      "group" : "ba683c3d.a294c",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "y" : 880,
      "nodata" : "",
      "interpolate" : "linear",
      "width" : 0,
      "ymin" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [],
         []
      ],
      "cutout" : 0,
      "type" : "ui_chart",
      "useOldStyle" : false,
      "label" : "Garage Door South Tilt",
      "legend" : "true",
      "order" : 0,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "removeOlder" : 1
   },
   {
      "type" : "api-current-state",
      "entity_id" : "zwave.garage_door_north_tilt",
      "y" : 920,
      "name" : "Garage Door South TIlt Sensor",
      "halt_if" : "",
      "id" : "845ca713.652ef8",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "a4d52a05.5764c8",
            "db484d0f.ecf26"
         ]
      ],
      "x" : 350,
      "z" : "7d04740a.ad6adc"
   },
   {
      "to" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "e942ef5f.b3516"
         ]
      ],
      "x" : 600,
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "a4d52a05.5764c8",
      "y" : 920,
      "name" : "",
      "reg" : false,
      "type" : "change",
      "rules" : [
         {
            "to" : "data.attributes.battery_level",
            "pt" : "msg",
            "p" : "payload",
            "tot" : "msg",
            "t" : "set"
         }
      ]
   },
   {
      "id" : "db484d0f.ecf26",
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "x" : 590,
      "wires" : [
         [
            "d4321b8c.015128"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "y" : 960
   },
   {
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "e942ef5f.b3516",
      "x" : 960,
      "group" : "2a707ff1.43daa",
      "seg1" : "",
      "gtype" : "gage",
      "max" : "100",
      "seg2" : "",
      "name" : "",
      "min" : 0,
      "y" : 920,
      "width" : "1",
      "format" : "{{value}}",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "label" : "pct",
      "type" : "ui_gauge",
      "order" : 13,
      "title" : "Garage Door North Tilt",
      "height" : "1"
   },
   {
      "dot" : false,
      "x" : 960,
      "ymax" : "",
      "removeOlderPoints" : "",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "useOneColor" : false,
      "id" : "d4321b8c.015128",
      "y" : 960,
      "nodata" : "",
      "interpolate" : "linear",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "group" : "ba683c3d.a294c",
      "chartType" : "line",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [],
         []
      ],
      "ymin" : "",
      "width" : 0,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "removeOlder" : 1,
      "legend" : "true",
      "order" : 0,
      "type" : "ui_chart",
      "useOldStyle" : false,
      "label" : "Garage Door North Tilt",
      "cutout" : 0
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "e41c2a57.3223d8",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "3f5d8256.4fc66e"
         ]
      ],
      "x" : 390,
      "type" : "api-current-state",
      "entity_id" : "zwave.front_door_switch",
      "y" : 1160,
      "halt_if" : "",
      "name" : "Front Porch Switch"
   },
   {
      "id" : "3f5d8256.4fc66e",
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "wires" : [
         [
            "144a6220.e7f98e"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 590,
      "y" : 1160
   },
   {
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "width" : 0,
      "ymin" : "",
      "legend" : "true",
      "order" : 0,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "removeOlder" : 1,
      "cutout" : 0,
      "useOldStyle" : false,
      "type" : "ui_chart",
      "label" : "Front Porch Switch",
      "dot" : false,
      "x" : 950,
      "removeOlderPoints" : "",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "useOneColor" : false,
      "id" : "144a6220.e7f98e",
      "ymax" : "",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "nodata" : "",
      "y" : 1160,
      "interpolate" : "linear",
      "group" : "ba683c3d.a294c",
      "chartType" : "line"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "83b4b32f.c1391",
      "wires" : [
         [
            "61ea8e18.0dee7",
            "415fdacd.1dbfd4"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 390,
      "entity_id" : "zwave.front_door",
      "type" : "api-current-state",
      "y" : 1000,
      "halt_if" : "",
      "name" : "Front Door Sensor"
   },
   {
      "reg" : false,
      "name" : "",
      "y" : 1000,
      "rules" : [
         {
            "pt" : "msg",
            "to" : "data.attributes.battery_level",
            "p" : "payload",
            "tot" : "msg",
            "t" : "set"
         }
      ],
      "type" : "change",
      "action" : "",
      "property" : "",
      "wires" : [
         [
            "97ff2579.959c88"
         ]
      ],
      "x" : 600,
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "id" : "61ea8e18.0dee7",
      "from" : ""
   },
   {
      "name" : "",
      "wires" : [
         [
            "fab9fb1c.4280f8"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 590,
      "y" : 1040,
      "id" : "415fdacd.1dbfd4",
      "type" : "subflow:e7369e7e.c4997"
   },
   {
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "97ff2579.959c88",
      "x" : 930,
      "group" : "2a707ff1.43daa",
      "gtype" : "gage",
      "max" : "100",
      "seg1" : "",
      "name" : "",
      "seg2" : "",
      "y" : 1000,
      "min" : 0,
      "width" : "1",
      "format" : "{{value}}",
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "type" : "ui_gauge",
      "label" : "pct",
      "title" : "Front Door",
      "order" : 14,
      "height" : "1"
   },
   {
      "ymin" : "",
      "width" : 0,
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "label" : "Front Door",
      "type" : "ui_chart",
      "useOldStyle" : false,
      "cutout" : 0,
      "removeOlder" : 1,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "order" : 0,
      "legend" : "true",
      "ymax" : "",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "fab9fb1c.4280f8",
      "useOneColor" : false,
      "removeOlderPoints" : "",
      "x" : 930,
      "dot" : false,
      "chartType" : "line",
      "group" : "ba683c3d.a294c",
      "interpolate" : "linear",
      "nodata" : "",
      "y" : 1040,
      "xformat" : "HH:mm:ss",
      "name" : ""
   },
   {
      "x" : 380,
      "wires" : [
         [
            "83ce684a.69b968"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "server" : "e2a02faf.48099",
      "id" : "4a699181.4d185",
      "halt_if" : "",
      "name" : "Coffee Grinder Switch",
      "y" : 1240,
      "entity_id" : "zwave.coffee_grinder",
      "type" : "api-current-state"
   },
   {
      "type" : "subflow:e7369e7e.c4997",
      "id" : "83ce684a.69b968",
      "y" : 1240,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "ed4700de.2d9d1"
         ]
      ],
      "x" : 590,
      "name" : ""
   },
   {
      "cutout" : 0,
      "type" : "ui_chart",
      "useOldStyle" : false,
      "label" : "Coffee Grinder Switch",
      "legend" : "true",
      "order" : 0,
      "height" : 0,
      "removeOlderUnit" : "3600",
      "removeOlder" : 1,
      "width" : 0,
      "ymin" : "",
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "chartType" : "line",
      "group" : "ba683c3d.a294c",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "y" : 1240,
      "nodata" : "",
      "interpolate" : "linear",
      "removeOlderPoints" : "",
      "id" : "ed4700de.2d9d1",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "useOneColor" : false,
      "ymax" : "",
      "dot" : false,
      "x" : 960
   },
   {
      "id" : "9c7a6221.e6ca",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "a4d1509b.42126"
         ]
      ],
      "x" : 350,
      "z" : "7d04740a.ad6adc",
      "entity_id" : "zwave.basement_dehumidifier",
      "type" : "api-current-state",
      "name" : "Basement Dehumidifier Switch",
      "halt_if" : "",
      "y" : 1280
   },
   {
      "id" : "a4d1509b.42126",
      "type" : "subflow:e7369e7e.c4997",
      "name" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "dbaa68a4.f1b2f8"
         ]
      ],
      "x" : 590,
      "y" : 1280
   },
   {
      "ymin" : "",
      "width" : 0,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [],
         []
      ],
      "useOldStyle" : false,
      "type" : "ui_chart",
      "label" : "Basement Dehumidifier Switch",
      "cutout" : 0,
      "removeOlderUnit" : "3600",
      "height" : 0,
      "removeOlder" : 1,
      "legend" : "true",
      "order" : 0,
      "ymax" : "",
      "removeOlderPoints" : "",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "dbaa68a4.f1b2f8",
      "useOneColor" : false,
      "dot" : false,
      "x" : 990,
      "chartType" : "line",
      "group" : "ba683c3d.a294c",
      "nodata" : "",
      "y" : 1280,
      "interpolate" : "linear",
      "name" : "",
      "xformat" : "HH:mm:ss"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "zwave.basement_back_door",
      "halt_if" : "",
      "name" : "Basement Back Door Sensor",
      "y" : 1080,
      "server" : "e2a02faf.48099",
      "id" : "4d395e23.30c5d",
      "x" : 360,
      "wires" : [
         [
            "803cbc60.1a639",
            "d0a146bf.7b5918"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "wires" : [
         [
            "cde0e900.d52498"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 600,
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "803cbc60.1a639",
      "y" : 1080,
      "reg" : false,
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "payload",
            "pt" : "msg",
            "to" : "data.attributes.battery_level"
         }
      ]
   },
   {
      "type" : "subflow:e7369e7e.c4997",
      "id" : "d0a146bf.7b5918",
      "y" : 1120,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "28b250b9.a384c"
         ]
      ],
      "x" : 590,
      "name" : ""
   },
   {
      "x" : 960,
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "cde0e900.d52498",
      "name" : "",
      "seg2" : "",
      "y" : 1080,
      "min" : 0,
      "group" : "2a707ff1.43daa",
      "max" : "100",
      "gtype" : "gage",
      "seg1" : "",
      "format" : "{{value}}",
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "width" : "1",
      "title" : "Basement Back Door",
      "order" : 15,
      "height" : "1",
      "type" : "ui_gauge",
      "label" : "pct"
   },
   {
      "useOldStyle" : false,
      "type" : "ui_chart",
      "label" : "Basement Back Door",
      "cutout" : 0,
      "height" : 0,
      "removeOlderUnit" : "3600",
      "removeOlder" : 1,
      "legend" : "true",
      "order" : 0,
      "ymin" : "",
      "width" : 0,
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "chartType" : "line",
      "group" : "ba683c3d.a294c",
      "nodata" : "",
      "y" : 1120,
      "interpolate" : "linear",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "ymax" : "",
      "removeOlderPoints" : "",
      "id" : "28b250b9.a384c",
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "useOneColor" : false,
      "dot" : false,
      "x" : 960
   },
   {
      "type" : "api-current-state",
      "entity_id" : "sensor.network_gear_voltage",
      "y" : 1320,
      "name" : "Network Gear Switch Power",
      "halt_if" : "",
      "id" : "981ce0e8.cdfba",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "cb99ff0b.f61cf",
            "21c03bfa.5995a4"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 360
   },
   {
      "halt_if" : "",
      "name" : "Coffee Grinder Switch Power",
      "y" : 1400,
      "entity_id" : "switch.coffee_grinder_switch",
      "type" : "api-current-state",
      "wires" : [
         [
            "7a3bcad4.5804e4"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 360,
      "server" : "e2a02faf.48099",
      "id" : "25039e35.ef7072"
   },
   {
      "y" : 1320,
      "reg" : false,
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "p" : "payload",
            "to" : "data.attributes.power_consumption",
            "pt" : "msg",
            "t" : "set",
            "tot" : "msg"
         },
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "pt" : "msg",
            "to" : "Network Gear Power Consumption"
         }
      ],
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "f0322859.670ce8"
         ]
      ],
      "x" : 600,
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "cb99ff0b.f61cf"
   },
   {
      "to" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "352c5a26.502bb6"
         ]
      ],
      "x" : 600,
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "7a3bcad4.5804e4",
      "y" : 1400,
      "reg" : false,
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "p" : "payload",
            "to" : "data.attributes.power_consumption",
            "pt" : "msg",
            "tot" : "msg",
            "t" : "set"
         },
         {
            "p" : "topic",
            "pt" : "msg",
            "to" : "Coffee Grinder Power Consumption",
            "tot" : "str",
            "t" : "set"
         }
      ]
   },
   {
      "chartType" : "line",
      "group" : "ea10f06.a52e21",
      "y" : 1320,
      "nodata" : "",
      "interpolate" : "linear",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "ymax" : "",
      "removeOlderPoints" : "",
      "useOneColor" : false,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "f0322859.670ce8",
      "dot" : false,
      "x" : 1000,
      "type" : "ui_chart",
      "useOldStyle" : false,
      "label" : "Network Gear Power Consumption",
      "cutout" : 0,
      "removeOlderUnit" : "3600",
      "height" : "6",
      "removeOlder" : 1,
      "legend" : "true",
      "order" : 3,
      "ymin" : "",
      "width" : "6",
      "wires" : [
         [],
         []
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [],
         []
      ],
      "ymin" : "",
      "width" : "6",
      "removeOlderUnit" : "3600",
      "height" : "6",
      "removeOlder" : 1,
      "legend" : "true",
      "order" : 5,
      "useOldStyle" : false,
      "type" : "ui_chart",
      "label" : "Coffee Grinder Power Consumption",
      "cutout" : 0,
      "dot" : false,
      "x" : 1000,
      "ymax" : "",
      "removeOlderPoints" : "",
      "useOneColor" : false,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "352c5a26.502bb6",
      "y" : 1400,
      "nodata" : "",
      "interpolate" : "linear",
      "name" : "",
      "xformat" : "HH:mm:ss",
      "group" : "ea10f06.a52e21",
      "chartType" : "line"
   },
   {
      "y" : 1360,
      "reg" : false,
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "str",
            "p" : "topic",
            "to" : "Network Gear Input Voltage",
            "pt" : "msg"
         }
      ],
      "wires" : [
         [
            "f6655737.5ea8f8"
         ]
      ],
      "x" : 600,
      "z" : "7d04740a.ad6adc",
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "21c03bfa.5995a4"
   },
   {
      "cutout" : 0,
      "label" : "Home Input Voltage",
      "type" : "ui_chart",
      "useOldStyle" : false,
      "order" : 4,
      "legend" : "true",
      "removeOlder" : 1,
      "removeOlderUnit" : "3600",
      "height" : "6",
      "width" : "6",
      "ymin" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [],
         []
      ],
      "group" : "ea10f06.a52e21",
      "chartType" : "line",
      "xformat" : "HH:mm:ss",
      "name" : "",
      "interpolate" : "linear",
      "y" : 1360,
      "nodata" : "",
      "useOneColor" : false,
      "colors" : [
         "#1f77b4",
         "#aec7e8",
         "#ff7f0e",
         "#2ca02c",
         "#98df8a",
         "#d62728",
         "#ff9896",
         "#9467bd",
         "#c5b0d5"
      ],
      "id" : "f6655737.5ea8f8",
      "removeOlderPoints" : "",
      "ymax" : "",
      "x" : 950,
      "dot" : false
   },
   {
      "entity_id" : "sensor.howd_ipad_air_battery_level",
      "type" : "api-current-state",
      "y" : 320,
      "name" : "iPad battery",
      "halt_if" : "",
      "id" : "526d53c5.a3ab2c",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "ff3a1cd7.66ee4"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 350
   },
   {
      "id" : "ff3a1cd7.66ee4",
      "from" : "",
      "action" : "",
      "property" : "",
      "wires" : [
         [
            "5ad88866.091e98"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 600,
      "to" : "",
      "rules" : [
         {
            "t" : "set",
            "tot" : "str",
            "pt" : "msg",
            "to" : "iPad Air Battery",
            "p" : "topic"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "",
      "y" : 320
   },
   {
      "type" : "ui_gauge",
      "label" : "pct",
      "height" : "2",
      "title" : "iPad Battery",
      "order" : 5,
      "width" : "2",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "format" : "{{value}}",
      "max" : "100",
      "gtype" : "gage",
      "seg1" : "",
      "group" : "2a707ff1.43daa",
      "y" : 320,
      "min" : 0,
      "name" : "",
      "seg2" : "",
      "colors" : [
         "#ff0000",
         "#ffff00",
         "#80ff00"
      ],
      "id" : "5ad88866.091e98",
      "x" : 930
   },
   {
      "y" : 280,
      "name" : "Temperature Set point",
      "halt_if" : "",
      "type" : "api-current-state",
      "entity_id" : "sensor.hallway_thermostat_nest_target",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "ec6830aa.140da"
         ]
      ],
      "x" : 380,
      "server" : "e2a02faf.48099",
      "id" : "bdb229f1.681488"
   },
   {
      "to" : "",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "5a104785.e8d4c8"
         ]
      ],
      "x" : 600,
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "ec6830aa.140da",
      "y" : 280,
      "reg" : false,
      "name" : "",
      "type" : "change",
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "pt" : "msg",
            "to" : "HVAC Set point (F)"
         }
      ]
   },
   {
      "y" : 80,
      "name" : "Current house humidity",
      "halt_if" : "",
      "entity_id" : "sensor.hallway_thermostat_nest_humidity",
      "type" : "api-current-state",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "8257b7ad.3e7fc8"
         ]
      ],
      "x" : 370,
      "server" : "e2a02faf.48099",
      "id" : "7a85784d.5c3d08"
   },
   {
      "to" : "",
      "x" : 600,
      "wires" : [
         [
            "f9d3c081.74441"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "8257b7ad.3e7fc8",
      "y" : 80,
      "name" : "",
      "reg" : false,
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "str",
            "pt" : "msg",
            "to" : "Inside Humidity (%)",
            "p" : "topic"
         }
      ]
   },
   {
      "height" : 0,
      "order" : 2,
      "title" : "Inside Humidity",
      "label" : "percent",
      "type" : "ui_gauge",
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "format" : "{{value}}",
      "width" : 0,
      "min" : 0,
      "y" : 240,
      "seg2" : "80",
      "name" : "",
      "seg1" : "20",
      "gtype" : "gage",
      "max" : "100",
      "group" : "ea10f06.a52e21",
      "x" : 940,
      "colors" : [
         "#ffff00",
         "#80ff00",
         "#ffff00"
      ],
      "id" : "f9d3c081.74441"
   },
   {
      "type" : "api-call-service",
      "y" : 240,
      "name" : "Set Walt Home",
      "mergecontext" : "",
      "service_domain" : "device_tracker",
      "id" : "86624837.767f38",
      "server" : "e2a02faf.48099",
      "z" : "e0703c90.1a341",
      "wires" : [
         []
      ],
      "x" : 1040,
      "data" : "{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"home\"}",
      "service" : "see"
   },
   {
      "payload" : "",
      "y" : 240,
      "topic" : "",
      "crontab" : "",
      "name" : "",
      "type" : "inject",
      "repeat" : "",
      "wires" : [
         [
            "86624837.767f38"
         ]
      ],
      "x" : 840,
      "z" : "e0703c90.1a341",
      "payloadType" : "date",
      "onceDelay" : 0.1,
      "once" : false,
      "id" : "b7e2c6b7.7a2fc8"
   },
   {
      "once" : false,
      "id" : "86cf92b4.04c4b",
      "wires" : [
         [
            "edebe89c.2806a8",
            "d7d6305.65421d"
         ]
      ],
      "z" : "e0703c90.1a341",
      "x" : 820,
      "payloadType" : "date",
      "onceDelay" : 0.1,
      "type" : "inject",
      "repeat" : "",
      "payload" : "",
      "y" : 300,
      "topic" : "",
      "name" : "",
      "crontab" : ""
   },
   {
      "y" : 280,
      "mergecontext" : "",
      "name" : "Set Walt Not Home",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "x" : 1050,
      "z" : "e0703c90.1a341",
      "data" : "{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"not_home\"}",
      "service" : "see",
      "service_domain" : "device_tracker",
      "id" : "edebe89c.2806a8",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "comment",
      "y" : 20,
      "name" : "Disabled iCloud2 tracking",
      "info" : "Underyling library tracks all devies, hoping they fix it:\n\nhttps://github.com/picklepete/pyicloud/issues/142\n",
      "id" : "b6128bac.d3deb8",
      "wires" : [],
      "x" : 1210,
      "z" : "46ed0d55.4c98b4"
   },
   {
      "id" : "11cac704.acdbc9",
      "outputLabels" : [
         "walt",
         "wife"
      ],
      "func" : "if(msg.person == \"walt\") {\n    return[ msg, null ];\n} else if(msg.person == \"wife\") {\n    return[ null, msg ];\n}",
      "wires" : [
         [],
         [
            "3a53eed2.e0e1f2"
         ]
      ],
      "x" : 1350,
      "z" : "46ed0d55.4c98b4",
      "noerr" : 0,
      "outputs" : "2",
      "type" : "function",
      "name" : "Switch user",
      "y" : 220
   },
   {
      "type" : "api-call-service",
      "y" : 320,
      "name" : "Set Walt Wifi Not Home",
      "mergecontext" : "",
      "service_domain" : "device_tracker",
      "server" : "e2a02faf.48099",
      "id" : "d7d6305.65421d",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "x" : 1070,
      "service" : "see",
      "data" : "{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}"
   },
   {
      "z" : "c663f7df.ca58b8",
      "wires" : [
         [
            "9a1ed94a.6731a8",
            "2ce419c7.fb69b6",
            "38d8e92.9caf216",
            "9239610f.2b97b"
         ]
      ],
      "randomFirst" : "1",
      "rate" : "1",
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "1",
      "drop" : false,
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "x" : 140,
      "timeout" : "1",
      "id" : "d2c9201e.f640e",
      "y" : 520,
      "name" : "",
      "pauseType" : "delay",
      "rateUnits" : "second"
   },
   {
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "a6d97fb.109798",
            "421449d8.238b68",
            "1d2995b.befbb6a"
         ]
      ],
      "z" : "3844d016.18a29",
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 100,
      "id" : "702132b0.14facc",
      "timeout" : "1",
      "x" : 300
   },
   {
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "nbRateUnits" : "1",
      "rate" : "1",
      "wires" : [
         [
            "341e614.4cf539e",
            "7ed74b51.666eb4",
            "d349f480.c33fe8"
         ]
      ],
      "z" : "2283eff7.ee9ab",
      "randomFirst" : "1",
      "pauseType" : "delay",
      "rateUnits" : "second",
      "y" : 180,
      "name" : "",
      "id" : "5904fbc7.300974",
      "x" : 180,
      "timeout" : "1"
   },
   {
      "repair" : false,
      "type" : "switch",
      "rules" : [
         {
            "t" : "regex",
            "case" : false,
            "vt" : "str",
            "v" : "^\\d{4}-\\d{2}-\\d{2}.\\d{2}:\\d{2}:\\d{2}.ERROR..MainThread...homeassistant.core..Error executing service..ServiceCall light.turn.*entity_id...light."
         }
      ],
      "outputs" : 1,
      "y" : 1940,
      "name" : "Zigbee light failure",
      "checkall" : "true",
      "propertyType" : "msg",
      "id" : "70445fd.82f60a",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "1a117a6.cfb5586",
            "d39aad46.c7dab"
         ]
      ],
      "x" : 530,
      "property" : "payload"
   },
   {
      "active" : true,
      "id" : "1a117a6.cfb5586",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 680,
      "tosidebar" : true,
      "type" : "debug",
      "console" : false,
      "y" : 1860,
      "tostatus" : false,
      "complete" : "true",
      "name" : "Zigbee failure"
   },
   {
      "wires" : [
         [
            "495baa2a.02b484"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 770,
      "noerr" : 0,
      "func" : "var outputMsgs      = [];\ndomain              = 'light';\nservice             = msg.payload.replace(/.*ServiceCall.light.(.*?):.*/, '$1');\nlights              = msg.payload.split(',');\nlight_check         = /^light\\./;\n\n\nfor (var w in lights) {\n    light           = lights[w].replace(/.*(light.*)\\'.*/, '$1');\n    \n    if(light_check.test(light)) {\n        ha_service_call = {payload: {'domain':domain,'service':service, data: {'entity_id':light} } };\n        \n        brightness_check    = /brightness/g;\n        transition_check    = /transition/g;\n        color_temp_check    = /color_temp/g;\n        number_check        = /^\\d+$/;\n        number_with_dec     = /^\\d+\\.\\d+$/;\n\n        if (brightness_check.test(msg.payload)) {\n            brightness      = msg.payload.replace(/.*brightness.(.*?)[,|>].*/, '$1');\n            \n            if (number_check.test(brightness)) {\n                ha_service_call.payload.data.brightness = brightness;\n            }\n        }\n\n        if (transition_check.test(msg.payload)) {\n            transition      = msg.payload.replace(/.*transition.(.*?)[,|>].*/, '$1');\n            \n            if(number_with_dec.test(transition)) {\n                ha_service_call.payload.data.transition = transition;\n            }\n        }\n        \n        if (color_temp_check.test(msg.payload)) {\n            color_temp      = msg.payload.replace(/.*color_temp.(.*?)[,|>].*/, '$1');\n            \n            if (number_check.test(color_temp)) {\n                ha_service_call.payload.data.color_temp = color_temp;\n            }\n        }        \n        \n        outputMsgs.push(ha_service_call);\n    }\n}\nreturn [ outputMsgs ];",
      "id" : "d39aad46.c7dab",
      "y" : 1940,
      "name" : "Split",
      "type" : "function",
      "outputs" : 1
   },
   {
      "y" : 1900,
      "mergecontext" : "",
      "name" : "Retry Zigbee Errors",
      "type" : "api-call-service",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "x" : 1990,
      "service" : "",
      "data" : "",
      "service_domain" : "",
      "id" : "d3dada85.4de268",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 1990,
      "tosidebar" : true,
      "active" : true,
      "id" : "234e1a27.dab9e6",
      "y" : 1860,
      "complete" : "true",
      "name" : "Retry Zigbee errors",
      "tostatus" : false,
      "type" : "debug",
      "console" : false
   },
   {
      "nbRateUnits" : "1",
      "drop" : false,
      "timeoutUnits" : "seconds",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "randomFirst" : "1",
      "wires" : [
         [
            "234e1a27.dab9e6",
            "d3dada85.4de268"
         ]
      ],
      "z" : "20661f8a.532c4",
      "rate" : "1",
      "name" : "",
      "y" : 1900,
      "rateUnits" : "second",
      "pauseType" : "rate",
      "timeout" : "5",
      "x" : 1770,
      "id" : "275fd6d8.0dfada"
   },
   {
      "id" : "7e44dbaa.f90c64",
      "func" : "msg.payload = { data: {'message': 'Hey guys, no school tomorrow!' } };\n\nreturn msg;",
      "noerr" : 0,
      "wires" : [
         [
            "458872e1.c0257c"
         ]
      ],
      "x" : 1110,
      "z" : "20661f8a.532c4",
      "outputs" : 1,
      "type" : "function",
      "name" : "Format message",
      "y" : 760
   },
   {
      "type" : "subflow:837bbace.420028",
      "id" : "458872e1.c0257c",
      "wires" : [
         [],
         []
      ],
      "z" : "20661f8a.532c4",
      "x" : 1290,
      "y" : 760
   },
   {
      "y" : 760,
      "halt_if" : "on",
      "name" : "If family not sleeping",
      "type" : "api-current-state",
      "entity_id" : "binary_sensor.family_sleeping",
      "x" : 900,
      "wires" : [
         [
            "7e44dbaa.f90c64"
         ]
      ],
      "z" : "20661f8a.532c4",
      "server" : "e2a02faf.48099",
      "id" : "c4d808d1.9fbf48"
   },
   {
      "wires" : [
         [
            "cb51bdab.52b95"
         ],
         []
      ],
      "startTime" : "07:00",
      "x" : 1030,
      "z" : "8bb76918.ef6b48",
      "lon" : "",
      "id" : "1eee1d2b.7e8613",
      "y" : 600,
      "name" : "7AM to 9AM",
      "type" : "time-range-switch",
      "endOffset" : 0,
      "startOffset" : 0,
      "lat" : "",
      "endTime" : "9:00"
   },
   {
      "data" : "{ \"entity_id\":\"cover.garage_door_south\"}",
      "service" : "open_cover",
      "x" : 1330,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "id" : "daa29e46.da8f8",
      "service_domain" : "cover",
      "server" : "e2a02faf.48099",
      "name" : "Open Garage Door South",
      "mergecontext" : "",
      "y" : 660,
      "type" : "api-call-service"
   },
   {
      "halt_if" : "255",
      "name" : "Garage door south already open?",
      "y" : 580,
      "entity_id" : "sensor.garage_door_south_tilt_alarm_level",
      "type" : "api-current-state",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "f211363f.a56138"
         ]
      ],
      "x" : 1360,
      "id" : "d15b2748.520bb8",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "sensor.garage_motion_sensor_alarm_level",
      "halt_if" : "255",
      "name" : "Garage motion active?",
      "y" : 620,
      "server" : "e2a02faf.48099",
      "id" : "f211363f.a56138",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "daa29e46.da8f8",
            "2102ce02.526672"
         ]
      ],
      "x" : 1320
   },
   {
      "y" : 540,
      "name" : "",
      "pauseType" : "rate",
      "rateUnits" : "minute",
      "x" : 1300,
      "timeout" : "5",
      "id" : "cb51bdab.52b95",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "nbRateUnits" : "3",
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "randomFirst" : "1",
      "wires" : [
         [
            "d15b2748.520bb8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "rate" : "1"
   },
   {
      "outputinitially" : false,
      "name" : "Garage Door South",
      "y" : 380,
      "entity_id" : "cover.garage_door_south",
      "updateinterval" : "60",
      "type" : "poll-state",
      "outputonchanged" : false,
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "d47ff605.02ade8"
         ]
      ],
      "x" : 130,
      "id" : "d40e196a.cb2728",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 380,
      "checkall" : "true",
      "name" : "",
      "type" : "switch",
      "repair" : false,
      "outputs" : 1,
      "rules" : [
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "unavailable"
         }
      ],
      "wires" : [
         [
            "d17db1a2.05091"
         ]
      ],
      "x" : 310,
      "z" : "e0703c90.1a341",
      "property" : "payload",
      "propertyType" : "msg",
      "id" : "d47ff605.02ade8"
   },
   {
      "name" : "",
      "y" : 380,
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "timeout" : "5",
      "x" : 480,
      "id" : "d17db1a2.05091",
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "6",
      "drop" : false,
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "wires" : [
         [
            "96b6730f.b2adc"
         ]
      ],
      "z" : "e0703c90.1a341",
      "randomFirst" : "1",
      "rate" : "1"
   },
   {
      "type" : "api-call-service",
      "mergecontext" : "",
      "name" : "Notify Walt",
      "y" : 380,
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "id" : "96b6730f.b2adc",
      "data" : "{ \"message\":\"Garage door opener unavailable\"}",
      "service" : "ios_walts_iphone",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "x" : 670
   },
   {
      "type" : "comment",
      "y" : 340,
      "name" : "Troubleshooting Garage door opener going unavailable",
      "info" : "",
      "id" : "573e951f.e8b80c",
      "x" : 220,
      "wires" : [],
      "z" : "e0703c90.1a341"
   },
   {
      "y" : 700,
      "mergecontext" : "",
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "x" : 1300,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Opening garage door south\" }",
      "service" : "log",
      "id" : "2102ce02.526672",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099"
   },
   {
      "y" : 460,
      "name" : "Update Walt's location when Homekit switch is flipped",
      "type" : "comment",
      "z" : "e0703c90.1a341",
      "wires" : [],
      "x" : 220,
      "info" : "",
      "id" : "99ba9e9b.721a1"
   },
   {
      "id" : "d9694c67.a204d",
      "server" : "e2a02faf.48099",
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "d9958b07.d289a8"
         ]
      ],
      "x" : 150,
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "name" : "Walt's Homekit Location",
      "y" : 500,
      "haltifstate" : "",
      "entityidfilter" : "input_boolean.walt_homekit"
   },
   {
      "propertyType" : "msg",
      "outputLabels" : [
         "home",
         "away"
      ],
      "id" : "d9958b07.d289a8",
      "wires" : [
         [
            "d1b8c7cb.487788",
            "dab55c8e.23a78"
         ],
         [
            "9041a2bd.1a3bd",
            "86b5c2d1.d853a",
            "d67927e1.0a67f8"
         ]
      ],
      "z" : "e0703c90.1a341",
      "x" : 370,
      "property" : "payload",
      "type" : "switch",
      "repair" : false,
      "rules" : [
         {
            "v" : "on",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "v" : "off",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "outputs" : 2,
      "y" : 500,
      "name" : "",
      "checkall" : "true"
   },
   {
      "service_domain" : "device_tracker",
      "server" : "e2a02faf.48099",
      "id" : "d1b8c7cb.487788",
      "z" : "e0703c90.1a341",
      "wires" : [
         []
      ],
      "x" : 600,
      "service" : "see",
      "data" : "{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"home\"}",
      "type" : "api-call-service",
      "y" : 480,
      "name" : "Set Walt Home",
      "mergecontext" : ""
   },
   {
      "type" : "api-call-service",
      "name" : "Set Walt Not Home",
      "mergecontext" : "",
      "y" : 520,
      "server" : "e2a02faf.48099",
      "service_domain" : "device_tracker",
      "id" : "9041a2bd.1a3bd",
      "data" : "{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}",
      "service" : "see",
      "z" : "e0703c90.1a341",
      "wires" : [
         []
      ],
      "x" : 610
   },
   {
      "service_domain" : "device_tracker",
      "server" : "e2a02faf.48099",
      "id" : "86b5c2d1.d853a",
      "service" : "see",
      "data" : "{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}",
      "x" : 630,
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "type" : "api-call-service",
      "mergecontext" : "",
      "name" : "Set Walt Wifi Not Home",
      "y" : 560
   },
   {
      "data" : "{ \"message\":\"Homekit marked you as home\"}",
      "service" : "ios_walts_iphone",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "x" : 590,
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "dab55c8e.23a78",
      "mergecontext" : "",
      "name" : "Notify Walt",
      "y" : 440,
      "type" : "api-call-service"
   },
   {
      "wires" : [
         []
      ],
      "x" : 590,
      "z" : "e0703c90.1a341",
      "data" : "{ \"message\":\"Homekit marked you as away\"}",
      "service" : "ios_walts_iphone",
      "service_domain" : "notify",
      "id" : "d67927e1.0a67f8",
      "server" : "e2a02faf.48099",
      "y" : 600,
      "name" : "Notify Walt",
      "mergecontext" : "",
      "type" : "api-call-service"
   },
   {
      "name" : "Logbook entry",
      "mergecontext" : "",
      "y" : 1060,
      "type" : "api-call-service",
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turn on coffee grinder\" }",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 740,
      "service_domain" : "logbook",
      "id" : "f0c63942.6650c8",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [
         []
      ],
      "x" : 740,
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turn off coffee grinder\" }",
      "service" : "log",
      "service_domain" : "logbook",
      "id" : "ec29f7b8.4f4088",
      "server" : "e2a02faf.48099",
      "y" : 1180,
      "name" : "Logbook entry",
      "mergecontext" : "",
      "type" : "api-call-service"
   },
   {
      "type" : "server-state-changed",
      "name" : "Master Bath Motion Sensor",
      "y" : 660,
      "haltifstate" : "",
      "entityidfilter" : "sensor.master_bathroom_motion_sensor",
      "server" : "e2a02faf.48099",
      "id" : "d3c8f1eb.30ea4",
      "wires" : [
         [
            "30b9f1c1.43613e"
         ]
      ],
      "entityidfiltertype" : "substring",
      "x" : 140,
      "z" : "e0703c90.1a341"
   },
   {
      "y" : 660,
      "name" : "",
      "checkall" : "true",
      "type" : "switch",
      "repair" : false,
      "rules" : [
         {
            "v" : "motion detected",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "v" : "standby",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "outputs" : 2,
      "x" : 370,
      "wires" : [
         [
            "f4d9b55f.a0ccb8",
            "56ee825a.cd305c"
         ],
         [
            "f4d9b55f.a0ccb8"
         ]
      ],
      "z" : "e0703c90.1a341",
      "property" : "payload",
      "propertyType" : "msg",
      "outputLabels" : [
         "motion",
         "standby"
      ],
      "id" : "30b9f1c1.43613e"
   },
   {
      "units" : "Minute",
      "wires" : [
         [
            "3070c147.7bb1fe"
         ],
         []
      ],
      "x" : 570,
      "duration" : "10",
      "z" : "e0703c90.1a341",
      "payloadval" : "0",
      "id" : "f4d9b55f.a0ccb8",
      "y" : 720,
      "name" : "10min",
      "type" : "stoptimer",
      "payloadtype" : "num"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "4cdd3888.656168",
      "data" : "{\"entity_id\":\"light.living_room\"}",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "x" : 1050,
      "z" : "e0703c90.1a341",
      "type" : "api-call-service",
      "mergecontext" : "",
      "name" : "Turn on living room lights",
      "y" : 660
   },
   {
      "y" : 700,
      "name" : "Turn off living room lights",
      "mergecontext" : "",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "x" : 1050,
      "service" : "turn_off",
      "data" : "{\"entity_id\":\"light.living_room\"}",
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "15d526d9.97cdd9"
   },
   {
      "z" : "e0703c90.1a341",
      "wires" : [
         [
            "f4d9b55f.a0ccb8"
         ]
      ],
      "x" : 110,
      "entityidfiltertype" : "exact",
      "id" : "77160de8.334bf4",
      "server" : "e2a02faf.48099",
      "name" : "Living room lights on",
      "y" : 720,
      "entityidfilter" : "light.living_room",
      "haltifstate" : "off",
      "type" : "server-state-changed"
   },
   {
      "y" : 620,
      "name" : "Testing Bruh multisensor",
      "type" : "comment",
      "wires" : [],
      "z" : "e0703c90.1a341",
      "x" : 130,
      "info" : "",
      "id" : "418cfb2d.87edb4"
   },
   {
      "id" : "495baa2a.02b484",
      "lower" : "",
      "wires" : [
         [
            "9db1de39.e0145",
            "8db2436f.d29c5"
         ]
      ],
      "upper" : "",
      "x" : 960,
      "z" : "20661f8a.532c4",
      "init" : "0",
      "step" : "1",
      "type" : "counter",
      "outputs" : "1",
      "y" : 1940,
      "mode" : "increment",
      "name" : ""
   },
   {
      "wires" : [
         [
            "291fbbf.51bb644"
         ],
         []
      ],
      "x" : 1130,
      "units" : "Second",
      "duration" : "30",
      "z" : "20661f8a.532c4",
      "id" : "9db1de39.e0145",
      "payloadval" : "0",
      "name" : "",
      "y" : 1860,
      "type" : "stoptimer",
      "payloadtype" : "num"
   },
   {
      "y" : 1780,
      "reg" : false,
      "name" : "Reset counter and stop timer",
      "type" : "change",
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "p" : "reset",
            "pt" : "msg",
            "to" : "true"
         },
         {
            "p" : "payload",
            "pt" : "msg",
            "to" : "stop",
            "tot" : "str",
            "t" : "set"
         }
      ],
      "to" : "",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "495baa2a.02b484",
            "9db1de39.e0145"
         ]
      ],
      "x" : 900,
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "291fbbf.51bb644"
   },
   {
      "repair" : false,
      "type" : "switch",
      "rules" : [
         {
            "vt" : "num",
            "t" : "lt",
            "v" : "50"
         },
         {
            "v2t" : "num",
            "v2" : "59",
            "v" : "51",
            "t" : "btwn",
            "vt" : "num"
         },
         {
            "t" : "gte",
            "vt" : "num",
            "v" : "60"
         }
      ],
      "outputs" : 3,
      "y" : 1920,
      "checkall" : "true",
      "name" : "Stop after 50",
      "propertyType" : "msg",
      "id" : "8db2436f.d29c5",
      "wires" : [
         [
            "eadfc4e6.40f328"
         ],
         [
            "984fceb.5bee93",
            "eadfc4e6.40f328"
         ],
         [
            "4245ce66.f40be"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 1150,
      "property" : "count"
   },
   {
      "name" : "Format template",
      "y" : 1940,
      "outputs" : 1,
      "type" : "function",
      "func" : "entity_id       = msg.payload.data.entity_id;\nmsg.template    = '{{ states.' + entity_id + '.attributes.friendly_name }}';\nreturn msg;",
      "wires" : [
         [
            "304e148d.faf4fc"
         ]
      ],
      "x" : 1360,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "id" : "4245ce66.f40be"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "304e148d.faf4fc",
      "wires" : [
         [
            "21d9f974.c96176"
         ]
      ],
      "x" : 1550,
      "z" : "20661f8a.532c4",
      "type" : "api-render-template",
      "template" : "",
      "y" : 1940,
      "name" : "Get friendly name"
   },
   {
      "type" : "function",
      "outputs" : 1,
      "y" : 1940,
      "name" : "Format message",
      "id" : "21d9f974.c96176",
      "wires" : [
         [
            "c5e59cbe.36777"
         ]
      ],
      "x" : 1750,
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "func" : "light        = msg.payload;\nmsg.payload = { data: {'message': light + ' has been failing to respond' } };\n\nreturn msg;"
   },
   {
      "name" : "Notify Walt",
      "mergecontext" : "",
      "y" : 1940,
      "type" : "api-call-service",
      "service" : "ios_walts_iphone",
      "data" : "{ \"message\": \"msg\" }",
      "x" : 2050,
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "id" : "ac282f7a.f96d1",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099"
   },
   {
      "inout" : "out",
      "id" : "c5e59cbe.36777",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "ac282f7a.f96d1",
            "f5858ee8.ef201"
         ]
      ],
      "x" : 1910,
      "func" : "rbe",
      "property" : "payload",
      "gap" : "",
      "type" : "rbe",
      "start" : "",
      "y" : 1940,
      "name" : ""
   },
   {
      "type" : "subflow:837bbace.420028",
      "id" : "35fa1b54.a80924",
      "z" : "20661f8a.532c4",
      "wires" : [
         [],
         []
      ],
      "x" : 2450,
      "y" : 1980,
      "name" : ""
   },
   {
      "y" : 1980,
      "halt_if" : "on",
      "name" : "If Guest Mode Off",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode",
      "wires" : [
         [
            "250d62d6.69ffce"
         ]
      ],
      "x" : 2070,
      "z" : "20661f8a.532c4",
      "id" : "f5858ee8.ef201",
      "server" : "e2a02faf.48099"
   },
   {
      "x" : 810,
      "wires" : [
         [
            "15d526d9.97cdd9"
         ]
      ],
      "z" : "e0703c90.1a341",
      "id" : "3070c147.7bb1fe",
      "server" : "e2a02faf.48099",
      "y" : 700,
      "halt_if" : "on",
      "name" : "If Guest Mode Off",
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state"
   },
   {
      "reg" : false,
      "name" : "",
      "y" : 1900,
      "rules" : [
         {
            "p" : "reset",
            "pt" : "msg",
            "t" : "delete"
         }
      ],
      "type" : "change",
      "action" : "",
      "property" : "",
      "x" : 1370,
      "wires" : [
         [
            "6799d54f.e4485c"
         ]
      ],
      "z" : "20661f8a.532c4",
      "to" : "",
      "id" : "eadfc4e6.40f328",
      "from" : ""
   },
   {
      "checkall" : "true",
      "name" : "Don't forward stops",
      "y" : 1900,
      "rules" : [
         {
            "t" : "neq",
            "vt" : "str",
            "v" : "stop"
         }
      ],
      "outputs" : 1,
      "repair" : false,
      "type" : "switch",
      "property" : "payload",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "275fd6d8.0dfada"
         ]
      ],
      "x" : 1580,
      "id" : "6799d54f.e4485c",
      "propertyType" : "msg"
   },
   {
      "x" : 810,
      "wires" : [
         [
            "4cdd3888.656168"
         ]
      ],
      "z" : "e0703c90.1a341",
      "server" : "e2a02faf.48099",
      "id" : "45e5a80.bbcad58",
      "y" : 660,
      "name" : "If Guest Mode Off",
      "halt_if" : "on",
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "250d62d6.69ffce",
      "x" : 2270,
      "wires" : [
         [
            "35fa1b54.a80924"
         ]
      ],
      "z" : "20661f8a.532c4",
      "entity_id" : "binary_sensor.family_in_bed",
      "type" : "api-current-state",
      "halt_if" : "on",
      "name" : "If Family Not in Bed",
      "y" : 1980
   },
   {
      "x" : 190,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "id" : "e8ab7a97.aebad8",
      "info" : "",
      "name" : "Convert MQTT Telemetry Messages to State",
      "y" : 540,
      "type" : "comment"
   },
   {
      "topic" : "",
      "y" : 480,
      "name" : "Inject MQTT message",
      "type" : "mqtt out",
      "retain" : "",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 960,
      "broker" : "4238db6e.227ed4",
      "qos" : "",
      "id" : "aa058212.22903"
   },
   {
      "outputonchanged" : true,
      "wires" : [
         [
            "22c2e627.52eada"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 140,
      "server" : "e2a02faf.48099",
      "id" : "fa0e1050.7a5",
      "outputinitially" : true,
      "name" : "Garage Door North Tilt Sensor",
      "y" : 460,
      "type" : "poll-state",
      "entity_id" : "sensor.garage_door_north_tilt_alarm_level",
      "updateinterval" : "600"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "p" : "topic",
            "to" : "garage/door/north/status",
            "pt" : "msg",
            "t" : "set",
            "tot" : "str"
         },
         {
            "t" : "set",
            "tot" : "str",
            "p" : "payload",
            "to" : "open",
            "pt" : "msg"
         }
      ],
      "y" : 420,
      "reg" : false,
      "name" : "Set to open",
      "from" : "",
      "id" : "71f0672.dc0b298",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "x" : 650,
      "to" : "",
      "action" : "",
      "property" : ""
   },
   {
      "y" : 460,
      "checkall" : "true",
      "name" : "Open or closed",
      "repair" : false,
      "type" : "switch",
      "rules" : [
         {
            "t" : "eq",
            "vt" : "num",
            "v" : "255"
         },
         {
            "v" : "0",
            "vt" : "num",
            "t" : "eq"
         }
      ],
      "outputs" : 2,
      "wires" : [
         [
            "71f0672.dc0b298"
         ],
         [
            "e2e08c0a.d8e6f"
         ]
      ],
      "x" : 400,
      "z" : "20661f8a.532c4",
      "property" : "payload.data.state",
      "propertyType" : "msg",
      "id" : "22c2e627.52eada",
      "outputLabels" : [
         "open",
         "closed"
      ]
   },
   {
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "to" : "garage/door/north/status",
            "pt" : "msg"
         },
         {
            "t" : "set",
            "tot" : "str",
            "to" : "closed",
            "pt" : "msg",
            "p" : "payload"
         }
      ],
      "type" : "change",
      "name" : "Set to closed",
      "reg" : false,
      "y" : 460,
      "id" : "e2e08c0a.d8e6f",
      "from" : "",
      "property" : "",
      "action" : "",
      "to" : "",
      "x" : 650,
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "y" : 500,
      "name" : "Garage Door South Tilt Sensor",
      "outputinitially" : true,
      "type" : "poll-state",
      "entity_id" : "sensor.garage_door_south_tilt_alarm_level",
      "updateinterval" : "600",
      "wires" : [
         [
            "3799e27a.ff923e"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 150,
      "outputonchanged" : true,
      "id" : "5dfee8bc.d7ced8",
      "server" : "e2a02faf.48099"
   },
   {
      "property" : "payload.data.state",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "321280b2.e8f25"
         ],
         [
            "8f04b30f.555a5"
         ]
      ],
      "x" : 400,
      "id" : "3799e27a.ff923e",
      "outputLabels" : [
         "open",
         "closed"
      ],
      "propertyType" : "msg",
      "name" : "Open or closed",
      "checkall" : "true",
      "y" : 500,
      "outputs" : 2,
      "rules" : [
         {
            "v" : "255",
            "vt" : "num",
            "t" : "eq"
         },
         {
            "vt" : "num",
            "t" : "eq",
            "v" : "0"
         }
      ],
      "type" : "switch",
      "repair" : false
   },
   {
      "reg" : false,
      "name" : "Set to open",
      "y" : 500,
      "rules" : [
         {
            "to" : "garage/door/south/status",
            "pt" : "msg",
            "p" : "topic",
            "t" : "set",
            "tot" : "str"
         },
         {
            "tot" : "str",
            "t" : "set",
            "p" : "payload",
            "pt" : "msg",
            "to" : "open"
         }
      ],
      "type" : "change",
      "action" : "",
      "property" : "",
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 650,
      "to" : "",
      "id" : "321280b2.e8f25",
      "from" : ""
   },
   {
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "to" : "garage/door/south/status",
            "pt" : "msg",
            "p" : "topic"
         },
         {
            "p" : "payload",
            "pt" : "msg",
            "to" : "closed",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "type" : "change",
      "name" : "Set to closed",
      "reg" : false,
      "y" : 540,
      "id" : "8f04b30f.555a5",
      "from" : "",
      "action" : "",
      "property" : "",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "aa058212.22903"
         ]
      ],
      "x" : 650,
      "to" : ""
   },
   {
      "name" : "Keep garage door opener state in sync with tilt sensors",
      "y" : 420,
      "type" : "comment",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 220,
      "id" : "dc5184fb.4e2c88",
      "info" : ""
   },
   {
      "service_domain" : "lock",
      "server" : "e2a02faf.48099",
      "id" : "6c92f048.18abb",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1220,
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "service" : "lock",
      "type" : "api-call-service",
      "y" : 2620,
      "name" : "Lock front door",
      "mergecontext" : ""
   },
   {
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1340,
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "service" : "lock",
      "service_domain" : "lock",
      "server" : "e2a02faf.48099",
      "id" : "3652e256.daaefe",
      "y" : 2880,
      "mergecontext" : "",
      "name" : "Lock front door",
      "type" : "api-call-service"
   },
   {
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "4321f595.99043c",
            "ce971dc7.47848",
            "86dd48f7.85d0c8"
         ]
      ],
      "x" : 1160,
      "noerr" : 0,
      "id" : "bf6eb2bf.f3cf4",
      "name" : "Clear msg",
      "y" : 1320,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "name" : "Clear msg",
      "y" : 1440,
      "outputs" : 1,
      "type" : "function",
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "wires" : [
         [
            "d890e20a.375ec",
            "72e3d694.804d08",
            "fe9b65ed.5508f8"
         ]
      ],
      "x" : 1160,
      "noerr" : 0,
      "z" : "8bb76918.ef6b48",
      "id" : "50de5197.f732a"
   },
   {
      "extend" : false,
      "units" : "s",
      "duration" : "3",
      "wires" : [
         [
            "e04cd686.d71298"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "op2type" : "str",
      "bytopic" : "all",
      "type" : "trigger",
      "op2" : "0",
      "x" : 1510,
      "id" : "b2e1971a.100438",
      "reset" : "",
      "op1" : "1",
      "name" : "Wait three seconds",
      "op1type" : "str",
      "y" : 1320
   },
   {
      "type" : "api-call-service",
      "y" : 1320,
      "name" : "Set color temperature",
      "mergecontext" : "",
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "e04cd686.d71298",
      "x" : 1720,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_on",
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"brightness\":\"1\", \"color_temp\":\"236\"}"
   },
   {
      "op2type" : "str",
      "extend" : false,
      "wires" : [
         [
            "1b5f7ab8.52fe45"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "duration" : "3",
      "units" : "s",
      "op2" : "0",
      "type" : "trigger",
      "bytopic" : "all",
      "id" : "d42c4e19.01a5c",
      "reset" : "",
      "x" : 1570,
      "name" : "Wait three seconds",
      "op1type" : "str",
      "op1" : "1",
      "y" : 1400
   },
   {
      "type" : "api-call-service",
      "name" : "Set color temperature",
      "mergecontext" : "",
      "y" : 1400,
      "service_domain" : "light",
      "id" : "1b5f7ab8.52fe45",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"brightness\":\"1\", \"color_temp\":\"236\"}",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "x" : 1780,
      "z" : "8bb76918.ef6b48"
   },
   {
      "id" : "1776e4a3.24d8ab",
      "payloadval" : "0",
      "wires" : [
         [
            "8f0c8c19.0eaac"
         ],
         []
      ],
      "duration" : "1",
      "x" : 1500,
      "units" : "Minute",
      "z" : "20661f8a.532c4",
      "type" : "stoptimer",
      "payloadtype" : "num",
      "name" : "",
      "y" : 2180
   },
   {
      "server" : "smtp.email.com",
      "id" : "f764ac54.e0fa4",
      "x" : 2460,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "port" : "465",
      "type" : "e-mail",
      "dname" : "",
      "secure" : true,
      "y" : 2180,
      "name" : "your-email-address@email.com"
   },
   {
      "inout" : "out",
      "id" : "b38e7b92.e76e78",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "e15da42.be21a58"
         ]
      ],
      "x" : 1870,
      "func" : "rbe",
      "property" : "payload",
      "type" : "rbe",
      "gap" : "",
      "start" : "",
      "y" : 2160,
      "name" : ""
   },
   {
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "673081c4.6aeb1"
         ]
      ],
      "rate" : "1",
      "drop" : true,
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "10",
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "x" : 2020,
      "timeout" : "5",
      "id" : "e15da42.be21a58",
      "y" : 2160,
      "name" : "",
      "pauseType" : "rate",
      "rateUnits" : "minute"
   },
   {
      "from" : "",
      "id" : "8f0c8c19.0eaac",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "b38e7b92.e76e78"
         ]
      ],
      "x" : 1690,
      "to" : "",
      "action" : "",
      "property" : "",
      "type" : "change",
      "rules" : [
         {
            "pt" : "msg",
            "to" : "Nothing written to Home Assistant log file in the last minute. Is Home Assistant still working? Restarting Home Assistant. ",
            "p" : "payload",
            "t" : "set",
            "tot" : "str"
         },
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "to" : "Home Assistant Log file not updating",
            "pt" : "msg"
         }
      ],
      "y" : 2180,
      "name" : "Format message",
      "reg" : false
   },
   {
      "addpay" : false,
      "id" : "fdeb4324.2366e",
      "wires" : [
         [],
         [],
         []
      ],
      "z" : "20661f8a.532c4",
      "x" : 2670,
      "append" : "",
      "timer" : "60",
      "type" : "exec",
      "command" : "/Users/hass/.homeassistant/start.sh restart",
      "y" : 2120,
      "useSpawn" : "false",
      "name" : "Restart Home Assistant",
      "oldrc" : false
   },
   {
      "negate_stop" : false,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "2bf46485.6d730c",
            "80dcc785.d26e68"
         ]
      ],
      "send_stop" : false,
      "default_start" : false,
      "type" : "traffic",
      "send_allow" : false,
      "ignore_case_allow" : false,
      "id" : "684a6b8f.f4d354",
      "negate_allow" : false,
      "x" : 1490,
      "property_stop" : "topic",
      "property_allow" : "topic",
      "filter_allow" : "go",
      "filter_stop" : "stop",
      "differ" : false,
      "y" : 2120,
      "ignore_case_stop" : false,
      "name" : ""
   },
   {
      "y" : 2060,
      "checkall" : "true",
      "name" : "AssertionError",
      "type" : "switch",
      "repair" : false,
      "rules" : [
         {
            "case" : false,
            "vt" : "str",
            "t" : "regex",
            "v" : "^AssertionError"
         }
      ],
      "outputs" : 1,
      "wires" : [
         [
            "684a6b8f.f4d354"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 520,
      "property" : "payload",
      "propertyType" : "msg",
      "id" : "da524a1f.6dd768"
   },
   {
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "to" : "go",
            "pt" : "msg"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "",
      "y" : 2040,
      "id" : "984fceb.5bee93",
      "from" : "",
      "action" : "",
      "property" : "",
      "wires" : [
         [
            "684a6b8f.f4d354",
            "bea03df4.55f04"
         ]
      ],
      "x" : 1480,
      "z" : "20661f8a.532c4",
      "to" : ""
   },
   {
      "payloadtype" : "num",
      "type" : "stoptimer",
      "y" : 2040,
      "name" : "",
      "payloadval" : "0",
      "id" : "bea03df4.55f04",
      "wires" : [
         [
            "2bf46485.6d730c"
         ],
         []
      ],
      "x" : 1700,
      "units" : "Minute",
      "duration" : "1",
      "z" : "20661f8a.532c4"
   },
   {
      "from" : "",
      "id" : "2bf46485.6d730c",
      "wires" : [
         [
            "684a6b8f.f4d354"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 1920,
      "to" : "",
      "action" : "",
      "property" : "",
      "type" : "change",
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "pt" : "msg",
            "to" : "stop",
            "p" : "topic"
         }
      ],
      "y" : 2040,
      "name" : "",
      "reg" : false
   },
   {
      "id" : "80dcc785.d26e68",
      "from" : "",
      "property" : "",
      "action" : "",
      "to" : "",
      "x" : 1690,
      "wires" : [
         [
            "b38e7b92.e76e78"
         ]
      ],
      "z" : "20661f8a.532c4",
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "pt" : "msg",
            "to" : "50+ Zigbee errors and AssertionErrors logged. Restarting Home Assistant. ",
            "p" : "payload"
         },
         {
            "tot" : "str",
            "t" : "set",
            "pt" : "msg",
            "to" : "Home Assistant Zigbee and AssertionErrors",
            "p" : "topic"
         }
      ],
      "type" : "change",
      "name" : "Format message",
      "reg" : false,
      "y" : 2140
   },
   {
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "1776e4a3.24d8ab"
         ]
      ],
      "rate" : "1",
      "name" : "",
      "y" : 2180,
      "rateUnits" : "second",
      "pauseType" : "rate",
      "timeout" : "5",
      "x" : 1290,
      "id" : "eb4e20ed.e3724"
   },
   {
      "crontab" : "",
      "name" : "",
      "payload" : "",
      "y" : 2220,
      "topic" : "",
      "repeat" : "60",
      "type" : "inject",
      "onceDelay" : "60",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "d72edd5d.ae209"
         ]
      ],
      "x" : 830,
      "payloadType" : "date",
      "id" : "64060e4b.f1468",
      "once" : true
   },
   {
      "id" : "d72edd5d.ae209",
      "method" : "GET",
      "tls" : "849977e5.257f68",
      "ret" : "txt",
      "url" : "https://127.0.0.1:8123",
      "wires" : [
         [
            "971a0fcf.0b2b8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 990,
      "type" : "http request",
      "name" : "",
      "y" : 2220
   },
   {
      "propertyType" : "msg",
      "id" : "971a0fcf.0b2b8",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "d5293219.47e9e",
            "e2481800.ece748"
         ]
      ],
      "x" : 1130,
      "property" : "payload",
      "repair" : false,
      "type" : "switch",
      "rules" : [
         {
            "v" : "ECONNREFUSED",
            "vt" : "str",
            "t" : "cont"
         }
      ],
      "outputs" : 1,
      "y" : 2220,
      "name" : "",
      "checkall" : "true"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "pt" : "msg",
            "to" : "Can't reach port 8123 on local host for Home Assistant. Restarting Home Assistant. ",
            "p" : "payload",
            "t" : "set",
            "tot" : "str"
         },
         {
            "tot" : "str",
            "t" : "set",
            "p" : "topic",
            "pt" : "msg",
            "to" : "Home Assistant Port not reachable"
         }
      ],
      "y" : 2220,
      "reg" : false,
      "name" : "Format message",
      "from" : "",
      "id" : "f7a6cfea.d4577",
      "to" : "",
      "wires" : [
         [
            "b38e7b92.e76e78"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 1690,
      "property" : "",
      "action" : ""
   },
   {
      "id" : "ea9a86d3.c745c8",
      "addpay" : false,
      "append" : "",
      "wires" : [
         [],
         [],
         []
      ],
      "x" : 2490,
      "z" : "20661f8a.532c4",
      "command" : "cp /Users/hass/.homeassistant/home-assistant.log home-assistant.log.crash",
      "type" : "exec",
      "timer" : "60",
      "oldrc" : false,
      "name" : "Copy Home Assistant Log file",
      "useSpawn" : "false",
      "y" : 2060
   },
   {
      "timeout" : "10",
      "x" : 2420,
      "id" : "be0ef2f5.b8c65",
      "name" : "",
      "y" : 2120,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "randomFirst" : "1",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "fdeb4324.2366e"
         ]
      ],
      "rate" : "1",
      "drop" : false,
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5"
   },
   {
      "console" : true,
      "type" : "debug",
      "name" : "HTTP Error",
      "complete" : "true",
      "tostatus" : false,
      "y" : 2340,
      "id" : "d5293219.47e9e",
      "active" : true,
      "tosidebar" : true,
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 1360
   },
   {
      "type" : "comment",
      "y" : 2180,
      "name" : "Monitor the Home Assistant port",
      "info" : "",
      "id" : "1b53664d.bf955a",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 870
   },
   {
      "type" : "api-current-state",
      "entity_id" : "group.main_level",
      "y" : 660,
      "name" : "If Main Level off",
      "halt_if" : "off",
      "id" : "56ee825a.cd305c",
      "server" : "e2a02faf.48099",
      "x" : 600,
      "wires" : [
         [
            "45e5a80.bbcad58"
         ]
      ],
      "z" : "e0703c90.1a341"
   },
   {
      "service" : "turn_on",
      "data" : "{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1610,
      "id" : "47c3d025.fe7ac",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "name" : "Turn on porch light",
      "mergecontext" : "",
      "y" : 980,
      "type" : "api-call-service"
   },
   {
      "name" : "Unlock front door",
      "mergecontext" : "",
      "y" : 2880,
      "type" : "api-call-service",
      "service" : "unlock",
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "wires" : [
         []
      ],
      "x" : 390,
      "z" : "8bb76918.ef6b48",
      "service_domain" : "lock",
      "id" : "d01e41d3.f6416",
      "server" : "e2a02faf.48099"
   },
   {
      "halt_if" : "on",
      "name" : "If Main Level off",
      "y" : 320,
      "entity_id" : "group.main_level",
      "type" : "api-current-state",
      "wires" : [
         [
            "61508967.a44508"
         ]
      ],
      "x" : 700,
      "z" : "8bb76918.ef6b48",
      "server" : "e2a02faf.48099",
      "id" : "bf6901d7.16c1d"
   },
   {
      "wires" : [
         [
            "f7cab010.39c01"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 490,
      "server" : "e2a02faf.48099",
      "id" : "8c4a9c3e.b7c28",
      "y" : 1020,
      "name" : "Quiet mode",
      "halt_if" : "",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.quiet_mode"
   },
   {
      "outputs" : 1,
      "type" : "function",
      "name" : "Set global variables",
      "y" : 1020,
      "id" : "f7cab010.39c01",
      "func" : "global.set('quiet_mode',msg.payload);\nreturn msg;",
      "wires" : [
         []
      ],
      "z" : "20661f8a.532c4",
      "x" : 670,
      "noerr" : 0
   },
   {
      "wires" : [
         [
            "81d992b2.e41e7"
         ],
         []
      ],
      "x" : 1530,
      "z" : "46ed0d55.4c98b4",
      "startTime" : "07:00",
      "lon" : "-92.58252",
      "id" : "79c82ba9.4d4844",
      "name" : "7AM to 8PM",
      "y" : 140,
      "lat" : "40.18942",
      "endTime" : "20:00",
      "startOffset" : 0,
      "endOffset" : 0,
      "type" : "time-range-switch"
   },
   {
      "y" : 280,
      "name" : "Is family home?",
      "type" : "function",
      "outputs" : 2,
      "wires" : [
         [],
         []
      ],
      "x" : 500,
      "z" : "451ca7d8.fa5568",
      "noerr" : 0,
      "func" : "family_mode         = global.get('family_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.family_mode     = family_mode;\n\nif( family_mode == 'not_home' && ha_uptime_sec > 600) {\n    msg.abort_alert = 1;\n    return[msg,null];\n} else {\n    msg.abort_alert = 0;\n    return[null,msg];    \n}",
      "outputLabels" : [
         "abort",
         "continue"
      ],
      "id" : "15e8c84c.e7f1f8"
   },
   {
      "z" : "451ca7d8.fa5568",
      "wires" : [
         [
            "dae2deb2.a8c4"
         ]
      ],
      "x" : 510,
      "id" : "1d7df955.f5ad27",
      "server" : "e2a02faf.48099",
      "y" : 200,
      "halt_if" : "",
      "name" : "Family Mode",
      "type" : "api-current-state",
      "entity_id" : "group.family"
   },
   {
      "id" : "dae2deb2.a8c4",
      "x" : 710,
      "wires" : [
         []
      ],
      "noerr" : 0,
      "z" : "451ca7d8.fa5568",
      "func" : "global.set('family_mode',msg.payload);\nreturn msg;",
      "type" : "function",
      "outputs" : 1,
      "y" : 200,
      "name" : "Set global variables"
   },
   {
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "451ca7d8.fa5568",
      "wires" : [
         [
            "15e8c84c.e7f1f8"
         ]
      ],
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "id" : "b52631f3.a41bd",
      "x" : 300,
      "timeout" : "1",
      "pauseType" : "delay",
      "rateUnits" : "second",
      "y" : 280,
      "name" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "e34d85db.72bea8",
      "wires" : [
         [
            "154abbd3.df8ad4"
         ]
      ],
      "z" : "451ca7d8.fa5568",
      "x" : 510,
      "type" : "api-current-state",
      "entity_id" : "sensor.ha_uptime_sec",
      "name" : "HA Uptime",
      "halt_if" : "",
      "y" : 160
   },
   {
      "type" : "function",
      "outputs" : 1,
      "y" : 160,
      "name" : "Set global variables",
      "id" : "154abbd3.df8ad4",
      "noerr" : 0,
      "wires" : [
         []
      ],
      "x" : 710,
      "z" : "451ca7d8.fa5568",
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;"
   },
   {
      "type" : "comment",
      "name" : "Checks if family is home and that HA has not restarted in last ten min",
      "y" : 240,
      "id" : "1f3731a2.70fffe",
      "info" : "",
      "z" : "451ca7d8.fa5568",
      "wires" : [],
      "x" : 660
   },
   {
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "z" : "451ca7d8.fa5568",
      "wires" : [
         [
            "e34d85db.72bea8",
            "1d7df955.f5ad27",
            "b52631f3.a41bd"
         ]
      ],
      "randomFirst" : "1",
      "rate" : "1",
      "name" : "",
      "y" : 160,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "timeout" : "1",
      "x" : 220,
      "id" : "9b844b56.2fdbb8"
   },
   {
      "wires" : [
         [
            "5e54acc4.be8764"
         ]
      ],
      "x" : 970,
      "z" : "af1cc9bd.91cc08",
      "func" : "rbe",
      "property" : "payload",
      "inout" : "out",
      "id" : "763a9ad3.14a7e4",
      "y" : 620,
      "name" : "",
      "gap" : "",
      "type" : "rbe",
      "start" : ""
   },
   {
      "step" : "1",
      "init" : "0",
      "upper" : "",
      "wires" : [
         [
            "af367c64.984dc"
         ]
      ],
      "x" : 1300,
      "z" : "20661f8a.532c4",
      "id" : "e2481800.ece748",
      "lower" : "",
      "name" : "",
      "y" : 2220,
      "mode" : "increment",
      "outputs" : "1",
      "type" : "counter"
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [],
         [
            "f7a6cfea.d4577",
            "64a995d5.df390c"
         ]
      ],
      "x" : 1480,
      "property" : "count",
      "propertyType" : "msg",
      "id" : "af367c64.984dc",
      "y" : 2220,
      "checkall" : "true",
      "name" : "Continue after 5 errors",
      "type" : "switch",
      "repair" : false,
      "outputs" : 2,
      "rules" : [
         {
            "t" : "lte",
            "vt" : "num",
            "v" : "5"
         },
         {
            "v" : "5",
            "vt" : "num",
            "t" : "gt"
         }
      ]
   },
   {
      "wires" : [
         [
            "e2481800.ece748"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 1360,
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "64a995d5.df390c",
      "y" : 2300,
      "name" : "Reset counter",
      "reg" : false,
      "type" : "change",
      "rules" : [
         {
            "pt" : "msg",
            "to" : "true",
            "p" : "reset",
            "t" : "set",
            "tot" : "str"
         }
      ]
   },
   {
      "noerr" : 0,
      "wires" : [
         [
            "a6b1d175.98fc1"
         ]
      ],
      "x" : 950,
      "z" : "10fa16ea.e265b9",
      "func" : "device      = msg.topic.replace(/^.*\\.(.*)/, '$1');\nmsg.payload = { data: {'message': device + ' has been offline for four hours' } };\n\nreturn msg;",
      "id" : "7aee7e9e.273f6",
      "y" : 700,
      "name" : "Format message",
      "type" : "function",
      "outputs" : 1
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "64a995d5.df390c"
         ],
         [
            "f764ac54.e0fa4",
            "be0ef2f5.b8c65",
            "ea9a86d3.c745c8"
         ]
      ],
      "x" : 2210,
      "write" : false,
      "id" : "673081c4.6aeb1",
      "pathType" : "str",
      "read" : true,
      "filenameType" : "str",
      "throwerror" : false,
      "path" : "/Users/hass/.homeassistant",
      "name" : "Stopped manually?",
      "y" : 2160,
      "filename" : "hass.stopped",
      "type" : "fs-ops-access"
   },
   {
      "wires" : [
         [
            "df2b14f7.b68a18"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 330,
      "id" : "bd41a649.b76d38",
      "server" : "e2a02faf.48099",
      "template" : "timestamp,device\n{{ as_timestamp(states.device_tracker.wifes_iphone.last_updated) }},wifes_iphone",
      "y" : 2800,
      "name" : "Wife's phone last talked",
      "type" : "api-render-template"
   },
   {
      "repeat" : "3600",
      "type" : "inject",
      "name" : "",
      "crontab" : "",
      "payload" : "",
      "y" : 2800,
      "topic" : "",
      "id" : "d9a07fc4.34e76",
      "once" : true,
      "onceDelay" : "600",
      "wires" : [
         [
            "bd41a649.b76d38",
            "54505472.4f7edc",
            "2ff1b98b.49b996"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 110,
      "payloadType" : "date"
   },
   {
      "y" : 2840,
      "template" : "timestamp,device\n{{ as_timestamp(states.device_tracker.walts_iphone.last_updated) }},walts_iphone",
      "name" : "Walts's phone last talked",
      "type" : "api-render-template",
      "x" : 330,
      "wires" : [
         [
            "df2b14f7.b68a18"
         ]
      ],
      "z" : "20661f8a.532c4",
      "server" : "e2a02faf.48099",
      "id" : "54505472.4f7edc"
   },
   {
      "wires" : [
         [
            "292db975.768be6"
         ]
      ],
      "x" : 720,
      "z" : "20661f8a.532c4",
      "noerr" : 0,
      "func" : "current_timestamp       = Math.round(+new Date());\n\ndiff                    = current_timestamp - (msg.payload.timestamp * 1000);\ndiff_min                = ((diff / 1000) / 60);\ndiff_hours              = diff_min / 60;\n\nmsg.current_timestamp   = current_timestamp;\nmsg.diff                = diff;\nmsg.diff_min            = diff_min;\nmsg.diff_hours          = diff_hours;\n\nreturn msg;",
      "id" : "2255432e.fde85c",
      "y" : 2840,
      "name" : "Time difference",
      "type" : "function",
      "outputs" : 1
   },
   {
      "y" : 2760,
      "name" : "IOS Clients Still Checking in?",
      "type" : "comment",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 140,
      "info" : "",
      "id" : "2860da3.a8cae26"
   },
   {
      "type" : "switch",
      "repair" : false,
      "rules" : [
         {
            "t" : "gt",
            "vt" : "num",
            "v" : "12"
         }
      ],
      "outputs" : 1,
      "y" : 2840,
      "name" : "",
      "checkall" : "true",
      "propertyType" : "msg",
      "id" : "292db975.768be6",
      "wires" : [
         [
            "46312cef.9689f4",
            "d7f83886.2463e8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 910,
      "property" : "diff_hours"
   },
   {
      "ret" : "\\n",
      "hdrout" : "",
      "hdrin" : true,
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "2255432e.fde85c"
         ]
      ],
      "x" : 550,
      "id" : "df2b14f7.b68a18",
      "temp" : "",
      "sep" : ",",
      "skip" : "0",
      "name" : "",
      "y" : 2840,
      "multi" : "one",
      "type" : "csv"
   },
   {
      "data" : "{ }",
      "service" : "ios_walts_iphone",
      "z" : "20661f8a.532c4",
      "wires" : [
         []
      ],
      "x" : 1710,
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "e162b4ad.599088",
      "name" : "Notify Walt",
      "mergecontext" : "",
      "y" : 2880,
      "type" : "api-call-service"
   },
   {
      "name" : "",
      "y" : 2840,
      "start" : "",
      "type" : "rbe",
      "gap" : "",
      "property" : "payload",
      "func" : "rbe",
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "208ce336.d4f2bc"
         ]
      ],
      "x" : 1330,
      "id" : "63699eb4.e8169",
      "inout" : "out"
   },
   {
      "pauseType" : "rate",
      "rateUnits" : "hour",
      "y" : 2840,
      "name" : "",
      "id" : "208ce336.d4f2bc",
      "x" : 1520,
      "timeout" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "8",
      "drop" : true,
      "timeoutUnits" : "seconds",
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "e121a83c.53eeb8"
         ]
      ],
      "z" : "20661f8a.532c4"
   },
   {
      "secure" : true,
      "dname" : "",
      "type" : "e-mail",
      "name" : "your-email-address@email.com",
      "y" : 2840,
      "id" : "e121a83c.53eeb8",
      "server" : "smtp.email.com",
      "z" : "20661f8a.532c4",
      "wires" : [],
      "x" : 1740,
      "port" : "465"
   },
   {
      "wires" : [
         [
            "50693820.319ce8"
         ]
      ],
      "noerr" : 0,
      "x" : 1150,
      "z" : "20661f8a.532c4",
      "func" : "msg.payload = { data: {'message': msg.payload.device + ' has not talked to Home Assistant in ' + msg.diff_hours } };\n\nreturn msg;",
      "id" : "46312cef.9689f4",
      "y" : 2880,
      "name" : "Format message",
      "type" : "function",
      "outputs" : 1
   },
   {
      "name" : "",
      "y" : 2880,
      "start" : "",
      "gap" : "",
      "type" : "rbe",
      "func" : "rbe",
      "property" : "payload",
      "wires" : [
         [
            "6d8e2bc6.ebd214"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 1330,
      "id" : "50693820.319ce8",
      "inout" : "out"
   },
   {
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "nbRateUnits" : "8",
      "rate" : "1",
      "wires" : [
         [
            "e162b4ad.599088"
         ]
      ],
      "z" : "20661f8a.532c4",
      "randomFirst" : "1",
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "name" : "",
      "y" : 2880,
      "id" : "6d8e2bc6.ebd214",
      "timeout" : "5",
      "x" : 1520
   },
   {
      "rules" : [
         {
            "t" : "set",
            "tot" : "str",
            "to" : "A IOS device has not talked to Home Assistant in over 12 hours",
            "pt" : "msg",
            "p" : "payload"
         },
         {
            "to" : "IOS Device not talking to Home Assistant",
            "pt" : "msg",
            "p" : "topic",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "Format message",
      "y" : 2840,
      "id" : "d7f83886.2463e8",
      "from" : "",
      "action" : "",
      "property" : "",
      "wires" : [
         [
            "63699eb4.e8169"
         ]
      ],
      "x" : 1150,
      "z" : "20661f8a.532c4",
      "to" : ""
   },
   {
      "z" : "20661f8a.532c4",
      "wires" : [
         [
            "df2b14f7.b68a18"
         ]
      ],
      "x" : 300,
      "server" : "e2a02faf.48099",
      "id" : "2ff1b98b.49b996",
      "name" : "iPad last talked",
      "y" : 2880,
      "template" : "timestamp,device\n{{ as_timestamp(states.device_tracker.howd_ipad_air.last_updated) }},ipad",
      "type" : "api-render-template"
   },
   {
      "info" : "",
      "id" : "e4d54329.105e6",
      "wires" : [],
      "z" : "20661f8a.532c4",
      "x" : 220,
      "type" : "comment",
      "y" : 2940,
      "name" : "Start HomeKit after Home Assistant is up for 10 minutes"
   },
   {
      "x" : 330,
      "wires" : [
         [
            "b24dbb06.3416f8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "server" : "e2a02faf.48099",
      "id" : "f18e1880.94e8c8",
      "halt_if" : "",
      "name" : "Home Assistant Uptime",
      "y" : 2980,
      "entity_id" : "sensor.ha_uptime_sec",
      "type" : "api-current-state"
   },
   {
      "crontab" : "",
      "name" : "",
      "topic" : "",
      "y" : 2980,
      "payload" : "",
      "repeat" : "600",
      "type" : "inject",
      "onceDelay" : "601",
      "payloadType" : "date",
      "x" : 110,
      "wires" : [
         [
            "f18e1880.94e8c8"
         ]
      ],
      "z" : "20661f8a.532c4",
      "id" : "2bcb93bd.72a15c",
      "once" : true
   },
   {
      "outputs" : 1,
      "rules" : [
         {
            "t" : "btwn",
            "vt" : "num",
            "v2t" : "num",
            "v2" : "1300",
            "v" : "500"
         }
      ],
      "repair" : false,
      "type" : "switch",
      "checkall" : "true",
      "name" : "",
      "y" : 2980,
      "id" : "b24dbb06.3416f8",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "a19ab6bf.3bba78"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 550
   },
   {
      "type" : "api-call-service",
      "mergecontext" : "",
      "name" : "Start HomeKit",
      "y" : 2980,
      "service_domain" : "homekit",
      "id" : "a19ab6bf.3bba78",
      "server" : "e2a02faf.48099",
      "data" : "{ }",
      "service" : "start",
      "wires" : [
         []
      ],
      "x" : 720,
      "z" : "20661f8a.532c4"
   },
   {
      "wires" : [],
      "z" : "4fa6bb30.5a4f94",
      "x" : 110,
      "id" : "d4f95e68.cbeff",
      "info" : "",
      "name" : "Trash alerts",
      "y" : 140,
      "type" : "comment"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "data.new_state.attributes.message",
            "pt" : "msg",
            "to" : "payload"
         }
      ],
      "y" : 180,
      "reg" : false,
      "name" : "Set calendar message",
      "from" : "",
      "id" : "fc130d1e.58b4",
      "wires" : [
         [
            "df624ca3.e374c"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 340,
      "to" : "",
      "action" : "",
      "property" : ""
   },
   {
      "id" : "51ab11b7.29862",
      "negate_allow" : false,
      "ignore_case_allow" : false,
      "filter_allow" : "release",
      "property_allow" : "topic",
      "property_stop" : "topic",
      "x" : 800,
      "differ" : true,
      "filter_stop" : "stop",
      "name" : "Store message then release",
      "ignore_case_stop" : false,
      "y" : 180,
      "negate_stop" : false,
      "send_stop" : false,
      "wires" : [
         [
            "b5a99d8d.321a3",
            "f16d6ab8.74df88"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "type" : "traffic",
      "default_start" : false,
      "send_allow" : false
   },
   {
      "id" : "df624ca3.e374c",
      "inout" : "out",
      "func" : "rbe",
      "property" : "payload",
      "x" : 530,
      "wires" : [
         [
            "51ab11b7.29862"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "start" : "",
      "gap" : "",
      "type" : "rbe",
      "name" : "",
      "y" : 180
   },
   {
      "x" : 160,
      "wires" : [
         [
            "1b709d2.a584963"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "payloadType" : "date",
      "onceDelay" : "",
      "id" : "b3f89636.084278",
      "once" : false,
      "payload" : "",
      "y" : 240,
      "topic" : "",
      "name" : "7:00PM on Tuesdays",
      "crontab" : "00 19 * * 2",
      "type" : "inject",
      "repeat" : ""
   },
   {
      "x" : 410,
      "wires" : [
         [
            "ee6d7ca9.e3d3c"
         ],
         []
      ],
      "z" : "4fa6bb30.5a4f94",
      "units" : "Minute",
      "duration" : "1",
      "id" : "1b709d2.a584963",
      "y" : 240,
      "maxtimeoutunits" : "Hour",
      "name" : "Loop until midnight",
      "maxloops" : "300",
      "type" : "looptimer",
      "maxtimeout" : "5"
   },
   {
      "id" : "ee6d7ca9.e3d3c",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "3d3f789d.847d18"
         ]
      ],
      "x" : 640,
      "z" : "4fa6bb30.5a4f94",
      "entity_id" : "group.family",
      "type" : "api-current-state",
      "halt_if" : "not_home",
      "name" : "If Family Home",
      "y" : 240
   },
   {
      "wires" : [
         [
            "d5ed089f.b2c918"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 650,
      "id" : "3d3f789d.847d18",
      "server" : "e2a02faf.48099",
      "halt_if" : "on",
      "name" : "If Guest Mode Off",
      "y" : 280,
      "type" : "api-current-state",
      "entity_id" : "input_boolean.guest_mode"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "to" : "stop",
            "pt" : "msg",
            "p" : "payload",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "y" : 320,
      "reg" : false,
      "name" : "Stop loop",
      "from" : "",
      "id" : "47296012.e74b2",
      "wires" : [
         [
            "1b709d2.a584963"
         ]
      ],
      "x" : 380,
      "z" : "4fa6bb30.5a4f94",
      "to" : "",
      "action" : "",
      "property" : ""
   },
   {
      "name" : "If Family not in bed",
      "halt_if" : "on",
      "y" : 320,
      "entity_id" : "binary_sensor.family_in_bed",
      "type" : "api-current-state",
      "wires" : [
         [
            "47296012.e74b2",
            "5ecf39c8.cda878",
            "adca9cdd.5643d"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 650,
      "id" : "d5ed089f.b2c918",
      "server" : "e2a02faf.48099"
   },
   {
      "outputs" : 1,
      "type" : "function",
      "name" : "Format message",
      "y" : 180,
      "id" : "bdc4479e.a95318",
      "func" : "calendar_check      = /calendar/g;\nrecycling_week      = msg.week % 2;\nmsg.recycling_week  = recycling_week;\n\nif(calendar_check.test(msg.topic)) {\n    reminder = msg.payload;\n} else if (recycling_week == 1) {\n    reminder = 'Hey everyone, it is recycling and a trash day tomorrow, so don\\'t forget to set out both bins!';\n} else  {\n    reminder = 'Hey guys, just letting you know that it is a trash day tomorrow!';\n}\n\nmsg.payload = { data: {'message': reminder } };\nreturn msg;",
      "wires" : [
         [
            "d922fa23.992b48",
            "60e0008a.ac4dc"
         ]
      ],
      "noerr" : 0,
      "x" : 1450,
      "z" : "4fa6bb30.5a4f94"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "d922fa23.992b48",
      "data" : "{ \"message\": \"msg\" }",
      "service" : "family_iphones",
      "wires" : [
         []
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 1670,
      "type" : "api-call-service",
      "name" : "Notify Family",
      "y" : 180
   },
   {
      "id" : "60e0008a.ac4dc",
      "type" : "subflow:837bbace.420028",
      "name" : "",
      "y" : 220,
      "wires" : [
         [],
         []
      ],
      "x" : 1670,
      "z" : "4fa6bb30.5a4f94"
   },
   {
      "y" : 320,
      "reg" : false,
      "name" : "Release messages",
      "type" : "change",
      "rules" : [
         {
            "p" : "topic",
            "pt" : "msg",
            "to" : "release",
            "t" : "set",
            "tot" : "str"
         }
      ],
      "to" : "",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "51ab11b7.29862"
         ]
      ],
      "x" : 1130,
      "property" : "",
      "action" : "",
      "from" : "",
      "id" : "5ecf39c8.cda878"
   },
   {
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "nbRateUnits" : "5",
      "drop" : true,
      "timeoutUnits" : "seconds",
      "rate" : "1",
      "wires" : [
         [
            "58554223.ab894c"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "randomFirst" : "1",
      "pauseType" : "rate",
      "rateUnits" : "hour",
      "y" : 180,
      "name" : "",
      "id" : "b5a99d8d.321a3",
      "x" : 1060,
      "timeout" : "5"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "to" : "stop",
            "pt" : "msg",
            "p" : "topic",
            "t" : "set",
            "tot" : "str"
         },
         {
            "pt" : "msg",
            "to" : "true",
            "p" : "reset",
            "tot" : "str",
            "t" : "set"
         }
      ],
      "y" : 260,
      "name" : "Hold messages and reset",
      "reg" : false,
      "from" : "",
      "id" : "f16d6ab8.74df88",
      "to" : "",
      "wires" : [
         [
            "51ab11b7.29862",
            "adca9cdd.5643d"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 910,
      "property" : "",
      "action" : ""
   },
   {
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "nbRateUnits" : "1",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "rate" : "1",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "51ab11b7.29862"
         ]
      ],
      "randomFirst" : "1",
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "Send default trash msg through after traffic light is green",
      "y" : 280,
      "id" : "adca9cdd.5643d",
      "timeout" : "5",
      "x" : 1290
   },
   {
      "name" : "Trash calendar event",
      "y" : 180,
      "entityidfilter" : "calendar.family_trash",
      "haltifstate" : "off",
      "type" : "server-state-changed",
      "wires" : [
         [
            "fc130d1e.58b4"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 130,
      "entityidfiltertype" : "exact",
      "id" : "17e6dd41.11d513",
      "server" : "e2a02faf.48099"
   },
   {
      "input" : "",
      "adjType" : "days",
      "inputType" : "date",
      "type" : "moment",
      "format" : "w",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "bdc4479e.a95318"
         ]
      ],
      "adjDir" : "add",
      "name" : "Week of the year",
      "outputType" : "msg",
      "locale" : "en_US",
      "y" : 180,
      "adjAmount" : 0,
      "topic" : "",
      "output" : "week",
      "outTz" : "America/Chicago",
      "x" : 1250,
      "inTz" : "America/Chicago",
      "id" : "58554223.ab894c"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "9b6f1a14.287fa8",
      "wires" : [
         [
            "7f8dc685.3deae8"
         ]
      ],
      "x" : 120,
      "z" : "4fa6bb30.5a4f94",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "y" : 500,
      "haltifstate" : "",
      "entityidfilter" : "sensor.mailbox",
      "name" : "Mailbox opened"
   },
   {
      "propertyType" : "msg",
      "id" : "7f8dc685.3deae8",
      "outputLabels" : [
         "Open / Motion",
         "Closed / No Motion"
      ],
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "228a4f8e.87fcd"
         ],
         []
      ],
      "x" : 300,
      "property" : "payload",
      "type" : "switch",
      "repair" : false,
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "open"
         },
         {
            "v" : "closed",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "outputs" : 2,
      "y" : 500,
      "name" : "Opened",
      "checkall" : "true"
   },
   {
      "id" : "228a4f8e.87fcd",
      "type" : "subflow:c663f7df.ca58b8",
      "name" : "",
      "y" : 500,
      "x" : 550,
      "wires" : [
         [
            "284caaec.a63526",
            "7d9b98f1.e410e8",
            "d1432319.44ffc"
         ]
      ],
      "z" : "4fa6bb30.5a4f94"
   },
   {
      "name" : "Update Walts location",
      "y" : 540,
      "type" : "api-call-service",
      "data" : "{ \"message\":\"request_location_update\"}",
      "service" : "ios_walts_iphone",
      "wires" : [
         []
      ],
      "x" : 1040,
      "z" : "4fa6bb30.5a4f94",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "id" : "284caaec.a63526"
   },
   {
      "type" : "api-call-service",
      "y" : 500,
      "name" : "Update Wifes location",
      "service_domain" : "notify",
      "id" : "7d9b98f1.e410e8",
      "server" : "e2a02faf.48099",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         []
      ],
      "x" : 1050,
      "data" : "{ \"message\":\"request_location_update\"}",
      "service" : "ios_wifes_iphone"
   },
   {
      "id" : "d1432319.44ffc",
      "x" : 720,
      "timeout" : "3",
      "pauseType" : "delay",
      "rateUnits" : "second",
      "y" : 560,
      "name" : "3 minute delay for location update",
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "7dedfa69.f16b84"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "drop" : false,
      "timeoutUnits" : "minutes",
      "nbRateUnits" : "1"
   },
   {
      "name" : "Family still not home",
      "y" : 620,
      "wires" : [
         [
            "cbccb0ed.6d9ce"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 740,
      "id" : "7dedfa69.f16b84",
      "type" : "subflow:c663f7df.ca58b8"
   },
   {
      "id" : "362378f2.3a9618",
      "x" : 1630,
      "wires" : [
         [
            "65d5cf98.3829c"
         ]
      ],
      "noerr" : 0,
      "z" : "4fa6bb30.5a4f94",
      "func" : "msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened!' } };\n\nreturn msg;",
      "type" : "function",
      "outputs" : 1,
      "y" : 660,
      "name" : "Format message"
   },
   {
      "id" : "65d5cf98.3829c",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "service" : "family_iphones",
      "data" : "{ \"message\": \"msg\" }",
      "wires" : [
         []
      ],
      "x" : 1850,
      "z" : "4fa6bb30.5a4f94",
      "type" : "api-call-service",
      "name" : "Notify Family",
      "y" : 660
   },
   {
      "x" : 160,
      "wires" : [],
      "z" : "4fa6bb30.5a4f94",
      "info" : "",
      "id" : "ee406e7b.b18ca",
      "y" : 400,
      "name" : "Mail and package notifications",
      "type" : "comment"
   },
   {
      "y" : 620,
      "checkall" : "true",
      "name" : "Getting mail today?",
      "repair" : false,
      "type" : "switch",
      "outputs" : 2,
      "rules" : [
         {
            "vt" : "num",
            "t" : "gt",
            "v" : "0"
         },
         {
            "v" : "0",
            "t" : "eq",
            "vt" : "num"
         }
      ],
      "wires" : [
         [
            "e55cc6db.96e8b8"
         ],
         [
            "32319881.c397a8"
         ]
      ],
      "x" : 1210,
      "z" : "4fa6bb30.5a4f94",
      "property" : "payload",
      "propertyType" : "msg",
      "outputLabels" : [
         "mail today",
         ""
      ],
      "id" : "7e02ac13.ef4704"
   },
   {
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "4eaedf08.d5bb4",
            "34159e27.7f2212"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "nbRateUnits" : "12",
      "id" : "e55cc6db.96e8b8",
      "timeout" : "5",
      "x" : 1420,
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "name" : "",
      "y" : 600
   },
   {
      "type" : "function",
      "outputs" : 1,
      "y" : 580,
      "name" : "Format message",
      "id" : "4eaedf08.d5bb4",
      "x" : 1630,
      "wires" : [
         [
            "f6dda28c.25669",
            "f28eb81c.1ea768",
            "2daf1f84.631ee"
         ]
      ],
      "noerr" : 0,
      "z" : "4fa6bb30.5a4f94",
      "func" : "msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened! Here is a preview of what is inside', data: { attachment: {'url': 'https://your-hostname.duckdns.org:65443/local/todays_mails.gif' } } } };\nreturn msg;"
   },
   {
      "type" : "api-call-service",
      "y" : 580,
      "name" : "Logbook entry",
      "mergecontext" : "",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "id" : "2daf1f84.631ee",
      "x" : 1860,
      "wires" : [
         []
      ],
      "z" : "4fa6bb30.5a4f94",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Sent today's mail notification to family iphones\" }",
      "service" : "log"
   },
   {
      "type" : "api-call-service",
      "name" : "Notify Family",
      "mergecontext" : "",
      "y" : 540,
      "id" : "f28eb81c.1ea768",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "data" : "{ \"message\": \"msg\" }",
      "service" : "family_iphones",
      "x" : 1850,
      "wires" : [
         []
      ],
      "z" : "4fa6bb30.5a4f94"
   },
   {
      "console" : false,
      "type" : "debug",
      "tostatus" : false,
      "complete" : "true",
      "name" : "ios attachment",
      "y" : 500,
      "id" : "f6dda28c.25669",
      "active" : true,
      "tosidebar" : true,
      "wires" : [],
      "x" : 1860,
      "z" : "4fa6bb30.5a4f94"
   },
   {
      "id" : "a885418.46998c",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "fa9123f2.a0faa"
         ]
      ],
      "x" : 130,
      "z" : "4fa6bb30.5a4f94",
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "name" : "UPS Package Count",
      "y" : 680,
      "entityidfilter" : "sensor.ups_packages",
      "haltifstate" : ""
   },
   {
      "wires" : [
         [
            "ba50c459.6dd5b8"
         ]
      ],
      "x" : 350,
      "z" : "4fa6bb30.5a4f94",
      "property" : "payload",
      "propertyType" : "msg",
      "id" : "fa9123f2.a0faa",
      "outputLabels" : [
         "packages today"
      ],
      "y" : 680,
      "checkall" : "true",
      "name" : "Getting packages today?",
      "type" : "switch",
      "repair" : false,
      "outputs" : 1,
      "rules" : [
         {
            "t" : "gt",
            "vt" : "num",
            "v" : "0"
         }
      ]
   },
   {
      "randomFirst" : "1",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "ab8d4017.d47d9"
         ]
      ],
      "rate" : "1",
      "nbRateUnits" : "12",
      "drop" : false,
      "timeoutUnits" : "seconds",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "x" : 600,
      "timeout" : "5",
      "id" : "ba50c459.6dd5b8",
      "y" : 680,
      "name" : "",
      "pauseType" : "rate",
      "rateUnits" : "hour"
   },
   {
      "type" : "function",
      "outputs" : 1,
      "y" : 680,
      "name" : "Format message",
      "id" : "ab8d4017.d47d9",
      "wires" : [
         [
            "eb0c3fbb.95ea",
            "6ac9290f.1d3a58",
            "9230963c.65fd98"
         ]
      ],
      "x" : 810,
      "noerr" : 0,
      "z" : "4fa6bb30.5a4f94",
      "func" : "packages    = msg.payload;\n\nif ( packages == 1 ) {\n   msg.payload = { data: {'message': 'There is one UPS package scheduled for delivery today' } }; \n   return msg;\n} else if ( packages > 1) {\n     msg.payload = { data: {'message': 'There are ' + packages + 'UPS packages scheduled for delivery today' } }; \n    return msg;\n}\n\n"
   },
   {
      "type" : "api-call-service",
      "name" : "Notify Family",
      "mergecontext" : "",
      "y" : 720,
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "6ac9290f.1d3a58",
      "service" : "family_iphones",
      "data" : "{ \"message\": \"msg\" }",
      "x" : 1030,
      "wires" : [
         []
      ],
      "z" : "4fa6bb30.5a4f94"
   },
   {
      "mergecontext" : "",
      "name" : "Logbook entry",
      "y" : 680,
      "type" : "api-call-service",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Sent today's UPS notification to family iphones\" }",
      "service" : "log",
      "x" : 1040,
      "wires" : [
         []
      ],
      "z" : "4fa6bb30.5a4f94",
      "id" : "9230963c.65fd98",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099"
   },
   {
      "wires" : [],
      "z" : "4fa6bb30.5a4f94",
      "x" : 1010,
      "tosidebar" : true,
      "active" : true,
      "id" : "eb0c3fbb.95ea",
      "y" : 760,
      "tostatus" : false,
      "complete" : "true",
      "name" : "UPS",
      "type" : "debug",
      "console" : false
   },
   {
      "id" : "e937aa9d.a2fd58",
      "server" : "e2a02faf.48099",
      "x" : 140,
      "wires" : [
         [
            "111ee391.1a5ebc"
         ]
      ],
      "entityidfiltertype" : "exact",
      "z" : "4fa6bb30.5a4f94",
      "type" : "server-state-changed",
      "name" : "FedEx Package Count",
      "y" : 800,
      "haltifstate" : "",
      "entityidfilter" : "sensor.fedex_packages"
   },
   {
      "repair" : false,
      "type" : "switch",
      "rules" : [
         {
            "vt" : "num",
            "t" : "gt",
            "v" : "0"
         }
      ],
      "outputs" : 1,
      "y" : 800,
      "checkall" : "true",
      "name" : "Getting packages today?",
      "propertyType" : "msg",
      "id" : "111ee391.1a5ebc",
      "outputLabels" : [
         "packages today"
      ],
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "b519312c.55332"
         ]
      ],
      "x" : 370,
      "property" : "payload"
   },
   {
      "rate" : "1",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "3b02adbb.5bb8d2"
         ]
      ],
      "randomFirst" : "1",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "nbRateUnits" : "12",
      "timeoutUnits" : "seconds",
      "drop" : false,
      "id" : "b519312c.55332",
      "x" : 600,
      "timeout" : "5",
      "pauseType" : "rate",
      "rateUnits" : "hour",
      "y" : 800,
      "name" : ""
   },
   {
      "id" : "3b02adbb.5bb8d2",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "79c7359a.6c759c",
            "79dc93f0.b54b7c",
            "4232d5f4.951b2c"
         ]
      ],
      "x" : 810,
      "noerr" : 0,
      "func" : "packages    = msg.payload;\n\nif ( packages == 1 ) {\n   msg.payload = { data: {'message': 'There is one FedEx package scheduled for delivery today' } }; \n   return msg;\n} else if ( packages > 1) {\n     msg.payload = { data: {'message': 'There are ' + packages + 'FedEx packages scheduled for delivery today' } }; \n    return msg;\n}\n\n",
      "type" : "function",
      "outputs" : 1,
      "y" : 800,
      "name" : "Format message"
   },
   {
      "name" : "Notify Family",
      "mergecontext" : "",
      "y" : 840,
      "type" : "api-call-service",
      "service" : "family_iphones",
      "data" : "{ \"message\": \"msg\" }",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         []
      ],
      "x" : 1030,
      "id" : "79dc93f0.b54b7c",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099"
   },
   {
      "name" : "Logbook entry",
      "mergecontext" : "",
      "y" : 800,
      "type" : "api-call-service",
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Sent today's FedEx notification to family iphones\" }",
      "wires" : [
         []
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 1040,
      "id" : "4232d5f4.951b2c",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "79c7359a.6c759c",
      "active" : true,
      "tosidebar" : true,
      "wires" : [],
      "x" : 1010,
      "z" : "4fa6bb30.5a4f94",
      "console" : false,
      "type" : "debug",
      "name" : "FedEx",
      "complete" : "true",
      "tostatus" : false,
      "y" : 880
   },
   {
      "id" : "cbccb0ed.6d9ce",
      "server" : "e2a02faf.48099",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "7e02ac13.ef4704"
         ]
      ],
      "x" : 1010,
      "entity_id" : "sensor.usps_mail",
      "type" : "api-current-state",
      "y" : 620,
      "halt_if" : "",
      "name" : "USPS Mail Count"
   },
   {
      "type" : "inject",
      "repeat" : "",
      "payload" : "",
      "y" : 440,
      "topic" : "",
      "name" : "Every five minutes in the morning",
      "crontab" : "*/5 7-9 * * *",
      "id" : "aa34e0c6.6a9be",
      "once" : false,
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "c7ba09e7.3718b8"
         ]
      ],
      "x" : 200,
      "payloadType" : "date",
      "onceDelay" : ""
   },
   {
      "mergecontext" : "",
      "name" : "Check USPS for mail",
      "y" : 440,
      "type" : "api-call-service",
      "data" : "{ }",
      "service" : "usps_mail_check",
      "x" : 1000,
      "wires" : [
         []
      ],
      "z" : "4fa6bb30.5a4f94",
      "id" : "c7ba09e7.3718b8",
      "service_domain" : "shell_command",
      "server" : "e2a02faf.48099"
   },
   {
      "outputs" : 1,
      "type" : "function",
      "name" : "Format message",
      "y" : 620,
      "id" : "34159e27.7f2212",
      "func" : "msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened!' } };\n\nreturn msg;",
      "noerr" : 0,
      "wires" : [
         [
            "a6cf3075.74c6a"
         ]
      ],
      "x" : 1630,
      "z" : "4fa6bb30.5a4f94"
   },
   {
      "wires" : [
         [],
         []
      ],
      "x" : 1850,
      "z" : "4fa6bb30.5a4f94",
      "y" : 620,
      "name" : "",
      "type" : "subflow:837bbace.420028",
      "id" : "a6cf3075.74c6a"
   },
   {
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "name" : "",
      "y" : 640,
      "id" : "32319881.c397a8",
      "timeout" : "5",
      "x" : 1420,
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "nbRateUnits" : "12",
      "drop" : false,
      "timeoutUnits" : "seconds",
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         [
            "362378f2.3a9618",
            "34159e27.7f2212"
         ]
      ]
   },
   {
      "units" : "Minute",
      "wires" : [
         [
            "4e94d395.f6758c"
         ],
         []
      ],
      "x" : 630,
      "duration" : "10",
      "z" : "4fa6bb30.5a4f94",
      "id" : "55b6911.795fe7",
      "payloadval" : "0",
      "name" : "10 minutes",
      "y" : 940,
      "payloadtype" : "num",
      "type" : "stoptimer"
   },
   {
      "y" : 940,
      "checkall" : "true",
      "name" : "Door Open Or Closed",
      "repair" : false,
      "type" : "switch",
      "rules" : [
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "open"
         },
         {
            "v" : "closed",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "outputs" : 2,
      "x" : 300,
      "wires" : [
         [
            "55b6911.795fe7"
         ],
         [
            "b9081694.925d58"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "property" : "payload",
      "propertyType" : "msg",
      "id" : "8e9ba303.34ba3",
      "outputLabels" : [
         "Open",
         "Closed"
      ]
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "1637d719.6e3919",
      "entityidfiltertype" : "exact",
      "wires" : [
         [
            "8e9ba303.34ba3"
         ]
      ],
      "x" : 110,
      "z" : "4fa6bb30.5a4f94",
      "type" : "server-state-changed",
      "y" : 940,
      "entityidfilter" : "sensor.fridge",
      "haltifstate" : "",
      "name" : "Fridge Door"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "pt" : "msg",
            "to" : "STOP",
            "p" : "payload"
         }
      ],
      "y" : 980,
      "name" : "Stop timer",
      "reg" : false,
      "from" : "",
      "id" : "b9081694.925d58",
      "to" : "",
      "x" : 490,
      "wires" : [
         [
            "55b6911.795fe7"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "property" : "",
      "action" : ""
   },
   {
      "func" : "msg.payload = { data: {'message': 'Fridge door has been open over 10 minutes' } };\n\nreturn msg;",
      "x" : 830,
      "wires" : [
         [
            "d1a2909.adaa47",
            "762f7488.9a688c",
            "3557758a.370eaa"
         ]
      ],
      "noerr" : 0,
      "z" : "4fa6bb30.5a4f94",
      "id" : "4e94d395.f6758c",
      "name" : "Format message",
      "y" : 940,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "notify",
      "id" : "d1a2909.adaa47",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         []
      ],
      "x" : 1070,
      "data" : "{ \"message\": \"msg\" }",
      "service" : "family_iphones",
      "type" : "api-call-service",
      "y" : 980,
      "name" : "Notify Family"
   },
   {
      "name" : "",
      "y" : 1020,
      "wires" : [
         [],
         []
      ],
      "z" : "4fa6bb30.5a4f94",
      "x" : 1070,
      "id" : "762f7488.9a688c",
      "type" : "subflow:837bbace.420028"
   },
   {
      "type" : "comment",
      "y" : 900,
      "name" : "Fridge left open",
      "info" : "",
      "id" : "61bfa3fa.5ad7cc",
      "x" : 120,
      "wires" : [],
      "z" : "4fa6bb30.5a4f94"
   },
   {
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Fridge left open\" }",
      "service" : "log",
      "z" : "4fa6bb30.5a4f94",
      "wires" : [
         []
      ],
      "x" : 1080,
      "id" : "3557758a.370eaa",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "name" : "Logbook entry",
      "y" : 940,
      "type" : "api-call-service"
   },
   {
      "y" : 1360,
      "name" : "Fade the family room overhead lights",
      "type" : "comment",
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "x" : 170,
      "info" : "",
      "id" : "fa9f3dc2.ea984"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "74e64649.247b98",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "78af6a02.2613f4"
         ]
      ],
      "x" : 540,
      "entity_id" : "light.family_room_overhead_lights",
      "type" : "api-current-state",
      "y" : 1400,
      "halt_if" : "off",
      "name" : "Family Room Overhead lights on?"
   },
   {
      "mergecontext" : "",
      "name" : "Fade off for next half hour",
      "y" : 1400,
      "type" : "api-call-service",
      "data" : "{ \"entity_id\":\"light.family_room_overhead_lights\", \"brightness\":\"0\",\"transition\":\"1800\"}",
      "service" : "turn_on",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 850,
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "78af6a02.2613f4"
   },
   {
      "y" : 1420,
      "aug" : true,
      "repeat" : true,
      "lat" : "40.173508",
      "endtime" : "1425",
      "month1" : 0,
      "starttime" : "5004",
      "jul" : true,
      "w5" : 0,
      "d3" : 0,
      "type" : "bigtimer",
      "apr" : true,
      "jun" : true,
      "mon" : true,
      "wires" : [
         [],
         [],
         [
            "25882cc5.e12544"
         ]
      ],
      "outpayload1" : "",
      "jan" : true,
      "day3" : 0,
      "suspend" : false,
      "feb" : true,
      "d4" : 0,
      "name" : "Hour before sunset",
      "sat" : true,
      "dec" : true,
      "odd" : false,
      "w2" : 0,
      "day2" : 0,
      "month4" : 0,
      "random" : false,
      "outpayload2" : "",
      "d5" : 0,
      "offs" : 0,
      "month2" : 0,
      "even" : false,
      "day1" : 0,
      "w4" : 0,
      "tue" : true,
      "startoff" : "-60",
      "nov" : true,
      "thu" : true,
      "w3" : 0,
      "atstart" : false,
      "oct" : true,
      "timeout" : 1440,
      "outtopic" : "",
      "wed" : true,
      "id" : "464cdfb.53e522",
      "mar" : true,
      "w1" : 0,
      "d2" : 0,
      "outtext2" : "off",
      "lon" : "-92.58988",
      "sun" : true,
      "x" : 110,
      "sep" : true,
      "d1" : 0,
      "month5" : 0,
      "month3" : 0,
      "day4" : 0,
      "fri" : true,
      "z" : "8bb76918.ef6b48",
      "endoff" : "0",
      "outtext1" : "on",
      "day5" : 0,
      "may" : true
   },
   {
      "rules" : [
         {
            "v" : "on",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "v" : "off",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "outputs" : 2,
      "type" : "switch",
      "name" : "",
      "checkall" : "true",
      "y" : 1400,
      "id" : "25882cc5.e12544",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "74e64649.247b98"
         ],
         []
      ],
      "x" : 330,
      "z" : "8bb76918.ef6b48"
   },
   {
      "info" : "",
      "id" : "69e7c64a.2484d8",
      "wires" : [],
      "x" : 140,
      "z" : "4fa6bb30.5a4f94",
      "type" : "comment",
      "y" : 40,
      "name" : "Speak calendar alerts"
   },
   {
      "type" : "server-state-changed",
      "haltifstate" : "off",
      "y" : 80,
      "entityidfilter" : "calendar.family",
      "name" : "Family Calendar Events",
      "id" : "371d1fe2.9e9c7",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "9da6c1d8.21f55"
         ]
      ],
      "x" : 140,
      "z" : "4fa6bb30.5a4f94",
      "entityidfiltertype" : "exact"
   },
   {
      "id" : "5b7fcfe8.9046c",
      "wires" : [
         [
            "7a5212f0.547f3c"
         ]
      ],
      "noerr" : 0,
      "x" : 710,
      "z" : "4fa6bb30.5a4f94",
      "func" : "msg.payload = { data: {'message': 'You have an event on the family calendar. Here it is..... ' + msg.payload } };\nreturn msg;",
      "type" : "function",
      "outputs" : 1,
      "y" : 80,
      "name" : "Format message"
   },
   {
      "id" : "8f05614.6c4e8a",
      "type" : "subflow:837bbace.420028",
      "name" : "",
      "wires" : [
         [],
         []
      ],
      "x" : 1150,
      "z" : "4fa6bb30.5a4f94",
      "y" : 80
   },
   {
      "x" : 360,
      "wires" : [
         [
            "9477e5f1.889208"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "9da6c1d8.21f55",
      "y" : 80,
      "reg" : false,
      "name" : "Set calendar message",
      "type" : "change",
      "rules" : [
         {
            "p" : "data.new_state.attributes.message",
            "to" : "payload",
            "pt" : "msg",
            "tot" : "msg",
            "t" : "move"
         }
      ]
   },
   {
      "id" : "9477e5f1.889208",
      "outputLabels" : [
         "Trash",
         "Cleaning",
         "Everything else"
      ],
      "propertyType" : "msg",
      "property" : "payload",
      "x" : 530,
      "wires" : [
         [],
         [],
         [
            "5b7fcfe8.9046c"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "outputs" : 3,
      "rules" : [
         {
            "v" : "trash",
            "vt" : "str",
            "t" : "cont"
         },
         {
            "v" : "Brenda",
            "t" : "cont",
            "vt" : "str"
         },
         {
            "t" : "nnull"
         }
      ],
      "type" : "switch",
      "repair" : false,
      "name" : "Filter",
      "checkall" : "false",
      "y" : 100
   },
   {
      "y" : 80,
      "x" : 940,
      "wires" : [
         [
            "8f05614.6c4e8a"
         ]
      ],
      "z" : "4fa6bb30.5a4f94",
      "name" : "",
      "type" : "subflow:2283eff7.ee9ab",
      "id" : "7a5212f0.547f3c"
   },
   {
      "service_domain" : "light",
      "id" : "330ed63f.3af7ca",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "x" : 1070,
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"color_temp\":\"400\"}",
      "service" : "turn_on",
      "type" : "api-call-service",
      "y" : 1520,
      "mergecontext" : "",
      "name" : "Set Son1's Lamp dusk color temp"
   },
   {
      "service" : "turn_on",
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"color_temp\":\"400\"}",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1070,
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "da36d0b5.81e24",
      "name" : "Set Master Bedroom dusk Color temp",
      "mergecontext" : "",
      "y" : 1600,
      "type" : "api-call-service"
   },
   {
      "y" : 1560,
      "mergecontext" : "",
      "name" : "Set Son1's Lamp night color temp",
      "type" : "api-call-service",
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1070,
      "data" : "{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"color_temp\":\"442\"}",
      "service" : "turn_on",
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "5dc13834.3260c8"
   },
   {
      "id" : "c4e7e586.446738",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "wires" : [
         []
      ],
      "x" : 1070,
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"entity_id\":\"light.master_bedroom\", \"color_temp\":\"442\"}",
      "service" : "turn_on",
      "type" : "api-call-service",
      "y" : 1640,
      "name" : "Set Master Bedroom night Color temp",
      "mergecontext" : ""
   },
   {
      "y" : 1500,
      "name" : "Set evening color temperatures",
      "type" : "comment",
      "wires" : [],
      "z" : "8bb76918.ef6b48",
      "x" : 150,
      "info" : "",
      "id" : "7d9a76be.023d48"
   },
   {
      "startOffset" : "-15",
      "endTime" : "sunset",
      "lat" : "40.17349",
      "type" : "time-range-switch",
      "endOffset" : 0,
      "name" : "Golden Hour",
      "y" : 1520,
      "id" : "5c47beb1.351bc",
      "lon" : "-92.58936",
      "wires" : [
         [
            "994ea68c.e47408"
         ],
         []
      ],
      "x" : 410,
      "startTime" : "sunsetStart",
      "z" : "8bb76918.ef6b48"
   },
   {
      "wires" : [
         [
            "43578917.231708"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "randomFirst" : "1",
      "rate" : "1",
      "nbRateUnits" : "12",
      "drop" : true,
      "timeoutUnits" : "seconds",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "timeout" : "5",
      "x" : 640,
      "id" : "994ea68c.e47408",
      "name" : "",
      "y" : 1520,
      "rateUnits" : "hour",
      "pauseType" : "rate"
   },
   {
      "outputonchanged" : true,
      "wires" : [
         [
            "ab280336.23d1b"
         ]
      ],
      "x" : 100,
      "z" : "8bb76918.ef6b48",
      "server" : "e2a02faf.48099",
      "id" : "cfded722.f52858",
      "name" : "Son1s Lamp",
      "outputinitially" : false,
      "y" : 1540,
      "type" : "poll-state",
      "entity_id" : "light.philips_lct014_0288ce3f_11",
      "updateinterval" : "600"
   },
   {
      "y" : 1540,
      "name" : "",
      "checkall" : "true",
      "type" : "switch",
      "repair" : false,
      "rules" : [
         {
            "v" : "on",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "outputs" : 1,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "5c47beb1.351bc",
            "cb613e2a.f3ce"
         ]
      ],
      "x" : 270,
      "property" : "payload.data.state",
      "propertyType" : "msg",
      "id" : "ab280336.23d1b"
   },
   {
      "name" : "Sunset",
      "y" : 1560,
      "startOffset" : "0",
      "endTime" : "dusk",
      "lat" : "40.17349",
      "type" : "time-range-switch",
      "endOffset" : 0,
      "x" : 390,
      "wires" : [
         [
            "8535fecb.72876"
         ],
         []
      ],
      "z" : "8bb76918.ef6b48",
      "startTime" : "sunset",
      "lon" : "-92.58936",
      "id" : "cb613e2a.f3ce"
   },
   {
      "pauseType" : "rate",
      "rateUnits" : "hour",
      "y" : 1560,
      "name" : "",
      "id" : "8535fecb.72876",
      "x" : 640,
      "timeout" : "5",
      "randomLast" : "5",
      "randomUnits" : "seconds",
      "type" : "delay",
      "nbRateUnits" : "12",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "rate" : "1",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "81a6fb8a.127bf8"
         ]
      ],
      "randomFirst" : "1"
   },
   {
      "id" : "ff121591.c145d8",
      "lon" : "-92.58936",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "778801f6.34c8f"
         ],
         []
      ],
      "x" : 410,
      "startTime" : "sunsetStart",
      "type" : "time-range-switch",
      "endOffset" : 0,
      "startOffset" : "-15",
      "lat" : "40.17349",
      "endTime" : "sunset",
      "y" : 1600,
      "name" : "Golden Hour"
   },
   {
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "nbRateUnits" : "12",
      "timeoutUnits" : "seconds",
      "drop" : true,
      "rate" : "1",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "d1b85ed5.71087"
         ]
      ],
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "name" : "",
      "y" : 1600,
      "id" : "778801f6.34c8f",
      "timeout" : "5",
      "x" : 640
   },
   {
      "entity_id" : "light.master_bedroom",
      "updateinterval" : "600",
      "type" : "poll-state",
      "name" : "Master Bedroom",
      "outputinitially" : false,
      "y" : 1620,
      "id" : "f53fc0eb.83756",
      "server" : "e2a02faf.48099",
      "outputonchanged" : true,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "5f45efc4.590a6"
         ]
      ],
      "x" : 100
   },
   {
      "y" : 1620,
      "checkall" : "true",
      "name" : "",
      "repair" : false,
      "type" : "switch",
      "outputs" : 1,
      "rules" : [
         {
            "v" : "on",
            "t" : "eq",
            "vt" : "str"
         }
      ],
      "wires" : [
         [
            "ff121591.c145d8",
            "37a61a5d.a4d976"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 270,
      "property" : "payload.data.state",
      "propertyType" : "msg",
      "id" : "5f45efc4.590a6"
   },
   {
      "y" : 1640,
      "name" : "Sunset",
      "endOffset" : 0,
      "type" : "time-range-switch",
      "endTime" : "dusk",
      "lat" : "40.17349",
      "startOffset" : "0",
      "wires" : [
         [
            "e98299d6.ba27f8"
         ],
         []
      ],
      "x" : 390,
      "startTime" : "sunset",
      "z" : "8bb76918.ef6b48",
      "lon" : "-92.58936",
      "id" : "37a61a5d.a4d976"
   },
   {
      "id" : "e98299d6.ba27f8",
      "timeout" : "5",
      "x" : 640,
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "name" : "",
      "y" : 1640,
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "a8657919.fbb5d8"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "nbRateUnits" : "12",
      "timeoutUnits" : "seconds",
      "drop" : true
   },
   {
      "name" : "Clear msg",
      "y" : 1520,
      "outputs" : 1,
      "type" : "function",
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "330ed63f.3af7ca"
         ]
      ],
      "x" : 820,
      "noerr" : 0,
      "id" : "43578917.231708"
   },
   {
      "wires" : [
         [
            "5dc13834.3260c8"
         ]
      ],
      "x" : 820,
      "noerr" : 0,
      "z" : "8bb76918.ef6b48",
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "id" : "81a6fb8a.127bf8",
      "y" : 1560,
      "name" : "Clear msg",
      "type" : "function",
      "outputs" : 1
   },
   {
      "name" : "Clear msg",
      "y" : 1600,
      "outputs" : 1,
      "type" : "function",
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "wires" : [
         [
            "da36d0b5.81e24"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 820,
      "noerr" : 0,
      "id" : "d1b85ed5.71087"
   },
   {
      "outputs" : 1,
      "type" : "function",
      "name" : "Clear msg",
      "y" : 1640,
      "id" : "a8657919.fbb5d8",
      "func" : "// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;",
      "noerr" : 0,
      "wires" : [
         [
            "c4e7e586.446738"
         ]
      ],
      "x" : 820,
      "z" : "8bb76918.ef6b48"
   },
   {
      "y" : 1720,
      "name" : "Turn on/off front porch light",
      "type" : "comment",
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "x" : 130,
      "info" : "",
      "id" : "eca6df8a.4bd31"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "3e22a6eb.eeddba",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1040,
      "service" : "turn_on",
      "data" : "{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}",
      "type" : "api-call-service",
      "y" : 1820,
      "name" : "Turn on porch light"
   },
   {
      "x" : 1040,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "data" : "{\"entity_id\":\"light.front_door_switch_level\"}",
      "service" : "turn_off",
      "service_domain" : "light",
      "id" : "9bcb1a66.32f5d8",
      "server" : "e2a02faf.48099",
      "y" : 1860,
      "name" : "Turn off porch light",
      "type" : "api-call-service"
   },
   {
      "sun" : true,
      "sep" : true,
      "x" : 70,
      "month3" : 0,
      "day4" : 0,
      "month5" : 0,
      "d1" : 0,
      "endoff" : "0",
      "may" : true,
      "day5" : 0,
      "outtext1" : "on",
      "z" : "8bb76918.ef6b48",
      "fri" : true,
      "w3" : 0,
      "thu" : true,
      "nov" : true,
      "w4" : 0,
      "startoff" : "-30",
      "tue" : true,
      "wed" : true,
      "id" : "555f3207.1765ac",
      "oct" : true,
      "atstart" : false,
      "outtopic" : "",
      "timeout" : 1440,
      "w1" : 0,
      "d2" : 0,
      "lon" : "-92.58988",
      "outtext2" : "off",
      "mar" : true,
      "sat" : true,
      "odd" : false,
      "dec" : true,
      "suspend" : false,
      "feb" : true,
      "day3" : 0,
      "d4" : 0,
      "name" : "Sunset",
      "month4" : 0,
      "w2" : 0,
      "day2" : 0,
      "outpayload2" : "",
      "d5" : 0,
      "random" : false,
      "even" : false,
      "day1" : 0,
      "offs" : 0,
      "month2" : 0,
      "aug" : true,
      "lat" : "40.173508",
      "repeat" : true,
      "y" : 1780,
      "endtime" : "1425",
      "month1" : 0,
      "starttime" : "5004",
      "apr" : true,
      "type" : "bigtimer",
      "jun" : true,
      "mon" : true,
      "jul" : true,
      "w5" : 0,
      "d3" : 0,
      "jan" : true,
      "outpayload1" : "",
      "wires" : [
         [],
         [],
         [
            "cfe9436a.47f67"
         ]
      ]
   },
   {
      "wires" : [
         [
            "ac300656.ca7d18"
         ],
         [
            "3b1c1ac5.6dcb36"
         ]
      ],
      "x" : 470,
      "z" : "8bb76918.ef6b48",
      "property" : "payload",
      "propertyType" : "msg",
      "id" : "cfe9436a.47f67",
      "y" : 1800,
      "checkall" : "true",
      "name" : "",
      "type" : "switch",
      "rules" : [
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "on"
         },
         {
            "v" : "off",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "outputs" : 2
   },
   {
      "id" : "e7ccb4e7.df42e8",
      "server" : "e2a02faf.48099",
      "x" : 90,
      "wires" : [
         [
            "fce48ab1.17bcc8"
         ]
      ],
      "entityidfiltertype" : "exact",
      "z" : "8bb76918.ef6b48",
      "type" : "server-state-changed",
      "haltifstate" : "off",
      "y" : 1840,
      "entityidfilter" : "binary_sensor.family_sleeping",
      "name" : "Family Asleep"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "c10b7c9a.67c6d",
      "wires" : [
         [
            "fce48ab1.17bcc8"
         ]
      ],
      "entityidfiltertype" : "exact",
      "x" : 90,
      "z" : "8bb76918.ef6b48",
      "type" : "server-state-changed",
      "name" : "Family in Bed",
      "haltifstate" : "off",
      "y" : 1900,
      "entityidfilter" : "binary_sensor.family_in_bed"
   },
   {
      "type" : "time-range-switch",
      "endOffset" : 0,
      "startOffset" : 0,
      "endTime" : "24:00",
      "lat" : "",
      "y" : 1860,
      "name" : "8PM to midnight",
      "lon" : "",
      "id" : "fce48ab1.17bcc8",
      "wires" : [
         [
            "ebacb496.1560f8"
         ],
         []
      ],
      "startTime" : "20:00",
      "x" : 260,
      "z" : "8bb76918.ef6b48"
   },
   {
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "name" : "",
      "y" : 1860,
      "id" : "ebacb496.1560f8",
      "timeout" : "5",
      "x" : 440,
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5",
      "timeoutUnits" : "seconds",
      "nbRateUnits" : "4",
      "drop" : true,
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "3b1c1ac5.6dcb36"
         ]
      ],
      "z" : "8bb76918.ef6b48"
   },
   {
      "type" : "api-call-service",
      "y" : 1780,
      "name" : "Logbook entry",
      "server" : "e2a02faf.48099",
      "service_domain" : "logbook",
      "id" : "a0557f25.0b5ea",
      "wires" : [
         []
      ],
      "x" : 1030,
      "z" : "8bb76918.ef6b48",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turning on front porch light\" }",
      "service" : "log"
   },
   {
      "y" : 1900,
      "name" : "Logbook entry",
      "type" : "api-call-service",
      "x" : 1030,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "log",
      "data" : "{ \"name\":\"Node-Red\",\"message\":\"Turning off front porch light\" }",
      "service_domain" : "logbook",
      "server" : "e2a02faf.48099",
      "id" : "bf6dda0.e78f028"
   },
   {
      "id" : "d130ced8.7fa58",
      "info" : "",
      "z" : "8bb76918.ef6b48",
      "wires" : [],
      "x" : 240,
      "type" : "comment",
      "name" : "Turn off Son2's Lamp and Upstairs Light after main level is off",
      "y" : 2060
   },
   {
      "type" : "server-state-changed",
      "name" : "Main level off",
      "haltifstate" : "on",
      "y" : 2100,
      "entityidfilter" : "group.main_level",
      "id" : "bc0c3815.889ae8",
      "server" : "e2a02faf.48099",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "b4f0dc6c.497df"
         ]
      ],
      "x" : 90,
      "entityidfiltertype" : "exact"
   },
   {
      "wires" : [
         [
            "81a37e37.ee915"
         ],
         []
      ],
      "x" : 270,
      "startTime" : "20:00",
      "z" : "8bb76918.ef6b48",
      "lon" : "-92.58249",
      "id" : "b4f0dc6c.497df",
      "y" : 2100,
      "name" : "8PM to 1AM",
      "endOffset" : 0,
      "type" : "time-range-switch",
      "endTime" : "1:00",
      "lat" : "40.18937",
      "startOffset" : 0
   },
   {
      "name" : "",
      "y" : 2100,
      "rateUnits" : "hour",
      "pauseType" : "rate",
      "timeout" : "5",
      "x" : 800,
      "id" : "859867d9.5d24c8",
      "nbRateUnits" : "5",
      "drop" : true,
      "timeoutUnits" : "seconds",
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "5ab9871.4200578"
         ]
      ],
      "rate" : "1"
   },
   {
      "name" : "",
      "y" : 2100,
      "rateUnits" : "second",
      "pauseType" : "delay",
      "timeout" : "10",
      "x" : 990,
      "id" : "5ab9871.4200578",
      "timeoutUnits" : "minutes",
      "nbRateUnits" : "1",
      "drop" : false,
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "randomFirst" : "1",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "378a4979.335416"
         ]
      ],
      "rate" : "1"
   },
   {
      "type" : "api-call-service",
      "y" : 2100,
      "mergecontext" : "",
      "name" : "Turn off Son2's Lamp and Upstairs",
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "378a4979.335416",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         []
      ],
      "x" : 1240,
      "data" : "{\"entity_id\":\"light.upstairs_hallway_and_colins_lamp\"}",
      "service" : "turn_off"
   },
   {
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 1040,
      "data" : "{ \"entity_id\":\"lock.front_door\" }",
      "service" : "lock",
      "service_domain" : "lock",
      "server" : "e2a02faf.48099",
      "id" : "3aaca6dc.eb0c6a",
      "y" : 1940,
      "name" : "Lock front door",
      "mergecontext" : "",
      "type" : "api-call-service"
   },
   {
      "y" : 1980,
      "name" : "Turn off porch light",
      "type" : "api-call-service",
      "x" : 1050,
      "wires" : [
         []
      ],
      "z" : "8bb76918.ef6b48",
      "service" : "turn_off",
      "data" : "{\"entity_id\":\"light.front_door_switch_level\"}",
      "service_domain" : "light",
      "id" : "b7c57570.887148",
      "server" : "e2a02faf.48099"
   },
   {
      "w3" : 0,
      "thu" : true,
      "nov" : true,
      "w4" : 0,
      "tue" : true,
      "startoff" : "0",
      "wed" : true,
      "id" : "767b61ef.7da0a",
      "atstart" : false,
      "oct" : true,
      "timeout" : 1440,
      "outtopic" : "",
      "w1" : 0,
      "d2" : 0,
      "lon" : "-92.58988",
      "outtext2" : "off",
      "mar" : true,
      "sun" : true,
      "sep" : true,
      "x" : 130,
      "month3" : 0,
      "day4" : 0,
      "month5" : 0,
      "d1" : 0,
      "endoff" : "90",
      "may" : true,
      "outtext1" : "on",
      "day5" : 0,
      "z" : "8bb76918.ef6b48",
      "fri" : true,
      "aug" : true,
      "lat" : "40.173508",
      "repeat" : true,
      "y" : 1960,
      "endtime" : "5003",
      "month1" : 0,
      "starttime" : "5000",
      "apr" : true,
      "type" : "bigtimer",
      "mon" : true,
      "jun" : true,
      "jul" : true,
      "w5" : 0,
      "d3" : 0,
      "jan" : true,
      "outpayload1" : "",
      "wires" : [
         [],
         [],
         [
            "95a3751.2f6c088"
         ]
      ],
      "sat" : true,
      "odd" : false,
      "dec" : true,
      "feb" : true,
      "day3" : 0,
      "suspend" : false,
      "d4" : 0,
      "name" : "90 minutes after sunrise",
      "month4" : 0,
      "w2" : 0,
      "day2" : 0,
      "d5" : 0,
      "outpayload2" : "",
      "random" : false,
      "even" : false,
      "day1" : 0,
      "offs" : 0,
      "month2" : 0
   },
   {
      "wires" : [
         [],
         [
            "b7c57570.887148"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "x" : 490,
      "property" : "payload",
      "propertyType" : "msg",
      "id" : "95a3751.2f6c088",
      "y" : 1960,
      "checkall" : "true",
      "name" : "",
      "type" : "switch",
      "rules" : [
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "on"
         },
         {
            "v" : "off",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "outputs" : 2
   },
   {
      "id" : "2d9a5f34.fff29",
      "x" : 110,
      "group" : "3edec13b.9cc3ee",
      "y" : 1560,
      "topic" : "",
      "icon" : "",
      "name" : "button heat",
      "bgcolor" : "",
      "width" : "2",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "85eef6c0.a4ca68"
         ]
      ],
      "payloadType" : "str",
      "label" : "heat",
      "type" : "ui_button",
      "passthru" : false,
      "color" : "",
      "payload" : "",
      "height" : "1",
      "order" : 2
   },
   {
      "x" : 110,
      "id" : "a73b7eb1.f8ec8",
      "name" : "button cool",
      "icon" : "",
      "topic" : "",
      "y" : 1600,
      "group" : "3edec13b.9cc3ee",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "d9a548f6.22e178"
         ]
      ],
      "payloadType" : "str",
      "width" : "2",
      "bgcolor" : "",
      "order" : 3,
      "payload" : "",
      "color" : "",
      "height" : "1",
      "passthru" : false,
      "label" : "cool",
      "type" : "ui_button"
   },
   {
      "width" : "2",
      "bgcolor" : "",
      "payloadType" : "str",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "1be1a551.1d5cab"
         ]
      ],
      "passthru" : false,
      "type" : "ui_button",
      "label" : "off",
      "order" : 4,
      "height" : "1",
      "payload" : "",
      "color" : "",
      "id" : "6cd3cd3.e3b8934",
      "x" : 100,
      "group" : "3edec13b.9cc3ee",
      "name" : "button off",
      "icon" : "",
      "y" : 1640,
      "topic" : ""
   },
   {
      "type" : "api-current-state",
      "entity_id" : "input_number.target_temp_cool",
      "name" : "target temp cool",
      "halt_if" : "",
      "y" : 1780,
      "id" : "28f20061.c25a2",
      "outputLabels" : [
         "data.attributes.temperature"
      ],
      "server" : "e2a02faf.48099",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "eff23817.c9c208"
         ]
      ],
      "x" : 620
   },
   {
      "name" : "set heat",
      "mergecontext" : "",
      "y" : 1560,
      "type" : "api-call-service",
      "service" : "set_operation_mode",
      "data" : "{   \"entity_id\": \"climate.hallway_nest\", \"operation_mode\": \"Heat\" }",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         []
      ],
      "x" : 260,
      "id" : "85eef6c0.a4ca68",
      "service_domain" : "climate",
      "server" : "e2a02faf.48099"
   },
   {
      "id" : "d9a548f6.22e178",
      "service_domain" : "climate",
      "server" : "e2a02faf.48099",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         []
      ],
      "x" : 260,
      "service" : "set_operation_mode",
      "data" : "{   \"entity_id\": \"climate.hallway_nest\", \"operation_mode\": \"Cool\" }",
      "type" : "api-call-service",
      "y" : 1600,
      "name" : "set cool",
      "mergecontext" : ""
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "climate",
      "id" : "1be1a551.1d5cab",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         []
      ],
      "x" : 250,
      "data" : "{   \"entity_id\": \"climate.hallway_nest\", \"operation_mode\": \"Off\" }",
      "service" : "set_operation_mode",
      "type" : "api-call-service",
      "y" : 1640,
      "mergecontext" : "",
      "name" : "set off"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "155d9069.ddbb7",
      "x" : 110,
      "wires" : [
         [
            "3788856b.1b691a"
         ]
      ],
      "entityidfiltertype" : "substring",
      "z" : "7d04740a.ad6adc",
      "type" : "server-state-changed",
      "name" : "mode",
      "y" : 1760,
      "haltifstate" : "",
      "entityidfilter" : "climate.hallway_nest"
   },
   {
      "onceDelay" : "1",
      "payloadType" : "date",
      "wires" : [
         [
            "3788856b.1b691a"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 110,
      "once" : true,
      "id" : "6a800ae4.239fa4",
      "name" : "init",
      "crontab" : "",
      "topic" : "",
      "y" : 1720,
      "payload" : "",
      "repeat" : "",
      "type" : "inject"
   },
   {
      "wires" : [],
      "x" : 450,
      "z" : "7d04740a.ad6adc",
      "format" : "{{msg.payload}}",
      "layout" : "col-center",
      "width" : "6",
      "id" : "123dfa6a.cb42e6",
      "y" : 1720,
      "height" : "2",
      "name" : "currentMode",
      "order" : 1,
      "type" : "ui_text",
      "label" : "current mode",
      "group" : "3edec13b.9cc3ee"
   },
   {
      "label" : "stairs",
      "type" : "ui_text",
      "group" : "3edec13b.9cc3ee",
      "height" : "1",
      "y" : 2040,
      "order" : 11,
      "name" : "",
      "layout" : "col-center",
      "id" : "e8d1847b.0e6808",
      "width" : "3",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "x" : 390,
      "format" : "{{msg.payload}}"
   },
   {
      "repeat" : "",
      "type" : "inject",
      "name" : "init",
      "crontab" : "",
      "payload" : "",
      "y" : 2020,
      "topic" : "",
      "id" : "63ce3aa7.5f7654",
      "once" : true,
      "onceDelay" : "0.5",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "8d2239e7.b23e88"
         ]
      ],
      "x" : 110,
      "payloadType" : "date"
   },
   {
      "wires" : [
         [
            "8d2239e7.b23e88"
         ]
      ],
      "x" : 110,
      "entityidfiltertype" : "exact",
      "z" : "7d04740a.ad6adc",
      "server" : "e2a02faf.48099",
      "id" : "f7b388f1.1262e8",
      "name" : "state",
      "y" : 2060,
      "haltifstate" : "",
      "entityidfilter" : "sensor.garage_stairs_motion_sensor_temperature",
      "type" : "server-state-changed"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "8d2239e7.b23e88",
      "wires" : [
         [
            "e8d1847b.0e6808"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 250,
      "type" : "api-current-state",
      "entity_id" : "sensor.garage_stairs_motion_sensor_temperature",
      "halt_if" : "",
      "name" : "temp",
      "y" : 2040
   },
   {
      "type" : "ui_text",
      "label" : "garage",
      "group" : "3edec13b.9cc3ee",
      "y" : 2140,
      "height" : "1",
      "name" : "",
      "order" : 10,
      "layout" : "col-center",
      "id" : "b853af4a.a2d55",
      "width" : "3",
      "wires" : [],
      "x" : 390,
      "z" : "7d04740a.ad6adc",
      "format" : "{{msg.payload}}"
   },
   {
      "type" : "inject",
      "repeat" : "",
      "payload" : "",
      "topic" : "",
      "y" : 2120,
      "name" : "init",
      "crontab" : "",
      "id" : "a2935016.885ea",
      "once" : true,
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "c10abb25.1c9468"
         ]
      ],
      "x" : 110,
      "payloadType" : "date",
      "onceDelay" : "0.5"
   },
   {
      "name" : "state",
      "y" : 2160,
      "haltifstate" : "",
      "entityidfilter" : "sensor.garage_motion_sensor_temperature",
      "type" : "server-state-changed",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "c10abb25.1c9468"
         ]
      ],
      "x" : 110,
      "entityidfiltertype" : "exact",
      "id" : "16c92f29.863061",
      "server" : "e2a02faf.48099"
   },
   {
      "name" : "temp",
      "halt_if" : "",
      "y" : 2140,
      "entity_id" : "sensor.garage_motion_sensor_temperature",
      "type" : "api-current-state",
      "wires" : [
         [
            "b853af4a.a2d55"
         ]
      ],
      "x" : 250,
      "z" : "7d04740a.ad6adc",
      "id" : "c10abb25.1c9468",
      "server" : "e2a02faf.48099"
   },
   {
      "type" : "ui_text",
      "label" : "thermostat",
      "group" : "3edec13b.9cc3ee",
      "y" : 2240,
      "height" : "1",
      "name" : "",
      "order" : 12,
      "layout" : "col-center",
      "width" : "3",
      "id" : "79d6c175.eb1ff",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "x" : 410,
      "format" : "{{msg.payload}}"
   },
   {
      "once" : true,
      "id" : "66f4f0d3.4dfde",
      "wires" : [
         [
            "575b5380.e26f1c"
         ]
      ],
      "x" : 110,
      "z" : "7d04740a.ad6adc",
      "payloadType" : "date",
      "onceDelay" : "0.5",
      "type" : "inject",
      "repeat" : "",
      "payload" : "",
      "y" : 2220,
      "topic" : "",
      "name" : "init",
      "crontab" : ""
   },
   {
      "id" : "6b954d07.1fe994",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "575b5380.e26f1c"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 110,
      "entityidfiltertype" : "exact",
      "type" : "server-state-changed",
      "y" : 2260,
      "entityidfilter" : "climate.hallway_nest",
      "haltifstate" : "",
      "name" : "state"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "climate.hallway_nest",
      "y" : 1740,
      "halt_if" : "",
      "name" : "thermostatMode",
      "server" : "e2a02faf.48099",
      "id" : "3788856b.1b691a",
      "wires" : [
         [
            "ff4b44ad.978548",
            "123dfa6a.cb42e6"
         ]
      ],
      "x" : 260,
      "z" : "7d04740a.ad6adc"
   },
   {
      "outputs" : 3,
      "rules" : [
         {
            "v" : "heat",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "t" : "eq",
            "vt" : "str",
            "v" : "cool"
         },
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "off"
         }
      ],
      "type" : "switch",
      "repair" : false,
      "checkall" : "true",
      "name" : "",
      "y" : 1760,
      "id" : "ff4b44ad.978548",
      "propertyType" : "msg",
      "property" : "payload",
      "x" : 430,
      "wires" : [
         [
            "83e52493.8ef0c8"
         ],
         [
            "28f20061.c25a2"
         ],
         [
            "6b170727.3ef518"
         ]
      ],
      "z" : "7d04740a.ad6adc"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "input_number.target_temp_heat",
      "y" : 1740,
      "name" : "target temp heat",
      "halt_if" : "",
      "server" : "e2a02faf.48099",
      "outputLabels" : [
         "data.attributes.temperature"
      ],
      "id" : "83e52493.8ef0c8",
      "wires" : [
         [
            "eff23817.c9c208"
         ]
      ],
      "x" : 620,
      "z" : "7d04740a.ad6adc"
   },
   {
      "label" : "raise",
      "type" : "ui_button",
      "passthru" : false,
      "payload" : "",
      "color" : "",
      "height" : "1",
      "order" : 6,
      "bgcolor" : "",
      "width" : "2",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "c6d4930e.c3d64"
         ]
      ],
      "payloadType" : "str",
      "group" : "3edec13b.9cc3ee",
      "y" : 1560,
      "topic" : "",
      "name" : "raise temp",
      "icon" : "",
      "id" : "aa8839a7.43f648",
      "x" : 450
   },
   {
      "payload" : "",
      "color" : "",
      "height" : "1",
      "order" : 7,
      "label" : "lower",
      "type" : "ui_button",
      "passthru" : false,
      "wires" : [
         [
            "1b86d0c2.79cbbf"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "payloadType" : "date",
      "bgcolor" : "",
      "width" : "2",
      "topic" : "",
      "y" : 1640,
      "icon" : "",
      "name" : "lower temp",
      "group" : "3edec13b.9cc3ee",
      "x" : 450,
      "id" : "9fc0e76e.c6b568"
   },
   {
      "format" : "{{msg.payload}}",
      "x" : 870,
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "id" : "eff23817.c9c208",
      "width" : "4",
      "layout" : "col-center",
      "order" : 5,
      "name" : "targetTempLabel",
      "y" : 1740,
      "height" : "2",
      "group" : "3edec13b.9cc3ee",
      "label" : "",
      "type" : "ui_text"
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "input_number",
      "id" : "24adcfd2.c8f1d",
      "wires" : [
         []
      ],
      "x" : 1000,
      "z" : "7d04740a.ad6adc",
      "data" : "{\"entity_id\":\"input_number.target_temp_cool\"}",
      "service" : "increment",
      "type" : "api-call-service",
      "y" : 1580,
      "name" : "coolRaiseTemp",
      "mergecontext" : ""
   },
   {
      "x" : 620,
      "wires" : [
         [
            "eff23817.c9c208",
            "9ccb298e.8aa1c8"
         ]
      ],
      "entityidfiltertype" : "substring",
      "z" : "7d04740a.ad6adc",
      "server" : "e2a02faf.48099",
      "id" : "91edfcc5.39489",
      "haltifstate" : "",
      "y" : 1900,
      "entityidfilter" : "input_number.target_temp_cool",
      "name" : "coolTargetTemp",
      "type" : "server-state-changed"
   },
   {
      "type" : "server-state-changed",
      "name" : "heatTargetTemp",
      "y" : 1860,
      "haltifstate" : "",
      "entityidfilter" : "input_number.target_temp_heat",
      "id" : "d4640a9d.6f6a98",
      "server" : "e2a02faf.48099",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         [
            "eff23817.c9c208",
            "1eac6ab3.527395"
         ]
      ],
      "x" : 620,
      "entityidfiltertype" : "substring"
   },
   {
      "y" : 1540,
      "mergecontext" : "",
      "name" : "heatRaiseTemp",
      "type" : "api-call-service",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         []
      ],
      "x" : 1000,
      "service" : "increment",
      "data" : "{\"entity_id\":\"input_number.target_temp_heat\"}",
      "server" : "e2a02faf.48099",
      "service_domain" : "input_number",
      "id" : "3922abf2.020394"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "climate.hallway_nest",
      "halt_if" : "",
      "name" : "thermostatModeHeat",
      "y" : 1560,
      "id" : "c6d4930e.c3d64",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "94428a12.f5a778",
            "beb03055.7a2a1"
         ]
      ],
      "x" : 640,
      "z" : "7d04740a.ad6adc"
   },
   {
      "wires" : [
         [
            "3922abf2.020394",
            "e2f2a236.a8d9a"
         ],
         [
            "24adcfd2.c8f1d"
         ],
         []
      ],
      "x" : 810,
      "z" : "7d04740a.ad6adc",
      "property" : "payload",
      "propertyType" : "msg",
      "id" : "94428a12.f5a778",
      "y" : 1560,
      "name" : "",
      "checkall" : "true",
      "repair" : false,
      "type" : "switch",
      "rules" : [
         {
            "v" : "heat",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "v" : "cool",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "v" : "off",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "outputs" : 3
   },
   {
      "server" : "e2a02faf.48099",
      "service_domain" : "input_number",
      "id" : "289835aa.d33b3a",
      "x" : 1000,
      "wires" : [
         []
      ],
      "z" : "7d04740a.ad6adc",
      "service" : "decrement",
      "data" : "{\"entity_id\":\"input_number.target_temp_cool\"}",
      "type" : "api-call-service",
      "y" : 1660,
      "mergecontext" : "",
      "name" : "coolLowerTemp"
   },
   {
      "z" : "7d04740a.ad6adc",
      "wires" : [
         []
      ],
      "x" : 1000,
      "data" : "{\"entity_id\":\"input_number.target_temp_heat\"}",
      "service" : "decrement",
      "service_domain" : "input_number",
      "id" : "bbd0f943.1ce758",
      "server" : "e2a02faf.48099",
      "y" : 1620,
      "name" : "heatLowerTemp",
      "mergecontext" : "",
      "type" : "api-call-service"
   },
   {
      "y" : 1640,
      "halt_if" : "",
      "name" : "thermostatModeHeat",
      "type" : "api-current-state",
      "entity_id" : "climate.hallway_nest",
      "x" : 640,
      "wires" : [
         [
            "1844676c.30b4f9"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "server" : "e2a02faf.48099",
      "id" : "1b86d0c2.79cbbf"
   },
   {
      "propertyType" : "msg",
      "id" : "1844676c.30b4f9",
      "wires" : [
         [
            "bbd0f943.1ce758"
         ],
         [
            "289835aa.d33b3a"
         ],
         []
      ],
      "z" : "7d04740a.ad6adc",
      "x" : 810,
      "property" : "payload",
      "repair" : false,
      "type" : "switch",
      "outputs" : 3,
      "rules" : [
         {
            "v" : "Heat",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "v" : "Cool",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "v" : "Off",
            "vt" : "str",
            "t" : "eq"
         }
      ],
      "y" : 1640,
      "checkall" : "true",
      "name" : ""
   },
   {
      "property" : "",
      "action" : "",
      "to" : "",
      "wires" : [
         [
            "eff23817.c9c208"
         ]
      ],
      "x" : 620,
      "z" : "7d04740a.ad6adc",
      "id" : "6b170727.3ef518",
      "from" : "",
      "name" : "",
      "reg" : false,
      "y" : 1820,
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "pt" : "msg",
            "to" : "Off",
            "p" : "payload"
         }
      ],
      "type" : "change"
   },
   {
      "service_domain" : "climate",
      "id" : "63867425.19f90c",
      "server" : "e2a02faf.48099",
      "data" : "{ }",
      "service" : "set_temperature",
      "z" : "7d04740a.ad6adc",
      "wires" : [
         []
      ],
      "x" : 990,
      "type" : "api-call-service",
      "name" : "coolSetThermostat",
      "mergecontext" : "",
      "y" : 1900
   },
   {
      "func" : "msg.payload = { data: { 'entity_id': 'climate.hallway_nest','temperature':msg.payload}};\n\nreturn msg;",
      "x" : 830,
      "wires" : [
         [
            "63867425.19f90c"
         ]
      ],
      "z" : "7d04740a.ad6adc",
      "noerr" : 0,
      "id" : "9ccb298e.8aa1c8",
      "name" : "Fn",
      "y" : 1900,
      "outputs" : 1,
      "type" : "function"
   },
   {
      "x" : 830,
      "wires" : [
         [
            "35a7b715.bc32d8"
         ]
      ],
      "noerr" : 0,
      "z" : "7d04740a.ad6adc",
      "func" : "msg.payload = { data: { 'entity_id': 'climate.hallway_nest','temperature':msg.payload}};\n\nreturn msg;",
      "id" : "1eac6ab3.527395",
      "y" : 1860,
      "name" : "Fn",
      "type" : "function",
      "outputs" : 1
   },
   {
      "mergecontext" : "",
      "name" : "heatSetThermostat",
      "y" : 1860,
      "type" : "api-call-service",
      "data" : "{ }",
      "service" : "set_temperature",
      "wires" : [
         []
      ],
      "x" : 990,
      "z" : "7d04740a.ad6adc",
      "service_domain" : "climate",
      "id" : "35a7b715.bc32d8",
      "server" : "e2a02faf.48099"
   },
   {
      "name" : "temp",
      "template" : "{{ states.climate.hallway_nest.attributes.current_temperature }}",
      "y" : 2240,
      "type" : "api-render-template",
      "wires" : [
         [
            "79d6c175.eb1ff",
            "c2449ebe.ffdea"
         ]
      ],
      "x" : 250,
      "z" : "7d04740a.ad6adc",
      "id" : "575b5380.e26f1c",
      "server" : "e2a02faf.48099"
   },
   {
      "width" : 0,
      "format" : "{{value}}",
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "type" : "ui_gauge",
      "label" : "",
      "title" : "temperature",
      "order" : 8,
      "height" : 0,
      "colors" : [
         "#0096ff",
         "#7af970",
         "#ca3838"
      ],
      "id" : "c2449ebe.ffdea",
      "x" : 430,
      "group" : "3edec13b.9cc3ee",
      "max" : "84",
      "gtype" : "gage",
      "seg1" : "69",
      "name" : "tempGauge",
      "seg2" : "75",
      "y" : 2200,
      "min" : "65"
   },
   {
      "name" : "",
      "complete" : "true",
      "tostatus" : false,
      "y" : 1760,
      "console" : false,
      "type" : "debug",
      "tosidebar" : true,
      "x" : 1150,
      "wires" : [],
      "z" : "7d04740a.ad6adc",
      "id" : "beb03055.7a2a1",
      "active" : true
   },
   {
      "name" : "raise heat",
      "complete" : "true",
      "tostatus" : false,
      "y" : 1652,
      "console" : false,
      "type" : "debug",
      "tosidebar" : true,
      "z" : "7d04740a.ad6adc",
      "wires" : [],
      "x" : 1198,
      "id" : "e2f2a236.a8d9a",
      "active" : true
   },
   {
      "id" : "bbcfaea0.9089e",
      "info" : "",
      "wires" : [],
      "x" : 110,
      "z" : "7d04740a.ad6adc",
      "type" : "comment",
      "name" : "Thermostat UI",
      "y" : 1500
   },
   {
      "wires" : [],
      "z" : "af1cc9bd.91cc08",
      "x" : 170,
      "id" : "608b0aa9.62bc44",
      "info" : "",
      "name" : "Vacation Mode - Geofence debugging",
      "y" : 920,
      "type" : "comment"
   },
   {
      "outputLabels" : [
         "abort",
         "continue"
      ],
      "id" : "91b3d307.2c4ad",
      "wires" : [
         [],
         []
      ],
      "x" : 670,
      "noerr" : 0,
      "z" : "be9b5775.eaa798",
      "func" : "vacation_mode         = global.get('vacation_mode')||null;\nguest_mode          = global.get('guest_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.vacation_mode   = vacation_mode;\nmsg.guest_mode      = guest_mode;\n\nif( vacation_mode == 'on' || guest_mode == 'on' || ha_uptime_sec < 600) {\n    msg.abort_alert = 1;\n    return [ msg, null ];\n} else {\n     msg.abort_alert = 0;\n    return [ null, msg ];   \n}",
      "type" : "function",
      "outputs" : 2,
      "y" : 260,
      "name" : "Is vacation mode or guest mode on?"
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "3a82d60b.0cad2a",
      "x" : 620,
      "wires" : [
         [
            "6b50dd9d.49fe64"
         ]
      ],
      "z" : "be9b5775.eaa798",
      "type" : "api-current-state",
      "entity_id" : "input_boolean.vacation_mode",
      "y" : 140,
      "halt_if" : "",
      "name" : "Vacation Mode"
   },
   {
      "entity_id" : "input_boolean.guest_mode",
      "type" : "api-current-state",
      "name" : "Guest mode",
      "halt_if" : "",
      "y" : 100,
      "server" : "e2a02faf.48099",
      "id" : "11f07d26.3081e3",
      "z" : "be9b5775.eaa798",
      "wires" : [
         [
            "534e3700.c56de8"
         ]
      ],
      "x" : 610
   },
   {
      "id" : "534e3700.c56de8",
      "func" : "global.set('guest_mode',msg.payload);\nreturn msg;",
      "x" : 810,
      "wires" : [
         []
      ],
      "noerr" : 0,
      "z" : "be9b5775.eaa798",
      "outputs" : 1,
      "type" : "function",
      "name" : "Set global variables",
      "y" : 100
   },
   {
      "wires" : [
         []
      ],
      "noerr" : 0,
      "x" : 810,
      "z" : "be9b5775.eaa798",
      "func" : "global.set('vacation_mode',msg.payload);\nreturn msg;",
      "id" : "6b50dd9d.49fe64",
      "y" : 140,
      "name" : "Set global variables",
      "type" : "function",
      "outputs" : 1
   },
   {
      "randomUnits" : "seconds",
      "type" : "delay",
      "randomLast" : "5",
      "timeoutUnits" : "milliseconds",
      "drop" : false,
      "nbRateUnits" : "1",
      "rate" : "1",
      "randomFirst" : "1",
      "wires" : [
         [
            "91b3d307.2c4ad"
         ]
      ],
      "z" : "be9b5775.eaa798",
      "rateUnits" : "second",
      "pauseType" : "delay",
      "name" : "",
      "y" : 260,
      "id" : "79580566.c1583c",
      "timeout" : "250",
      "x" : 430
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "fc107c1a.0367d",
      "wires" : [
         [
            "f9def910.155178"
         ]
      ],
      "z" : "be9b5775.eaa798",
      "x" : 610,
      "entity_id" : "sensor.ha_uptime_sec",
      "type" : "api-current-state",
      "y" : 60,
      "halt_if" : "",
      "name" : "HA Uptime"
   },
   {
      "x" : 810,
      "wires" : [
         []
      ],
      "z" : "be9b5775.eaa798",
      "noerr" : 0,
      "func" : "global.set('ha_uptime_sec',msg.payload);\nreturn msg;",
      "id" : "f9def910.155178",
      "y" : 60,
      "name" : "Set global variables",
      "type" : "function",
      "outputs" : 1
   },
   {
      "z" : "be9b5775.eaa798",
      "wires" : [],
      "x" : 830,
      "info" : "",
      "id" : "964b16bb.52b058",
      "y" : 220,
      "name" : "Checks if vacation mode or guest mode is on, and that HA has not restarted in last ten min",
      "type" : "comment"
   },
   {
      "x" : 290,
      "timeout" : "250",
      "id" : "38f48943.994b56",
      "y" : 220,
      "name" : "",
      "pauseType" : "delay",
      "rateUnits" : "second",
      "randomFirst" : "1",
      "z" : "be9b5775.eaa798",
      "wires" : [
         [
            "11f07d26.3081e3",
            "3a82d60b.0cad2a",
            "fc107c1a.0367d",
            "79580566.c1583c"
         ]
      ],
      "rate" : "1",
      "drop" : false,
      "timeoutUnits" : "milliseconds",
      "nbRateUnits" : "1",
      "type" : "delay",
      "randomUnits" : "seconds",
      "randomLast" : "5"
   },
   {
      "wires" : [
         [
            "26fd3a1f.f752f6"
         ]
      ],
      "z" : "20661f8a.532c4",
      "x" : 500,
      "id" : "168f8d.7a22d074",
      "server" : "e2a02faf.48099",
      "name" : "Vacation mode",
      "halt_if" : "",
      "y" : 1060,
      "type" : "api-current-state",
      "entity_id" : "input_boolean.vacation_mode"
   },
   {
      "id" : "26fd3a1f.f752f6",
      "x" : 690,
      "wires" : [
         []
      ],
      "noerr" : 0,
      "z" : "20661f8a.532c4",
      "func" : "global.set('vacation_mode',msg.payload);\nreturn msg;",
      "type" : "function",
      "outputs" : 1,
      "y" : 1060,
      "name" : "Set global variables"
   },
   {
      "id" : "7c8a5c3d.31e5d4",
      "type" : "subflow:be9b5775.eaa798",
      "name" : "",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "2b9c3b21.c9bee4"
         ]
      ],
      "x" : 660,
      "y" : 180
   },
   {
      "y" : 1040,
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "x" : 580,
      "id" : "97609ed6.ee83",
      "type" : "subflow:be9b5775.eaa798"
   },
   {
      "name" : "",
      "crontab" : "",
      "payload" : "",
      "y" : 1040,
      "topic" : "",
      "repeat" : "",
      "type" : "inject",
      "onceDelay" : 0.1,
      "x" : 300,
      "wires" : [
         [
            "283182b4.4ee36e"
         ]
      ],
      "z" : "e0703c90.1a341",
      "payloadType" : "date",
      "id" : "48a56a11.a9fca4",
      "once" : false
   },
   {
      "id" : "68eb7376.ee358c",
      "active" : true,
      "tosidebar" : true,
      "z" : "e0703c90.1a341",
      "wires" : [],
      "x" : 830,
      "console" : false,
      "type" : "debug",
      "complete" : "true",
      "tostatus" : false,
      "name" : "",
      "y" : 1040
   },
   {
      "id" : "61508967.a44508",
      "type" : "subflow:be9b5775.eaa798",
      "name" : "",
      "wires" : [
         [
            "b621c0a7.2c659",
            "99edfdc7.a8032"
         ]
      ],
      "x" : 740,
      "z" : "8bb76918.ef6b48",
      "y" : 360
   },
   {
      "y" : 780,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "76acb4c6.9160dc"
         ]
      ],
      "x" : 680,
      "type" : "subflow:be9b5775.eaa798",
      "id" : "a93cf8a2.ddae58"
   },
   {
      "id" : "67dc5799.2aa338",
      "type" : "subflow:be9b5775.eaa798",
      "y" : 900,
      "wires" : [
         [
            "1bb8b0a0.e9c35f"
         ]
      ],
      "x" : 680,
      "z" : "8bb76918.ef6b48"
   },
   {
      "type" : "subflow:be9b5775.eaa798",
      "id" : "293da600.9a431a",
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "ce8445.e7feabb8",
            "35f94b13.cba8a4",
            "6bf1b288.344ccc",
            "bc127838.e440f8",
            "47c3d025.fe7ac"
         ]
      ],
      "x" : 1280,
      "y" : 1020
   },
   {
      "y" : 1100,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "bead0d7e.cf404",
            "f0c63942.6650c8"
         ]
      ],
      "x" : 460,
      "type" : "subflow:be9b5775.eaa798",
      "id" : "ad516266.0ddec"
   },
   {
      "id" : "7638c76a.be3b08",
      "type" : "subflow:be9b5775.eaa798",
      "y" : 1280,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "b966d79e.a1f698"
         ]
      ],
      "x" : 400
   },
   {
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "3e22a6eb.eeddba",
            "a0557f25.0b5ea"
         ]
      ],
      "x" : 760,
      "y" : 1800,
      "id" : "ac300656.ca7d18",
      "type" : "subflow:be9b5775.eaa798"
   },
   {
      "wires" : [
         [
            "9bcb1a66.32f5d8",
            "bf6dda0.e78f028",
            "3aaca6dc.eb0c6a"
         ]
      ],
      "x" : 740,
      "z" : "8bb76918.ef6b48",
      "y" : 1900,
      "type" : "subflow:be9b5775.eaa798",
      "id" : "3b1c1ac5.6dcb36"
   },
   {
      "id" : "81a37e37.ee915",
      "type" : "subflow:be9b5775.eaa798",
      "y" : 2100,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "859867d9.5d24c8"
         ]
      ],
      "x" : 540
   },
   {
      "y" : 2420,
      "z" : "8bb76918.ef6b48",
      "wires" : [
         [
            "5f38355c.d1e38c"
         ]
      ],
      "x" : 360,
      "type" : "subflow:be9b5775.eaa798",
      "id" : "4873ca94.1b2854"
   },
   {
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "763a9ad3.14a7e4"
         ]
      ],
      "x" : 740,
      "y" : 700,
      "type" : "subflow:c663f7df.ca58b8",
      "id" : "7c9a4d6b.764174"
   },
   {
      "id" : "283182b4.4ee36e",
      "type" : "subflow:c663f7df.ca58b8",
      "name" : "",
      "wires" : [
         [
            "68eb7376.ee358c"
         ]
      ],
      "z" : "e0703c90.1a341",
      "x" : 600,
      "y" : 1140
   },
   {
      "id" : "babfd95f.14af18",
      "type" : "subflow:451ca7d8.fa5568",
      "name" : "",
      "wires" : [
         []
      ],
      "z" : "e0703c90.1a341",
      "x" : 560,
      "y" : 1200
   },
   {
      "type" : "subflow:451ca7d8.fa5568",
      "id" : "5f38355c.d1e38c",
      "x" : 420,
      "wires" : [
         [
            "264e27e2.d38b58"
         ]
      ],
      "z" : "8bb76918.ef6b48",
      "y" : 2460
   },
   {
      "y" : 960,
      "haltifstate" : "",
      "entityidfilter" : "device_tracker.wifes_iphone",
      "name" : "Wifes Location Changed",
      "type" : "server-state-changed",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ebdc8ed4.c72b9"
         ]
      ],
      "x" : 130,
      "entityidfiltertype" : "exact",
      "server" : "e2a02faf.48099",
      "id" : "d10a384f.7dac28"
   },
   {
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ebdc8ed4.c72b9"
         ]
      ],
      "x" : 130,
      "entityidfiltertype" : "exact",
      "server" : "e2a02faf.48099",
      "id" : "b6a3ab81.1e91b8",
      "haltifstate" : "",
      "y" : 1000,
      "entityidfilter" : "device_tracker.walts_iphone",
      "name" : "Walts Location Changed",
      "type" : "server-state-changed"
   },
   {
      "type" : "geofence",
      "name" : "Away",
      "points" : [],
      "mode" : "circle",
      "y" : 960,
      "id" : "702c42e9.982d2c",
      "centre" : {
         "longitude" : -92.5927734375,
         "latitude" : 40.1956590933647
      },
      "rad" : 97521.8720487219,
      "inside" : "false",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "670ff504.c6d99c"
         ]
      ],
      "x" : 650
   },
   {
      "type" : "function",
      "outputs" : 1,
      "y" : 980,
      "name" : "Format device_tracker data",
      "id" : "ebdc8ed4.c72b9",
      "wires" : [
         [
            "702c42e9.982d2c",
            "8b088f0a.f639c",
            "d89eaa53.ce2688"
         ]
      ],
      "noerr" : 0,
      "x" : 420,
      "z" : "af1cc9bd.91cc08",
      "func" : "newmsg = {};\n\n// Get the person we for this event\n// and their previous location\nperson          = msg.data.old_state.attributes.friendly_name.toLowerCase();\nprevious_loc    = global.get(person + '_previous_loc')||null;\n\n\n// Get the last GPS coordinates for both of us. These get set in a \n// loop in the Utilities tab.\nwalt_lat        = parseFloat(global.get('walt_latitude'))||null;\nwalt_lon        = parseFloat(global.get('walt_longitude'))||null;\nwife_lat        = parseFloat(global.get('wife_latitude'))||null;\nwife_lon        = parseFloat(global.get('wife_longitude'))||null;\n\n// What direction are we headed?\n//\n// Still in the same zone as before\nif (msg.data.new_state.state == msg.data.old_state.state) {\n    verb        = 'unknown';\n    location    = msg.data.new_state.state;\n// Leaving a zone\n} else if (msg.data.new_state.state == 'not_home') {\n    verb        = 'left';\n    location    = msg.data.old_state.state;\n// Entering a new zone\n} else {    \n    verb        = 'is at';\n    location    = msg.data.new_state.state;\n}\n\n// Do the math to see how far apart we are\nlat_diff        = Math.abs(walt_lat - wife_lat);\nlon_diff        = Math.abs(walt_lon - wife_lon);\n\nif ( lat_diff > 0.003 || lon_diff > 0.003 ) {\n    newmsg.apart   = 1;\n} else {\n    newmsg.apart   = 0;\n}\n\n// Does this event have us\n// in the same zone as we were last?\nif (location == previous_loc) {\n    newmsg.samezone = 1;\n    newmsg.previous_loc = previous_loc;\n// If not, update our global variables\n} else {\n    newmsg.samezone = 0;\n    newmsg.previous_loc = previous_loc;\n    global.set(person + '_previous_loc', location);\n}\n\n// Build our message object\nnewmsg.walt_lat = walt_lat;\nnewmsg.walt_lon = walt_lon;\nnewmsg.wife_lat = wife_lat;\nnewmsg.wife_lon = wife_lon;\nnewmsg.lat_diff = lat_diff;\nnewmsg.lon_diff = lon_diff;\nnewmsg.person   = person;\nnewmsg.loc      = location;\nnewmsg.verb     = verb;\nnewmsg.lat      = msg.data.new_state.attributes.latitude;\nnewmsg.lon      = msg.data.new_state.attributes.longitude;\nnewmsg.payload  = { data: {'message': capitalizeFirstLetter(person) + ' ' + verb + ' ' + location } };\n\nreturn newmsg;\n\n\nfunction capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}"
   },
   {
      "console" : false,
      "type" : "debug",
      "tostatus" : false,
      "complete" : "true",
      "name" : "Away",
      "y" : 960,
      "id" : "670ff504.c6d99c",
      "active" : true,
      "tosidebar" : true,
      "z" : "af1cc9bd.91cc08",
      "wires" : [],
      "x" : 850
   },
   {
      "type" : "geofence",
      "y" : 1000,
      "mode" : "circle",
      "points" : [],
      "name" : "Back",
      "centre" : {
         "longitude" : -92.5927734375,
         "latitude" : 40.1956590933647
      },
      "id" : "8b088f0a.f639c",
      "inside" : "true",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "ca7e088a.be9cd8"
         ]
      ],
      "x" : 650,
      "rad" : 97521.8720487219
   },
   {
      "y" : 1000,
      "tostatus" : false,
      "complete" : "true",
      "name" : "Back",
      "type" : "debug",
      "console" : false,
      "wires" : [],
      "x" : 850,
      "z" : "af1cc9bd.91cc08",
      "tosidebar" : true,
      "active" : true,
      "id" : "ca7e088a.be9cd8"
   },
   {
      "console" : false,
      "type" : "debug",
      "complete" : "true",
      "name" : "After format",
      "tostatus" : false,
      "y" : 1040,
      "id" : "d89eaa53.ce2688",
      "active" : true,
      "tosidebar" : true,
      "wires" : [],
      "z" : "af1cc9bd.91cc08",
      "x" : 650
   },
   {
      "id" : "c5d67d9b.f020d",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "c1c06a56.3b8038"
         ]
      ],
      "x" : 130,
      "entityidfiltertype" : "exact",
      "z" : "af1cc9bd.91cc08",
      "type" : "server-state-changed",
      "haltifstate" : "",
      "y" : 1160,
      "entityidfilter" : "device_tracker.wifes_iphone",
      "name" : "Wifes Location Changed"
   },
   {
      "type" : "server-state-changed",
      "name" : "Walts Location Changed",
      "entityidfilter" : "device_tracker.walts_iphone",
      "y" : 1200,
      "haltifstate" : "",
      "server" : "e2a02faf.48099",
      "id" : "6e80de9d.e0115",
      "x" : 130,
      "wires" : [
         [
            "c1c06a56.3b8038"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "entityidfiltertype" : "exact"
   },
   {
      "id" : "c1c06a56.3b8038",
      "func" : "newmsg = {};\n\n// Get the person we for this event\n// and their previous location\nperson          = msg.data.old_state.attributes.friendly_name.toLowerCase();\nprevious_loc    = global.get(person + '_previous_loc')||null;\n\n\n// Get the last GPS coordinates for both of us. These get set in a \n// loop in the Utilities tab.\nwalt_lat        = parseFloat(global.get('walt_latitude'))||null;\nwalt_lon        = parseFloat(global.get('walt_longitude'))||null;\nwife_lat        = parseFloat(global.get('wife_latitude'))||null;\nwife_lon        = parseFloat(global.get('wife_longitude'))||null;\n\n// What direction are we headed?\n//\n// Still in the same zone as before\nif (msg.data.new_state.state == msg.data.old_state.state) {\n    verb        = 'unknown';\n    location    = msg.data.new_state.state;\n// Leaving a zone\n} else if (msg.data.new_state.state == 'not_home') {\n    verb        = 'left';\n    location    = msg.data.old_state.state;\n// Entering a new zone\n} else {    \n    verb        = 'is at';\n    location    = msg.data.new_state.state;\n}\n\n// Do the math to see how far apart we are\nlat_diff        = Math.abs(walt_lat - wife_lat);\nlon_diff        = Math.abs(walt_lon - wife_lon);\n\nif ( lat_diff > 0.003 || lon_diff > 0.003 ) {\n    newmsg.apart   = 1;\n} else {\n    newmsg.apart   = 0;\n}\n\n// Does this event have us\n// in the same zone as we were last?\nif (location == previous_loc) {\n    newmsg.samezone = 1;\n    newmsg.previous_loc = previous_loc;\n// If not, update our global variables\n} else {\n    newmsg.samezone = 0;\n    newmsg.previous_loc = previous_loc;\n    global.set(person + '_previous_loc', location);\n}\n\n// Build our message object\nnewmsg.walt_lat = walt_lat;\nnewmsg.walt_lon = walt_lon;\nnewmsg.wife_lat = wife_lat;\nnewmsg.wife_lon = wife_lon;\nnewmsg.lat_diff = lat_diff;\nnewmsg.lon_diff = lon_diff;\nnewmsg.person   = person;\nnewmsg.loc      = location;\nnewmsg.verb     = verb;\nnewmsg.lat      = msg.data.new_state.attributes.latitude;\nnewmsg.lon      = msg.data.new_state.attributes.longitude;\nnewmsg.payload  = { data: {'message': capitalizeFirstLetter(person) + ' ' + verb + ' ' + location } };\n\nreturn newmsg;\n\n\nfunction capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}",
      "wires" : [
         [
            "99852643.a125b8",
            "192cffa2.f7cad",
            "7ee0869c.144b88"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 420,
      "noerr" : 0,
      "outputs" : 1,
      "type" : "function",
      "name" : "Format device_tracker data",
      "y" : 1180
   },
   {
      "points" : [],
      "name" : "Away",
      "y" : 1160,
      "mode" : "circle",
      "type" : "geofence",
      "rad" : 97521.8720487219,
      "wires" : [
         [
            "9e45a319.21f9a"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 790,
      "inside" : "false",
      "id" : "1729b577.138dbb",
      "centre" : {
         "latitude" : 40.1956590933647,
         "longitude" : -92.5927734375
      }
   },
   {
      "rad" : 97521.8720487219,
      "x" : 790,
      "wires" : [
         [
            "86f0c331.4a6f2"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "inside" : "true",
      "id" : "d04b8eb9.3a6e4",
      "centre" : {
         "latitude" : 40.1956590933647,
         "longitude" : -92.5927734375
      },
      "points" : [],
      "name" : "Back",
      "mode" : "circle",
      "y" : 1220,
      "type" : "geofence"
   },
   {
      "x" : 650,
      "wires" : [
         [
            "1729b577.138dbb"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "to" : "",
      "action" : "",
      "property" : "",
      "from" : "",
      "id" : "99852643.a125b8",
      "y" : 1160,
      "reg" : false,
      "name" : "Check Walt",
      "type" : "change",
      "rules" : [
         {
            "tot" : "msg",
            "t" : "set",
            "pt" : "msg",
            "to" : "lat",
            "p" : "walt_lat"
         },
         {
            "tot" : "msg",
            "t" : "set",
            "p" : "walt_lon",
            "pt" : "msg",
            "to" : "lon"
         }
      ]
   },
   {
      "from" : "",
      "id" : "9e45a319.21f9a",
      "wires" : [
         [
            "a0e74faf.c2bd7"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 930,
      "to" : "",
      "action" : "",
      "property" : "",
      "type" : "change",
      "rules" : [
         {
            "t" : "set",
            "tot" : "msg",
            "p" : "wife_lat",
            "pt" : "msg",
            "to" : "lat"
         },
         {
            "tot" : "msg",
            "t" : "set",
            "pt" : "msg",
            "to" : "lon",
            "p" : "wife_lon"
         }
      ],
      "y" : 1160,
      "name" : "Check Wife",
      "reg" : false
   },
   {
      "inside" : "false",
      "wires" : [
         [
            "d4016f0d.3aa84"
         ]
      ],
      "x" : 1070,
      "z" : "af1cc9bd.91cc08",
      "rad" : 97521.8720487219,
      "centre" : {
         "longitude" : -92.5927734375,
         "latitude" : 40.1956590933647
      },
      "id" : "a0e74faf.c2bd7",
      "y" : 1160,
      "mode" : "circle",
      "points" : [],
      "name" : "Away",
      "type" : "geofence"
   },
   {
      "id" : "192cffa2.f7cad",
      "from" : "",
      "property" : "",
      "action" : "",
      "to" : "",
      "x" : 650,
      "wires" : [
         [
            "d04b8eb9.3a6e4"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "rules" : [
         {
            "tot" : "msg",
            "t" : "set",
            "pt" : "msg",
            "to" : "lat",
            "p" : "walt_lat"
         },
         {
            "pt" : "msg",
            "to" : "lon",
            "p" : "walt_lon",
            "t" : "set",
            "tot" : "msg"
         }
      ],
      "type" : "change",
      "reg" : false,
      "name" : "Check Walt",
      "y" : 1200
   },
   {
      "id" : "7ee0869c.144b88",
      "from" : "",
      "action" : "",
      "property" : "",
      "x" : 650,
      "wires" : [
         [
            "d04b8eb9.3a6e4"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "to" : "",
      "rules" : [
         {
            "tot" : "msg",
            "t" : "set",
            "p" : "wife_lat",
            "pt" : "msg",
            "to" : "lat"
         },
         {
            "p" : "wife_lon",
            "pt" : "msg",
            "to" : "lon",
            "t" : "set",
            "tot" : "msg"
         }
      ],
      "type" : "change",
      "name" : "Check Wife",
      "reg" : false,
      "y" : 1240
   },
   {
      "id" : "4a2b5571.fe1bdc",
      "service_domain" : "input_boolean",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\":\"input_boolean.vacation_mode\" }",
      "service" : "turn_off",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         []
      ],
      "x" : 1420,
      "type" : "api-call-service",
      "name" : "Turn off vacation mode",
      "mergecontext" : "",
      "y" : 1220
   },
   {
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 1660,
      "data" : "{ \"entity_id\":\"input_boolean.vacation_mode\" }",
      "service" : "turn_on",
      "id" : "70241a92.423bd4",
      "service_domain" : "input_boolean",
      "server" : "e2a02faf.48099",
      "y" : 1160,
      "mergecontext" : "",
      "name" : "Turn on vacation mode",
      "type" : "api-call-service"
   },
   {
      "type" : "comment",
      "y" : 1120,
      "name" : "Automatically turn on Vacation Mode",
      "info" : "",
      "id" : "c07a2fcc.f886f",
      "x" : 160,
      "wires" : [],
      "z" : "af1cc9bd.91cc08"
   },
   {
      "id" : "d4016f0d.3aa84",
      "server" : "e2a02faf.48099",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "2c685842.4032a8"
         ]
      ],
      "x" : 1250,
      "type" : "api-current-state",
      "entity_id" : "input_boolean.vacation_mode",
      "name" : "Stop if vacation mode on",
      "halt_if" : "on",
      "y" : 1160
   },
   {
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "id" : "572f0e6b.06947",
      "x" : 1810,
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "data" : "{ \"message\": \"msg\" }",
      "service" : "family_iphones",
      "type" : "api-call-service",
      "y" : 1200,
      "name" : "Notify Family"
   },
   {
      "outputs" : 1,
      "type" : "function",
      "name" : "Format message",
      "y" : 1200,
      "id" : "2ea7e80f.67cac8",
      "func" : "msg.payload = { data: {'message': 'Turning on vacation mode for the house. Lighting will randomly simulate occupancy' } };\nreturn msg;",
      "wires" : [
         [
            "572f0e6b.06947"
         ]
      ],
      "x" : 1630,
      "noerr" : 0,
      "z" : "af1cc9bd.91cc08"
   },
   {
      "type" : "function",
      "outputs" : 1,
      "y" : 1260,
      "name" : "Format message",
      "id" : "5f431d3e.b084b4",
      "x" : 1410,
      "wires" : [
         [
            "2ffbe925.4524b6"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "noerr" : 0,
      "func" : "msg.payload = { data: {'message': 'Turning off vacation mode for the house' } };\nreturn msg;"
   },
   {
      "type" : "api-call-service",
      "name" : "Notify Family",
      "y" : 1260,
      "id" : "2ffbe925.4524b6",
      "service_domain" : "notify",
      "server" : "e2a02faf.48099",
      "service" : "family_iphones",
      "data" : "{ \"message\": \"msg\" }",
      "x" : 1590,
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08"
   },
   {
      "type" : "comment",
      "y" : 1440,
      "name" : "Vacation Mode",
      "info" : "",
      "id" : "c9847606.b63c68",
      "z" : "af1cc9bd.91cc08",
      "wires" : [],
      "x" : 100
   },
   {
      "type" : "server-state-changed",
      "name" : "Vacation mode on",
      "haltifstate" : "off",
      "y" : 1480,
      "entityidfilter" : "input_boolean.vacation_mode",
      "id" : "638cfb5d.095cd4",
      "server" : "e2a02faf.48099",
      "wires" : [
         [
            "d469bafa.954918"
         ]
      ],
      "x" : 110,
      "z" : "af1cc9bd.91cc08",
      "entityidfiltertype" : "exact"
   },
   {
      "onPayloadType" : "str",
      "z" : "af1cc9bd.91cc08",
      "fri" : true,
      "disableMax" : false,
      "offPayloadVal" : "off",
      "x" : 750,
      "maxOnHours" : "2",
      "sat" : true,
      "sun" : true,
      "offPayloadType" : "str",
      "minOnHours" : "1",
      "name" : "Outside Lights (Morning)",
      "maxOnMinutes" : "5",
      "lon" : "-92.58254",
      "offTopicVal" : "",
      "wires" : [
         [
            "be04c00f.869a1"
         ]
      ],
      "type" : "vacation-timer",
      "turnOffOnDaysOff" : true,
      "mon" : true,
      "offTime" : "14:00",
      "randMinutes" : "30",
      "midnightSchedule" : true,
      "wed" : true,
      "suspended" : true,
      "onTopicVal" : "",
      "minOnMinutes" : "0",
      "id" : "142be2fb.6aab0d",
      "onTime" : "06:45",
      "onPayloadVal" : "on",
      "randOffMinutes" : "0",
      "stopTab" : "tab-1",
      "thu" : true,
      "lat" : "40.1894",
      "y" : 1400,
      "tue" : true
   },
   {
      "from" : "",
      "id" : "d469bafa.954918",
      "to" : "",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "e707df7f.568a1"
         ]
      ],
      "x" : 320,
      "property" : "",
      "action" : "",
      "type" : "change",
      "rules" : [
         {
            "tot" : "str",
            "t" : "set",
            "to" : "start",
            "pt" : "msg",
            "p" : "payload"
         }
      ],
      "y" : 1480,
      "name" : "Turn on vacation timer",
      "reg" : false
   },
   {
      "server" : "e2a02faf.48099",
      "id" : "525833d.5e201cc",
      "wires" : [
         [
            "4fa4342e.1e84dc"
         ]
      ],
      "x" : 110,
      "entityidfiltertype" : "exact",
      "z" : "af1cc9bd.91cc08",
      "type" : "server-state-changed",
      "name" : "Vacation mode off",
      "haltifstate" : "on",
      "y" : 1520,
      "entityidfilter" : "input_boolean.vacation_mode"
   },
   {
      "type" : "change",
      "rules" : [
         {
            "p" : "payload",
            "pt" : "msg",
            "to" : "stop",
            "tot" : "str",
            "t" : "set"
         }
      ],
      "y" : 1520,
      "name" : "Turn off vacation timer",
      "reg" : false,
      "from" : "",
      "id" : "4fa4342e.1e84dc",
      "to" : "",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "e707df7f.568a1"
         ]
      ],
      "x" : 320,
      "property" : "",
      "action" : ""
   },
   {
      "y" : 1400,
      "mergecontext" : "",
      "name" : "Turn on porch light",
      "type" : "api-call-service",
      "x" : 1150,
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "data" : "{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}",
      "service" : "turn_on",
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "f3120fe2.f5605"
   },
   {
      "id" : "be04c00f.869a1",
      "propertyType" : "msg",
      "property" : "payload",
      "wires" : [
         [
            "f3120fe2.f5605"
         ],
         [
            "3c2f8084.07469"
         ]
      ],
      "x" : 970,
      "z" : "af1cc9bd.91cc08",
      "outputs" : 2,
      "rules" : [
         {
            "v" : "on",
            "vt" : "str",
            "t" : "eq"
         },
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "off"
         }
      ],
      "repair" : false,
      "type" : "switch",
      "checkall" : "true",
      "name" : "",
      "y" : 1420
   },
   {
      "mergecontext" : "",
      "name" : "Turn off porch light",
      "y" : 1440,
      "type" : "api-call-service",
      "data" : "{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}",
      "service" : "turn_off",
      "x" : 1150,
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "id" : "3c2f8084.07469"
   },
   {
      "type" : "api-current-state",
      "entity_id" : "input_boolean.vacation_mode",
      "y" : 1220,
      "halt_if" : "off",
      "name" : "Stop if vacation mode off",
      "id" : "86f0c331.4a6f2",
      "server" : "e2a02faf.48099",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "cce8dc96.40f"
         ]
      ],
      "x" : 990
   },
   {
      "turnOffOnDaysOff" : true,
      "type" : "vacation-timer",
      "offTime" : "14:00",
      "randMinutes" : "55",
      "mon" : true,
      "midnightSchedule" : true,
      "lon" : "-92.58254",
      "wires" : [
         [
            "435c08e5.c24778"
         ]
      ],
      "offTopicVal" : "",
      "stopTab" : "tab-1",
      "lat" : "40.1894",
      "thu" : true,
      "y" : 1480,
      "tue" : true,
      "suspended" : true,
      "wed" : true,
      "onTime" : "dusk",
      "onPayloadVal" : "on",
      "minOnMinutes" : "0",
      "onTopicVal" : "",
      "id" : "71cbc019.18dcf",
      "randOffMinutes" : "0",
      "onPayloadType" : "str",
      "fri" : true,
      "z" : "af1cc9bd.91cc08",
      "offPayloadVal" : "off",
      "disableMax" : false,
      "sun" : false,
      "maxOnHours" : "4",
      "sat" : false,
      "offPayloadType" : "str",
      "minOnHours" : "1",
      "name" : "Main Level Lights (Weekdays)",
      "maxOnMinutes" : "5",
      "x" : 770
   },
   {
      "minOnHours" : "1",
      "name" : "Main Level Lights (Weekends)",
      "maxOnMinutes" : "5",
      "maxOnHours" : "4",
      "sun" : true,
      "sat" : true,
      "offPayloadType" : "str",
      "x" : 770,
      "z" : "af1cc9bd.91cc08",
      "fri" : false,
      "disableMax" : false,
      "offPayloadVal" : "off",
      "onPayloadType" : "str",
      "y" : 1520,
      "tue" : false,
      "stopTab" : "tab-1",
      "lat" : "40.1894",
      "thu" : false,
      "randOffMinutes" : "0",
      "wed" : false,
      "suspended" : true,
      "minOnMinutes" : "0",
      "onTopicVal" : "",
      "id" : "5eb607ae.458bd8",
      "onTime" : "18:00",
      "onPayloadVal" : "on",
      "midnightSchedule" : true,
      "turnOffOnDaysOff" : true,
      "type" : "vacation-timer",
      "mon" : false,
      "offTime" : "14:00",
      "randMinutes" : "55",
      "wires" : [
         [
            "435c08e5.c24778"
         ]
      ],
      "offTopicVal" : "",
      "lon" : "-92.58254"
   },
   {
      "propertyType" : "msg",
      "id" : "e707df7f.568a1",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         [
            "142be2fb.6aab0d",
            "b145e559.73fe38",
            "71cbc019.18dcf",
            "5eb607ae.458bd8",
            "11324451.0c874c",
            "982b9905.e5b908"
         ]
      ],
      "x" : 510,
      "property" : "payload",
      "repair" : false,
      "type" : "switch",
      "outputs" : 1,
      "rules" : [
         {
            "t" : "nnull"
         }
      ],
      "y" : 1500,
      "checkall" : "true",
      "name" : ""
   },
   {
      "x" : 750,
      "sat" : true,
      "sun" : true,
      "maxOnHours" : "5",
      "offPayloadType" : "str",
      "minOnHours" : "3",
      "name" : "Outside Lights (Evening)",
      "maxOnMinutes" : "5",
      "onPayloadType" : "str",
      "z" : "af1cc9bd.91cc08",
      "fri" : true,
      "disableMax" : false,
      "offPayloadVal" : "off",
      "wed" : true,
      "suspended" : true,
      "minOnMinutes" : "0",
      "onTopicVal" : "",
      "id" : "b145e559.73fe38",
      "onPayloadVal" : "on",
      "onTime" : "dusk",
      "randOffMinutes" : "0",
      "stopTab" : "tab-1",
      "thu" : true,
      "lat" : "40.1894",
      "y" : 1440,
      "tue" : true,
      "lon" : "-92.58254",
      "wires" : [
         [
            "be04c00f.869a1"
         ]
      ],
      "offTopicVal" : "",
      "type" : "vacation-timer",
      "turnOffOnDaysOff" : true,
      "mon" : true,
      "offTime" : "14:00",
      "randMinutes" : "30",
      "midnightSchedule" : true
   },
   {
      "repair" : false,
      "type" : "switch",
      "rules" : [
         {
            "v" : "on",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "off"
         }
      ],
      "outputs" : 2,
      "y" : 1500,
      "name" : "",
      "checkall" : "true",
      "propertyType" : "msg",
      "id" : "435c08e5.c24778",
      "wires" : [
         [
            "ad4a15c1.dcc208"
         ],
         [
            "c32c5a22.9fb9b8"
         ]
      ],
      "x" : 970,
      "z" : "af1cc9bd.91cc08",
      "property" : "payload"
   },
   {
      "x" : 740,
      "minOnHours" : "2",
      "name" : "Upstairs (Weekdays)",
      "maxOnMinutes" : "5",
      "sat" : true,
      "maxOnHours" : "4",
      "sun" : true,
      "offPayloadType" : "str",
      "z" : "af1cc9bd.91cc08",
      "fri" : true,
      "disableMax" : false,
      "offPayloadVal" : "off",
      "onPayloadType" : "str",
      "randOffMinutes" : "0",
      "wed" : true,
      "suspended" : true,
      "onTopicVal" : "",
      "minOnMinutes" : "0",
      "id" : "11324451.0c874c",
      "onTime" : "dusk",
      "onPayloadVal" : "on",
      "y" : 1560,
      "tue" : true,
      "stopTab" : "tab-1",
      "thu" : true,
      "lat" : "40.1894",
      "offTopicVal" : "",
      "wires" : [
         [
            "42b63dea.200ea4"
         ]
      ],
      "lon" : "-92.58254",
      "midnightSchedule" : true,
      "turnOffOnDaysOff" : true,
      "type" : "vacation-timer",
      "mon" : true,
      "randMinutes" : "55",
      "offTime" : "14:00"
   },
   {
      "stopTab" : "tab-1",
      "lat" : "40.1894",
      "thu" : false,
      "y" : 1600,
      "tue" : false,
      "wed" : false,
      "suspended" : true,
      "minOnMinutes" : "0",
      "onTopicVal" : "",
      "id" : "982b9905.e5b908",
      "onPayloadVal" : "on",
      "onTime" : "18:00",
      "randOffMinutes" : "0",
      "type" : "vacation-timer",
      "turnOffOnDaysOff" : true,
      "mon" : false,
      "offTime" : "14:00",
      "randMinutes" : "55",
      "midnightSchedule" : true,
      "lon" : "-92.58254",
      "wires" : [
         [
            "42b63dea.200ea4"
         ]
      ],
      "offTopicVal" : "",
      "sat" : true,
      "sun" : true,
      "maxOnHours" : "4",
      "offPayloadType" : "str",
      "minOnHours" : "1",
      "maxOnMinutes" : "5",
      "name" : "Upstairs (Weekends)",
      "x" : 740,
      "onPayloadType" : "str",
      "z" : "af1cc9bd.91cc08",
      "fri" : false,
      "disableMax" : false,
      "offPayloadVal" : "off"
   },
   {
      "propertyType" : "msg",
      "id" : "42b63dea.200ea4",
      "wires" : [
         [
            "f82a98dc.fedf88"
         ],
         [
            "43c9259d.b0dddc"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 970,
      "property" : "payload",
      "type" : "switch",
      "repair" : false,
      "rules" : [
         {
            "v" : "on",
            "t" : "eq",
            "vt" : "str"
         },
         {
            "vt" : "str",
            "t" : "eq",
            "v" : "off"
         }
      ],
      "outputs" : 2,
      "y" : 1580,
      "name" : "",
      "checkall" : "true"
   },
   {
      "type" : "api-call-service",
      "name" : "Main Level Lights on",
      "y" : 1480,
      "service_domain" : "scene",
      "server" : "e2a02faf.48099",
      "id" : "ad4a15c1.dcc208",
      "data" : "{ \"entity_id\": \"scene.main_level_lights\" }",
      "service" : "turn_on",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         []
      ],
      "x" : 1160
   },
   {
      "service_domain" : "scene",
      "server" : "e2a02faf.48099",
      "id" : "c32c5a22.9fb9b8",
      "wires" : [
         []
      ],
      "z" : "af1cc9bd.91cc08",
      "x" : 1160,
      "service" : "turn_off",
      "data" : "{ \"entity_id\": \"scene.main_level_lights\" }",
      "type" : "api-call-service",
      "y" : 1520,
      "mergecontext" : "",
      "name" : "Main Level Lights off"
   },
   {
      "data" : "{ \"entity_id\": \"group.upstairs\" }",
      "service" : "turn_on",
      "wires" : [
         []
      ],
      "x" : 1150,
      "z" : "af1cc9bd.91cc08",
      "server" : "e2a02faf.48099",
      "service_domain" : "light",
      "id" : "f82a98dc.fedf88",
      "mergecontext" : "",
      "name" : "Upstairs Lights on",
      "y" : 1560,
      "type" : "api-call-service"
   },
   {
      "type" : "api-call-service",
      "name" : "Upstairs Lights off",
      "mergecontext" : "",
      "y" : 1600,
      "id" : "43c9259d.b0dddc",
      "service_domain" : "light",
      "server" : "e2a02faf.48099",
      "data" : "{ \"entity_id\": \"group.upstairs\" }",
      "service" : "turn_off",
      "z" : "af1cc9bd.91cc08",
      "wires" : [
         []
      ],
      "x" : 1150
   },
   {
      "wires" : [
         [
            "3a8d7ef3.299a02"
         ]
      ],
      "x" : 120,
      "z" : "8bb76918.ef6b48",
      "entityidfiltertype" : "exact",
      "id" : "b1f98d5a.8be2f",
      "server" : "e2a02faf.48099",
      "name" : "Basement Back Door",
      "y" : 240,
      "haltifstate" : "",
      "entityidfilter" : "sensor.basement_back_door_access_control",
      "type" : "server-state-changed"
   },
   {
      "rate" : "1",
      "wires" : [
         [
            "70241a92.423bd4",
            "2ea7e80f.67cac8"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "randomFirst" : "1",
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "drop" : true,
      "nbRateUnits" : "5",
      "timeoutUnits" : "seconds",
      "id" : "2c685842.4032a8",
      "x" : 1460,
      "timeout" : "5",
      "pauseType" : "rate",
      "rateUnits" : "minute",
      "y" : 1160,
      "name" : ""
   },
   {
      "id" : "cce8dc96.40f",
      "x" : 1200,
      "timeout" : "5",
      "pauseType" : "rate",
      "rateUnits" : "minute",
      "y" : 1220,
      "name" : "",
      "rate" : "1",
      "wires" : [
         [
            "4a2b5571.fe1bdc",
            "5f431d3e.b084b4"
         ]
      ],
      "z" : "af1cc9bd.91cc08",
      "randomFirst" : "1",
      "randomLast" : "5",
      "type" : "delay",
      "randomUnits" : "seconds",
      "nbRateUnits" : "5",
      "drop" : true,
      "timeoutUnits" : "seconds"
   }
]
